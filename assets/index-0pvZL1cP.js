var e,t,s,i=Object.defineProperty,n=(e,t,s)=>((e,t,s)=>t in e?i(e,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[t]=s)(e,"symbol"!=typeof t?t+"":t,s);import{r,g as a}from"./phaser-BUlrDfUd.js";!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver(e=>{for(const s of e)if("childList"===s.type)for(const e of s.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&t(e)}).observe(document,{childList:!0,subtree:!0})}function t(e){if(e.ep)return;e.ep=!0;const t=function(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerPolicy&&(t.referrerPolicy=e.referrerPolicy),"use-credentials"===e.crossOrigin?t.credentials="include":"anonymous"===e.crossOrigin?t.credentials="omit":t.credentials="same-origin",t}(e);fetch(e.href,t)}}();var o=r();function h(e,t,s){function i(s,i){var n;Object.defineProperty(s,"_zod",{value:s._zod??{},enumerable:!1}),(n=s._zod).traits??(n.traits=new Set),s._zod.traits.add(e),t(s,i);for(const e in a.prototype)e in s||Object.defineProperty(s,e,{value:a.prototype[e].bind(s)});s._zod.constr=a,s._zod.def=i}const n=(null==s?void 0:s.Parent)??Object;class r extends n{}function a(e){var t;const n=(null==s?void 0:s.Parent)?new r:this;i(n,e),(t=n._zod).deferred??(t.deferred=[]);for(const s of n._zod.deferred)s();return n}return Object.defineProperty(r,"name",{value:e}),Object.defineProperty(a,"init",{value:i}),Object.defineProperty(a,Symbol.hasInstance,{value:t=>{var i,n;return!!((null==s?void 0:s.Parent)&&t instanceof s.Parent)||(null==(n=null==(i=null==t?void 0:t._zod)?void 0:i.traits)?void 0:n.has(e))}}),Object.defineProperty(a,"name",{value:e}),a}class c extends Error{constructor(){super("Encountered Promise during synchronous parse. Use .parseAsync() instead.")}}class l extends Error{constructor(e){super(`Encountered unidirectional transform during encode: ${e}`),this.name="ZodEncodeError"}}const d={};function u(e){return d}function p(e,t){return"bigint"==typeof t?t.toString():t}function m(e){return{get value(){{const t=e();return Object.defineProperty(this,"value",{value:t}),t}}}}function g(e){return null==e}function f(e){const t=e.startsWith("^")?1:0,s=e.endsWith("$")?e.length-1:e.length;return e.slice(t,s)}const y=Symbol("evaluating");function v(e,t,s){let i;Object.defineProperty(e,t,{get(){if(i!==y)return void 0===i&&(i=y,i=s()),i},set(s){Object.defineProperty(e,t,{value:s})},configurable:!0})}function b(e,t,s){Object.defineProperty(e,t,{value:s,writable:!0,enumerable:!0,configurable:!0})}function w(...e){const t={};for(const s of e){const e=Object.getOwnPropertyDescriptors(s);Object.assign(t,e)}return Object.defineProperties({},t)}function _(e){return JSON.stringify(e)}const x="captureStackTrace"in Error?Error.captureStackTrace:(...e)=>{};function k(e){return"object"==typeof e&&null!==e&&!Array.isArray(e)}const P=m(()=>{var e;if("undefined"!=typeof navigator&&(null==(e=null==navigator?void 0:navigator.userAgent)?void 0:e.includes("Cloudflare")))return!1;try{return new Function(""),!0}catch(t){return!1}});function z(e){if(!1===k(e))return!1;const t=e.constructor;if(void 0===t)return!0;const s=t.prototype;return!1!==k(s)&&!1!==Object.prototype.hasOwnProperty.call(s,"isPrototypeOf")}function S(e){return z(e)?{...e}:Array.isArray(e)?[...e]:e}const I=new Set(["string","number","symbol"]);function T(e){return e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function E(e,t,s){const i=new e._zod.constr(t??e._zod.def);return t&&!(null==s?void 0:s.parent)||(i._zod.parent=e),i}function M(e){const t=e;if(!t)return{};if("string"==typeof t)return{error:()=>t};if(void 0!==(null==t?void 0:t.message)){if(void 0!==(null==t?void 0:t.error))throw new Error("Cannot specify both `message` and `error` params");t.error=t.message}return delete t.message,"string"==typeof t.error?{...t,error:()=>t.error}:t}const O={safeint:[Number.MIN_SAFE_INTEGER,Number.MAX_SAFE_INTEGER],int32:[-2147483648,2147483647],uint32:[0,4294967295],float32:[-34028234663852886e22,34028234663852886e22],float64:[-Number.MAX_VALUE,Number.MAX_VALUE]};function A(e,t=0){var s;if(!0===e.aborted)return!0;for(let i=t;i<e.issues.length;i++)if(!0!==(null==(s=e.issues[i])?void 0:s.continue))return!0;return!1}function $(e,t){return t.map(t=>{var s;return(s=t).path??(s.path=[]),t.path.unshift(e),t})}function C(e){return"string"==typeof e?e:null==e?void 0:e.message}function R(e,t,s){var i,n,r,a,o,h;const c={...e,path:e.path??[]};if(!e.message){const l=C(null==(r=null==(n=null==(i=e.inst)?void 0:i._zod.def)?void 0:n.error)?void 0:r.call(n,e))??C(null==(a=null==t?void 0:t.error)?void 0:a.call(t,e))??C(null==(o=s.customError)?void 0:o.call(s,e))??C(null==(h=s.localeError)?void 0:h.call(s,e))??"Invalid input";c.message=l}return delete c.inst,delete c.continue,(null==t?void 0:t.reportInput)||delete c.input,c}function j(e){return Array.isArray(e)?"array":"string"==typeof e?"string":"unknown"}function F(...e){const[t,s,i]=e;return"string"==typeof t?{message:t,code:"custom",input:s,inst:i}:{...t}}const D=(e,t)=>{e.name="$ZodError",Object.defineProperty(e,"_zod",{value:e._zod,enumerable:!1}),Object.defineProperty(e,"issues",{value:t,enumerable:!1}),e.message=JSON.stringify(t,p,2),Object.defineProperty(e,"toString",{value:()=>e.message,enumerable:!1})},Z=h("$ZodError",D),N=h("$ZodError",D,{Parent:Error}),B=e=>(t,s,i,n)=>{const r=i?Object.assign(i,{async:!1}):{async:!1},a=t._zod.run({value:s,issues:[]},r);if(a instanceof Promise)throw new c;if(a.issues.length){const t=new((null==n?void 0:n.Err)??e)(a.issues.map(e=>R(e,r,u())));throw x(t,null==n?void 0:n.callee),t}return a.value},V=e=>async(t,s,i,n)=>{const r=i?Object.assign(i,{async:!0}):{async:!0};let a=t._zod.run({value:s,issues:[]},r);if(a instanceof Promise&&(a=await a),a.issues.length){const t=new((null==n?void 0:n.Err)??e)(a.issues.map(e=>R(e,r,u())));throw x(t,null==n?void 0:n.callee),t}return a.value},K=e=>(t,s,i)=>{const n=i?{...i,async:!1}:{async:!1},r=t._zod.run({value:s,issues:[]},n);if(r instanceof Promise)throw new c;return r.issues.length?{success:!1,error:new(e??Z)(r.issues.map(e=>R(e,n,u())))}:{success:!0,data:r.value}},U=K(N),L=e=>async(t,s,i)=>{const n=i?Object.assign(i,{async:!0}):{async:!0};let r=t._zod.run({value:s,issues:[]},n);return r instanceof Promise&&(r=await r),r.issues.length?{success:!1,error:new e(r.issues.map(e=>R(e,n,u())))}:{success:!0,data:r.value}},G=L(N),X=e=>(t,s,i)=>{const n=i?Object.assign(i,{direction:"backward"}):{direction:"backward"};return B(e)(t,s,n)},q=e=>(t,s,i)=>B(e)(t,s,i),W=e=>async(t,s,i)=>{const n=i?Object.assign(i,{direction:"backward"}):{direction:"backward"};return V(e)(t,s,n)},H=e=>async(t,s,i)=>V(e)(t,s,i),Y=e=>(t,s,i)=>{const n=i?Object.assign(i,{direction:"backward"}):{direction:"backward"};return K(e)(t,s,n)},J=e=>(t,s,i)=>K(e)(t,s,i),Q=e=>async(t,s,i)=>{const n=i?Object.assign(i,{direction:"backward"}):{direction:"backward"};return L(e)(t,s,n)},ee=e=>async(t,s,i)=>L(e)(t,s,i),te=/^[cC][^\s-]{8,}$/,se=/^[0-9a-z]+$/,ie=/^[0-9A-HJKMNP-TV-Za-hjkmnp-tv-z]{26}$/,ne=/^[0-9a-vA-V]{20}$/,re=/^[A-Za-z0-9]{27}$/,ae=/^[a-zA-Z0-9_-]{21}$/,oe=/^P(?:(\d+W)|(?!.*W)(?=\d|T\d)(\d+Y)?(\d+M)?(\d+D)?(T(?=\d)(\d+H)?(\d+M)?(\d+([.,]\d+)?S)?)?)$/,he=/^([0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{12})$/,ce=e=>e?new RegExp(`^([0-9a-fA-F]{8}-[0-9a-fA-F]{4}-${e}[0-9a-fA-F]{3}-[89abAB][0-9a-fA-F]{3}-[0-9a-fA-F]{12})$`):/^([0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[1-8][0-9a-fA-F]{3}-[89abAB][0-9a-fA-F]{3}-[0-9a-fA-F]{12}|00000000-0000-0000-0000-000000000000|ffffffff-ffff-ffff-ffff-ffffffffffff)$/,le=/^(?!\.)(?!.*\.\.)([A-Za-z0-9_'+\-\.]*)[A-Za-z0-9_+-]@([A-Za-z0-9][A-Za-z0-9\-]*\.)+[A-Za-z]{2,}$/,de=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,ue=/^(([0-9a-fA-F]{1,4}:){7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:))$/,pe=/^((25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/([0-9]|[1-2][0-9]|3[0-2])$/,me=/^(([0-9a-fA-F]{1,4}:){7}[0-9a-fA-F]{1,4}|::|([0-9a-fA-F]{1,4})?::([0-9a-fA-F]{1,4}:?){0,6})\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,ge=/^$|^(?:[0-9a-zA-Z+/]{4})*(?:(?:[0-9a-zA-Z+/]{2}==)|(?:[0-9a-zA-Z+/]{3}=))?$/,fe=/^[A-Za-z0-9_-]*$/,ye=/^(?=.{1,253}\.?$)[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[-0-9a-zA-Z]{0,61}[0-9a-zA-Z])?)*\.?$/,ve=/^\+(?:[0-9]){6,14}[0-9]$/,be="(?:(?:\\d\\d[2468][048]|\\d\\d[13579][26]|\\d\\d0[48]|[02468][048]00|[13579][26]00)-02-29|\\d{4}-(?:(?:0[13578]|1[02])-(?:0[1-9]|[12]\\d|3[01])|(?:0[469]|11)-(?:0[1-9]|[12]\\d|30)|(?:02)-(?:0[1-9]|1\\d|2[0-8])))",we=new RegExp(`^${be}$`);function _e(e){const t="(?:[01]\\d|2[0-3]):[0-5]\\d";return"number"==typeof e.precision?-1===e.precision?`${t}`:0===e.precision?`${t}:[0-5]\\d`:`${t}:[0-5]\\d\\.\\d{${e.precision}}`:`${t}(?::[0-5]\\d(?:\\.\\d+)?)?`}const xe=/^-?\d+$/,ke=/^-?\d+(?:\.\d+)?/,Pe=/^(?:true|false)$/i,ze=/^[^A-Z]*$/,Se=/^[^a-z]*$/,Ie=h("$ZodCheck",(e,t)=>{var s;e._zod??(e._zod={}),e._zod.def=t,(s=e._zod).onattach??(s.onattach=[])}),Te={number:"number",bigint:"bigint",object:"date"},Ee=h("$ZodCheckLessThan",(e,t)=>{Ie.init(e,t);const s=Te[typeof t.value];e._zod.onattach.push(e=>{const s=e._zod.bag,i=(t.inclusive?s.maximum:s.exclusiveMaximum)??Number.POSITIVE_INFINITY;t.value<i&&(t.inclusive?s.maximum=t.value:s.exclusiveMaximum=t.value)}),e._zod.check=i=>{(t.inclusive?i.value<=t.value:i.value<t.value)||i.issues.push({origin:s,code:"too_big",maximum:t.value,input:i.value,inclusive:t.inclusive,inst:e,continue:!t.abort})}}),Me=h("$ZodCheckGreaterThan",(e,t)=>{Ie.init(e,t);const s=Te[typeof t.value];e._zod.onattach.push(e=>{const s=e._zod.bag,i=(t.inclusive?s.minimum:s.exclusiveMinimum)??Number.NEGATIVE_INFINITY;t.value>i&&(t.inclusive?s.minimum=t.value:s.exclusiveMinimum=t.value)}),e._zod.check=i=>{(t.inclusive?i.value>=t.value:i.value>t.value)||i.issues.push({origin:s,code:"too_small",minimum:t.value,input:i.value,inclusive:t.inclusive,inst:e,continue:!t.abort})}}),Oe=h("$ZodCheckMultipleOf",(e,t)=>{Ie.init(e,t),e._zod.onattach.push(e=>{var s;(s=e._zod.bag).multipleOf??(s.multipleOf=t.value)}),e._zod.check=s=>{if(typeof s.value!=typeof t.value)throw new Error("Cannot mix number and bigint in multiple_of check.");("bigint"==typeof s.value?s.value%t.value===BigInt(0):0===function(e,t){const s=(e.toString().split(".")[1]||"").length,i=t.toString();let n=(i.split(".")[1]||"").length;if(0===n&&/\d?e-\d?/.test(i)){const e=i.match(/\d?e-(\d?)/);(null==e?void 0:e[1])&&(n=Number.parseInt(e[1]))}const r=s>n?s:n;return Number.parseInt(e.toFixed(r).replace(".",""))%Number.parseInt(t.toFixed(r).replace(".",""))/10**r}(s.value,t.value))||s.issues.push({origin:typeof s.value,code:"not_multiple_of",divisor:t.value,input:s.value,inst:e,continue:!t.abort})}}),Ae=h("$ZodCheckNumberFormat",(e,t)=>{var s;Ie.init(e,t),t.format=t.format||"float64";const i=null==(s=t.format)?void 0:s.includes("int"),n=i?"int":"number",[r,a]=O[t.format];e._zod.onattach.push(e=>{const s=e._zod.bag;s.format=t.format,s.minimum=r,s.maximum=a,i&&(s.pattern=xe)}),e._zod.check=s=>{const o=s.value;if(i){if(!Number.isInteger(o))return void s.issues.push({expected:n,format:t.format,code:"invalid_type",continue:!1,input:o,inst:e});if(!Number.isSafeInteger(o))return void(o>0?s.issues.push({input:o,code:"too_big",maximum:Number.MAX_SAFE_INTEGER,note:"Integers must be within the safe integer range.",inst:e,origin:n,continue:!t.abort}):s.issues.push({input:o,code:"too_small",minimum:Number.MIN_SAFE_INTEGER,note:"Integers must be within the safe integer range.",inst:e,origin:n,continue:!t.abort}))}o<r&&s.issues.push({origin:"number",input:o,code:"too_small",minimum:r,inclusive:!0,inst:e,continue:!t.abort}),o>a&&s.issues.push({origin:"number",input:o,code:"too_big",maximum:a,inst:e})}}),$e=h("$ZodCheckMaxLength",(e,t)=>{var s;Ie.init(e,t),(s=e._zod.def).when??(s.when=e=>{const t=e.value;return!g(t)&&void 0!==t.length}),e._zod.onattach.push(e=>{const s=e._zod.bag.maximum??Number.POSITIVE_INFINITY;t.maximum<s&&(e._zod.bag.maximum=t.maximum)}),e._zod.check=s=>{const i=s.value;if(i.length<=t.maximum)return;const n=j(i);s.issues.push({origin:n,code:"too_big",maximum:t.maximum,inclusive:!0,input:i,inst:e,continue:!t.abort})}}),Ce=h("$ZodCheckMinLength",(e,t)=>{var s;Ie.init(e,t),(s=e._zod.def).when??(s.when=e=>{const t=e.value;return!g(t)&&void 0!==t.length}),e._zod.onattach.push(e=>{const s=e._zod.bag.minimum??Number.NEGATIVE_INFINITY;t.minimum>s&&(e._zod.bag.minimum=t.minimum)}),e._zod.check=s=>{const i=s.value;if(i.length>=t.minimum)return;const n=j(i);s.issues.push({origin:n,code:"too_small",minimum:t.minimum,inclusive:!0,input:i,inst:e,continue:!t.abort})}}),Re=h("$ZodCheckLengthEquals",(e,t)=>{var s;Ie.init(e,t),(s=e._zod.def).when??(s.when=e=>{const t=e.value;return!g(t)&&void 0!==t.length}),e._zod.onattach.push(e=>{const s=e._zod.bag;s.minimum=t.length,s.maximum=t.length,s.length=t.length}),e._zod.check=s=>{const i=s.value,n=i.length;if(n===t.length)return;const r=j(i),a=n>t.length;s.issues.push({origin:r,...a?{code:"too_big",maximum:t.length}:{code:"too_small",minimum:t.length},inclusive:!0,exact:!0,input:s.value,inst:e,continue:!t.abort})}}),je=h("$ZodCheckStringFormat",(e,t)=>{var s,i;Ie.init(e,t),e._zod.onattach.push(e=>{const s=e._zod.bag;s.format=t.format,t.pattern&&(s.patterns??(s.patterns=new Set),s.patterns.add(t.pattern))}),t.pattern?(s=e._zod).check??(s.check=s=>{t.pattern.lastIndex=0,t.pattern.test(s.value)||s.issues.push({origin:"string",code:"invalid_format",format:t.format,input:s.value,...t.pattern?{pattern:t.pattern.toString()}:{},inst:e,continue:!t.abort})}):(i=e._zod).check??(i.check=()=>{})}),Fe=h("$ZodCheckRegex",(e,t)=>{je.init(e,t),e._zod.check=s=>{t.pattern.lastIndex=0,t.pattern.test(s.value)||s.issues.push({origin:"string",code:"invalid_format",format:"regex",input:s.value,pattern:t.pattern.toString(),inst:e,continue:!t.abort})}}),De=h("$ZodCheckLowerCase",(e,t)=>{t.pattern??(t.pattern=ze),je.init(e,t)}),Ze=h("$ZodCheckUpperCase",(e,t)=>{t.pattern??(t.pattern=Se),je.init(e,t)}),Ne=h("$ZodCheckIncludes",(e,t)=>{Ie.init(e,t);const s=T(t.includes),i=new RegExp("number"==typeof t.position?`^.{${t.position}}${s}`:s);t.pattern=i,e._zod.onattach.push(e=>{const t=e._zod.bag;t.patterns??(t.patterns=new Set),t.patterns.add(i)}),e._zod.check=s=>{s.value.includes(t.includes,t.position)||s.issues.push({origin:"string",code:"invalid_format",format:"includes",includes:t.includes,input:s.value,inst:e,continue:!t.abort})}}),Be=h("$ZodCheckStartsWith",(e,t)=>{Ie.init(e,t);const s=new RegExp(`^${T(t.prefix)}.*`);t.pattern??(t.pattern=s),e._zod.onattach.push(e=>{const t=e._zod.bag;t.patterns??(t.patterns=new Set),t.patterns.add(s)}),e._zod.check=s=>{s.value.startsWith(t.prefix)||s.issues.push({origin:"string",code:"invalid_format",format:"starts_with",prefix:t.prefix,input:s.value,inst:e,continue:!t.abort})}}),Ve=h("$ZodCheckEndsWith",(e,t)=>{Ie.init(e,t);const s=new RegExp(`.*${T(t.suffix)}$`);t.pattern??(t.pattern=s),e._zod.onattach.push(e=>{const t=e._zod.bag;t.patterns??(t.patterns=new Set),t.patterns.add(s)}),e._zod.check=s=>{s.value.endsWith(t.suffix)||s.issues.push({origin:"string",code:"invalid_format",format:"ends_with",suffix:t.suffix,input:s.value,inst:e,continue:!t.abort})}}),Ke=h("$ZodCheckOverwrite",(e,t)=>{Ie.init(e,t),e._zod.check=e=>{e.value=t.tx(e.value)}});class Ue{constructor(e=[]){this.content=[],this.indent=0,this&&(this.args=e)}indented(e){this.indent+=1,e(this),this.indent-=1}write(e){if("function"==typeof e)return e(this,{execution:"sync"}),void e(this,{execution:"async"});const t=e.split("\n").filter(e=>e),s=Math.min(...t.map(e=>e.length-e.trimStart().length)),i=t.map(e=>e.slice(s)).map(e=>" ".repeat(2*this.indent)+e);for(const n of i)this.content.push(n)}compile(){return new Function(...null==this?void 0:this.args,[...((null==this?void 0:this.content)??[""]).map(e=>`  ${e}`)].join("\n"))}}const Le={major:4,minor:1,patch:11},Ge=h("$ZodType",(e,t)=>{var s,i;e??(e={}),e._zod.def=t,e._zod.bag=e._zod.bag||{},e._zod.version=Le;const n=[...e._zod.def.checks??[]];e._zod.traits.has("$ZodCheck")&&n.unshift(e);for(const r of n)for(const t of r._zod.onattach)t(e);if(0===n.length)(i=e._zod).deferred??(i.deferred=[]),null==(s=e._zod.deferred)||s.push(()=>{e._zod.run=e._zod.parse});else{const t=(e,t,s)=>{let i,n=A(e);for(const r of t){if(r._zod.def.when){if(!r._zod.def.when(e))continue}else if(n)continue;const t=e.issues.length,a=r._zod.check(e);if(a instanceof Promise&&!1===(null==s?void 0:s.async))throw new c;if(i||a instanceof Promise)i=(i??Promise.resolve()).then(async()=>{await a,e.issues.length!==t&&(n||(n=A(e,t)))});else{if(e.issues.length===t)continue;n||(n=A(e,t))}}return i?i.then(()=>e):e},s=(s,i,r)=>{if(A(s))return s.aborted=!0,s;const a=t(i,n,r);if(a instanceof Promise){if(!1===r.async)throw new c;return a.then(t=>e._zod.parse(t,r))}return e._zod.parse(a,r)};e._zod.run=(i,r)=>{if(r.skipChecks)return e._zod.parse(i,r);if("backward"===r.direction){const t=e._zod.parse({value:i.value,issues:[]},{...r,skipChecks:!0});return t instanceof Promise?t.then(e=>s(e,i,r)):s(t,i,r)}const a=e._zod.parse(i,r);if(a instanceof Promise){if(!1===r.async)throw new c;return a.then(e=>t(e,n,r))}return t(a,n,r)}}e["~standard"]={validate:t=>{var s;try{const i=U(e,t);return i.success?{value:i.data}:{issues:null==(s=i.error)?void 0:s.issues}}catch(i){return G(e,t).then(e=>{var t;return e.success?{value:e.data}:{issues:null==(t=e.error)?void 0:t.issues}})}},vendor:"zod",version:1}}),Xe=h("$ZodString",(e,t)=>{var s;Ge.init(e,t),e._zod.pattern=[...(null==(s=null==e?void 0:e._zod.bag)?void 0:s.patterns)??[]].pop()??(e=>{const t=e?`[\\s\\S]{${(null==e?void 0:e.minimum)??0},${(null==e?void 0:e.maximum)??""}}`:"[\\s\\S]*";return new RegExp(`^${t}$`)})(e._zod.bag),e._zod.parse=(s,i)=>{if(t.coerce)try{s.value=String(s.value)}catch(n){}return"string"==typeof s.value||s.issues.push({expected:"string",code:"invalid_type",input:s.value,inst:e}),s}}),qe=h("$ZodStringFormat",(e,t)=>{je.init(e,t),Xe.init(e,t)}),We=h("$ZodGUID",(e,t)=>{t.pattern??(t.pattern=he),qe.init(e,t)}),He=h("$ZodUUID",(e,t)=>{if(t.version){const e={v1:1,v2:2,v3:3,v4:4,v5:5,v6:6,v7:7,v8:8}[t.version];if(void 0===e)throw new Error(`Invalid UUID version: "${t.version}"`);t.pattern??(t.pattern=ce(e))}else t.pattern??(t.pattern=ce());qe.init(e,t)}),Ye=h("$ZodEmail",(e,t)=>{t.pattern??(t.pattern=le),qe.init(e,t)}),Je=h("$ZodURL",(e,t)=>{qe.init(e,t),e._zod.check=s=>{try{const i=s.value.trim(),n=new URL(i);return t.hostname&&(t.hostname.lastIndex=0,t.hostname.test(n.hostname)||s.issues.push({code:"invalid_format",format:"url",note:"Invalid hostname",pattern:ye.source,input:s.value,inst:e,continue:!t.abort})),t.protocol&&(t.protocol.lastIndex=0,t.protocol.test(n.protocol.endsWith(":")?n.protocol.slice(0,-1):n.protocol)||s.issues.push({code:"invalid_format",format:"url",note:"Invalid protocol",pattern:t.protocol.source,input:s.value,inst:e,continue:!t.abort})),void(t.normalize?s.value=n.href:s.value=i)}catch(i){s.issues.push({code:"invalid_format",format:"url",input:s.value,inst:e,continue:!t.abort})}}}),Qe=h("$ZodEmoji",(e,t)=>{t.pattern??(t.pattern=new RegExp("^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$","u")),qe.init(e,t)}),et=h("$ZodNanoID",(e,t)=>{t.pattern??(t.pattern=ae),qe.init(e,t)}),tt=h("$ZodCUID",(e,t)=>{t.pattern??(t.pattern=te),qe.init(e,t)}),st=h("$ZodCUID2",(e,t)=>{t.pattern??(t.pattern=se),qe.init(e,t)}),it=h("$ZodULID",(e,t)=>{t.pattern??(t.pattern=ie),qe.init(e,t)}),nt=h("$ZodXID",(e,t)=>{t.pattern??(t.pattern=ne),qe.init(e,t)}),rt=h("$ZodKSUID",(e,t)=>{t.pattern??(t.pattern=re),qe.init(e,t)}),at=h("$ZodISODateTime",(e,t)=>{t.pattern??(t.pattern=function(e){const t=_e({precision:e.precision}),s=["Z"];e.local&&s.push(""),e.offset&&s.push("([+-](?:[01]\\d|2[0-3]):[0-5]\\d)");const i=`${t}(?:${s.join("|")})`;return new RegExp(`^${be}T(?:${i})$`)}(t)),qe.init(e,t)}),ot=h("$ZodISODate",(e,t)=>{t.pattern??(t.pattern=we),qe.init(e,t)}),ht=h("$ZodISOTime",(e,t)=>{t.pattern??(t.pattern=new RegExp(`^${_e(t)}$`)),qe.init(e,t)}),ct=h("$ZodISODuration",(e,t)=>{t.pattern??(t.pattern=oe),qe.init(e,t)}),lt=h("$ZodIPv4",(e,t)=>{t.pattern??(t.pattern=de),qe.init(e,t),e._zod.onattach.push(e=>{e._zod.bag.format="ipv4"})}),dt=h("$ZodIPv6",(e,t)=>{t.pattern??(t.pattern=ue),qe.init(e,t),e._zod.onattach.push(e=>{e._zod.bag.format="ipv6"}),e._zod.check=s=>{try{new URL(`http://[${s.value}]`)}catch{s.issues.push({code:"invalid_format",format:"ipv6",input:s.value,inst:e,continue:!t.abort})}}}),ut=h("$ZodCIDRv4",(e,t)=>{t.pattern??(t.pattern=pe),qe.init(e,t)}),pt=h("$ZodCIDRv6",(e,t)=>{t.pattern??(t.pattern=me),qe.init(e,t),e._zod.check=s=>{const i=s.value.split("/");try{if(2!==i.length)throw new Error;const[e,t]=i;if(!t)throw new Error;const s=Number(t);if(`${s}`!==t)throw new Error;if(s<0||s>128)throw new Error;new URL(`http://[${e}]`)}catch{s.issues.push({code:"invalid_format",format:"cidrv6",input:s.value,inst:e,continue:!t.abort})}}});function mt(e){if(""===e)return!0;if(e.length%4!=0)return!1;try{return atob(e),!0}catch{return!1}}const gt=h("$ZodBase64",(e,t)=>{t.pattern??(t.pattern=ge),qe.init(e,t),e._zod.onattach.push(e=>{e._zod.bag.contentEncoding="base64"}),e._zod.check=s=>{mt(s.value)||s.issues.push({code:"invalid_format",format:"base64",input:s.value,inst:e,continue:!t.abort})}}),ft=h("$ZodBase64URL",(e,t)=>{t.pattern??(t.pattern=fe),qe.init(e,t),e._zod.onattach.push(e=>{e._zod.bag.contentEncoding="base64url"}),e._zod.check=s=>{(function(e){if(!fe.test(e))return!1;const t=e.replace(/[-_]/g,e=>"-"===e?"+":"/");return mt(t.padEnd(4*Math.ceil(t.length/4),"="))})(s.value)||s.issues.push({code:"invalid_format",format:"base64url",input:s.value,inst:e,continue:!t.abort})}}),yt=h("$ZodE164",(e,t)=>{t.pattern??(t.pattern=ve),qe.init(e,t)}),vt=h("$ZodJWT",(e,t)=>{qe.init(e,t),e._zod.check=s=>{(function(e,t=null){try{const s=e.split(".");if(3!==s.length)return!1;const[i]=s;if(!i)return!1;const n=JSON.parse(atob(i));return!("typ"in n&&"JWT"!==(null==n?void 0:n.typ)||!n.alg||t&&(!("alg"in n)||n.alg!==t))}catch{return!1}})(s.value,t.alg)||s.issues.push({code:"invalid_format",format:"jwt",input:s.value,inst:e,continue:!t.abort})}}),bt=h("$ZodNumber",(e,t)=>{Ge.init(e,t),e._zod.pattern=e._zod.bag.pattern??ke,e._zod.parse=(s,i)=>{if(t.coerce)try{s.value=Number(s.value)}catch(a){}const n=s.value;if("number"==typeof n&&!Number.isNaN(n)&&Number.isFinite(n))return s;const r="number"==typeof n?Number.isNaN(n)?"NaN":Number.isFinite(n)?void 0:"Infinity":void 0;return s.issues.push({expected:"number",code:"invalid_type",input:n,inst:e,...r?{received:r}:{}}),s}}),wt=h("$ZodNumber",(e,t)=>{Ae.init(e,t),bt.init(e,t)}),_t=h("$ZodBoolean",(e,t)=>{Ge.init(e,t),e._zod.pattern=Pe,e._zod.parse=(s,i)=>{if(t.coerce)try{s.value=Boolean(s.value)}catch(r){}const n=s.value;return"boolean"==typeof n||s.issues.push({expected:"boolean",code:"invalid_type",input:n,inst:e}),s}}),xt=h("$ZodUnknown",(e,t)=>{Ge.init(e,t),e._zod.parse=e=>e}),kt=h("$ZodNever",(e,t)=>{Ge.init(e,t),e._zod.parse=(t,s)=>(t.issues.push({expected:"never",code:"invalid_type",input:t.value,inst:e}),t)});function Pt(e,t,s){e.issues.length&&t.issues.push(...$(s,e.issues)),t.value[s]=e.value}const zt=h("$ZodArray",(e,t)=>{Ge.init(e,t),e._zod.parse=(s,i)=>{const n=s.value;if(!Array.isArray(n))return s.issues.push({expected:"array",code:"invalid_type",input:n,inst:e}),s;s.value=Array(n.length);const r=[];for(let e=0;e<n.length;e++){const a=n[e],o=t.element._zod.run({value:a,issues:[]},i);o instanceof Promise?r.push(o.then(t=>Pt(t,s,e))):Pt(o,s,e)}return r.length?Promise.all(r).then(()=>s):s}});function St(e,t,s,i){e.issues.length&&t.issues.push(...$(s,e.issues)),void 0===e.value?s in i&&(t.value[s]=void 0):t.value[s]=e.value}function It(e){var t,s,i,n;const r=Object.keys(e.shape);for(const h of r)if(!(null==(n=null==(i=null==(s=null==(t=e.shape)?void 0:t[h])?void 0:s._zod)?void 0:i.traits)?void 0:n.has("$ZodType")))throw new Error(`Invalid element at key "${h}": expected a Zod schema`);const a=(o=e.shape,Object.keys(o).filter(e=>"optional"===o[e]._zod.optin&&"optional"===o[e]._zod.optout));var o;return{...e,keys:r,keySet:new Set(r),numKeys:r.length,optionalKeys:new Set(a)}}function Tt(e,t,s,i,n,r){const a=[],o=n.keySet,h=n.catchall._zod,c=h.def.type;for(const l of Object.keys(t)){if(o.has(l))continue;if("never"===c){a.push(l);continue}const n=h.run({value:t[l],issues:[]},i);n instanceof Promise?e.push(n.then(e=>St(e,s,l,t))):St(n,s,l,t)}return a.length&&s.issues.push({code:"unrecognized_keys",keys:a,input:t,inst:r}),e.length?Promise.all(e).then(()=>s):s}const Et=h("$ZodObject",(e,t)=>{Ge.init(e,t);const s=Object.getOwnPropertyDescriptor(t,"shape");if(!(null==s?void 0:s.get)){const e=t.shape;Object.defineProperty(t,"shape",{get:()=>{const s={...e};return Object.defineProperty(t,"shape",{value:s}),s}})}const i=m(()=>It(t));v(e._zod,"propValues",()=>{const e=t.shape,s={};for(const t in e){const i=e[t]._zod;if(i.values){s[t]??(s[t]=new Set);for(const e of i.values)s[t].add(e)}}return s});const n=k,r=t.catchall;let a;e._zod.parse=(t,s)=>{a??(a=i.value);const o=t.value;if(!n(o))return t.issues.push({expected:"object",code:"invalid_type",input:o,inst:e}),t;t.value={};const h=[],c=a.shape;for(const e of a.keys){const i=c[e]._zod.run({value:o[e],issues:[]},s);i instanceof Promise?h.push(i.then(s=>St(s,t,e,o))):St(i,t,e,o)}return r?Tt(h,o,t,s,i.value,e):h.length?Promise.all(h).then(()=>t):t}}),Mt=h("$ZodObjectJIT",(e,t)=>{Et.init(e,t);const s=e._zod.parse,i=m(()=>It(t));let n;const r=k,a=!d.jitless,o=a&&P.value,h=t.catchall;let c;e._zod.parse=(l,d)=>{c??(c=i.value);const u=l.value;return r(u)?a&&o&&!1===(null==d?void 0:d.async)&&!0!==d.jitless?(n||(n=(e=>{const t=new Ue(["shape","payload","ctx"]),s=i.value,n=e=>{const t=_(e);return`shape[${t}]._zod.run({ value: input[${t}], issues: [] }, ctx)`};t.write("const input = payload.value;");const r=Object.create(null);let a=0;for(const i of s.keys)r[i]="key_"+a++;t.write("const newResult = {};");for(const i of s.keys){const e=r[i],s=_(i);t.write(`const ${e} = ${n(i)};`),t.write(`\n        if (${e}.issues.length) {\n          payload.issues = payload.issues.concat(${e}.issues.map(iss => ({\n            ...iss,\n            path: iss.path ? [${s}, ...iss.path] : [${s}]\n          })));\n        }\n        \n        \n        if (${e}.value === undefined) {\n          if (${s} in input) {\n            newResult[${s}] = undefined;\n          }\n        } else {\n          newResult[${s}] = ${e}.value;\n        }\n        \n      `)}t.write("payload.value = newResult;"),t.write("return payload;");const o=t.compile();return(t,s)=>o(e,t,s)})(t.shape)),l=n(l,d),h?Tt([],u,l,d,c,e):l):s(l,d):(l.issues.push({expected:"object",code:"invalid_type",input:u,inst:e}),l)}});function Ot(e,t,s,i){for(const r of e)if(0===r.issues.length)return t.value=r.value,t;const n=e.filter(e=>!A(e));return 1===n.length?(t.value=n[0].value,n[0]):(t.issues.push({code:"invalid_union",input:t.value,inst:s,errors:e.map(e=>e.issues.map(e=>R(e,i,u())))}),t)}const At=h("$ZodUnion",(e,t)=>{Ge.init(e,t),v(e._zod,"optin",()=>t.options.some(e=>"optional"===e._zod.optin)?"optional":void 0),v(e._zod,"optout",()=>t.options.some(e=>"optional"===e._zod.optout)?"optional":void 0),v(e._zod,"values",()=>{if(t.options.every(e=>e._zod.values))return new Set(t.options.flatMap(e=>Array.from(e._zod.values)))}),v(e._zod,"pattern",()=>{if(t.options.every(e=>e._zod.pattern)){const e=t.options.map(e=>e._zod.pattern);return new RegExp(`^(${e.map(e=>f(e.source)).join("|")})$`)}});const s=1===t.options.length,i=t.options[0]._zod.run;e._zod.parse=(n,r)=>{if(s)return i(n,r);let a=!1;const o=[];for(const e of t.options){const t=e._zod.run({value:n.value,issues:[]},r);if(t instanceof Promise)o.push(t),a=!0;else{if(0===t.issues.length)return t;o.push(t)}}return a?Promise.all(o).then(t=>Ot(t,n,e,r)):Ot(o,n,e,r)}}),$t=h("$ZodIntersection",(e,t)=>{Ge.init(e,t),e._zod.parse=(e,s)=>{const i=e.value,n=t.left._zod.run({value:i,issues:[]},s),r=t.right._zod.run({value:i,issues:[]},s);return n instanceof Promise||r instanceof Promise?Promise.all([n,r]).then(([t,s])=>Rt(e,t,s)):Rt(e,n,r)}});function Ct(e,t){if(e===t)return{valid:!0,data:e};if(e instanceof Date&&t instanceof Date&&+e===+t)return{valid:!0,data:e};if(z(e)&&z(t)){const s=Object.keys(t),i=Object.keys(e).filter(e=>-1!==s.indexOf(e)),n={...e,...t};for(const r of i){const s=Ct(e[r],t[r]);if(!s.valid)return{valid:!1,mergeErrorPath:[r,...s.mergeErrorPath]};n[r]=s.data}return{valid:!0,data:n}}if(Array.isArray(e)&&Array.isArray(t)){if(e.length!==t.length)return{valid:!1,mergeErrorPath:[]};const s=[];for(let i=0;i<e.length;i++){const n=Ct(e[i],t[i]);if(!n.valid)return{valid:!1,mergeErrorPath:[i,...n.mergeErrorPath]};s.push(n.data)}return{valid:!0,data:s}}return{valid:!1,mergeErrorPath:[]}}function Rt(e,t,s){if(t.issues.length&&e.issues.push(...t.issues),s.issues.length&&e.issues.push(...s.issues),A(e))return e;const i=Ct(t.value,s.value);if(!i.valid)throw new Error(`Unmergable intersection. Error path: ${JSON.stringify(i.mergeErrorPath)}`);return e.value=i.data,e}const jt=h("$ZodEnum",(e,t)=>{Ge.init(e,t);const s=function(e){const t=Object.values(e).filter(e=>"number"==typeof e);return Object.entries(e).filter(([e,s])=>-1===t.indexOf(+e)).map(([e,t])=>t)}(t.entries),i=new Set(s);e._zod.values=i,e._zod.pattern=new RegExp(`^(${s.filter(e=>I.has(typeof e)).map(e=>"string"==typeof e?T(e):e.toString()).join("|")})$`),e._zod.parse=(t,n)=>{const r=t.value;return i.has(r)||t.issues.push({code:"invalid_value",values:s,input:r,inst:e}),t}}),Ft=h("$ZodTransform",(e,t)=>{Ge.init(e,t),e._zod.parse=(s,i)=>{if("backward"===i.direction)throw new l(e.constructor.name);const n=t.transform(s.value,s);if(i.async)return(n instanceof Promise?n:Promise.resolve(n)).then(e=>(s.value=e,s));if(n instanceof Promise)throw new c;return s.value=n,s}});function Dt(e,t){return e.issues.length&&void 0===t?{issues:[],value:void 0}:e}const Zt=h("$ZodOptional",(e,t)=>{Ge.init(e,t),e._zod.optin="optional",e._zod.optout="optional",v(e._zod,"values",()=>t.innerType._zod.values?new Set([...t.innerType._zod.values,void 0]):void 0),v(e._zod,"pattern",()=>{const e=t.innerType._zod.pattern;return e?new RegExp(`^(${f(e.source)})?$`):void 0}),e._zod.parse=(e,s)=>{if("optional"===t.innerType._zod.optin){const i=t.innerType._zod.run(e,s);return i instanceof Promise?i.then(t=>Dt(t,e.value)):Dt(i,e.value)}return void 0===e.value?e:t.innerType._zod.run(e,s)}}),Nt=h("$ZodNullable",(e,t)=>{Ge.init(e,t),v(e._zod,"optin",()=>t.innerType._zod.optin),v(e._zod,"optout",()=>t.innerType._zod.optout),v(e._zod,"pattern",()=>{const e=t.innerType._zod.pattern;return e?new RegExp(`^(${f(e.source)}|null)$`):void 0}),v(e._zod,"values",()=>t.innerType._zod.values?new Set([...t.innerType._zod.values,null]):void 0),e._zod.parse=(e,s)=>null===e.value?e:t.innerType._zod.run(e,s)}),Bt=h("$ZodDefault",(e,t)=>{Ge.init(e,t),e._zod.optin="optional",v(e._zod,"values",()=>t.innerType._zod.values),e._zod.parse=(e,s)=>{if("backward"===s.direction)return t.innerType._zod.run(e,s);if(void 0===e.value)return e.value=t.defaultValue,e;const i=t.innerType._zod.run(e,s);return i instanceof Promise?i.then(e=>Vt(e,t)):Vt(i,t)}});function Vt(e,t){return void 0===e.value&&(e.value=t.defaultValue),e}const Kt=h("$ZodPrefault",(e,t)=>{Ge.init(e,t),e._zod.optin="optional",v(e._zod,"values",()=>t.innerType._zod.values),e._zod.parse=(e,s)=>("backward"===s.direction||void 0===e.value&&(e.value=t.defaultValue),t.innerType._zod.run(e,s))}),Ut=h("$ZodNonOptional",(e,t)=>{Ge.init(e,t),v(e._zod,"values",()=>{const e=t.innerType._zod.values;return e?new Set([...e].filter(e=>void 0!==e)):void 0}),e._zod.parse=(s,i)=>{const n=t.innerType._zod.run(s,i);return n instanceof Promise?n.then(t=>Lt(t,e)):Lt(n,e)}});function Lt(e,t){return e.issues.length||void 0!==e.value||e.issues.push({code:"invalid_type",expected:"nonoptional",input:e.value,inst:t}),e}const Gt=h("$ZodCatch",(e,t)=>{Ge.init(e,t),v(e._zod,"optin",()=>t.innerType._zod.optin),v(e._zod,"optout",()=>t.innerType._zod.optout),v(e._zod,"values",()=>t.innerType._zod.values),e._zod.parse=(e,s)=>{if("backward"===s.direction)return t.innerType._zod.run(e,s);const i=t.innerType._zod.run(e,s);return i instanceof Promise?i.then(i=>(e.value=i.value,i.issues.length&&(e.value=t.catchValue({...e,error:{issues:i.issues.map(e=>R(e,s,u()))},input:e.value}),e.issues=[]),e)):(e.value=i.value,i.issues.length&&(e.value=t.catchValue({...e,error:{issues:i.issues.map(e=>R(e,s,u()))},input:e.value}),e.issues=[]),e)}}),Xt=h("$ZodPipe",(e,t)=>{Ge.init(e,t),v(e._zod,"values",()=>t.in._zod.values),v(e._zod,"optin",()=>t.in._zod.optin),v(e._zod,"optout",()=>t.out._zod.optout),v(e._zod,"propValues",()=>t.in._zod.propValues),e._zod.parse=(e,s)=>{if("backward"===s.direction){const i=t.out._zod.run(e,s);return i instanceof Promise?i.then(e=>qt(e,t.in,s)):qt(i,t.in,s)}const i=t.in._zod.run(e,s);return i instanceof Promise?i.then(e=>qt(e,t.out,s)):qt(i,t.out,s)}});function qt(e,t,s){return e.issues.length?(e.aborted=!0,e):t._zod.run({value:e.value,issues:e.issues},s)}const Wt=h("$ZodReadonly",(e,t)=>{Ge.init(e,t),v(e._zod,"propValues",()=>t.innerType._zod.propValues),v(e._zod,"values",()=>t.innerType._zod.values),v(e._zod,"optin",()=>t.innerType._zod.optin),v(e._zod,"optout",()=>t.innerType._zod.optout),e._zod.parse=(e,s)=>{if("backward"===s.direction)return t.innerType._zod.run(e,s);const i=t.innerType._zod.run(e,s);return i instanceof Promise?i.then(Ht):Ht(i)}});function Ht(e){return e.value=Object.freeze(e.value),e}const Yt=h("$ZodCustom",(e,t)=>{Ie.init(e,t),Ge.init(e,t),e._zod.parse=(e,t)=>e,e._zod.check=s=>{const i=s.value,n=t.fn(i);if(n instanceof Promise)return n.then(t=>Jt(t,s,i,e));Jt(n,s,i,e)}});function Jt(e,t,s,i){if(!e){const e={code:"custom",input:s,inst:i,path:[...i._zod.def.path??[]],continue:!i._zod.def.abort};i._zod.def.params&&(e.params=i._zod.def.params),t.issues.push(F(e))}}class Qt{constructor(){this._map=new WeakMap,this._idmap=new Map}add(e,...t){const s=t[0];if(this._map.set(e,s),s&&"object"==typeof s&&"id"in s){if(this._idmap.has(s.id))throw new Error(`ID ${s.id} already exists in the registry`);this._idmap.set(s.id,e)}return this}clear(){return this._map=new WeakMap,this._idmap=new Map,this}remove(e){const t=this._map.get(e);return t&&"object"==typeof t&&"id"in t&&this._idmap.delete(t.id),this._map.delete(e),this}get(e){const t=e._zod.parent;if(t){const s={...this.get(t)??{}};delete s.id;const i={...s,...this._map.get(e)};return Object.keys(i).length?i:void 0}return this._map.get(e)}has(e){return this._map.has(e)}}function es(){return new Qt}const ts=es();function ss(e,t){return new e({type:"string",format:"guid",check:"string_format",abort:!1,...M(t)})}function is(e,t){return new Ee({check:"less_than",...M(t),value:e,inclusive:!1})}function ns(e,t){return new Ee({check:"less_than",...M(t),value:e,inclusive:!0})}function rs(e,t){return new Me({check:"greater_than",...M(t),value:e,inclusive:!1})}function as(e,t){return new Me({check:"greater_than",...M(t),value:e,inclusive:!0})}function os(e,t){return new Oe({check:"multiple_of",...M(t),value:e})}function hs(e,t){return new $e({check:"max_length",...M(t),maximum:e})}function cs(e,t){return new Ce({check:"min_length",...M(t),minimum:e})}function ls(e,t){return new Re({check:"length_equals",...M(t),length:e})}function ds(e){return new Ke({check:"overwrite",tx:e})}const us=h("ZodISODateTime",(e,t)=>{at.init(e,t),As.init(e,t)});const ps=h("ZodISODate",(e,t)=>{ot.init(e,t),As.init(e,t)});const ms=h("ZodISOTime",(e,t)=>{ht.init(e,t),As.init(e,t)});const gs=h("ZodISODuration",(e,t)=>{ct.init(e,t),As.init(e,t)});const fs=h("ZodError",(e,t)=>{Z.init(e,t),e.name="ZodError",Object.defineProperties(e,{format:{value:t=>function(e,t){const s=t||function(e){return e.message},i={_errors:[]},n=e=>{for(const t of e.issues)if("invalid_union"===t.code&&t.errors.length)t.errors.map(e=>n({issues:e}));else if("invalid_key"===t.code)n({issues:t.issues});else if("invalid_element"===t.code)n({issues:t.issues});else if(0===t.path.length)i._errors.push(s(t));else{let e=i,n=0;for(;n<t.path.length;){const i=t.path[n];n===t.path.length-1?(e[i]=e[i]||{_errors:[]},e[i]._errors.push(s(t))):e[i]=e[i]||{_errors:[]},e=e[i],n++}}};return n(e),i}(e,t)},flatten:{value:t=>function(e,t=e=>e.message){const s={},i=[];for(const n of e.issues)n.path.length>0?(s[n.path[0]]=s[n.path[0]]||[],s[n.path[0]].push(t(n))):i.push(t(n));return{formErrors:i,fieldErrors:s}}(e,t)},addIssue:{value:t=>{e.issues.push(t),e.message=JSON.stringify(e.issues,p,2)}},addIssues:{value:t=>{e.issues.push(...t),e.message=JSON.stringify(e.issues,p,2)}},isEmpty:{get:()=>0===e.issues.length}})},{Parent:Error}),ys=B(fs),vs=V(fs),bs=K(fs),ws=L(fs),_s=X(fs),xs=q(fs),ks=W(fs),Ps=H(fs),zs=Y(fs),Ss=J(fs),Is=Q(fs),Ts=ee(fs),Es=h("ZodType",(e,t)=>(Ge.init(e,t),e.def=t,e.type=t.type,Object.defineProperty(e,"_def",{value:t}),e.check=(...s)=>e.clone(w(t,{checks:[...t.checks??[],...s.map(e=>"function"==typeof e?{_zod:{check:e,def:{check:"custom"},onattach:[]}}:e)]})),e.clone=(t,s)=>E(e,t,s),e.brand=()=>e,e.register=(t,s)=>(t.add(e,s),e),e.parse=(t,s)=>ys(e,t,s,{callee:e.parse}),e.safeParse=(t,s)=>bs(e,t,s),e.parseAsync=async(t,s)=>vs(e,t,s,{callee:e.parseAsync}),e.safeParseAsync=async(t,s)=>ws(e,t,s),e.spa=e.safeParseAsync,e.encode=(t,s)=>_s(e,t,s),e.decode=(t,s)=>xs(e,t,s),e.encodeAsync=async(t,s)=>ks(e,t,s),e.decodeAsync=async(t,s)=>Ps(e,t,s),e.safeEncode=(t,s)=>zs(e,t,s),e.safeDecode=(t,s)=>Ss(e,t,s),e.safeEncodeAsync=async(t,s)=>Is(e,t,s),e.safeDecodeAsync=async(t,s)=>Ts(e,t,s),e.refine=(t,s)=>e.check(function(e,t={}){return function(e,t,s){return new zi({type:"custom",check:"custom",fn:t,...M(s)})}(0,e,t)}(t,s)),e.superRefine=t=>e.check(function(e){const t=function(e){const t=new Ie({check:"custom",...M(void 0)});return t._zod.check=e,t}(s=>(s.addIssue=e=>{if("string"==typeof e)s.issues.push(F(e,s.value,t._zod.def));else{const i=e;i.fatal&&(i.continue=!1),i.code??(i.code="custom"),i.input??(i.input=s.value),i.inst??(i.inst=t),i.continue??(i.continue=!t._zod.def.abort),s.issues.push(F(i))}},e(s.value,s)));return t}(t)),e.overwrite=t=>e.check(ds(t)),e.optional=()=>gi(e),e.nullable=()=>yi(e),e.nullish=()=>gi(yi(e)),e.nonoptional=t=>function(e,t){return new wi({type:"nonoptional",innerType:e,...M(t)})}(e,t),e.array=()=>function(e,t,s){return new hi({type:"array",element:t,...M(s)})}(0,e,undefined),e.or=t=>new li({type:"union",options:[e,t],...M(undefined)}),e.and=t=>new di({type:"intersection",left:e,right:t}),e.transform=t=>ki(e,new pi({type:"transform",transform:t})),e.default=t=>{return s=t,new vi({type:"default",innerType:e,get defaultValue(){return"function"==typeof s?s():S(s)}});var s},e.prefault=t=>{return s=t,new bi({type:"prefault",innerType:e,get defaultValue(){return"function"==typeof s?s():S(s)}});var s},e.catch=t=>{return new _i({type:"catch",innerType:e,catchValue:"function"==typeof(s=t)?s:()=>s});var s},e.pipe=t=>ki(e,t),e.readonly=()=>new Pi({type:"readonly",innerType:e}),e.describe=t=>{const s=e.clone();return ts.add(s,{description:t}),s},Object.defineProperty(e,"description",{get(){var t;return null==(t=ts.get(e))?void 0:t.description},configurable:!0}),e.meta=(...t)=>{if(0===t.length)return ts.get(e);const s=e.clone();return ts.add(s,t[0]),s},e.isOptional=()=>e.safeParse(void 0).success,e.isNullable=()=>e.safeParse(null).success,e)),Ms=h("_ZodString",(e,t)=>{Xe.init(e,t),Es.init(e,t);const s=e._zod.bag;e.format=s.format??null,e.minLength=s.minimum??null,e.maxLength=s.maximum??null,e.regex=(...t)=>e.check(function(e,t){return new Fe({check:"string_format",format:"regex",...M(t),pattern:e})}(...t)),e.includes=(...t)=>e.check(function(e,t){return new Ne({check:"string_format",format:"includes",...M(t),includes:e})}(...t)),e.startsWith=(...t)=>e.check(function(e,t){return new Be({check:"string_format",format:"starts_with",...M(t),prefix:e})}(...t)),e.endsWith=(...t)=>e.check(function(e,t){return new Ve({check:"string_format",format:"ends_with",...M(t),suffix:e})}(...t)),e.min=(...t)=>e.check(cs(...t)),e.max=(...t)=>e.check(hs(...t)),e.length=(...t)=>e.check(ls(...t)),e.nonempty=(...t)=>e.check(cs(1,...t)),e.lowercase=t=>e.check(function(e){return new De({check:"string_format",format:"lowercase",...M(e)})}(t)),e.uppercase=t=>e.check(function(e){return new Ze({check:"string_format",format:"uppercase",...M(e)})}(t)),e.trim=()=>e.check(ds(e=>e.trim())),e.normalize=(...t)=>e.check(function(e){return ds(t=>t.normalize(e))}(...t)),e.toLowerCase=()=>e.check(ds(e=>e.toLowerCase())),e.toUpperCase=()=>e.check(ds(e=>e.toUpperCase()))}),Os=h("ZodString",(e,t)=>{Xe.init(e,t),Ms.init(e,t),e.email=t=>e.check(function(e,t){return new $s({type:"string",format:"email",check:"string_format",abort:!1,...M(t)})}(0,t)),e.url=t=>e.check(function(e,t){return new js({type:"string",format:"url",check:"string_format",abort:!1,...M(t)})}(0,t)),e.jwt=t=>e.check(function(e,t){return new Ys({type:"string",format:"jwt",check:"string_format",abort:!1,...M(t)})}(0,t)),e.emoji=t=>e.check(function(e,t){return new Fs({type:"string",format:"emoji",check:"string_format",abort:!1,...M(t)})}(0,t)),e.guid=t=>e.check(ss(Cs,t)),e.uuid=t=>e.check(function(e,t){return new Rs({type:"string",format:"uuid",check:"string_format",abort:!1,...M(t)})}(0,t)),e.uuidv4=t=>e.check(function(e,t){return new Rs({type:"string",format:"uuid",check:"string_format",abort:!1,version:"v4",...M(t)})}(0,t)),e.uuidv6=t=>e.check(function(e,t){return new Rs({type:"string",format:"uuid",check:"string_format",abort:!1,version:"v6",...M(t)})}(0,t)),e.uuidv7=t=>e.check(function(e,t){return new Rs({type:"string",format:"uuid",check:"string_format",abort:!1,version:"v7",...M(t)})}(0,t)),e.nanoid=t=>e.check(function(e,t){return new Ds({type:"string",format:"nanoid",check:"string_format",abort:!1,...M(t)})}(0,t)),e.guid=t=>e.check(ss(Cs,t)),e.cuid=t=>e.check(function(e,t){return new Zs({type:"string",format:"cuid",check:"string_format",abort:!1,...M(t)})}(0,t)),e.cuid2=t=>e.check(function(e,t){return new Ns({type:"string",format:"cuid2",check:"string_format",abort:!1,...M(t)})}(0,t)),e.ulid=t=>e.check(function(e,t){return new Bs({type:"string",format:"ulid",check:"string_format",abort:!1,...M(t)})}(0,t)),e.base64=t=>e.check(function(e,t){return new qs({type:"string",format:"base64",check:"string_format",abort:!1,...M(t)})}(0,t)),e.base64url=t=>e.check(function(e,t){return new Ws({type:"string",format:"base64url",check:"string_format",abort:!1,...M(t)})}(0,t)),e.xid=t=>e.check(function(e,t){return new Vs({type:"string",format:"xid",check:"string_format",abort:!1,...M(t)})}(0,t)),e.ksuid=t=>e.check(function(e,t){return new Ks({type:"string",format:"ksuid",check:"string_format",abort:!1,...M(t)})}(0,t)),e.ipv4=t=>e.check(function(e,t){return new Us({type:"string",format:"ipv4",check:"string_format",abort:!1,...M(t)})}(0,t)),e.ipv6=t=>e.check(function(e,t){return new Ls({type:"string",format:"ipv6",check:"string_format",abort:!1,...M(t)})}(0,t)),e.cidrv4=t=>e.check(function(e,t){return new Gs({type:"string",format:"cidrv4",check:"string_format",abort:!1,...M(t)})}(0,t)),e.cidrv6=t=>e.check(function(e,t){return new Xs({type:"string",format:"cidrv6",check:"string_format",abort:!1,...M(t)})}(0,t)),e.e164=t=>e.check(function(e,t){return new Hs({type:"string",format:"e164",check:"string_format",abort:!1,...M(t)})}(0,t)),e.datetime=t=>e.check(function(e){return function(e,t){return new us({type:"string",format:"datetime",check:"string_format",offset:!1,local:!1,precision:null,...M(t)})}(0,e)}(t)),e.date=t=>e.check(function(e){return function(e,t){return new ps({type:"string",format:"date",check:"string_format",...M(t)})}(0,e)}(t)),e.time=t=>e.check(function(e){return function(e,t){return new ms({type:"string",format:"time",check:"string_format",precision:null,...M(t)})}(0,e)}(t)),e.duration=t=>e.check(function(e){return function(e,t){return new gs({type:"string",format:"duration",check:"string_format",...M(t)})}(0,e)}(t))}),As=h("ZodStringFormat",(e,t)=>{qe.init(e,t),Ms.init(e,t)}),$s=h("ZodEmail",(e,t)=>{Ye.init(e,t),As.init(e,t)}),Cs=h("ZodGUID",(e,t)=>{We.init(e,t),As.init(e,t)}),Rs=h("ZodUUID",(e,t)=>{He.init(e,t),As.init(e,t)}),js=h("ZodURL",(e,t)=>{Je.init(e,t),As.init(e,t)}),Fs=h("ZodEmoji",(e,t)=>{Qe.init(e,t),As.init(e,t)}),Ds=h("ZodNanoID",(e,t)=>{et.init(e,t),As.init(e,t)}),Zs=h("ZodCUID",(e,t)=>{tt.init(e,t),As.init(e,t)}),Ns=h("ZodCUID2",(e,t)=>{st.init(e,t),As.init(e,t)}),Bs=h("ZodULID",(e,t)=>{it.init(e,t),As.init(e,t)}),Vs=h("ZodXID",(e,t)=>{nt.init(e,t),As.init(e,t)}),Ks=h("ZodKSUID",(e,t)=>{rt.init(e,t),As.init(e,t)}),Us=h("ZodIPv4",(e,t)=>{lt.init(e,t),As.init(e,t)}),Ls=h("ZodIPv6",(e,t)=>{dt.init(e,t),As.init(e,t)}),Gs=h("ZodCIDRv4",(e,t)=>{ut.init(e,t),As.init(e,t)}),Xs=h("ZodCIDRv6",(e,t)=>{pt.init(e,t),As.init(e,t)}),qs=h("ZodBase64",(e,t)=>{gt.init(e,t),As.init(e,t)}),Ws=h("ZodBase64URL",(e,t)=>{ft.init(e,t),As.init(e,t)}),Hs=h("ZodE164",(e,t)=>{yt.init(e,t),As.init(e,t)}),Ys=h("ZodJWT",(e,t)=>{vt.init(e,t),As.init(e,t)}),Js=h("ZodNumber",(e,t)=>{bt.init(e,t),Es.init(e,t),e.gt=(t,s)=>e.check(rs(t,s)),e.gte=(t,s)=>e.check(as(t,s)),e.min=(t,s)=>e.check(as(t,s)),e.lt=(t,s)=>e.check(is(t,s)),e.lte=(t,s)=>e.check(ns(t,s)),e.max=(t,s)=>e.check(ns(t,s)),e.int=t=>e.check(ti(t)),e.safe=t=>e.check(ti(t)),e.positive=t=>e.check(rs(0,t)),e.nonnegative=t=>e.check(as(0,t)),e.negative=t=>e.check(is(0,t)),e.nonpositive=t=>e.check(ns(0,t)),e.multipleOf=(t,s)=>e.check(os(t,s)),e.step=(t,s)=>e.check(os(t,s)),e.finite=()=>e;const s=e._zod.bag;e.minValue=Math.max(s.minimum??Number.NEGATIVE_INFINITY,s.exclusiveMinimum??Number.NEGATIVE_INFINITY)??null,e.maxValue=Math.min(s.maximum??Number.POSITIVE_INFINITY,s.exclusiveMaximum??Number.POSITIVE_INFINITY)??null,e.isInt=(s.format??"").includes("int")||Number.isSafeInteger(s.multipleOf??.5),e.isFinite=!0,e.format=s.format??null});function Qs(e){return function(e,t){return new Js({type:"number",checks:[],...M(t)})}(0,e)}const ei=h("ZodNumberFormat",(e,t)=>{wt.init(e,t),Js.init(e,t)});function ti(e){return function(e,t){return new ei({type:"number",check:"number_format",abort:!1,format:"safeint",...M(t)})}(0,e)}const si=h("ZodBoolean",(e,t)=>{_t.init(e,t),Es.init(e,t)});function ii(e){return function(e,t){return new si({type:"boolean",...M(t)})}(0,e)}const ni=h("ZodUnknown",(e,t)=>{xt.init(e,t),Es.init(e,t)});function ri(){return new ni({type:"unknown"})}const ai=h("ZodNever",(e,t)=>{kt.init(e,t),Es.init(e,t)});function oi(e){return function(e,t){return new ai({type:"never",...M(t)})}(0,e)}const hi=h("ZodArray",(e,t)=>{zt.init(e,t),Es.init(e,t),e.element=t.element,e.min=(t,s)=>e.check(cs(t,s)),e.nonempty=t=>e.check(cs(1,t)),e.max=(t,s)=>e.check(hs(t,s)),e.length=(t,s)=>e.check(ls(t,s)),e.unwrap=()=>e.element}),ci=h("ZodObject",(e,t)=>{Mt.init(e,t),Es.init(e,t),v(e,"shape",()=>t.shape),e.keyof=()=>function(e){const t=Array.isArray(e)?Object.fromEntries(e.map(e=>[e,e])):e;return new ui({type:"enum",entries:t,...M(void 0)})}(Object.keys(e._zod.def.shape)),e.catchall=t=>e.clone({...e._zod.def,catchall:t}),e.passthrough=()=>e.clone({...e._zod.def,catchall:ri()}),e.loose=()=>e.clone({...e._zod.def,catchall:ri()}),e.strict=()=>e.clone({...e._zod.def,catchall:oi()}),e.strip=()=>e.clone({...e._zod.def,catchall:void 0}),e.extend=t=>function(e,t){if(!z(t))throw new Error("Invalid input to extend: expected a plain object");const s=e._zod.def.checks;if(s&&s.length>0)throw new Error("Object schemas containing refinements cannot be extended. Use `.safeExtend()` instead.");const i=w(e._zod.def,{get shape(){const s={...e._zod.def.shape,...t};return b(this,"shape",s),s},checks:[]});return E(e,i)}(e,t),e.safeExtend=t=>function(e,t){if(!z(t))throw new Error("Invalid input to safeExtend: expected a plain object");const s={...e._zod.def,get shape(){const s={...e._zod.def.shape,...t};return b(this,"shape",s),s},checks:e._zod.def.checks};return E(e,s)}(e,t),e.merge=t=>function(e,t){const s=w(e._zod.def,{get shape(){const s={...e._zod.def.shape,...t._zod.def.shape};return b(this,"shape",s),s},get catchall(){return t._zod.def.catchall},checks:[]});return E(e,s)}(e,t),e.pick=t=>function(e,t){const s=e._zod.def;return E(e,w(e._zod.def,{get shape(){const e={};for(const i in t){if(!(i in s.shape))throw new Error(`Unrecognized key: "${i}"`);t[i]&&(e[i]=s.shape[i])}return b(this,"shape",e),e},checks:[]}))}(e,t),e.omit=t=>function(e,t){const s=e._zod.def,i=w(e._zod.def,{get shape(){const i={...e._zod.def.shape};for(const e in t){if(!(e in s.shape))throw new Error(`Unrecognized key: "${e}"`);t[e]&&delete i[e]}return b(this,"shape",i),i},checks:[]});return E(e,i)}(e,t),e.partial=(...t)=>function(e,t,s){const i=w(t._zod.def,{get shape(){const i=t._zod.def.shape,n={...i};if(s)for(const t in s){if(!(t in i))throw new Error(`Unrecognized key: "${t}"`);s[t]&&(n[t]=e?new e({type:"optional",innerType:i[t]}):i[t])}else for(const t in i)n[t]=e?new e({type:"optional",innerType:i[t]}):i[t];return b(this,"shape",n),n},checks:[]});return E(t,i)}(mi,e,t[0]),e.required=(...t)=>function(e,t,s){const i=w(t._zod.def,{get shape(){const i=t._zod.def.shape,n={...i};if(s)for(const t in s){if(!(t in n))throw new Error(`Unrecognized key: "${t}"`);s[t]&&(n[t]=new e({type:"nonoptional",innerType:i[t]}))}else for(const t in i)n[t]=new e({type:"nonoptional",innerType:i[t]});return b(this,"shape",n),n},checks:[]});return E(t,i)}(wi,e,t[0])}),li=h("ZodUnion",(e,t)=>{At.init(e,t),Es.init(e,t),e.options=t.options}),di=h("ZodIntersection",(e,t)=>{$t.init(e,t),Es.init(e,t)}),ui=h("ZodEnum",(e,t)=>{jt.init(e,t),Es.init(e,t),e.enum=t.entries,e.options=Object.values(t.entries);const s=new Set(Object.keys(t.entries));e.extract=(e,i)=>{const n={};for(const r of e){if(!s.has(r))throw new Error(`Key ${r} not found in enum`);n[r]=t.entries[r]}return new ui({...t,checks:[],...M(i),entries:n})},e.exclude=(e,i)=>{const n={...t.entries};for(const t of e){if(!s.has(t))throw new Error(`Key ${t} not found in enum`);delete n[t]}return new ui({...t,checks:[],...M(i),entries:n})}}),pi=h("ZodTransform",(e,t)=>{Ft.init(e,t),Es.init(e,t),e._zod.parse=(s,i)=>{if("backward"===i.direction)throw new l(e.constructor.name);s.addIssue=i=>{if("string"==typeof i)s.issues.push(F(i,s.value,t));else{const t=i;t.fatal&&(t.continue=!1),t.code??(t.code="custom"),t.input??(t.input=s.value),t.inst??(t.inst=e),s.issues.push(F(t))}};const n=t.transform(s.value,s);return n instanceof Promise?n.then(e=>(s.value=e,s)):(s.value=n,s)}}),mi=h("ZodOptional",(e,t)=>{Zt.init(e,t),Es.init(e,t),e.unwrap=()=>e._zod.def.innerType});function gi(e){return new mi({type:"optional",innerType:e})}const fi=h("ZodNullable",(e,t)=>{Nt.init(e,t),Es.init(e,t),e.unwrap=()=>e._zod.def.innerType});function yi(e){return new fi({type:"nullable",innerType:e})}const vi=h("ZodDefault",(e,t)=>{Bt.init(e,t),Es.init(e,t),e.unwrap=()=>e._zod.def.innerType,e.removeDefault=e.unwrap}),bi=h("ZodPrefault",(e,t)=>{Kt.init(e,t),Es.init(e,t),e.unwrap=()=>e._zod.def.innerType}),wi=h("ZodNonOptional",(e,t)=>{Ut.init(e,t),Es.init(e,t),e.unwrap=()=>e._zod.def.innerType}),_i=h("ZodCatch",(e,t)=>{Gt.init(e,t),Es.init(e,t),e.unwrap=()=>e._zod.def.innerType,e.removeCatch=e.unwrap}),xi=h("ZodPipe",(e,t)=>{Xt.init(e,t),Es.init(e,t),e.in=t.in,e.out=t.out});function ki(e,t){return new xi({type:"pipe",in:e,out:t})}const Pi=h("ZodReadonly",(e,t)=>{Wt.init(e,t),Es.init(e,t),e.unwrap=()=>e._zod.def.innerType}),zi=h("ZodCustom",(e,t)=>{Yt.init(e,t),Es.init(e,t)});class Si extends Error{constructor(){super("function param was incorrectly typed")}}class Ii extends Error{constructor(e){super(e=void 0!==e?`missing player object in class: ${e}`:"missing player object in class")}}class Ti extends Error{constructor(e){super(`class ${e} was not initialized correctly`)}}const Ei=()=>{const e=new WeakMap;return(t,s,i)=>{const n=i.value;if(!1===((e,t)=>"update"!==t?(console.error(new Error("must be used on update")),!1):"function"==typeof e&&2===e.length)(n,s))throw new Error("you fucked up a decorator dawg");return i.value=function(t,s){const i=e.get(this)??0;t>3e4*i&&(e.set(this,i+1),this.constructor.name),n.call(this,t,s)},i}},Mi=function(e){const t={type:"object",shape:e??{},...M(void 0)};return new ci(t)}({time:Qs(),soundEffects:ii(),music:ii(),difficulty:Qs(),lastPlayed:Qs(),email:function(e,t){return new Os({type:"string",...M(t)})}(0,undefined).optional()});const Oi={time:0,soundEffects:!0,music:!0,difficulty:1,lastPlayed:0},Ai=class e extends Phaser.Plugins.BasePlugin{constructor(e){super(e),this.pluginManager=e}load(){const t=localStorage.getItem(e.key);if(null===t)return Oi;try{return Mi.parse(JSON.parse(t))}catch(s){return Oi}}save(t){const s={...this.load(),...t},i=JSON.stringify(s);return localStorage.setItem(e.key,i),JSON.stringify(this.load())===JSON.stringify(s)}};n(Ai,"key","ConfigManager"),n(Ai,"mapping","_config");let $i=Ai;const Ci={key:$i.key,plugin:$i,start:!0,mapping:$i.mapping};let Ri=(e=class extends Phaser.Plugins.BasePlugin{constructor(e){super(e),n(this,"alive"),this.alive=!0}isAlive(){return this.alive}},n(e,"key","PlayerManager"),n(e,"mapping","_playerplugin"),e);const ji={key:Ri.key,plugin:Ri,start:!1,mapping:Ri.mapping},Fi="MainMenu",Di="Preloader",Zi="AnimationManager",Ni="MainScene",Bi="IdleScene",Vi="ActionScene";class Ki{constructor(e,t,s){n(this,"tween"),n(this,"target"),this.tween=e.tweens.addCounter({paused:!0,persist:!0,from:t,to:s,duration:200,onUpdate:e=>{if(!this.target)return;let t=e.getValue();if(null===t)throw new Error("invalid tween");t=Math.floor(t),this.target.setTint(Phaser.Display.Color.GetColor(t,t,t))}})}restart(e){this.target=e,this.tween.resume()}pause(){this.target=void 0,this.tween.pause().seek(0)}}let Ui=(t=class extends Phaser.GameObjects.Image{constructor(e,t,s,i){var r,a;super(e.scene,t,s,"menu-item"),n(this,"text"),n(this,"tween"),n(this,"onClick",()=>{}),n(this,"focused",!1),this.container=e,this.idx=i,e.scene.add.existing(this),this.setInteractive(),this.tween=new Ki(this.scene,255,204),this.text=e.scene.add.text(this.width/2+t,this.height/2+s,"",{fontSize:40,color:"#ffffff",stroke:"#000000",strokeThickness:8,align:"center"}).setOrigin(.5,.5).setShadow(5,5,"#5588EE",0,!0,!0),e.add(this.text),this.on("pointerup",e=>{if(!(e instanceof Phaser.Input.Pointer))throw new Si;this.onClick(e)}),this.on("pointerover",()=>{this.container.idx=void 0,this.pointerover()}),this.on("pointerout",()=>{this.container.idx=void 0,this.pointerout()}),null==(r=this.preFX)||r.setPadding(16),null==(a=this.preFX)||a.addShadow()}pointerout(){this.focused&&(this.tween.pause(),this.setRotation(0).setTint(16777215),this.focused=!1)}pointerover(){this.focused||(this.tween.restart(this),this.setRotation(Math.PI/32),setTimeout(()=>{this.setRotation(0)},50),this.focused=!0)}update(e,t){void 0!==this.container.idx&&(this.container.idx===this.idx?this.pointerover():this.pointerout())}},n(t,"texture","menu-item"),t);class Li extends Phaser.GameObjects.Container{constructor(e,t){var s,i,r;super(e,t.x,t.y),n(this,"buttonWidth"),n(this,"buttonHeight"),n(this,"bg"),n(this,"buttons",[]),n(this,"width"),n(this,"tween"),n(this,"prompts",[{xbox:{frame:"xbox_dpad_vertical",color:16777215},kbm:{frame:"mouse_move",color:16711935},text:"navigate"},{xbox:{frame:"xbox_button_color_a",color:16777215},kbm:{frame:"mouse_left",color:16711935},text:"select"},{xbox:{frame:"xbox_button_color_b",color:16777215},kbm:{frame:"keyboard_escape",color:16711935},text:"exit"}]),n(this,"idx",0),this.scene=e,this.scene.add.existing(this),this.setVisible(!1);const a=this.scene.textures.get(Ui.texture).getFrameBounds();this.scene.textures.get("close-icon").getFrameBounds(),this.buttonHeight=a.height,this.buttonWidth=a.width,this.width=this.buttonWidth+10+10,this.bg=this.scene.add.tileSprite(0,0,this.menuWidth(1),this.menuHeight(2),"repeating-background").setOrigin(0,0),this.add(this.bg),null==(s=this.bg.preFX)||s.setPadding(32),null==(i=this.bg.preFX)||i.addGlow(16777215,100),null==(r=this.bg.preFX)||r.addShadow(),this.tween=new Ki(this.scene,255,204)}menuWidth(e){return this.width=this.buttonWidth+10+10,this.width}menuHeight(e){const t=10*Math.max(e-1,0);return e*this.buttonHeight+t+10+10+10}createButton(e){const t=new Ui(this,10,10+(this.buttonHeight+10)*e+10,e);return t.setPosition(t.width/2+10,t.height/2+(this.buttonHeight+10)*e+10),this.buttons.push(t),this.add(t),t.text.setAbove(t),t}open(e,t){if(!bn.instance)throw new Ii;this.idx=0;const s=this.scene.player;bn.instance.cameras.main.worldView.x,bn.instance.cameras.main.width,bn.instance.cameras.main.worldView.y,bn.instance.cameras.main.height;const i=bn.instance.cameras.main.width-this.width-100;console.log(bn.instance.cameras.main.worldView.x,bn.instance.cameras.main.width,s.x),s.x>i?this.setPosition(100,t+100):this.setPosition(i,t+100),this.setVisible(!0),Ji.instance.setOnInteract(this)}close(){this.setVisible(!1),Ji.instance.removeOnInteract(this)}onInteract(){this.idx=0}onCancel(){this.close()}onSelect(){var e;null==(e=this.buttons[this.idx??0])||e.onClick()}onMovement(e,t){0!==t&&(this.idx=(this.idx??0)+t,-1===this.idx?this.idx=this.buttons.length-1:this.idx=this.idx%this.buttons.length,console.log(this.idx))}setButtons(e){for(let t=0;t<e.length;t++){const s=e[t];if(!s)throw new Error("invalid type");const i=this.buttons[t]??this.createButton(t);i.onClick=s.onClick,i.text.text=s.text}this.bg.setSize(this.menuWidth(1),this.menuHeight(e.length));for(let t=e.length;t<this.buttons.length;t++){const e=this.buttons[t];if(!e)return;e.setVisible(!1).text.setVisible(!1)}}update(e,t){for(const s of this.buttons)s.update(e,t)}}const Gi=()=>{},Xi={fontFamily:"MarcellusSC",fontSize:40,color:"#ffffff",stroke:"#000000",strokeThickness:8,align:"center"};class qi{constructor(e,t=[]){var s,i;n(this,"xbox",[]),n(this,"kbm",[]),n(this,"text",[]),n(this,"width",0),n(this,"background"),n(this,"last"),n(this,"key"),this.scene=e;const r=this.scene.scale.width/2,a=this.scene.scale.height-200;this.background=this.scene.add.rectangle(r,a,256,128,0,.75).setVisible(!1).setOrigin(.5);for(const n of t){const e=this.scene.add.image(r,a,"kbm",n.kbm.frame).setVisible(!1).setScale(.75).setOrigin(0,.5);null==(s=e.preFX)||s.addShadow(-.25,-.25,.1,1,n.kbm.color),this.kbm.push(e);const t=this.scene.add.image(r,a,"xbox",n.xbox.frame).setVisible(!1).setScale(.75).setOrigin(0,.5);null==(i=t.preFX)||i.addShadow(-.5,-.5,.1,1,n.xbox.color),this.xbox.push(t);const o=this.scene.add.text(r,a,n.text,Xi).setVisible(!1).setOrigin(0,.5);if(this.text.push(o),e.displayWidth!==t.displayWidth)throw new Error("invalid assumption");this.width+=10+e.displayWidth+20+o.displayWidth+10}this.width+=20}button(e){return"xbox"===e||"ps4"===e?this.xbox:this.kbm}enable(e,t){if(this.last===t&&this.key===e)return;this.key=e,this.last=t,this.hide();const s=this.button(t);this.background.setSize(this.width,128).setVisible(!0);const{left:i}=this.background.getBounds();let n=i+10;for(let r=0;r<s.length;r++){const e=s[r],t=this.text[r];if(!e||!t)throw new Error;n+=10,e.x=n,n+=e.displayWidth,n+=20,t.x=n,n+=t.displayWidth,n+=10,e.setVisible(!0),t.setVisible(!0)}}hide(){this.background.setVisible(!1);for(let e=0;e<this.kbm.length;e++){const t=this.kbm[e],s=this.text[e],i=this.xbox[e];if(!t||!s||!i)throw new Error;t.setVisible(!1),s.setVisible(!1),i.setVisible(!1)}}destroy(){this.background.destroy();for(let e=0;e<this.kbm.length;e++){const t=this.kbm[e],s=this.text[e],i=this.xbox[e];if(!t||!s||!i)throw new Error;t.destroy(),s.destroy(),i.destroy()}}disable(){this.key=void 0,this.hide()}}const Wi=e=>Phaser.Input.Keyboard.KeyCodes[e],Hi=(e,t)=>Math.abs(e)===Math.SQRT1_2&&Math.abs(t)===Math.SQRT1_2,Yi=(e,t)=>0===e&&1===Math.abs(t)||0===t&&1===Math.abs(e);class Ji{constructor(e,t,s={up:"W",left:"A",down:"S",right:"D"}){n(this,"prompts",new Map),n(this,"prompt"),n(this,"_focus"),n(this,"_gamepadPlugin"),n(this,"_keyboardPlugin"),n(this,"gamepad"),n(this,"_movement"),n(this,"_systemKeys"),n(this,"_keys"),n(this,"isSetup",!1),n(this,"setup",!1),n(this,"active",!1),n(this,"connected",!1),n(this,"last","kbm"),n(this,"onTab",Gi),n(this,"onPause",Gi),n(this,"interactTarget",[]),n(this,"onInteract",()=>{const e=this.interactTarget[this.interactTarget.length-1];e&&e.onInteract()}),n(this,"lastPos",[[0,0]]),n(this,"dashing",!1),n(this,"framesUnmoved",0),n(this,"framesMoved",0),n(this,"moved",!1),n(this,"prevTarget"),this.scene=e,this.num=t,this.movementKeys=s,this.prompt=new qi(this.scene,[{xbox:{frame:"xbox_stick_l",color:16711935},kbm:{frame:"keyboard_wasd",color:16777215},text:"move"}]),this.prompts.set("move",this.prompt),console.log("assigning instance for",t)}destroy(){this.prompts.forEach(e=>{e.destroy()}),this.prompt=void 0,this.prompts=new Map}get focus(){return this._focus||(this.scene instanceof Li||this.scene instanceof rn?this._focus=this.scene:this._focus=null),this._focus}get gamepadPlugin(){if(null===this.scene.input.gamepad)throw new Error("missing gamepad plugin");return this._gamepadPlugin??(this._gamepadPlugin=this.scene.input.gamepad),this._gamepadPlugin}get keyboardPlugin(){if(null===this.scene.input.keyboard)throw new Error("missing keyboard plugin");return this._keyboardPlugin??(this._keyboardPlugin=this.scene.input.keyboard),this._keyboardPlugin}get movement(){return this._movement??(this._movement={up:{onInteract:Gi,kbm:this.keyboardPlugin.addKey(Wi(this.movementKeys.up)),button:-1},left:{onInteract:Gi,kbm:this.keyboardPlugin.addKey(Wi(this.movementKeys.left)),button:-1},down:{onInteract:Gi,kbm:this.keyboardPlugin.addKey(Wi(this.movementKeys.down)),button:-1},right:{onInteract:Gi,kbm:this.keyboardPlugin.addKey(Wi(this.movementKeys.right)),button:-1}}),this._movement}get systemKeys(){return this._systemKeys??(this._systemKeys={pause:{onInteract:()=>{const e=this.interactTarget[this.interactTarget.length-1];e?(e.onCancel(),this.removeOnInteract(this.interactTarget[this.interactTarget.length-1])):this.onPause()},kbm:this.keyboardPlugin.addKey(Phaser.Input.Keyboard.KeyCodes.ESC),button:9}}),this._systemKeys}get keys(){return this._keys??(this._keys={menu_up:{onInteract:()=>{var e;const t=this.interactTarget[this.interactTarget.length-1];t&&(null==(e=t.onMovement)||e.call(t,0,-1))},kbm:this.keyboardPlugin.addKey(Phaser.Input.Keyboard.KeyCodes.UP),button:12},menu_left:{onInteract:Gi,kbm:this.keyboardPlugin.addKey(Phaser.Input.Keyboard.KeyCodes.LEFT),button:14},menu_down:{onInteract:()=>{var e;const t=this.interactTarget[this.interactTarget.length-1];t&&(null==(e=t.onMovement)||e.call(t,0,1))},kbm:this.keyboardPlugin.addKey(Phaser.Input.Keyboard.KeyCodes.DOWN),button:13},menu_right:{onInteract:Gi,kbm:this.keyboardPlugin.addKey(Phaser.Input.Keyboard.KeyCodes.RIGHT),button:15},dash:{onInteract:()=>{this.dashing=!0},kbm:this.keyboardPlugin.addKey(Phaser.Input.Keyboard.KeyCodes.SPACE),button:0},upgrade:{onInteract:this.onTab,kbm:this.keyboardPlugin.addKey(Phaser.Input.Keyboard.KeyCodes.TAB),button:16},aim:{onInteract:Gi,kbm:this.keyboardPlugin.addKey(Phaser.Input.Keyboard.KeyCodes.SHIFT),button:6},interact:{onInteract:this.onInteract,kbm:this.keyboardPlugin.addKey(Phaser.Input.Keyboard.KeyCodes.E),button:2},cancel:{onInteract:()=>{const e=this.interactTarget[this.interactTarget.length-1];e&&e.onCancel(),this.removeOnInteract(this.interactTarget[this.interactTarget.length-1])},kbm:this.keyboardPlugin.addKey(Phaser.Input.Keyboard.KeyCodes.H),button:1},select:{onInteract:()=>{const e=this.interactTarget[this.interactTarget.length-1];e&&e.onSelect()},kbm:null,button:0}}),this._keys}setupKBM(){var e;if(!this.isSetup){if(42===this.num)for(const[,e]of Object.entries(this.systemKeys))e.kbm.on("up",()=>{this.last="kbm",e.onInteract()});else if(0===this.num)for(const[,t]of Object.entries(this.keys))null==(e=t.kbm)||e.on("up",()=>{this.last="kbm",t.onInteract()});this.isSetup=!0}}setupController(){return!!this.setup||!!this.gamepad&&(this.gamepad.on("down",(e,t,s)=>{if("number"!=typeof e)throw new Si;if("number"!=typeof t)throw new Si;if(!(s instanceof Phaser.Input.Gamepad.Button))throw new Si;s.pad.id.toLowerCase().includes("xbox")?this.last="xbox":this.last="ps4";for(const[,i]of Object.entries(this.keys))s.index===i.button&&i.onInteract();s.index!==Phaser.Input.Gamepad.Configs.XBOX_360.START&&s.index!==Phaser.Input.Gamepad.Configs.XBOX_360.A||(this.active=!0),s.index,Phaser.Input.Gamepad.Configs.XBOX_360.BACK,s.index,Phaser.Input.Gamepad.Configs.XBOX_360.START,s.index,Phaser.Input.Gamepad.Configs.XBOX_360.X}),this.gamepadPlugin.on("down",(e,t)=>{if(!(e instanceof Phaser.Input.Gamepad.Gamepad))throw new Si;if(!(t instanceof Phaser.Input.Gamepad.Button))throw new Si;e.id.toLowerCase().includes("xbox")?this.last="xbox":this.last="ps4",t.index===Phaser.Input.Gamepad.Configs.XBOX_360.BACK&&this.onTab(),t.index===Phaser.Input.Gamepad.Configs.XBOX_360.START&&this.onPause(),t.index===Phaser.Input.Gamepad.Configs.XBOX_360.X&&this.onInteract()}),this.setup=!0,!0)}updateConnection(){this.connected||(this.gamepad=this.gamepadPlugin.gamepads[this.num],this.gamepad&&this.setupController()&&(this.connected=!0))}setOnTab(e){this.onTab=e}setOnPause(e){this.onPause=e}setOnInteract(e){if(e instanceof Li&&(this._focus=e),-1!==this.interactTarget.findIndex(t=>t===e))return;let t=this.prompts.get(e.constructor.name);t||(t=new qi(this.scene,e.prompts),this.prompts.set(e.constructor.name,t)),this.prompt=t,this.prevTarget=this.interactTarget[this.interactTarget.length-1],this.interactTarget.push(e)}removeOnInteract(e){var t;if(0===this.interactTarget.length)return;const s=this.interactTarget.findIndex(t=>t===e);-1!==s&&(this.interactTarget.splice(s),void 0===this.interactTarget[this.interactTarget.length-1]&&(null==(t=this.prompt)||t.disable()),0===this.interactTarget.length&&(this.scene instanceof rn?this._focus=this.scene:this._focus=null))}get aiming(){let e=this.keys.aim.kbm.isDown;return this.gamepad&&(e=e||this.gamepad.L2>.5),e}lastPosition(){let e=[];this.lastPos.reduce((t,s)=>(((e,t)=>{const[s,i]=e,[n,r]=t;return s===n&&i===r||(Yi(s,i)&&Hi(n,r)||!(!Hi(s,i)||!Yi(n,r)))&&(Math.sign(s)===Math.sign(n)||Math.sign(i)===Math.sign(r))})(t,s)?e.push(s):e=[s],s));const t=[0,0],s=e.length;return e.forEach(e=>{t[0]+=e[0]/s,t[1]+=e[1]/s}),t}target(e){const t=e.scene.input.activePointer,s=e.x-e.scene.cameras.main.scrollX,i=e.y-e.scene.cameras.main.scrollY;let n=t.x,r=t.y,a=Phaser.Math.Angle.Between(s,i,t.worldX,t.worldY);3!==this.num&&([n,r]=this.lastPosition(),a=Phaser.Math.Angle.Between(0,0,n,r));const{x:o,y:h}=this.axes("right");return 0===o&&0===h||(a=Phaser.Math.Angle.Between(0,0,o,h),n=e.x,r=e.y),{x:n,y:r,angle:a}}axes(e){if(!this.gamepad)return{x:0,y:0};const t="left"===e?0:2,s=this.gamepad.axes[0+t],i=this.gamepad.axes[1+t];let n=0,r=0;return void 0!==s&&void 0!==i&&(s.threshold=.15,i.threshold=.15,n=s.getValue(),r=i.getValue()),0===n&&0===r||(this.last="xbox"),{x:n,y:r}}position(){let{x:e,y:t}=this.axes("left");const s=e**2+t**2;s>1&&(e/=Math.sqrt(s),t/=Math.sqrt(s));const i=this.movement.left.kbm.isDown,n=this.movement.right.kbm.isDown;i&&(e-=1),n&&(e+=1);const r=this.movement.up.kbm.isDown,a=this.movement.down.kbm.isDown;return r&&(t-=1),a&&(t+=1),(r||i||a||n)&&(this.last="kbm"),this.focus instanceof rn?(Math.abs(e)+Math.abs(t)>1&&(e*=Math.SQRT1_2,t*=Math.SQRT1_2),0===e&&0===t||(this.moved=!0,this.active=!0,this.lastPos.push([e,t]),this.lastPos.length>30&&this.lastPos.shift()),[e,t]):(console.log(this.focus),[0,0])}refresh(){this.setupKBM(),this.updateConnection()}update(e,t){var s,i;if(this.setupKBM(),42===this.num)return;const n=this.interactTarget[this.interactTarget.length-1];if(n&&this.prompt&&(n!==this.prevTarget&&(this.prevTarget&&(null==(s=this.prompts.get(this.prevTarget.constructor.name))||s.disable()),this.prevTarget=n),this.prompt.enable(n.constructor.name,this.last)),this.framesUnmoved<600)this.framesUnmoved++;else if(this.moved&&this.framesMoved<100)this.framesMoved++;else if(this.framesMoved<100){const e=this.prompts.get("move");null==e||e.enable("move",this.last)}else 100===this.framesMoved&&(null==(i=this.prompts.get("move"))||i.disable());this.updateConnection()}}var Qi,en;const tn=a(en?Qi:(en=1,Qi=function e(t,s){if(t===s)return!0;if(t&&s&&"object"==typeof t&&"object"==typeof s){if(t.constructor!==s.constructor)return!1;var i,n,r;if(Array.isArray(t)){if((i=t.length)!=s.length)return!1;for(n=i;0!==n--;)if(!e(t[n],s[n]))return!1;return!0}if(t.constructor===RegExp)return t.source===s.source&&t.flags===s.flags;if(t.valueOf!==Object.prototype.valueOf)return t.valueOf()===s.valueOf();if(t.toString!==Object.prototype.toString)return t.toString()===s.toString();if((i=(r=Object.keys(t)).length)!==Object.keys(s).length)return!1;for(n=i;0!==n--;)if(!Object.prototype.hasOwnProperty.call(s,r[n]))return!1;for(n=i;0!==n--;){var a=r[n];if(!e(t[a],s[a]))return!1}return!0}return t!=t&&s!=s}));class sn extends Phaser.Scene{}class nn extends sn{constructor(){super(...arguments),n(this,"debugging",!1),n(this,"_layers"),n(this,"_inputProvider"),n(this,"_configPlugin",null),n(this,"_playerPlugin",null),n(this,"_inputPlugin",null)}get layers(){var e;if(!this._layers){const t=(()=>{const e=this.scale.height/96,t=this.scale.width/96,s=[];for(let i=0;i<e;i++){const e=[];for(let s=0;s<t;s++)e.push(Math.floor(64*Math.random()));s.push(e)}return{data:s,tileWidth:32,tileHeight:32}})(),s=this.make.tilemap(t),i=s.addTilesetImage("tileset-grass");if(null===i)throw new Error("tileset problems");this._layers={map:s.createLayer(0,i,0,0),game:this.add.layer().setDepth(5),ui:this.add.layer(),menu:this.add.layer().setVisible(!1).setDepth(10)},null==(e=this._layers.map)||e.setScale(3)}return this._layers}get inputProvider(){return this._inputProvider??(this._inputProvider=new Ji(this,42)),this._inputProvider}init(){this.physics.world.drawDebug=!1,this.events.on("update",(e,t)=>{if("number"!=typeof e||"number"!=typeof t)throw new Si;this.inputProvider.update(e,t)})}shutdown(){this._inputProvider=void 0,this._layers=void 0}get config(){if(!this._configPlugin){const e=this.game.plugins.get($i.key);if(!(e instanceof $i))throw new Error("misconfigured plugin");this._configPlugin=e}return this._configPlugin}get playerplugin(){if(!this._playerPlugin){const e=this.game.plugins.get(Ri.key);if(!(e instanceof Ri))throw new Error("misconfigured plugin");this._playerPlugin=e}return this._playerPlugin}get inputv2(){if(!this._inputPlugin)throw this.load.scenePlugin(wr.key,wr,wr.mapping),new Error("misconfigured scene plugin");return this._inputPlugin}}class rn extends nn{constructor(){super(...arguments),n(this,"p"),n(this,"_players"),n(this,"_debugGraphics"),n(this,"_input1"),n(this,"_player1"),n(this,"_input2"),n(this,"_player2")}get pp(){return this.p[0]}get players(){return this._players||(this._players=this.add.group({runChildUpdate:!0})),this._players}get debugGraphics(){var e;return this.debugging?(this._debugGraphics||(this._debugGraphics=this.add.graphics()),this._debugGraphics):(null==(e=this._debugGraphics)||e.clear(),null)}init(){super.init()}update(e,t){console.log("wat")}shutdown(){var e,t,s,i;super.shutdown(),this.players.destroy(!0,!0),null==(e=this._player1)||e.destroy(),this._player1=void 0,null==(t=this._player2)||t.destroy(),this._player2=void 0,null==(s=this._input1)||s.destroy(),this._input1=void 0,null==(i=this._input2)||i.destroy(),this._input2=void 0}get input1(){return this._input1||(this._input1=new Ji(this,0)),this._input1}get player1(){return this._player1??(this._player1=new Yn(this,this.scale.baseSize.width/2,this.scale.baseSize.height/2,"player1",this.input1)),this._player1}get input2(){return this._input2||(this._input2=new Ji(this,1,{up:"UP",left:"LEFT",down:"DOWN",right:"RIGHT"})),this._input2}get player2(){return this._player2??(this._player2=new Yn(this,this.scale.baseSize.width/2,this.scale.baseSize.height/2,"player2",this.input2)),this._player2.setVisible(this.input2.active),this._player2}}class an{constructor(e){n(this,"lastDeps",[]),n(this,"lastValue"),this.fn=e}run(e){return void 0!==this.lastValue&&tn(this.lastDeps,e)||(this.lastValue=this.fn(),this.lastDeps=structuredClone(e)),this.lastValue}}class on extends rn{constructor(){super(...arguments),n(this,"border",0),n(this,"_playercams"),n(this,"_maskShapes"),n(this,"_cameraMasks"),n(this,"split",!1),n(this,"_centers"),n(this,"graphics")}init(){super.init(),this.cameras.main.startFollow(this.player1),this.events.on("update",()=>{this.updateScreen()})}shutdown(){super.shutdown()}updateScreen(){if(this.drawDebug(),this.player2.inputProvider.active&&!this.player2.visible&&this.onConnect(),!this.player2.inputProvider.active&&this.player2.visible&&this.onDisconnect(),!this.player2.visible)return;const e=this.centers.p1.distance(this.centers.center2)-this.centers.p1.distance(this.centers.center1);this.border=0,e>200?this.border=20:e>0&&(this.border=.1*e),this.maskShapes.p1.clear(),this.maskShapes.p2.clear(),this.border>0&&(this.maskShapes.p1.lineStyle(this.border,16777215),this.maskShapes.p2.lineStyle(this.border,16777215),this.debugging&&(this.maskShapes.p1.lineStyle(this.border,16711935),this.maskShapes.p2.lineStyle(this.border,16776960))),this.border>0?this.onSplit():e<0&&this.onJoin(),this.split?(this.debugging?(this.cameras.main.setVisible(!0),this.playercams.p1.clearMask(),this.playercams.p2.clearMask(),this.cameras.main.centerOn(this.centers.midpoint.x,this.centers.midpoint.y)):(this.cameras.main.setVisible(!1),this.playercams.p1.setMask(this.cameraMasks.p2,!1),this.playercams.p2.setMask(this.cameraMasks.p1,!1)),this.playercams.p1.centerOn(this.centers.center2.x,this.centers.center2.y),this.playercams.p2.centerOn(this.centers.center1.x,this.centers.center1.y),this.draw(this.maskShapes.p1,1),this.draw(this.maskShapes.p2,2)):this.cameras.main.centerOn(this.centers.midpoint.x,this.centers.midpoint.y)}draw(e,t){e.clear();const s=this.centers.d.clone();0===s.length()&&s.set(1,0);const i=s.clone().normalize(),n=new Phaser.Math.Vector2(-i.y,i.x),r=2*Math.max(this.scale.width,this.scale.height),a=4*Math.max(this.scale.width,this.scale.height);let o,h;1===t?(o=this.centers.center1.clone().add(n.clone().scale(r)),h=this.centers.center1.clone().add(n.clone().scale(-r))):(o=this.centers.center2.clone().add(n.clone().scale(r)),h=this.centers.center2.clone().add(n.clone().scale(-r)));const c=i.clone().scale(1===t?-a:a),l=o.clone().add(c),d=h.clone().add(c);this.debugging&&e.lineStyle(5*this.border,0,1),e.lineStyle(this.border,16777215,1),e.beginPath(),e.moveTo(o.x,o.y),e.lineTo(l.x,l.y),e.lineTo(d.x,d.y),e.lineTo(h.x,h.y),e.closePath();const u=this.debugging?.5:0;this.maskShapes.p1.fillStyle(16711935,u),this.maskShapes.p2.fillStyle(16776960,u),e.fillPath(),e.strokePath()}get playercams(){if(!this._playercams){const e=this.cameras.add(0,0,this.scale.width,this.scale.height,!1).setVisible(!1),t=this.cameras.add(0,0,this.scale.width,this.scale.height,!1).setVisible(!1);this._playercams={p1:e,p2:t}}return this._playercams}get maskShapes(){if(!this._maskShapes){const e=this.add.graphics({x:0,y:0}),t=this.add.graphics({x:0,y:0});this.layers.ui.add(e),this.layers.ui.add(t),this._maskShapes={p1:e,p2:t}}return this._maskShapes}get cameraMasks(){if(!this._cameraMasks){const e=this.maskShapes.p1.createGeometryMask(),t=this.maskShapes.p2.createGeometryMask();this._cameraMasks={p1:e,p2:t}}return this._cameraMasks}onConnect(){this.player2.visible||(this.cameras.main.stopFollow(),this.player2.setVisible(!0),this.layers.game.add(this.player2))}onDisconnect(){this.player2.visible&&(this.cameras.main.startFollow(this.player1),this.player2.setVisible(!1),this.layers.game.remove(this.player2))}onSplit(){this.split||(this.debugging||(this.cameras.main.stopFollow(),this.playercams.p1.setVisible(!0),this.playercams.p2.setVisible(!0)),this.split=!0)}onJoin(){!1!==this.split&&(this.cameras.main.setVisible(!0),this.playercams.p1.setVisible(!1),this.playercams.p2.setVisible(!1),this.split=!1)}get centers(){return this._centers??(this._centers=new an(()=>{const e=(this.player1.x+this.player2.x)/2,t=(this.player1.y+this.player2.y)/2,s=new Phaser.Math.Vector2(e,t),i=this.player2.x-this.player1.x,n=this.player2.y-this.player1.y,r=new Phaser.Math.Vector2(i,n),a=new Phaser.Math.Vector2(this.player1.x,this.player1.y),o=new Phaser.Math.Vector2(this.player2.x,this.player2.y),h=r.angle(),c=Math.sin(h)*this.scale.height/4,l=Math.cos(h)*this.scale.width/4,d=Math.sqrt(c**2+l**2);return{p1:a,p2:o,center1:r.clone().normalize().multiply({x:d,y:d}).add(this.player1),center2:r.clone().normalize().multiply({x:-d,y:-d}).add(this.player2),midpoint:s,d:r}})),this._centers.run([this.player1.x,this.player1.y,this.player2.x,this.player2.y])}drawDebug(){this.debugging&&(this.graphics??(this.graphics={p1:this.add.graphics({}),p2:this.add.graphics({}),center1:this.add.graphics({}),center2:this.add.graphics({}),midpoint:this.add.graphics({}),d:this.add.graphics({})}),this.graphics.p1.clear(),this.graphics.p1.fillStyle(16711680,1),this.graphics.p1.fillCircle(this.centers.p1.x,this.centers.p1.y,15),this.graphics.center1.clear(),this.graphics.center1.fillStyle(16711935,1),this.graphics.center1.fillCircle(this.centers.center1.x,this.centers.center1.y,5),this.graphics.p2.clear(),this.graphics.p2.fillStyle(65280,1),this.graphics.p2.fillCircle(this.centers.p2.x,this.centers.p2.y,15),this.graphics.center2.clear(),this.graphics.center2.fillStyle(16776960,1),this.graphics.center2.fillCircle(this.centers.center2.x,this.centers.center2.y,5),this.graphics.midpoint.clear(),this.graphics.midpoint.fillStyle(255,1),this.graphics.midpoint.fillCircle(this.centers.midpoint.x,this.centers.midpoint.y,5),this.graphics.d.clear(),this.graphics.d.fillStyle(65535,1),this.graphics.d.fillCircle(this.centers.d.x,this.centers.d.y,5))}}class hn extends Phaser.Physics.Arcade.Sprite{constructor(e,t,s){super(e,s.x,s.y,"pickaxe"),n(this,"container"),n(this,"newTween"),n(this,"glow"),n(this,"amount",0),n(this,"amountText"),n(this,"interactionBox"),n(this,"new",!0),n(this,"prompts",[{xbox:{frame:"xbox_button_color_x",color:16777215},kbm:{frame:"keyboard_e",color:16711935},text:"manage drones"}]),this.scene=e,this.resourceType=t,this.scene.add.existing(this),this.scene.physics.add.existing(this);const{x:i,y:r,width:a,height:o}=this.getBounds();this.interactionBox=new Phaser.Geom.Rectangle(i-20,r-20,a+40,o+40),this.setImmovable(!0).setScale(.5);const{centerX:h,top:c}=this.getBounds();this.amountText=this.scene.add.text(h,c-20,"",Xi).setOrigin(.5),this.container=new Li(e,s);const l=e.tweens.addCounter({paused:!0,persist:!0,from:255,to:204,duration:200,onUpdate:e=>{let t=e.getValue();if(null===t)throw new Error("invalid tween");t=Math.floor(t),this.setTint(Phaser.Display.Color.GetColor(t,t,t))}});this.on("pointerover",()=>{l.play(),this.setRotation(Math.PI/32),setTimeout(()=>{this.setRotation(0)},50)}),this.on("pointerout",()=>{l.pause().seek(0),this.clearTint(),this.setRotation(0)}),this.on("pointerup",()=>{this.disableNew(),this.container.open(0,0)}),this.setInteractive(),this.enableNew()}setButtons(e){this.container.setButtons(e)}enableNew(){var e,t,s;null==(e=this.preFX)||e.setPadding(32),null==(t=this.preFX)||t.addShadow(),this.glow=null==(s=this.preFX)?void 0:s.addGlow(16762624),this.newTween=this.scene.tweens.add({targets:this.glow,outerStrength:100,yoyo:!0,loop:-1,ease:"sine.inout",duration:1e3})}disableNew(){var e,t,s,i;this.new&&(this.new=!1,this.glow&&(null==(e=this.preFX)||e.remove(this.glow)),null==(t=this.preFX)||t.setPadding(16),this.glow=null==(s=this.preFX)?void 0:s.addGlow(16777215,100),null==(i=this.preFX)||i.addShadow(),this.newTween.stop())}onInteract(){this.container.visible?this.container.setVisible(!1):this.container.open(0,0)}onSelect(){}onCancel(){}update(e,t){this.container.update(e,t);for(const s of[this.scene.player1,this.scene.player2]){if(!s)continue;const e=s.x,t=s.y;this.interactionBox.contains(e,t)?s.inputProvider.setOnInteract(this):s.inputProvider.removeOnInteract(this)}}attention(){!1!==this.new&&(this.setRotation(Math.PI/32),this.scene.time.delayedCall(50,()=>{this.setRotation(0)}),Math.random()<.3&&(this.scene.time.delayedCall(100,()=>{this.setRotation(Math.PI/32)}),this.scene.time.delayedCall(150,()=>{this.setRotation(0)})),this.scene.time.delayedCall(1750+500*Math.random(),()=>{this.attention()}))}}class cn extends Phaser.Physics.Arcade.Sprite{constructor(e,t,s,i=1){super(e,t.x,t.y,""),n(this,"level"),n(this,"debugText"),n(this,"xpBase",1.2),n(this,"xp"),n(this,"xpRequired"),n(this,"task","idle"),n(this,"speed",100),n(this,"travelTime",1e4),n(this,"travelElapsed",0),n(this,"distance",0),n(this,"carrying",0),n(this,"resourceContainer"),n(this,"miningTime",500),n(this,"miningElapsed",0),n(this,"resourceTarget"),this.scene=e,this.base=t,this.setOrigin(.5,.5).setScale(2),this.scene.add.existing(this),this.scene.physics.add.existing(this),this.scene.physics.add.collider(this.scene.player,this),this.setBounce(.25),this.resourceContainer=s,this.level=i,this.xp=this.xpBase**i,this.xpRequired=this.xpBase**(i+1),this.resourceTarget=void 0,this.debugText=this.scene.add.text(this.x,this.y,"",{fontFamily:"Arial Black",fontSize:20,color:"#ffffff",stroke:"#000000",strokeThickness:4,align:"center"}),this.play("idle")}assignResource(e){if(this.resourceTarget=e,e){const t=this.base.x-e.x,s=this.base.y-e.y;this.distance=Math.sqrt(t*t+s*s)}}handleXp(){this.xp+=this.level,this.xp>=this.xpRequired&&(this.level+=1,this.xpRequired=this.xpBase**(this.level+1),this.travelTime=Math.max(Math.trunc(.9*this.travelTime),500),this.miningTime=Math.max(Math.trunc(.9*this.miningTime),100))}update(e,t){switch((e=>{try{throw new Error}catch(t){if(t instanceof Error){const s=/(\w+)@|at (\w+)\.(\w+) \(/g,i=t.stack;if(void 0===i)return;const n=s.exec(i);if("update"!==(null==n?void 0:n[3]))throw new Error("must be used within an update method");if(n[2]!==e.constructor.name)throw new Error("idk how this would happen or why it would matter")}}if(e.body instanceof Phaser.Physics.Arcade.Body){const t=e.scene.add.graphics({lineStyle:{width:2,color:16711680},fillStyle:{color:16711680,alpha:.3}});t.strokeRect(e.body.left,e.body.top,e.body.width,e.body.height),e.scene.time.delayedCall(1,()=>{t.destroy()})}})(this),this.debugText.setPosition(this.x,this.y).setOrigin(0,1),this.debugText.text=`lvl: ${this.level} (${this.xp}/${this.xpRequired})\ntravel:\t${this.travelTime}\nmining:\t${this.miningTime}`,this.task){case"move":if(void 0===this.resourceTarget){this.task="deliver",this.play("deliver");break}this.moveTo(this.resourceTarget.x,this.resourceTarget.y,t),this.reached(this.resourceTarget)&&(this.task="mine",this.play("mine"),this.travelElapsed=0,this.miningElapsed=0);break;case"mine":if(void 0===this.resourceTarget){this.task="deliver",this.play("deliver");break}if(!this.reached(this.resourceTarget)){this.task="move",this.play("move");break}if(this.miningElapsed+=t,this.miningElapsed>=this.miningTime){if(this.carrying+=this.resourceTarget.mine(this.level-this.carrying),this.carrying<this.level)return this.resourceTarget=void 0,this.task="move",void this.play("move");this.task="deliver",this.play("move")}break;case"celebrate":if("deliver"===this.anims.getName())break;this.handleXp(),this.play("deliver"),setTimeout(()=>{this.task="move",this.play("move")},250);break;case"deliver":if(this.moveTo(this.base.x,this.base.y,t),this.reached(this.base)){if(this.resourceContainer.addResource(this.carrying),this.carrying=0,this.travelElapsed=0,void 0===this.resourceTarget){this.task="idle",this.play("idle");break}this.task="celebrate"}break;case"idle":void 0!==this.resourceTarget&&(this.task="move",this.play("move"))}}moveTo(e,t,s){const i=e-this.x,n=t-this.y,r=Math.sqrt(i*i+n*n),a=this.travelTime-this.travelElapsed;if(r>10){let e=r/a*1e3;e=Math.max(e,100);const t=Math.atan2(n,i),s=Math.cos(t)*e,o=Math.sin(t)*e;this.flipX=s<0,this.body instanceof Phaser.Physics.Arcade.Body&&(this.body.velocity.x/s<.1||this.body.velocity.y/o<.1)&&this.setVelocity(s,o)}else this.setVelocity(0,0);this.travelElapsed+=s}moveToPosition(e,t,s){const i=e-this.x,n=t-this.y,r=Math.sqrt(i*i+n*n),a=this.travelTime-this.travelElapsed;if(r>1){let e=r/a*1e3;e=Math.max(e,100);const t=Math.atan2(n,i),o=Math.cos(t)*e*(s/1e3),h=Math.sin(t)*e*(s/1e3);this.flipX=o<0,this.x+=o,this.y+=h,this.setVelocity(e,e)}}reached(e){const t=e.x-this.x,s=e.y-this.y;return t*t+s*s<100}}class ln extends Phaser.Physics.Arcade.Image{constructor(e,t,s,i,r=1e3){const a=["00","16","32","48","64"],o=`${t}${a[Math.floor(Math.random()*a.length)]??"00"}`;super(e,s.x,s.y,"ores",o),n(this,"text"),this.scene=e,this.resourceType=t,this.position=s,this.size=i,this.amountLeft=r;const h=this.size/this.width;this.setScale(h),this.scene.physics.add.existing(this),this.text=this.scene.add.text(this.position.x,this.position.y,`${this.amountLeft}`,{fontSize:40}).setOrigin(.5,2),e.add.existing(this)}mine(e){const t=Math.min(e,this.amountLeft);return this.amountLeft-=t,this.text.setText(`${this.amountLeft}`),t}}class dn extends Phaser.GameObjects.Text{constructor(e,t,s,i,r){super(e,t,s,i,r),n(this,"tween"),this.setVisible(!1),this.setAlpha(0)}}class un{constructor(e,t,s){var i;n(this,"drones",[]),n(this,"resourceNodes",[]),n(this,"nodes"),n(this,"notificationText"),n(this,"building"),n(this,"baseCost",10),n(this,"costMultiplier",1.2),n(this,"costExponent",1.05),n(this,"amount",1e3),n(this,"resourceSize",64),this.scene=e,this.type=t,this.probeBody=s,this.nodes=this.scene.physics.add.group(this.resourceNodes);const r=this.scene.add.rectangle(0,0,this.scene.scale.baseSize.width,this.scene.scale.baseSize.height,255,255).setInteractive().on("pointerdown",e=>{if(!(e instanceof Phaser.Input.Pointer))throw new Si;e.rightButtonDown()&&this.createNode(e)}).setOrigin(0);for(null==(i=this.scene.GameLayer)||i.add(r),this.building=new hn(this.scene,this.type,{x:2e3,y:1e3}),this.building.setButtons([{text:`Spawn Drone\n(${this.cost})`,tooltip:"1",onClick:()=>{this.createDrone()}},{text:"I'm a button",tooltip:"1",onClick:()=>{console.log("button")}},{text:"I'm also a button",tooltip:"1",onClick:()=>{console.log("also a button")}}]),this.notificationText=this.scene.add.group({maxSize:15});15!==this.notificationText.children.size;){const e=new dn(this.scene,this.building.x,this.building.y,"+1",{fontSize:40,color:pn[this.type].toString(16),strokeThickness:8,align:"center"});e.tween=this.scene.tweens.add({paused:!0,persist:!0,targets:e,x:{from:this.building.x,to:this.building.x+50},y:{from:this.building.y-50,to:this.building.y-150},alpha:[1,.95,.9,.85,.8,.75,.7,.6,.5,0],duration:500}),this.notificationText.add(e,!0)}this.createNode({x:this.scene.scale.baseSize.width*(3/4),y:this.scene.scale.baseSize.height*(3/4)})}get cost(){const e=this.costMultiplier*this.drones.length,t=this.costExponent**this.drones.length-1;return Math.trunc(this.baseCost*(e+t))}update(e,t){var s;for(const i of this.drones){if(0===(null==(s=i.resourceTarget)?void 0:s.amountLeft)&&(i.resourceTarget.text.destroy(),this.nodes.remove(i.resourceTarget,!0,!0),i.assignResource(void 0)),!i.resourceTarget){const e=this.scene.physics.closest({x:i.x,y:i.y},this.nodes.getChildren());e&&e instanceof ln&&i.assignResource(e)}i.update(e,t)}this.building.update(),this.building.amountText.setText(`${this.amount}`)}createDrone(){if(this.amount<this.cost)return;const e=new cn(this.scene,this.building,this,1);this.amount-=this.cost,this.drones.push(e),this.scene.physics.add.collider(this.drones,e),this.scene.physics.overlap(this.drones,e),this.building.setButtons([{text:`Spawn Drone\n(${this.cost})`,tooltip:"1",onClick:()=>{this.createDrone()}},{text:"I'm a button",tooltip:"1",onClick:()=>{console.log("button")}},{text:"I'm also a button",tooltip:"1",onClick:()=>{console.log("also a button")}}])}createNode(e){var t;e??(e={x:600,y:200}),this.probeBody.setEnable(!0).reset(e.x,e.y);const s=this.scene.physics.overlap(this.probeBody,this.nodes);if(this.probeBody.setEnable(!1),s)return;const i=new ln(this.scene,this.type,e,this.resourceSize);return this.resourceNodes.push(i),null==(t=this.scene.ResourceLayer)||t.add(i),this.nodes.add(i),i}addResource(e){var t;this.amount+=e;const s=this.notificationText.getMatching("alpha",0),i=s[Math.trunc(s.length*Math.random())];let n;i instanceof dn&&(n=i,n.text=`+${e}`,n.setVisible(!0),null==(t=n.tween)||t.restart())}consumeResource(e){return this.amount>=e&&(this.amount-=e,!0)}}const pn={stone:5855577,copper:13857085,silver:14869218,gold:16634896};class mn{constructor(e){n(this,"resources",new Map),n(this,"probeBody"),this.scene=e,this.probeBody=this.scene.physics.add.body(0,0,0,0).setEnable(!1)}update(e,t){for(const[,s]of this.resources)s.update(e,t)}initialize(e){const t=new un(this.scene,e,this.probeBody);this.resources.set(e,t)}createDrone(e){const t=this.resources.get(e);if(!t)throw new Error("meow");t.createDrone()}createNode(e){const t=this.resources.get(e);if(!t)throw new Error("meow");t.createNode()}addResource(e,t){const s=this.resources.get(e);if(!s)throw new Error("meow");s.addResource(t)}consumeResource(e,t){const s=this.resources.get(e);if(!s)throw new Error("meow");return s.consumeResource(t)}}Phaser.Renderer.WebGL.Pipelines.MultiPipeline;class gn extends Phaser.Renderer.WebGL.Pipelines.SinglePipeline{constructor(e,t="lightshaft"){const s=e.cache.shader.get(t);if(!(s instanceof Phaser.Display.BaseShader))throw new Error(`${t} shader missing from cache`);super({game:e,name:t,fragShader:s.fragmentSrc})}onBind(e){if(super.onBind(),console.log(e),e instanceof Phaser.GameObjects.Sprite){const t=2*e.width,s=10*e.height;this.set2f("spriteDimensions",t,s),console.log(`Sprite width: ${t}, Height: ${s}`)}this.set3f("glowColor",1,.8,.3)}}var fn=Object.defineProperty,yn=Object.getOwnPropertyDescriptor;const vn=(s=class extends nn{constructor(){if(super(Ni),n(this,"GameLayer",null),n(this,"UILayer",null),n(this,"MenuLayer",null),n(this,"menuOpen",!1),n(this,"enemies",null),n(this,"_debugGraphics"),n(this,"activeScene",Vi),n(this,"cursors",{}),n(this,"shouldDrawCursor",!0),n(this,"menuInit",!1),s.instance)return s.instance;s.instance=this}get debugGraphics(){var e;return this.debugging?(this._debugGraphics||(this._debugGraphics=this.add.graphics()),this._debugGraphics):(null==(e=this._debugGraphics)||e.clear(),null)}follow(e){this.cameras.main.setBounds(-1e3,-1e3,this.scale.width+2e3,this.scale.height+2e3)}drawCursor(){this.cursors.attack||(this.cursors.attack=this.add.sprite(0,0,"cursor-attack").setOrigin(0).setScale(.5).setVisible(!1)),this.cursors.default||(this.cursors.default=this.add.sprite(0,0,"cursor-default").setOrigin(0).setScale(.5).setVisible(!1)),5===this.scene.getStatus(Fi)||this.activeScene!==Vi?(this.cursors.attack.setVisible(!1),this.cursors.default.setVisible(this.shouldDrawCursor)):(this.cursors.attack.setVisible(this.shouldDrawCursor),this.cursors.default.setVisible(!1)),this.cursors.default.setPosition(this.input.activePointer.x,this.input.activePointer.y),this.cursors.attack.setPosition(this.input.activePointer.x,this.input.activePointer.y)}create(){var e,t;if(null==(e=this.input.mouse)||e.disableContextMenu(),this.GameLayer=this.add.layer(),this.UILayer=this.add.layer(),this.MenuLayer=this.add.layer().setVisible(!1).setDepth(10),null==(t=this.input.mouse)||t.disableContextMenu(),this.input.setDefaultCursor("none"),this.game.events.on(Phaser.Core.Events.FOCUS,()=>{this.input.setDefaultCursor("none"),this.shouldDrawCursor=!0}),this.game.events.on(Phaser.Core.Events.BLUR,()=>{this.shouldDrawCursor=!1}),!this.input.keyboard)throw new Error("why no keyboard?");if(this.renderer instanceof Phaser.Renderer.WebGL.WebGLRenderer){const e=new gn(this.game);this.renderer.pipelines.add("lightshaft",e)}this.scene.launch(this.activeScene),(e=>{const t=e.add.image(e.scale.width-16,16,"fullscreen",0).setOrigin(1,0).setInteractive();t.on("pointerup",()=>{console.log("width",e.scale.width,"height",e.scale.height),console.log("baseSize",e.scale.baseSize),console.log("gameSize",e.scale.gameSize),console.log("displaySize",e.scale.displaySize),console.log("displaySize",e.scale.displaySize.width,e.scale.displaySize.height),e.scale.isFullscreen?(t.setFrame(0),e.scale.stopFullscreen()):(t.setFrame(1),e.scale.startFullscreen())},void 0)})(this),this.inputProvider.setOnPause(()=>{this.onMenu()})}onMenu(){console.trace(this.menuOpen),this.menuOpen?this.onResume():this.onPause()}onPause(){this.menuInit||(this.scene.launch(Fi),this.menuInit=!0),this.scene.setActive(!0,Fi),this.scene.setVisible(!0,Fi),this.scene.setActive(!1,this.activeScene),this.menuOpen=!0}onResume(){this.scene.setActive(!1,Fi),this.scene.setVisible(!1,Fi),this.scene.setActive(!0,this.activeScene),this.menuOpen=!1}launch(e){this.menuOpen&&this.onResume(),this.scene.key===Ni?(this.scene.stop(this.activeScene),this.scene.launch(e)):this.scene.start(e),this.activeScene=e}update(e,t){this.drawCursor()}},n(s,"instance"),s);((e,t,s)=>{for(var i,n=yn(t,s),r=e.length-1;r>=0;r--)(i=e[r])&&(n=i(t,s,n)||n);n&&fn(t,s,n)})([Ei()],vn.prototype,"update");let bn=vn,wn=class{constructor(e){var t,s,i;n(this,"ellipse"),n(this,"particles"),n(this,"portal"),n(this,"prompts",[{xbox:{frame:"xbox_button_color_x",color:16777215},kbm:{frame:"keyboard_e",color:16711935},text:"enter"}]),this.scene=e;const r=e.scale.baseSize.width/2,a=e.scale.baseSize.height/4;this.portal=this.scene.add.sprite(r,a,"portal").setOrigin(.5),this.particles=this.scene.add.sprite(r,a,"portal-particles").setOrigin(.5).setZ(10),this.particles.play("portal-start"),this.particles.on("animationcomplete",e=>{if(!(e instanceof Phaser.Animations.Animation))throw new Error("not an animation?");"portal-start"===e.key&&this.particles.play("portal-enabled")});const{x:o,y:h,width:c,height:l}=this.portal;if(this.ellipse=new Phaser.Geom.Ellipse(o,h,c-20,l-20),!0===this.scene.physics.config.debug){const e=this.scene.add.ellipse(o,h,c-20,l-20,15790320);null==(t=this.scene.ResourceLayer)||t.add(e)}null==(s=this.scene.ResourceLayer)||s.add(this.portal),null==(i=this.scene.ResourceLayer)||i.add(this.particles)}onInteract(){var e;this.scene.scene.start(Vi),this.scene.player1.inputProvider.removeOnInteract(this),null==(e=this.scene.player2)||e.inputProvider.removeOnInteract(this),bn.instance&&(bn.instance.activeScene=Vi)}onSelect(){}onCancel(){}update(){for(const e of[this.scene.player1,this.scene.player2]){if(!e)continue;const t=e.x,s=e.y;Phaser.Geom.Ellipse.Contains(this.ellipse,t,s)?e.inputProvider.setOnInteract(this):e.inputProvider.removeOnInteract(this)}}};class _n extends Phaser.Physics.Arcade.Sprite{constructor(e,t,s,i,r){var a,o;super(e,t,s,i,r),n(this,"type"),this.scene=e,this.type=r,null==(a=this.preFX)||a.setPadding(64),null==(o=this.preFX)||o.addShadow(),this.scene.add.existing(this),this.scene.drops.add(this)}}class xn{constructor(e,t,s,i,r){n(this,"drop"),this.scene=e,this.drop=new _n(e,t,s,i,r)}}const kn=["pepper","leek","potato","onion"];class Pn extends xn{constructor(e,t,s){let i;switch(Math.floor(4*Math.random())){case 0:default:i=kn[0];break;case 1:i=kn[1];break;case 2:i=kn[2];break;case 3:i=kn[3]}super(e,t,s,"crops",`${i}-seed`),n(this,"type"),this.type=i,this.drop.setScale(2)}}Phaser.Physics.Arcade.Sprite,Phaser.Physics.Arcade.Sprite,Phaser.Physics.Arcade.Sprite,Phaser.Physics.Arcade.Sprite,Math.max(20,0);const zn=e=>{const t=[];for(let i=0;i<e;i++){const s=Math.random()*((i+1)/e),n=160+80*Math.random();t.push({position:s,speed:n})}let s=1;return t.reduce((e,t)=>(s=Math.min(s,Math.abs(e.position-t.position)),t)),s<.1?(console.log("retrying"),zn(e)):t},Sn=class e{constructor(){for(let t=0;t<240;t++){if(t%2!=0){e.table.push([]);continue}const s=Math.ceil(2+2*Math.random());e.table.push(zn(s))}}static next(){e.instance||(e.instance=new e),e.idx>=e.table.length&&(console.warn("random numbers exhausted"),e.idx=0);const t=e.table[e.idx++];if(void 0===t)throw new Error;return t}};n(Sn,"idx",0),n(Sn,"table",[]),n(Sn,"instance"),Phaser.Scene;const In=["bat.png","blob.png","blob_1.png","blobie-walk copy.png","blobie-walk.png","brawler48x48.png","char.png","drone.png","portal-particles_240_340.png","portal_240_340.png","rat.png","stick-head.png","stick.png","thickius.png"],Tn=[1,5,25,125,625],En="xp_",Mn=["grid","castle","pebble","menu-item","border","border-wide","close-icon","pickaxe","sword","bow","arrow","reticle"],On=new Map([["grid","grid-ps2.png"],["castle","castle.png"],["pebble","pebble.gif"],["menu-item","border-wide.png"],["close-icon","close-icon.png"]]);class An extends o.Scene{constructor(){super({key:Di,plugins:Phaser.Plugins.DefaultPlugins.DefaultScene})}init(){this.add.rectangle(1920,1824,3072,128).setOrigin(.5).setStrokeStyle(1,16777215);const e=this.add.rectangle(384,1824,4,124,16777215).setOrigin(.5);let t;this.load.on("progress",s=>{0===s&&(t=performance.now()),1===s&&performance.now(),e.width=4+3072*s})}preload(){this.load.setPath("assets"),this.load.image("logo","logo.png"),this.load.font("Roboto","fonts/Roboto/Roboto-VariableFont_wdth,wght.ttf"),this.load.font("AntonSC","fonts/Anton_SC/AntonSC-Regular.ttf"),this.load.font("MarcellusSC","fonts/Marcellus_SC/MarcellusSC-Regular.ttf"),this.load.spritesheet("brawler","animations/brawler48x48.png",{frameWidth:48,frameHeight:48}),this.preloadTexture(),this.load.spritesheet("fullscreen","ui/fullscreen.png",{frameWidth:64,frameHeight:64}),this.load.atlas("xbox","ui/xbox.png","ui/xbox.json"),this.load.atlas("kbm","ui/kbm.png","ui/kbm.json"),this.load.image("cursor-attack","ui/cursor-attack.png"),this.load.image("cursor-default","ui/cursor-default.png"),this.load.atlas("flares","particles/flares.png","particles/flares.json"),this.load.spritesheet("stick","animations/stick.png",{frameWidth:180,frameHeight:339.375}),this.load.spritesheet("stick-head","animations/stick-head.png",{frameWidth:18,frameHeight:18}),this.load.spritesheet("drone","animations/drone.png",{frameWidth:34,frameHeight:34}),this.load.spritesheet("blobie-walk","animations/blobie-walk.png",{frameWidth:34,frameHeight:34}),this.load.spritesheet("char","animations/char.png",{frameWidth:34,frameHeight:34}),this.load.spritesheet("rat","animations/rat.png",{frameWidth:34,frameHeight:34}),this.load.spritesheet("blob","animations/blob.png",{frameWidth:34,frameHeight:34}),this.load.spritesheet("bat","animations/bat.png",{frameWidth:34,frameHeight:34}),this.load.atlas("torch","animations/torch.png","animations/torch.json"),this.load.atlas("barrel","animations/barrel.png","animations/barrel.json"),this.load.atlas("tnt","animations/tnt.png","animations/tnt.json"),this.load.atlas("player1","animations/warrior.png","animations/warrior.json"),this.load.atlas("player2","animations/warrior2.png","animations/warrior.json"),this.load.atlas("crops","textures/crops.png","textures/crops.json"),In.forEach(e=>{const[t,s,i]=e.replace(".png","").split("_");void 0!==t&&void 0!==s&&void 0!==i&&this.load.spritesheet(t,`animations/${e}`,{frameWidth:parseInt(s),frameHeight:parseInt(i)})}),this.load.glsl("fire","shaders/fire.glsl"),this.load.glsl("lightshaft","shaders/lightshaft.glsl.js"),this.load.image("repeating-background","textures/tile.png"),this.load.image("tileset-grass","textures/tileset-grass.png")}preloadXP(){for(const e of Tn)this.load.image(`${En}${e}`,`textures/xp/${e}.png`)}preloadTexture(){const e="textures";for(const t of Mn){const s=On.get(t);void 0===s?this.load.image(t,`${e}/${t}.png`):this.load.image(t,`${e}/${s}`)}this.load.atlas("ores","textures/ores.png","textures/ores.json"),this.preloadXP()}create(){this.scene.start(Zi),this.scene.start(Ni)}}class $n extends Phaser.Physics.Arcade.Sprite{constructor(e,t,s,i){var r,a,o;if(!1===Tn.includes(i))throw new Error("invalid xp amount");super(e,t,s,`${En}${i}`),n(this,"timer"),n(this,"shader"),this.scene=e,this.amount=i,this.setScale(.5),null==(r=this.preFX)||r.setPadding(64),null==(a=this.preFX)||a.addShadow(),null==(o=this.preFX)||o.addGlow(),this.scene.add.existing(this),this.scene.drops.add(this),this.timer=this.scene.time.addEvent({delay:5e3,callback:()=>{this.collapse()},callbackScope:this,loop:!0})}destroy(e){this.timer.destroy(),super.destroy(e)}collapse(){const e=this.scene.physics.overlapCirc(this.x,this.y,250),t=new Set;for(const s of e){const e=s.gameObject;if(e instanceof $n&&e.amount===this.amount&&(t.add(e),5===t.size)){const e=5*this.amount;this.setTexture(`${En}${e}`),this.amount=e;for(const s of t)s!==this&&s.destroy();t.clear()}}}}var Cn=Object.defineProperty,Rn=Object.getOwnPropertyDescriptor;const jn=[{rarity:"common",chance:.73375,required:5,size:1,health:1,dmg:1,prefxPadding:16,glow:16777215},{rarity:"uncommon",chance:.195,required:10,size:1.5,health:1.2,dmg:1.2,prefxPadding:16,glow:2031360},{rarity:"rare",chance:.0525,required:25,size:1.8,health:1.5,dmg:1.5,prefxPadding:16,glow:28927},{rarity:"epic",chance:.014,required:100,size:1.8,health:2,dmg:2,prefxPadding:16,glow:10696174},{rarity:"legendary",chance:.00375,required:500,size:2,health:3,dmg:3,prefxPadding:16,glow:16744448},{rarity:"mythic",chance:.001,required:1e3,size:2.5,health:5,dmg:5,prefxPadding:16,glow:16711680}];let Fn=0;const Dn=new Set(["common","uncommon","rare","epic","legendary"]);for(const zr of jn){Dn.delete(zr.rarity);const e=Math.round(1e5*(Fn+zr.chance))/1e5;zr.rand=[Fn,e],Fn=e}if(1!==Fn)throw new Error(`sum ${Fn} is incorrect`);if(0!==Dn.size)throw new Error("missing rarity");class Zn extends Phaser.Physics.Arcade.Sprite{constructor(e,t){var s;if(super(e,0,0,t.TEXTURE_KEY),n(this,"lastDmgTime",0),n(this,"applyDamage",null),n(this,"dmg",{min:0,max:0}),n(this,"health",{curr:0,max:0}),n(this,"healthBar",null),n(this,"id",crypto.randomUUID().slice(-4)),n(this,"rarities"),n(this,"rarity"),n(this,"glow",{common:void 0,uncommon:void 0,rare:void 0,epic:void 0,legendary:void 0,mythic:void 0}),n(this,"target",null),n(this,"updated",500),this.scene=e,this.info=t,this.setOrigin(.5).setScale(2),this.health={curr:t.stats.health,max:t.stats.health},this.dmg={min:this.info.stats.damage,max:this.info.stats.damage},this.scene.physics.add.existing(this),this.scene.physics.add.collider(this.scene.player1.body,this,()=>{this.applyDamage="player1"}),this.scene.player2.visible&&this.scene.physics.add.collider(this.scene.player2.body,this,()=>{this.applyDamage="player2"}),!jn[0])throw new Error("RARITIES is not set?");this.rarities=[{...jn[0]}],this.rarity=jn[0],null==(s=this.scene.enemies)||s.add(this),this.setBounce(1)}enableNew(){}location(){if(!this.target)return;const e=Math.min(this.scene.scale.width,this.scene.scale.height)/2,t=3*e/4+Math.random()*(e/4),s=2*Math.PI*Math.random(),i=t*Math.cos(s)+this.target.x,n=t*Math.sin(s)+this.target.y;this.setPosition(i,n)}damage(e){!this.scene.debugging&&this.applyDamage&&(this.lastDmgTime<e-this.info.stats.attackSpeed&&(this.lastDmgTime=e,this.scene[this.applyDamage].applyDamage(this.dmg.min)),this.applyDamage=null)}dealDamage(e){this.health.curr-=e}updateRarityData(){const e=this.rarities[this.rarities.length-1];if(!e)throw new Error("");if("mythic"!==e.rarity)if(0===e.required){const e=jn[this.rarities.length];if(!e)throw new Error("");this.rarities.push({...e})}else e.required--}spawn(e,t=1){var s,i;this.updateRarityData(),this.target=e;const n=Math.random(),r=this.rarities.find(e=>void 0!==e.rand&&n>e.rand[0]&&n<e.rand[1])??this.rarities[0];if(!r)throw new Error(`${n}`);null==(s=this.preFX)||s.setPadding(r.prefxPadding);for(const[o,h]of Object.entries(this.glow))h&&(o===r.rarity?h.setActive(!0):h.setActive(!1));this.glow[r.rarity]||(this.glow[r.rarity]=null==(i=this.preFX)?void 0:i.addGlow(r.glow));const a=this.info.stats.health*1.02**(t-1)*r.health;this.dmg={min:this.info.stats.damage*r.dmg,max:this.info.stats.damage*r.dmg},this.health.curr=a,this.health.max=a,this.setScale(r.size),this.setActive(!0),this.setVisible(!0),this.location(),this.body instanceof Phaser.Physics.Arcade.Body&&this.body.setEnable(!0)}die(){console.debug(this.id,"dead"),this.setVisible(!1),this.body instanceof Phaser.Physics.Arcade.Body&&this.body.setEnable(!1);const e=this.x,t=this.y,s=this.rarity.chance**5,i=this.rarity.chance;Math.random()>s&&(Math.random()>i?(new Pn(this.scene,e-10,t),new $n(this.scene,e+10,t,this.info.loot.xp)):new $n(this.scene,e,t,this.info.loot.xp)),new Pn(this.scene,e-10,t-20),this.setActive(!1)}findPlayer(e,t){this.scene.player2?this.target=this.scene.physics.closest(this,[this.scene.player1,this.scene.player2]):this.target=this.scene.player1}update(e,t){(e=>{var t;if(e.health.curr<=0&&e.die(),e.health.bar||(e.health.bar=e.scene.add.graphics(),null==(t=e.scene.UILayer)||t.add(e.health.bar)),e.health.bar.clear(),e.health.curr===e.health.max||e.health.curr<=0)return;const s=e.x-50,i=e.y-50-30;e.health.bar.fillStyle(2236962,1),e.health.bar.fillRect(s,i,100,20);const n=100/e.health.max;e.health.bar.fillStyle(65280,1),e.health.bar.fillRect(s,i,Phaser.Math.Clamp(e.health.curr*n,0,100),20)})(this),this.move(t),this.damage(e),this.reachedPlayer&&this.play(this.info.FRAMES.ATTACK,!0),this.play(this.info.FRAMES.MOVE,!0)}move(e){this.updated<500?this.updated+=e:(this.scene.player2.visible?this.target=this.scene.physics.closest(this,[this.scene.player1,this.scene.player2]):this.target=this.scene.player1,this.target&&(this.reachedPlayer||(this.updated=0,this.flipX=this.target.x<this.x,this.scene.physics.moveToObject(this,this.target,this.info.stats.moveSpeed))))}distanceToPlayer(){if(!this.target)return Number.MAX_SAFE_INTEGER;const e=this.target.getBounds(),t=this.getBounds(),s=e.centerX-t.centerX,i=e.centerY-t.centerY;return s*s+i*i}get reachedPlayer(){return this.distanceToPlayer()<this.info.stats.range**2}}((e,t,s)=>{for(var i,n=Rn(t,s),r=e.length-1;r>=0;r--)(i=e[r])&&(n=i(t,s,n)||n);n&&Cn(t,s,n)})([(()=>{const e=new WeakMap;return(t,s,i)=>{const n=i.value;if(0==("function"==typeof(r=n)&&2===r.length))throw new Error("you fucked up a decorator dawg");var r;return i.value=function(t,s){const i=e.get(this)??0;t>1e3*i&&(e.set(this,i+1),this.constructor.name),n.call(this,t,s)},i}})()],Zn.prototype,"findPlayer");class Nn extends Phaser.Physics.Arcade.Group{constructor(e,t){super(e.physics.world,e,t.config),this.scene=e,this.info=t,this.runChildUpdate=!0}getFirstDead(){const e=super.getFirstDead(!1);return e instanceof Zn?e:!1===this.isFull()?new Zn(this.scene,this.info):void 0}spawn(e,t){for(let s=0;s<e;s++){const e=this.getFirstDead();e&&(e.spawn(t),super.add(e,!0))}return this}add(){const e=new Zn(this.scene,this.info);return super.add(e,!0),this}}class Bn{constructor(e,t={}){n(this,"scene"),n(this,"bar"),n(this,"text"),n(this,"config"),n(this,"x",0),n(this,"y",0),n(this,"width",0),n(this,"height",0),n(this,"percision"),this.scene=e;const s=.025*e.scale.height;this.config={x:t.x??s,y:t.y??e.scale.height-s,width:t.width??e.scale.width/3.5-s,height:t.height??s,percision:t.percision??0,color:t.color??65280,bgColor:t.bgColor??2236962,maxValue:t.maxValue??100,value:t.value??t.maxValue??100},this.width=this.config.width,this.height=this.config.height,this.x=this.config.x,this.y=this.config.y,this.bar=e.add.graphics().setScrollFactor(0),this.text=e.add.text(0,0,"",Xi).setOrigin(.5).setScrollFactor(0),this.text.x=this.x+this.width/2,this.text.y=this.y+this.config.height/2,this.percision=10**this.config.percision,this.draw()}update(e,t){this.config.value===e&&this.config.maxValue===t||(this.config.maxValue=t,this.config.value=Phaser.Math.Clamp(e,0,this.config.maxValue),this.draw())}draw(){this.bar.clear(),this.bar.lineStyle(6,0,.5),this.bar.strokeRect(this.x-3,this.y-3,this.width+6,this.config.height+6),this.bar.fillStyle(this.config.bgColor),this.bar.fillRect(this.x,this.y,this.width,this.config.height);const e=this.config.value/this.config.maxValue*this.width;this.bar.fillStyle(this.config.color),this.bar.fillRect(this.x,this.y,e,this.config.height),this.text.text=`${Math.round(this.config.value*this.percision)/this.percision} / ${this.config.maxValue}`}destroy(){this.bar.destroy(),this.text.destroy()}}const Vn={attack:{duration:250,delay:75,cooldown:1e3,delta:0,speed:1920,range:2e3,damage:{start:9,end:15},projectiles:{total:2,fired:0,pierce:2},projectile:{vx:0,vy:0,vangular:0,pierce:Number.POSITIVE_INFINITY,projectiles:2,speed:800,duration:150,offsetAngle:0,range:0,damage:40},deviation:Math.PI/64}};class Kn extends Phaser.Physics.Arcade.Sprite{constructor(e,t,s,i,r,a){super(e,t,s,"arrow"),n(this,"enemiesDamaged",[]),n(this,"pierce",0),n(this,"size"),n(this,"hitbox"),n(this,"created",!1),this.scene=e,this.rotation=i,this.stats=a,this.size=Math.min(this.width,this.height),e.add.existing(this),e.physics.add.existing(this),this.setRotation(i).setScale(Wn),this.setCollideWorldBounds(!0)}create(){if(this.created)return;const e=Math.cos(this.rotation),t=Math.sin(this.rotation),s=e*this.stats.attack.speed,i=t*this.stats.attack.speed;this.setVelocity(s,i),this.scene.time.addEvent({delay:this.stats.attack.range/this.stats.attack.speed*1e3,callback:()=>{this.destroy()}}),this.created=!0}destroy(){var e;null==(e=this.hitbox)||e.destroy(),super.destroy()}updateHitbox(){void 0===this.hitbox&&(this.hitbox=this.scene.physics.add.body(this.x,this.y,this.size,this.size));const e=Math.cos(this.rotation)*(this.width/2),t=Math.sin(this.rotation)*(this.width/2);this.hitbox.x=this.x+e-this.hitbox.width/2,this.hitbox.y=this.y+t-this.hitbox.height/2}update(e,t){var s;this.create(),this.updateHitbox();const{left:i,top:n,width:r,height:a}=this.getBounds(),o=this.scene.physics.overlapRect(i,n,r,a);for(const h of o){const e=h.gameObject;e instanceof Zn&&!1!==(null==(s=e.body)?void 0:s.enable)&&(this.enemiesDamaged.includes(e)||(e.dealDamage(this.stats.attack.projectile.damage),this.enemiesDamaged.push(e),this.pierce++,this.pierce>=this.stats.attack.projectiles.pierce&&this.destroy()))}}}const Un={attack:{duration:250,delay:150,cooldown:2e3,delta:0,speed:3840,range:2e3,damage:{start:9,end:15},projectiles:{total:2,fired:0,pierce:2},projectile:{vx:0,vy:0,vangular:800,pierce:Number.POSITIVE_INFINITY,projectiles:2,speed:800,duration:150,offsetAngle:800*Phaser.Math.DEG_TO_RAD*.15/2,range:0,damage:40},deviation:0}};class Ln extends Phaser.Physics.Arcade.Sprite{constructor(e,t,s,i,r,a){super(e,t,s,"sword"),n(this,"enemiesDamaged",[]),n(this,"pierce",0),n(this,"created",!1),this.scene=e,this.stats=a,e.add.existing(this),e.physics.add.existing(this),this.stats.attack.projectile.vangular=this.stats.attack.projectile.vangular*r;const o=this.stats.attack.projectile.vangular*(this.stats.attack.projectile.duration/1e3),h=Phaser.Math.DEG_TO_RAD*(o/2);this.setRotation(i-h).setScale(Wn).setOrigin(-.5,.5),this.setCollideWorldBounds(!0)}create(){this.created||(this.setVelocityX(this.stats.attack.projectile.vx),this.setVelocityY(this.stats.attack.projectile.vy),this.body instanceof Phaser.Physics.Arcade.Body&&(this.body.maxAngular=2160),this.setAngularVelocity(this.stats.attack.projectile.vangular),this.scene.time.addEvent({delay:this.stats.attack.projectile.duration,callback:()=>{this.destroy()}}),this.created=!0)}update(e,t){if(this.create(),!this.scene.player)throw new Ii;this.x=this.scene.player.x,this.y=this.scene.player.y;const{left:s,top:i,width:n,height:r}=this.getBounds(),a=this.scene.physics.overlapRect(s,i,n,r);for(const o of a){const e=o.gameObject;e instanceof Zn&&(this.enemiesDamaged.includes(e)||(e.dealDamage(this.stats.attack.projectile.damage),this.enemiesDamaged.push(e),this.pierce++,this.pierce>=this.stats.attack.projectile.pierce&&this.destroy()))}}}class Gn{constructor(e){switch(n(this,"defaultStats"),n(this,"stats"),e){case"arrow":this.defaultStats=Vn,this.stats=structuredClone(Vn);break;case"sword":this.defaultStats=Un,this.stats=structuredClone(Un);break;default:throw new Error("invalid projectile")}}levelUp(e){this.stats.attack.projectile.damage=this.defaultStats.attack.projectile.damage*e.attack,this.stats.attack.projectile.range=this.defaultStats.attack.projectile.range*e.range,this.stats.attack.projectile.offsetAngle=this.defaultStats.attack.projectile.offsetAngle/e.accuracy,this.stats.attack.projectile.speed=this.defaultStats.attack.projectile.range*e.speed}}class Xn extends Gn{constructor(e,t,s){if(super(t),n(this,"projectiles"),n(this,"keys"),n(this,"cone"),n(this,"arc"),this.scene=e,this.projectile=t,this.player=s,this.projectiles=this.scene.physics.add.group(),this.projectiles.runChildUpdate=!0,!this.scene.input.keyboard)throw new Error("why no keyboard?");this.keys={alt:this.scene.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.ALT)},this.cone=this.scene.add.graphics({lineStyle:{width:4,color:16711935,alpha:.1},fillStyle:{color:0,alpha:.05}}),this.arc=this.scene.add.graphics({lineStyle:{width:4,color:16777215,alpha:.5},fillStyle:{color:0,alpha:0}})}attack({x:e,y:t,angles:{actual:s}}){const{projectiles:i}=this.stats.attack,n=i.fired%2==0?-1:1;if("sword"===this.projectile){const i=new Ln(this.scene,e,t,s,n,this.stats);this.projectiles.add(i)}else{const i=new Kn(this.scene,e,t,s,n,this.stats);this.projectiles.add(i)}}aim({angles:{target:e}}){if(this.cone.clear(),!this.player.inputProvider.aiming)return;const{deviation:t,range:s}=this.stats.attack;this.cone.beginPath(),this.cone.arc(this.player.x,this.player.y,s,e-t,e+t,!1).strokePath().lineTo(this.player.x,this.player.y).fillPath()}position(e,t){const{x:s,y:i,angle:n}=this.player.target(t),r=e+n,a=Math.random()*this.stats.attack.deviation*2-this.stats.attack.deviation,o=n+a,h=Math.cos(o),c=Math.sin(o),l=h*this.stats.attack.speed,d=c*this.stats.attack.speed;return{x:this.player.x+40*h,y:this.player.y+40*c,targetX:s,targetY:i,vx:l,vy:d,angles:{target:n,offset:r,actual:o,deviation:a}}}cooldown({targetX:e,targetY:t}){if(this.arc.clear(),!this.player.inputProvider.aiming)return;const{attack:s}=this.stats,i=s.cooldown,n=1-Math.min(s.delta/i,1),r=2*Math.PI*n;this.arc.arc(e,t,50,0,r,!1).strokePath().fillPath()}update(e,t){const{attack:s}=this.stats,{projectiles:i}=s;s.delta+=t;const n=i.fired%2==0?-1:1,r=this.position(n*this.stats.attack.projectile.offsetAngle,e);this.aim(r),s.delta>=s.cooldown+(s.duration+s.delay)*i.fired&&(i.fired++,this.attack(r),i.fired>=i.total&&(s.delta=0,i.fired=0)),this.cooldown(r)}}const qn=e=>{if(e<=1)return!1;if(2===e)return!0;if(e%2==0)return!1;for(let t=3;t*t<=e;t+=2)if(e%t===0)return!1;return!0},Wn=1.5;class Hn extends Phaser.Physics.Arcade.Sprite{constructor(e,t,s,i){super(e,t,s,i,void 0),this.scene=e,this.scene.add.existing(this),this.scene.layers.game.add(this),this.setOrigin(.5)}}class Yn{constructor(e,t,s,i,r){n(this,"container"),n(this,"_player"),n(this,"weapons",new Map),n(this,"active_weapon","bow"),n(this,"hasBody",!1),n(this,"visible",!0),n(this,"_reticle"),n(this,"health",{curr:100,max:100}),n(this,"_hpbar"),n(this,"xp",{curr:0,max:5}),n(this,"_xpbar"),n(this,"inventory",{plants:[]}),n(this,"_inventoryUI"),n(this,"level",1),n(this,"stats",{attack:1,range:1,accuracy:1,speed:1,regen:0}),n(this,"hitbox",{}),n(this,"_curve"),n(this,"graphics"),n(this,"alive",!0),n(this,"dashStart",0),n(this,"dashing",!1),n(this,"lastPosition",[1,0]),n(this,"lastHpUpdate",0),this.scene=e,this.textureKey=i,this.inputProvider=r,this.container=this.scene.add.container(t,s),this.reticle&&this.container.add(this.reticle),this.container.add(this.player),this.graphics=this.scene.add.graphics(),this.graphics.lineStyle(2,16711680,1),this.container.add(this.graphics),e instanceof sr&&(this.weapons.set("sword",new Xn(e,"sword",this)),this.weapons.set("bow",new Xn(e,"arrow",this))),this.scene.layers.game.add(this.container)}get player(){return this._player??(this._player=new Hn(this.scene,0,0,this.textureKey)),this._player}get body(){if(this.container.body||this.scene.physics.add.existing(this.container),this.container.body instanceof Phaser.Physics.Arcade.Body)return this.hasBody||(this.container.body.setSize(0,0),this.hasBody=!0),this.container.body;throw new Error("idk")}get x(){return this.body.x}get y(){return this.body.y}setVisible(e){var t;this.player.setVisible(e),null==(t=this.reticle)||t.setVisible(e),this.visible=e}destroy(e){var t;this.container.destroy(e),this.player.destroy(e),null==(t=this.reticle)||t.destroy(e),this._reticle=void 0,this._player=void 0,this.container=void 0}get reticle(){return this.scene instanceof sr?(this._reticle||(this._reticle=this.scene.add.sprite(0,0,"reticle").setOrigin(.5),this.scene.layers.game.add(this._reticle),this._reticle.setBelow(this.player)),this._reticle):null}get hpbar(){if(!(this.scene instanceof sr))return null;if(!this._hpbar){const e=26,t=52,s=this.scene.scale.width/3.5-e,i="player1"===this.textureKey?0:130-this.scene.scale.height,n={color:16711680,x:("player1"===this.textureKey?0:this.scene.scale.width-s-2*e)+e,y:i+this.scene.scale.height-2*e-t,width:s,height:t,percision:1};this._hpbar=new Bn(this.scene,n)}return this._hpbar}get xpbar(){if(!(this.scene instanceof sr))return null;const e="player1"===this.textureKey?0:130-this.scene.scale.height;if(!this._xpbar){const t=52,s=26,i=26,n={color:16777215,x:t,y:e+this.scene.scale.height-s-i,width:this.scene.scale.width-2*t,height:i,percision:0};this._xpbar=new Bn(this.scene,n)}return this._xpbar}get inventoryUI(){return this.scene instanceof sr?("player1"!==this.textureKey&&this.scene.scale.height,this._inventoryUI||(this._inventoryUI=this.scene.add.container()),this._inventoryUI):null}updateInventory(e){var t;const s=this.scene.add.sprite(40+40*Math.floor(this.inventory.plants.length/30),150+this.inventory.plants.length%30*40,"crops",e).setScale(3);null==(t=this.inventoryUI)||t.add(s),this.inventory.plants.push(e)}get curve(){return this._curve??(this._curve=new Phaser.Curves.Ellipse(10,35,50,20)),this._curve}getBounds(e){return this.player.getBounds(e)}physics(){if(this.body.enable!==this.visible&&(this.body.enable=this.visible),!(this.scene instanceof sr))return;const{width:e,height:t}=this.getBounds(),s=this.x-e/2,i=this.y-t/2;if(void 0===this.hitbox.loot){const n=this.scene.physics.add.body(s,i,e,t);return this.hitbox={loot:n},void this.scene.physics.add.collider(n,this.scene.drops,(e,t)=>{t instanceof $n&&(console.log(t),this.xp.curr+=t.amount,t.destroy()),t instanceof _n&&(this.updateInventory(t.type),t.destroy())})}this.hitbox.loot.x=s,this.hitbox.loot.y=i}flickerSprite(e,t){let s=0;const i=this.scene.time.addEvent({delay:50,callback:()=>{e.visible=!e.visible,e.tint=16711680,s+=50,s>=t&&(e.visible=!0,e.tint=16777215,i.remove())},callbackScope:this,loop:!0})}applyDamage(e){this.health.curr-=e,this.flickerSprite(this.player,200)}die(){this.scene.scene.start(Bi),bn.instance&&(bn.instance.activeScene=Bi),this.alive&&(this.alive=!1)}levelUp(){if(this.xp.curr>=this.xp.max){this.xp.curr=this.xp.curr%this.xp.max,this.xp.max=(()=>{let e=this.xp.max+1;for(;;){if(qn(e))return e;e++}})(),this.level+=1,this.stats.attack=1.05*this.stats.attack,this.stats.speed=1.025*this.stats.speed,this.stats.accuracy=1.1*this.stats.accuracy,this.stats.range=1.1*this.stats.range,this.stats.regen=this.stats.regen+.2;for(const[,e]of this.weapons)e.levelUp(this.stats)}}updateResources(){var e,t,s;this.scene instanceof sr&&this.levelUp(),null==(e=this.xpbar)||e.update(this.xp.curr,this.xp.max),null==(t=this.hpbar)||t.update(this.health.curr,this.health.max),null==(s=this.inventoryUI)||s.setPosition(this.x-this.scene.scale.width/2,this.y-this.scene.scale.height/2),this.health.curr<=0&&this.die()}hp(e,t){this.health.curr<this.health.max?this.health.curr+=this.stats.regen*(t/1e3):(this.lastHpUpdate+=t,this.lastHpUpdate>1e3&&this.health.curr<this.health.max&&(this.health.curr+=this.stats.regen,this.lastHpUpdate=0))}add(e){return this.scene.layers.game.add(e),this.container.add(e),this}target(e){var t;const s=this.inputProvider.target(this);this.scene.debugging&&this.curve.draw(this.graphics,64);const{x:i,y:n}=this.curve.getPoint(s.angle/(2*Math.PI));return null==(t=this.reticle)||t.setRotation(s.angle).setPosition(i,n),s}update(e,t){this.physics(),!1===this.visible?this.inputProvider.refresh():this.inputProvider.update(e,t),this.updateResources(),this.hp(e,t);const s=this.weapons.get(this.active_weapon);if(s&&this.visible&&s.update(e,t),!(this.body instanceof Phaser.Physics.Arcade.Body))return;this.inputProvider.dashing&&(this.dashStart=e,this.inputProvider.dashing=!1),this.dashing=this.dashStart+200>e,this.body.checkCollision.none=this.dashing;let i=320*this.stats.speed;this.dashing&&(i*=5);const[n,r]=this.inputProvider.position();n<0?this.player.flipX=!0:n>0&&(this.player.flipX=!1),0===n&&0===r?this.player.play(`${this.textureKey}-idle`,!0):this.player.play(`${this.textureKey}-move`,!0);const a=i*n,o=i*r;this.body instanceof Phaser.Physics.Arcade.Body&&this.body.setVelocity(a,o)}}const Jn=[{TEXTURE_KEY:"torch",FRAMES:{IDLE:{key:"torch-idle",config:{start:0,end:6}},MOVE:{key:"torch-move",config:{start:7,end:11}},ATTACK:{key:"torch-attack",config:{start:13,end:18}}},frameRate:10,stats:{level:1,damage:5,attackSpeed:400,moveSpeed:160,health:80,range:100},loot:{xp:1},config:{maxSize:100},metadata:{startTime:0,spawn:[{rate:2e3,count:1,max:25},{rate:1500,count:1,max:50},{rate:1e3,count:1,max:50},{rate:500,count:1,max:100},{rate:1e3,count:1,max:75},{rate:2e3,count:1,max:25}],lastSpawn:0}},{TEXTURE_KEY:"barrel",FRAMES:{IDLE:{key:"barrel-idle",config:{frames:[0,1]}},MOVE:{key:"barrel-move",config:{start:6,end:11}},ATTACK:{key:"barrel-attack",config:{start:13,end:18}}},frameRate:10,stats:{level:2,damage:20,attackSpeed:800,moveSpeed:320/3,health:250,range:100},config:{maxSize:50},loot:{xp:5},metadata:{startTime:120,spawn:[{rate:2e3,count:1,max:15},{rate:1e3,count:1,max:25},{rate:500,count:1,max:50},{rate:1e3,count:1,max:25},{rate:2e3,count:1,max:15}],lastSpawn:0}},{TEXTURE_KEY:"tnt",FRAMES:{IDLE:{key:"tnt-idle",config:{frames:[0,1]}},MOVE:{key:"tnt-move",config:{start:1,end:6}},ATTACK:{key:"tnt-attack",config:{start:13,end:18}}},frameRate:10,stats:{level:3,damage:5,attackSpeed:200,moveSpeed:320,health:50,range:250},config:{maxSize:25},loot:{xp:1},metadata:{startTime:240,spawn:[{rate:2e3,count:1,max:15},{rate:1e3,count:1,max:25},{rate:500,count:1,max:50},{rate:1e3,count:1,max:25},{rate:2e3,count:1,max:15}],lastSpawn:0}}];class Qn{constructor(e,t){n(this,"groups",new Map),n(this,"elapsed",0),this.scene=e,this.player=t;for(const s of Jn)this.groups.set(s.TEXTURE_KEY,new Nn(this.scene,structuredClone(s)));this.elapsed=0}spawn(e,t){const s=this.groups.get(e);null==s||s.spawn(t,this.player)}update(e,t){this.elapsed+=t;const s=Math.floor(this.elapsed/1e3),i=Math.floor(s/60);for(const[,n]of this.groups){const{info:{metadata:r}}=n,{startTime:a,spawn:o}=r,h=o[i]??o[o.length-1];if(!h)throw new Error("something's wrong");if(s>=a&&r.lastSpawn+h.rate<e){const t=h.max-n.countActive();n.spawn(Math.min(t,h.count),this.player),r.lastSpawn=e}n.preUpdate(e,t)}}}var er=Object.defineProperty,tr=Object.getOwnPropertyDescriptor;class sr extends on{constructor(){super(Vi),n(this,"enemiesEnabled",!1),n(this,"_xpbar"),n(this,"_hpbar"),n(this,"displayTimeTime",0),n(this,"_displayTime"),n(this,"enemyManager1"),n(this,"enemyManager2"),n(this,"enemies",null),n(this,"active",!0),n(this,"_drops"),n(this,"sizer"),n(this,"parent"),n(this,"handlerScene")}get xpbar(){if(!this._xpbar){const e=52,t=26,s=26,i={color:16777215,x:e,y:this.scale.height-t-s,width:this.scale.width-2*e,height:s,percision:0};this._xpbar=new Bn(this,i)}return this._xpbar}get hpbar(){if(!this._hpbar){const e=26,t=52,s={color:16711680,x:e,y:this.scale.height-2*e-t,width:this.scale.width/3.5-e,height:t,percision:1};this._hpbar=new Bn(this,s)}return this._hpbar}get displayTime(){return this._displayTime||(this._displayTime=this.add.text(this.scale.width/2,200,"",Xi)),this._displayTime}shutdown(){var e,t,s,i;super.shutdown(),console.trace("shutting down action scene"),null==(e=this._hpbar)||e.destroy(),this._hpbar=void 0,null==(t=this._xpbar)||t.destroy(),this._xpbar=void 0,null==(s=this._drops)||s.destroy(),this._drops=void 0,null==(i=this._displayTime)||i.destroy(),this._displayTime=void 0,this.displayTimeTime=0}get drops(){return this._drops??(this._drops=this.physics.add.group())}create(){this.enemies=this.physics.add.group(),this.physics.add.collider(this.enemies,this.enemies),this.enemyManager1=new Qn(this,this.player1),this.enemyManager2=new Qn(this,this.player2),this.events.once(Phaser.Scenes.Events.SHUTDOWN,()=>{this.shutdown()},this)}update(e,t){var s,i;this.active&&(this.player1.update(e,t),this.player2.update(e,t),this.enemiesEnabled?(null==(s=this.enemyManager1)||s.update(e,t),this.player2.visible&&(console.log(this.player2.visible),null==(i=this.enemyManager2)||i.update(e,t)),this.displayTimeTime+=t,this.displayTime.text=`${Math.round(this.displayTimeTime/1e3)}`):0===this.drops.countActive(!0)?(this.config.save({lastPlayed:Date.now()}),this.enemiesEnabled=!0):this.config.load().lastPlayed+3e5<Date.now()?(this.drops.add(new $n(this,this.player1.x,this.player1.y+150,1)),this.drops.add(new $n(this,this.player1.x+300,this.player1.y+300,1)),this.drops.add(new $n(this,this.player1.x+300,this.player1.y-300,1)),this.drops.add(new $n(this,this.player1.x-300,this.player1.y+300,1)),this.drops.add(new $n(this,this.player1.x-300,this.player1.y-300,1))):this.enemiesEnabled=!0)}}n(sr,"key",""),((e,t,s)=>{for(var i,n=tr(t,s),r=e.length-1;r>=0;r--)(i=e[r])&&(n=i(t,s,n)||n);n&&er(t,s,n)})([Ei()],sr.prototype,"update");const ir=(e,t)=>{e.level<=t&&(0===e.prerequisites.length||(e.level=t+1));for(const s of e.children)ir(s,e.level)},nr=e=>e.id.slice(0,e.id.lastIndexOf("_")),rr=(e,t)=>{if(t.availablePoints<e.cost)return!1;if((t.spent.get(e.id)??0)>=e.maxPoints)return!1;for(const s of e.prerequisites)if((t.spent.get(s.id)??0)<s.points)return!1;return!0},ar={damage_1:{id:"damage_1",name:"Damage I",description:"Increase base damage by 5%",cost:1,maxPoints:5,prerequisites:[],level:0},damage_2:{id:"damage_2",name:"Damage II",description:"Increase base damage by 10%",cost:2,maxPoints:5,prerequisites:[{id:"damage_1",points:1,total:5}],level:0},attack_speed_1:{id:"attack_speed_1",name:"Attack Speed I",description:"Increases attack speed by 10%",cost:1,maxPoints:5,prerequisites:[],level:0},attack_speed_2:{id:"attack_speed_2",name:"Attack Speed II",description:"Increases attack speed by 20%",cost:2,maxPoints:5,prerequisites:[{id:"attack_speed_1",points:1,total:5}],level:0},attack_speed_3:{id:"attack_speed_3",name:"Attack Speed III",description:"Increases attack speed by 30%",cost:3,maxPoints:3,prerequisites:[{id:"attack_speed_2",points:1,total:5}],level:0},attack_speed_4:{id:"attack_speed_4",name:"Attack Speed IV",description:"Massive increase to attack speed by 50%",cost:4,maxPoints:2,prerequisites:[{id:"attack_speed_3",points:1,total:5}],level:0},crit_chance_1:{id:"crit_chance_1",name:"Critical Chance I",description:"5% chance to deal double damage",cost:1,maxPoints:3,prerequisites:[{id:"damage_1",points:1,total:5}],level:2},crit_chance_2:{id:"crit_chance_2",name:"Critical Chance II",description:"+10% chance to critically hit",cost:3,maxPoints:2,prerequisites:[{id:"crit_chance_1",points:2}],level:4},crit_chance_3:{id:"crit_chance_3",name:"Critical Chance III",description:"Adds 15% more to critical chance",cost:3,maxPoints:1,prerequisites:[{id:"crit_chance_2",points:1,total:3}],level:0},crit_damage_1:{id:"crit_damage_1",name:"Critical Damage I",description:"Critical hits deal 50% more damage",cost:3,maxPoints:3,prerequisites:[{id:"crit_chance_1",points:1,total:3}],level:0},health_1:{id:"health_1",name:"Health I",description:"Increase maximum health by 10%",cost:1,maxPoints:5,prerequisites:[],level:0},health_2:{id:"health_2",name:"Health II",description:"Increase maximum health by 20%",cost:2,maxPoints:5,prerequisites:[{id:"health_1",points:1,total:5}],level:0},health_3:{id:"health_3",name:"Health III",description:"Increase maximum health by 30%",cost:3,maxPoints:5,prerequisites:[{id:"health_2",points:1,total:5}],level:0},health_4:{id:"health_4",name:"Health IV",description:"Massive increase to health by 50%",cost:5,maxPoints:3,prerequisites:[{id:"health_3",points:1,total:5}],level:0},armor_1:{id:"armor_1",name:"Armor I",description:"Increase armor by 10%",cost:2,maxPoints:5,prerequisites:[{id:"health_1",points:3}],level:2},armor_2:{id:"armor_2",name:"Armor II",description:"Increase armor by 10%",cost:2,maxPoints:5,prerequisites:[{id:"armor_1",points:1,total:5}],level:0},armor_3:{id:"armor_3",name:"Armor III",description:"Increase armor by 15%",cost:3,maxPoints:5,prerequisites:[{id:"armor_2",points:1,total:5}],level:0},armor_4:{id:"armor_4",name:"Armor IV",description:"Increase armor by 25%",cost:4,maxPoints:2,prerequisites:[{id:"armor_3",points:1,total:5}],level:0},mana_1:{id:"mana_1",name:"Mana I",description:"Increase mana pool by 10%",cost:1,maxPoints:5,prerequisites:[],level:0},mana_3:{id:"mana_3",name:"Mana III",description:"Increase mana regeneration by 10%",cost:3,maxPoints:5,prerequisites:[{id:"mana_2",points:1,total:5}],level:0},resource_efficiency:{id:"resource_efficiency",name:"Resource Efficiency",description:"Reduce resource consumption by 10%",cost:4,maxPoints:3,prerequisites:[{id:"mana_3",points:1,total:5}],level:0},health_regen_1:{id:"health_regen_1",name:"Health Regeneration I",description:"Regenerate health 5% faster",cost:1,maxPoints:5,prerequisites:[],level:0},health_regen_2:{id:"health_regen_2",name:"Health Regeneration II",description:"Regenerate health 10% faster",cost:2,maxPoints:5,prerequisites:[{id:"health_regen_1",points:1,total:5}],level:0},mana_regen_2:{id:"mana_regen_2",name:"Mana Regeneration II",description:"Regenerate mana 10% faster",cost:2,maxPoints:5,prerequisites:[{id:"mana_regen_1",points:1,total:5}],level:0},teleportation:{id:"teleportation",name:"Teleportation",description:"Unlocks teleportation ability",cost:10,maxPoints:1,prerequisites:[{id:"mana_2",points:1,total:5}],level:0},shield_ability:{id:"shield_ability",name:"Shield Ability",description:"Grants the ability to shield for 5 seconds",cost:8,maxPoints:1,prerequisites:[{id:"armor_2",points:1,total:5}],level:0},mana_2:{id:"mana_2",name:"Mana II",description:"Increase mana regen by 5%",cost:2,maxPoints:5,prerequisites:[{id:"mana_1",points:3}],level:1},damage_3:{id:"damage_3",name:"Damage III",description:"Increase damage by 15%",cost:3,maxPoints:5,prerequisites:[{id:"damage_2",points:3}],level:3},crit_damage_2:{id:"crit_damage_2",name:"Critical Damage II",description:"Crits deal +50% more damage",cost:3,maxPoints:3,prerequisites:[{id:"crit_damage_1",points:1},{id:"crit_chance_2",points:1}],level:5},mana_regen_1:{id:"mana_regen_1",name:"Mana Regen I",description:"Regenerate 5% mana/sec",cost:2,maxPoints:5,prerequisites:[{id:"mana_2",points:3}],level:3},damage_4:{id:"damage_4",name:"Damage IV",description:"Increases damage by 25%",cost:5,maxPoints:3,prerequisites:[{id:"damage_3",points:3}],level:5},berserk_mode:{id:"berserk_mode",name:"Berserk Mode",description:"Unlocks Berserk: +100% damage, -50% defense for 5s",cost:6,maxPoints:1,prerequisites:[{id:"damage_4",points:1}],level:7},shield_wall:{id:"shield_wall",name:"Shield Wall",description:"Activate to block 90% damage for 3 seconds",cost:6,maxPoints:1,prerequisites:[{id:"armor_1",points:3}],level:6},arcane_burst:{id:"arcane_burst",name:"Arcane Burst",description:"Unleash AoE spell consuming 50% mana",cost:6,maxPoints:1,prerequisites:[{id:"mana_regen_1",points:3}],level:6},precision_mastery:{id:"precision_mastery",name:"Precision Mastery",description:"Crits always do max damage",cost:7,maxPoints:1,prerequisites:[{id:"crit_damage_2",points:3},{id:"crit_chance_3",points:2}],level:8},overclock:{id:"overclock",name:"Overclock",description:"Temporarily double attack speed for 5 seconds (cooldown: 30s)",cost:8,maxPoints:1,prerequisites:[{id:"attack_speed_2",points:5}],level:8},divine_aegis:{id:"divine_aegis",name:"Divine Aegis",description:"One-time shield prevents fatal damage and heals 50%",cost:10,maxPoints:1,prerequisites:[{id:"shield_wall",points:1},{id:"health_1",points:5}],level:10},mana_overflow:{id:"mana_overflow",name:"Mana Overflow",description:"Grants double mana regen when under 30% mana",cost:7,maxPoints:1,prerequisites:[{id:"mana_regen_1",points:5}],level:8}},or=120*Wn,hr=70*Wn,cr=[255,32896,32768,16776960,16753920,16744272,8900331,4251856,65280,14329120];class lr{constructor(e,t,s){var i;n(this,"tree"),n(this,"graphics"),n(this,"updateVisual",(e,t,s)=>{const i=this.state.spent.get(e.id)??0;i>0?t.setFillStyle(52326):rr(e,this.state)?t.setFillStyle(13421568):t.setFillStyle(6711039),s.setText(`${e.name}\n(${i}/${e.maxPoints})`)}),n(this,"i",0),n(this,"startOffset",new Map),n(this,"endOffset",new Map),this.scene=e,this.state=t,this.setState=s,this.menu(),this.graphics=e.add.graphics(),null==(i=e.MenuLayer)||i.add(this.graphics),this.tree=((e,t,s)=>{const i=(e=>{const t=(e=>{const t=new Map;for(const i of Object.values(e))for(const e of i.prerequisites){const s=t.get(e.id)??[];s.push(i.id),t.set(e.id,s)}const s=i=>{const n=e[i];return{...n,children:(t.get(i)??[]).map(s),level:n.level??0}};return Object.values(e).filter(e=>0===e.prerequisites.length).map(e=>s(e.id))})(e),s=t.reduce((e,t)=>(t.children.length>0&&e.push(t),e),[]);for(const i of s)ir(i,0);return t})(e),n=new Map,r=new Map,a=({node:e,parentDepth:t})=>{var i,o;e.children.sort((t,s)=>{const i=nr(t)===nr(e),n=nr(s)===nr(e);return i&&!n?-1:n&&!i?1:0});const h=e.children.map(t=>a({node:t,parentDepth:e.level})),c=h[0],l=h[h.length-1];let d;if(0===h.length)d=n.get(e.level)??0;else if(1===h.length&&c){const t=c.column,s=n.get(e.level)??0;d=Math.max(t,s)}else if(c&&l){const t=(null==(i=h[e.children.findIndex(t=>nr(t)===nr(e))])?void 0:i.column)??Math.floor(c.column+l.column/2),s=n.get(e.level)??0;d=Math.max(t,s)}else console.log("wtf bro"),d=n.get(e.level)??0;d=Math.max(d,(null==(o=r.get(e.id))?void 0:o.col)??0);for(let s=t+1;s<=e.level;s++){const t=n.get(e.level)??0;n.set(s,Math.max(d+1,t))}return r.set(e.id,{...e,x:0,y:s.y+200+e.level*hr,col:d}),{column:d}};i.forEach(e=>{a({node:e,parentDepth:-1})}),r.entries();let o=Number.MAX_SAFE_INTEGER,h=Number.MIN_SAFE_INTEGER;r.forEach(e=>{o=Math.min(e.col,o),h=Math.max(e.col,h)});const c=2*s.x+(t-200)/2-(h-o)*or;return r.forEach(e=>{e.x=Math.max(s.x,c)+e.col*or}),r})(ar,this.scene.scale.width-1200,{x:600,y:600});for(const[,n]of this.tree)this.placeUpgrade(n,this.tree)}menu(){if(!this.scene.MenuLayer)throw new Ti("scene.MenuLayer");const e=this.scene.add.rectangle(0,0,this.scene.scale.baseSize.width,this.scene.scale.baseSize.height,10592673,.5).setOrigin(0),t=this.scene.add.rectangle(600,600,this.scene.scale.baseSize.width-1200,this.scene.scale.baseSize.height-1200,1118481,.9).setOrigin(0);this.scene.MenuLayer.add(e),this.scene.MenuLayer.add(t)}placeUpgrade(e,t){var s,i;const n=e.x,r=e.y,a=this.scene.add.rectangle(n,r,100,50,6711039).setScale(Wn),o=this.scene.add.text(n,r,e.name,{fontSize:12*Wn+"px",color:"#ffffff"}).setOrigin(.5);null==(s=this.scene.MenuLayer)||s.add(a),null==(i=this.scene.MenuLayer)||i.add(o),a.setInteractive({useHandCursor:!0}).on("pointerdown",t=>{t.rightButtonDown()?((e,t,s)=>{if((t.spent.get(e.id)??0)<=0)return!1;for(const[,i]of s)for(const s of i.prerequisites)if(s.id===e.id){const e=t.spent.get(i.id)??0;if(e>0&&e>=s.points)return!1}return!0})(e,this.state,this.tree)&&(((e,t)=>{const s=t.spent.get(e.id)??0;s<=0||(t.spent.set(e.id,s-1),t.availablePoints+=e.cost)})(e,this.state),this.setState(this.state),this.updateVisual(e,a,o)):rr(e,this.state)&&(((e,t)=>{if(!rr(e,t))return;const s=t.spent.get(e.id)??0;t.availablePoints=t.availablePoints-e.cost,t.spent.set(e.id,s+1)})(e,this.state),this.setState(this.state),this.updateVisual(e,a,o))});for(const h of e.prerequisites){const e=t.get(h.id);if(!e)throw new Error("");const s=this.startOffset.get(`${e.x}:${e.y}`)??e.x,i=e.y+50*Wn/2,a=this.endOffset.get(`${n}:${r}`)??n,o=r-50*Wn/2;this.startOffset.set(`${e.x}:${e.y}`,s+25),this.endOffset.set(`${n}:${r}`,a-25),this.graphics.beginPath(),this.graphics.lineStyle(4,cr[this.i++%cr.length]),this.graphics.moveTo(s,i),this.graphics.lineTo(s,i+25),this.graphics.lineTo(a,i+25),this.graphics.lineTo(a,o),this.graphics.lineTo(a-10,o-10),this.graphics.lineTo(a+10,o-10),this.graphics.lineTo(a,o),this.graphics.strokePath()}}}class dr extends Phaser.Scene{constructor(){super({key:Zi,plugins:Phaser.Plugins.DefaultPlugins.DefaultScene})}preload(){}create(){performance.now();this.createPlayerAnimations(),this.createIncrementalAnimations(),this.createEnemyAnimations(),this.createEffectsAnimations();performance.now();this.scene.stop()}createPlayerAnimations(){const e=this.anims;e.exists("player1-idle")||e.create({key:"player1-idle",frames:e.generateFrameNumbers("player1",{start:0,end:5}),frameRate:1,repeat:-1}),e.exists("player1-move")||e.create({key:"player1-move",frames:e.generateFrameNumbers("player1",{start:6,end:11}),frameRate:10,repeat:-1}),e.exists("player2-idle")||e.create({key:"player2-idle",frames:e.generateFrameNumbers("player2",{start:0,end:5}),frameRate:1,repeat:-1}),e.exists("player2-move")||e.create({key:"player2-move",frames:e.generateFrameNumbers("player2",{start:6,end:11}),frameRate:10,repeat:-1})}createIncrementalAnimations(){this.anims.create({key:"move",frames:this.anims.generateFrameNumbers("drone",{frames:[4,5]}),frameRate:8,repeat:-1}),this.anims.create({key:"smooth-move",frames:this.anims.generateFrameNumbers("blobie-walk",{start:0,end:7}),frameRate:16,repeat:-1}),this.anims.create({key:"idle",frames:this.anims.generateFrameNumbers("drone",{frames:[0,2]}),frameRate:4,repeat:-1}),this.anims.create({key:"idle2",frames:this.anims.generateFrameNumbers("drone",{frames:[1,3]}),frameRate:4,repeat:-1}),this.anims.create({key:"mine",frames:this.anims.generateFrameNumbers("drone",{frames:[0,2]}),frameRate:8,repeat:-1}),this.anims.create({key:"deliver",frames:this.anims.generateFrameNumbers("drone",{frames:[8,9]}),frameRate:8,repeat:-1})}createEnemyAnimations(){const e=this.anims;for(const t of Jn)this.load.spritesheet(t.TEXTURE_KEY,`assets/animations/${t.TEXTURE_KEY}.png`,{frameWidth:34,frameHeight:34});for(const t of Jn)for(const{key:s,config:i}of Object.values(t.FRAMES))e.exists(s)||e.create({key:s,frames:e.generateFrameNumbers(t.TEXTURE_KEY,i),frameRate:t.frameRate,repeat:-1})}createEffectsAnimations(){this.anims.create({key:"portal-start",frames:this.anims.generateFrameNumbers("portal-particles",{start:0,end:59}),frameRate:60,repeat:0}),this.anims.create({key:"portal-enabled",frames:this.anims.generateFrameNumbers("portal-particles",{start:60}),frameRate:60,repeat:-1}),this.anims.create({key:"portal",frames:this.anims.generateFrameNumbers("portal",{start:0,end:0}),frameRate:60,repeat:0})}}var ur=Object.defineProperty,pr=Object.getOwnPropertyDescriptor;class mr extends Phaser.Scene{constructor(){super({key:"Boot",plugins:Phaser.Plugins.DefaultPlugins.DefaultScene}),n(this,"gameScene"),n(this,"sceneRunning",null),n(this,"sceneStopped",!0)}preload(){}create(){this.cameras.main.setBackgroundColor("#FFF000"),this.cameras.main.setBackgroundColor("#CDD7E1"),this.launchScene(Di)}launchScene(e,t){this.scene.launch(e,t),this.gameScene=this.scene.get(e)}updateResize(e){e.scale.on("resize",this.resize,e);const t=e.scale.gameSize.width,s=e.scale.gameSize.height;e.parent=new Phaser.Structs.Size(t,s),e.sizer=new Phaser.Structs.Size(e.width,e.height,Phaser.Structs.Size.FIT,e.parent),e.parent.setSize(t,s),e.sizer.setSize(t,s),this.updateCamera(e)}resize(e){if(!this.sceneStopped){const t=e.width,s=e.height;this.parent.setSize(t,s),this.sizer.setSize(t,s);const i=this.cameras.main,n=this.sizer.width/this.game.screenBaseSize.width,r=this.sizer.height/this.game.screenBaseSize.height;i.setZoom(Math.max(n,r)),i.centerOn(this.game.screenBaseSize.width/2,this.game.screenBaseSize.height/2)}}updateCamera(e){const t=e.cameras.main,s=e.sizer.width/this.game.screenBaseSize.width,i=e.sizer.height/this.game.screenBaseSize.height;t.setZoom(Math.max(s,i)),t.centerOn(this.game.screenBaseSize.width/2,this.game.screenBaseSize.height/2)}update(e,t){}}((e,t,s)=>{for(var i,n=pr(t,s),r=e.length-1;r>=0;r--)(i=e[r])&&(n=i(t,s,n)||n);n&&ur(t,s,n)})([Ei()],mr.prototype,"update"),o.GameObjects.Sprite,performance.now(),performance.now(),performance.now();class gr extends Phaser.GameObjects.Text{constructor(e,t,s,i){super(e,e.scale.width/2,e.scale.height/3,s,{...Xi,fontSize:60}),n(this,"defaultText"),n(this,"timer"),this.setOrigin(.5),this.scene.add.existing(this),this.setPosition(e.scale.width/2,e.scale.height/3+t*this.height*1.5),this.defaultText=s,i&&this.setInteraction(i)}setInteraction(e){this.setInteractive().on("pointerdown",e).on("pointerover",e=>{var t;if(!(e instanceof Phaser.Input.Pointer))throw new Si;null==(t=this.timer)||t.destroy(),this.setColor("rgba(68,192,141,128)")}).on("pointerout",e=>{if(!(e instanceof Phaser.Input.Pointer))throw new Si;this.setColor("rgba(255,255,255,128)"),this.timer=this.scene.time.addEvent({delay:1e3,callback:()=>this.text=this.defaultText})})}}class fr extends Phaser.Scene{constructor(){super({key:Fi,visible:!1,active:!1}),n(this,"background"),n(this,"logo"),n(this,"title"),n(this,"_menu"),n(this,"_menuBorder"),n(this,"started",!1),n(this,"shine"),n(this,"wipeMenu"),n(this,"wipeBorder"),n(this,"_buttons"),n(this,"weapon",()=>{var e;const t=this.scene.get(Vi);if(6!==this.scene.getStatus(Vi))return;if(!(t instanceof sr))return;if(!(null==(e=t.player)?void 0:e.weapons))return;const s=t.player.weapons;let i=this.scale.baseSize.width/2-200*(s.size-1)-10*(s.size-1);for(const[n,r]of s){const e=this.add.rectangle(i,100,400,200,n===t.player.active_weapon?30464:16711680).setInteractive().on("pointerup",()=>{if(t.player){t.player.active_weapon=n;for(const t of this.buttons)t===e?t.setFillStyle(30464):t.setFillStyle(16711680)}}),s=this.add.text(i,100,n,{fontSize:40,color:"#ffffff",stroke:"#000000",strokeThickness:8,align:"center"}).setOrigin(.5);this.add.existing(e),this.add.existing(s),this.buttons.push(e),i+=410}}),n(this,"switchers",[]),n(this,"switcher",()=>{})}get menu(){if(!this._menu){const e=this.add.graphics();e.fillGradientStyle(68112,68112,68112,68112,.95),e.lineGradientStyle(5,12092939,12092939,12092939,12092939),this._menu=e}return this._menu}get menuBorder(){if(!this._menuBorder){const e=this.add.graphics();e.lineStyle(5,6808493),this._menuBorder=e}return this._menuBorder}create(){console.log("why recreate?"),console.log(this.plugins),this.menu.fillRect(0,0,0,0).setVisible(!1),this.menuBorder.strokeRect(0,0,0,0).setVisible(!1),this.weapon(),this.switcher();let e=this.scale.baseSize.height,t=this.scale.baseSize.width,s=0,i=0;for(const[,a]of Object.entries(this.buttons)){const n=a.getBounds();e=Math.min(n.top,e),t=Math.min(n.left,t),s=Math.max(n.right,s),i=Math.max(n.bottom,i)}e-=200,t-=400,s+=400,i+=200;const n=i-e,r=s-t;this.wipeMenu=this.menu.postFX.addReveal(.1,0,0),this.wipeBorder=this.menuBorder.postFX.addReveal(.1,0,0),this.wipeMenu.progress=0,this.wipeBorder.progress=0,this.menu.fillRect(t,e,r,n),this.menuBorder.strokeRect(t,e,r,n),this.menu.setVisible(!0),this.menuBorder.setVisible(!0),this.tweens.add({targets:this.wipeMenu,progress:1,repeatDelay:0,hold:0,yoyo:!1,repeat:0,duration:250}),this.tweens.add({targets:this.wipeBorder,progress:1,repeatDelay:0,hold:0,yoyo:!1,repeat:0,duration:250}),this.events.on(Phaser.Scenes.Events.RESUME,()=>{this.wipeMenu.progress=0,this.wipeBorder.progress=0,this.tweens.add({targets:this.wipeMenu,progress:1,repeatDelay:0,hold:0,yoyo:!1,repeat:0,duration:250}),this.tweens.add({targets:this.wipeBorder,progress:1,repeatDelay:0,hold:0,yoyo:!1,repeat:0,duration:250}),console.log("resume")},this),this.events.on(Phaser.Scenes.Events.PAUSE,()=>{this.wipeMenu.progress=1,this.wipeBorder.progress=1,this.tweens.add({targets:this.wipeMenu,progress:0,repeatDelay:0,hold:0,yoyo:!1,repeat:0,duration:250}),this.tweens.add({targets:this.wipeBorder,progress:0,repeatDelay:0,hold:0,yoyo:!1,repeat:0,duration:250}),console.log("pause")},this),this.shine??(this.shine=this.menuBorder.postFX.addShine(.5,.1,5,!1));for(const[,a]of Object.entries(this.buttons))a.postFX.add(this.shine);this.cameras.main.setBackgroundColor("rgba(0,0,0,128)")}shimmer(){this.time.addEvent({delay:1e3,loop:!0,callback:()=>{if(!this.shine)return;const e=.25+.5*Math.random();this.shine.speed=e,this.menuBorder.postFX.add(this.shine),this.time.addEvent({delay:2e3/e,callback:()=>{console.trace("stack"),this.shine&&this.menuBorder.postFX.remove(this.shine)}})}})}shutdown(){}get buttons(){if(!this._buttons){const e=new gr(this,0,"Resume");e.setInteraction(e=>{if(!(e instanceof Phaser.Input.Pointer))throw new Si;const t=this.scene.get(Ni);t instanceof bn&&(this.wipeMenu.progress=1,this.wipeBorder.progress=1,this.tweens.add({targets:this.wipeMenu,progress:0,repeatDelay:0,hold:0,yoyo:!1,repeat:0,duration:250}),this.tweens.add({targets:this.wipeBorder,progress:0,repeatDelay:0,hold:0,yoyo:!1,repeat:0,duration:250,onComplete:()=>{t.onResume()}}))});const t=new gr(this,2,"Options",()=>{t.text="I don't have any right now\ntry the full screen button "}),s=new gr(this,3,"Fullscreen",()=>{this.scale.startFullscreen()}),i=new gr(this,4,"Restart",()=>{const e=this.scene.get(Ni);e instanceof bn&&e.launch(Vi)}),n=new gr(this,5,"Switch");n.setInteraction(e=>{if(!(e instanceof Phaser.Input.Pointer))throw new Si;const t=this.scene.get(Ni);t instanceof bn&&(console.log(t.activeScene),t.activeScene===Vi?"to the useless page?"===n.text?(t.launch(Bi),n.text="Switch"):n.text="to the useless page?":"to the action?"===n.text?(t.launch(Vi),n.text="Switch"):n.text="to the action?")});const r="I was hoping you wouldn't click this one.",a="Are you sure?\nthis only works on the electron app",o=new gr(this,7,"Exit");o.setInteraction(()=>{o.text===r||o.text===a?o.text===a?"electronAPI"in window&&(console.log(window.electronAPI),window.electronAPI.exit()):o.text=a:o.text=r}),this._buttons={resume:e,options:t,fullscreen:s,restart:i,change:n,exit:o}}return this._buttons}}const yr={availablePoints:15,spent:new Map};class vr extends Phaser.Scene{constructor(){super({key:"UpgradeTree",visible:!1,active:!1}),n(this,"GameLayer",null),n(this,"UILayer",null),n(this,"MenuLayer",null)}create(){this.GameLayer=this.add.layer(),this.UILayer=this.add.layer(),this.MenuLayer=this.add.layer(),new lr(this,yr,()=>{console.log("setState")})}}const br=class e extends Phaser.Plugins.ScenePlugin{constructor(t,s,i){if(super(t,s,i),this.scene=t,"Scene2"===t.constructor.name)return;if(!(t instanceof nn))return;if(!e.config){const t=s.get($i.key);t instanceof $i&&(e.config=t)}const n=t.input.keyboard;if(n){n.addKey(Phaser.Input.Keyboard.KeyCodes.H).on("up",(e,t)=>{if(!(e instanceof Phaser.Input.Keyboard.Key))throw new Si;if(!(t instanceof KeyboardEvent))throw new Si});const e=n.createCombo([Phaser.Input.Keyboard.KeyCodes.ALT,Phaser.Input.Keyboard.KeyCodes.H],{resetOnMatch:!0}),t=n.createCombo([Phaser.Input.Keyboard.KeyCodes.ALT,Phaser.Input.Keyboard.KeyCodes.K],{resetOnMatch:!0});n.addKey(Phaser.Input.Keyboard.KeyCodes.BACKTICK).on("up",(e,t)=>{if(!(e instanceof Phaser.Input.Keyboard.Key))throw new Si;if(!(t instanceof KeyboardEvent))throw new Si;if(t.altKey){const e=!this.scene.physics.world.drawDebug;if(console.log("toggling debug to",e),console.log(this.scene),!(this.scene instanceof nn))return;this.scene.debugging=e,e||this.scene.physics.world.debugGraphic.clear(),this.scene.physics.world.drawDebug=e}}),n.on("keycombomatch",(s,i)=>{if(!(s instanceof Phaser.Input.Keyboard.KeyCombo))throw new Si;if(!(i instanceof KeyboardEvent))throw new Si;s===e&&console.log(this.scene),s===t&&console.log("combo!")})}}updateMapping(){var t;null==(t=e.config)||t.save({time:performance.now()})}};n(br,"key","SceneInput"),n(br,"mapping","_inputPlugin"),n(br,"config",null);let wr=br;const _r={key:wr.key,plugin:wr,start:!1,mapping:wr.mapping},xr=[mr,An,dr,sr,class extends on{constructor(){super(Bi),n(this,"resourceManager"),n(this,"ResourceLayer",null),n(this,"GameLayer",null),n(this,"UILayer",null),n(this,"MenuLayer",null),n(this,"portal"),n(this,"sizer"),n(this,"parent"),n(this,"handlerScene"),n(this,"portalEnabled",!1)}create(){var e;this.ResourceLayer=this.add.layer(),this.GameLayer=this.add.layer(),this.UILayer=this.add.layer(),this.MenuLayer=this.add.layer(),null==(e=this.input.mouse)||e.disableContextMenu(),this.resourceManager=new mn(this),this.setupAnimations(),this.portal=new wn(this),this.resourceManager.initialize("stone")}setupAnimations(){}update(e,t){var s,i;null==(s=this.resourceManager)||s.update(e,t),this.player1.update(e,t),this.player2.update(e,t),null==(i=this.portal)||i.update()}},vr,fr,bn],kr=o.Scale.FIT,Pr={type:o.AUTO,width:3840,height:2160,min:{width:720,height:480},scale:{mode:kr,autoCenter:o.Scale.CENTER_BOTH},physics:{default:"arcade",arcade:{gravity:{x:0,y:0},debug:!0}},fps:{limit:120},input:{gamepad:!0},parent:"game-container",plugins:{global:[ji,Ci],scene:[_r]},scene:xr};document.addEventListener("DOMContentLoaded",()=>{new o.Game({...Pr,parent:"game-container"})});
