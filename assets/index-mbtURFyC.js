var t,e,s,i,n,r,a,o,h,c,l,d,u,p,m,f,g,y,v,b,w,x,k,_,P,S,z,I,M,T,E,A,O,C,D,$,R=Object.defineProperty,N=t=>{throw TypeError(t)},j=(t,e,s)=>((t,e,s)=>e in t?R(t,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[e]=s)(t,"symbol"!=typeof e?e+"":e,s),F=(t,e,s)=>e.has(t)||N("Cannot "+s),G=(t,e,s)=>(F(t,e,"read from private field"),s?s.call(t):e.get(t)),Z=(t,e,s)=>e.has(t)?N("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(t):e.set(t,s),V=(t,e,s,i)=>(F(t,e,"write to private field"),i?i.call(t,s):e.set(t,s),s),B=(t,e,s)=>(F(t,e,"access private method"),s);import{r as W,g as U}from"./phaser-BUlrDfUd.js";!function(){const t=document.createElement("link").relList;if(!(t&&t.supports&&t.supports("modulepreload"))){for(const t of document.querySelectorAll('link[rel="modulepreload"]'))e(t);new MutationObserver(t=>{for(const s of t)if("childList"===s.type)for(const t of s.addedNodes)"LINK"===t.tagName&&"modulepreload"===t.rel&&e(t)}).observe(document,{childList:!0,subtree:!0})}function e(t){if(t.ep)return;t.ep=!0;const e=function(t){const e={};return t.integrity&&(e.integrity=t.integrity),t.referrerPolicy&&(e.referrerPolicy=t.referrerPolicy),"use-credentials"===t.crossOrigin?e.credentials="include":"anonymous"===t.crossOrigin?e.credentials="omit":e.credentials="same-origin",e}(t);fetch(t.href,e)}}();var K=W();function L(t,e,s){function i(s,i){var n;Object.defineProperty(s,"_zod",{value:s._zod??{},enumerable:!1}),(n=s._zod).traits??(n.traits=new Set),s._zod.traits.add(t),e(s,i);for(const t in a.prototype)t in s||Object.defineProperty(s,t,{value:a.prototype[t].bind(s)});s._zod.constr=a,s._zod.def=i}const n=(null==s?void 0:s.Parent)??Object;class r extends n{}function a(t){var e;const n=(null==s?void 0:s.Parent)?new r:this;i(n,t),(e=n._zod).deferred??(e.deferred=[]);for(const s of n._zod.deferred)s();return n}return Object.defineProperty(r,"name",{value:t}),Object.defineProperty(a,"init",{value:i}),Object.defineProperty(a,Symbol.hasInstance,{value:e=>{var i,n;return!!((null==s?void 0:s.Parent)&&e instanceof s.Parent)||(null==(n=null==(i=null==e?void 0:e._zod)?void 0:i.traits)?void 0:n.has(t))}}),Object.defineProperty(a,"name",{value:t}),a}class H extends Error{constructor(){super("Encountered Promise during synchronous parse. Use .parseAsync() instead.")}}class X extends Error{constructor(t){super(`Encountered unidirectional transform during encode: ${t}`),this.name="ZodEncodeError"}}const Y={};function q(t){return Y}function J(t,e){return"bigint"==typeof e?e.toString():e}function Q(t){return{get value(){{const e=t();return Object.defineProperty(this,"value",{value:e}),e}}}}function tt(t){return null==t}function et(t){const e=t.startsWith("^")?1:0,s=t.endsWith("$")?t.length-1:t.length;return t.slice(e,s)}const st=Symbol("evaluating");function it(t,e,s){let i;Object.defineProperty(t,e,{get(){if(i!==st)return void 0===i&&(i=st,i=s()),i},set(s){Object.defineProperty(t,e,{value:s})},configurable:!0})}function nt(t,e,s){Object.defineProperty(t,e,{value:s,writable:!0,enumerable:!0,configurable:!0})}function rt(...t){const e={};for(const s of t){const t=Object.getOwnPropertyDescriptors(s);Object.assign(e,t)}return Object.defineProperties({},e)}function at(t){return JSON.stringify(t)}const ot="captureStackTrace"in Error?Error.captureStackTrace:(...t)=>{};function ht(t){return"object"==typeof t&&null!==t&&!Array.isArray(t)}const ct=Q(()=>{var t;if("undefined"!=typeof navigator&&(null==(t=null==navigator?void 0:navigator.userAgent)?void 0:t.includes("Cloudflare")))return!1;try{return new Function(""),!0}catch(e){return!1}});function lt(t){if(!1===ht(t))return!1;const e=t.constructor;if(void 0===e)return!0;const s=e.prototype;return!1!==ht(s)&&!1!==Object.prototype.hasOwnProperty.call(s,"isPrototypeOf")}function dt(t){return lt(t)?{...t}:Array.isArray(t)?[...t]:t}const ut=new Set(["string","number","symbol"]);function pt(t){return t.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function mt(t,e,s){const i=new t._zod.constr(e??t._zod.def);return e&&!(null==s?void 0:s.parent)||(i._zod.parent=t),i}function ft(t){const e=t;if(!e)return{};if("string"==typeof e)return{error:()=>e};if(void 0!==(null==e?void 0:e.message)){if(void 0!==(null==e?void 0:e.error))throw new Error("Cannot specify both `message` and `error` params");e.error=e.message}return delete e.message,"string"==typeof e.error?{...e,error:()=>e.error}:e}const gt={safeint:[Number.MIN_SAFE_INTEGER,Number.MAX_SAFE_INTEGER],int32:[-2147483648,2147483647],uint32:[0,4294967295],float32:[-34028234663852886e22,34028234663852886e22],float64:[-Number.MAX_VALUE,Number.MAX_VALUE]};function yt(t,e=0){var s;if(!0===t.aborted)return!0;for(let i=e;i<t.issues.length;i++)if(!0!==(null==(s=t.issues[i])?void 0:s.continue))return!0;return!1}function vt(t,e){return e.map(e=>{var s;return(s=e).path??(s.path=[]),e.path.unshift(t),e})}function bt(t){return"string"==typeof t?t:null==t?void 0:t.message}function wt(t,e,s){var i,n,r,a,o,h;const c={...t,path:t.path??[]};if(!t.message){const l=bt(null==(r=null==(n=null==(i=t.inst)?void 0:i._zod.def)?void 0:n.error)?void 0:r.call(n,t))??bt(null==(a=null==e?void 0:e.error)?void 0:a.call(e,t))??bt(null==(o=s.customError)?void 0:o.call(s,t))??bt(null==(h=s.localeError)?void 0:h.call(s,t))??"Invalid input";c.message=l}return delete c.inst,delete c.continue,(null==e?void 0:e.reportInput)||delete c.input,c}function xt(t){return Array.isArray(t)?"array":"string"==typeof t?"string":"unknown"}function kt(...t){const[e,s,i]=t;return"string"==typeof e?{message:e,code:"custom",input:s,inst:i}:{...e}}const _t=(t,e)=>{t.name="$ZodError",Object.defineProperty(t,"_zod",{value:t._zod,enumerable:!1}),Object.defineProperty(t,"issues",{value:e,enumerable:!1}),t.message=JSON.stringify(e,J,2),Object.defineProperty(t,"toString",{value:()=>t.message,enumerable:!1})},Pt=L("$ZodError",_t),St=L("$ZodError",_t,{Parent:Error}),zt=t=>(e,s,i,n)=>{const r=i?Object.assign(i,{async:!1}):{async:!1},a=e._zod.run({value:s,issues:[]},r);if(a instanceof Promise)throw new H;if(a.issues.length){const e=new((null==n?void 0:n.Err)??t)(a.issues.map(t=>wt(t,r,q())));throw ot(e,null==n?void 0:n.callee),e}return a.value},It=t=>async(e,s,i,n)=>{const r=i?Object.assign(i,{async:!0}):{async:!0};let a=e._zod.run({value:s,issues:[]},r);if(a instanceof Promise&&(a=await a),a.issues.length){const e=new((null==n?void 0:n.Err)??t)(a.issues.map(t=>wt(t,r,q())));throw ot(e,null==n?void 0:n.callee),e}return a.value},Mt=t=>(e,s,i)=>{const n=i?{...i,async:!1}:{async:!1},r=e._zod.run({value:s,issues:[]},n);if(r instanceof Promise)throw new H;return r.issues.length?{success:!1,error:new(t??Pt)(r.issues.map(t=>wt(t,n,q())))}:{success:!0,data:r.value}},Tt=Mt(St),Et=t=>async(e,s,i)=>{const n=i?Object.assign(i,{async:!0}):{async:!0};let r=e._zod.run({value:s,issues:[]},n);return r instanceof Promise&&(r=await r),r.issues.length?{success:!1,error:new t(r.issues.map(t=>wt(t,n,q())))}:{success:!0,data:r.value}},At=Et(St),Ot=t=>(e,s,i)=>{const n=i?Object.assign(i,{direction:"backward"}):{direction:"backward"};return zt(t)(e,s,n)},Ct=t=>(e,s,i)=>zt(t)(e,s,i),Dt=t=>async(e,s,i)=>{const n=i?Object.assign(i,{direction:"backward"}):{direction:"backward"};return It(t)(e,s,n)},$t=t=>async(e,s,i)=>It(t)(e,s,i),Rt=t=>(e,s,i)=>{const n=i?Object.assign(i,{direction:"backward"}):{direction:"backward"};return Mt(t)(e,s,n)},Nt=t=>(e,s,i)=>Mt(t)(e,s,i),jt=t=>async(e,s,i)=>{const n=i?Object.assign(i,{direction:"backward"}):{direction:"backward"};return Et(t)(e,s,n)},Ft=t=>async(e,s,i)=>Et(t)(e,s,i),Gt=/^[cC][^\s-]{8,}$/,Zt=/^[0-9a-z]+$/,Vt=/^[0-9A-HJKMNP-TV-Za-hjkmnp-tv-z]{26}$/,Bt=/^[0-9a-vA-V]{20}$/,Wt=/^[A-Za-z0-9]{27}$/,Ut=/^[a-zA-Z0-9_-]{21}$/,Kt=/^P(?:(\d+W)|(?!.*W)(?=\d|T\d)(\d+Y)?(\d+M)?(\d+D)?(T(?=\d)(\d+H)?(\d+M)?(\d+([.,]\d+)?S)?)?)$/,Lt=/^([0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{12})$/,Ht=t=>t?new RegExp(`^([0-9a-fA-F]{8}-[0-9a-fA-F]{4}-${t}[0-9a-fA-F]{3}-[89abAB][0-9a-fA-F]{3}-[0-9a-fA-F]{12})$`):/^([0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[1-8][0-9a-fA-F]{3}-[89abAB][0-9a-fA-F]{3}-[0-9a-fA-F]{12}|00000000-0000-0000-0000-000000000000|ffffffff-ffff-ffff-ffff-ffffffffffff)$/,Xt=/^(?!\.)(?!.*\.\.)([A-Za-z0-9_'+\-\.]*)[A-Za-z0-9_+-]@([A-Za-z0-9][A-Za-z0-9\-]*\.)+[A-Za-z]{2,}$/,Yt=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,qt=/^(([0-9a-fA-F]{1,4}:){7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:))$/,Jt=/^((25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/([0-9]|[1-2][0-9]|3[0-2])$/,Qt=/^(([0-9a-fA-F]{1,4}:){7}[0-9a-fA-F]{1,4}|::|([0-9a-fA-F]{1,4})?::([0-9a-fA-F]{1,4}:?){0,6})\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,te=/^$|^(?:[0-9a-zA-Z+/]{4})*(?:(?:[0-9a-zA-Z+/]{2}==)|(?:[0-9a-zA-Z+/]{3}=))?$/,ee=/^[A-Za-z0-9_-]*$/,se=/^(?=.{1,253}\.?$)[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[-0-9a-zA-Z]{0,61}[0-9a-zA-Z])?)*\.?$/,ie=/^\+(?:[0-9]){6,14}[0-9]$/,ne="(?:(?:\\d\\d[2468][048]|\\d\\d[13579][26]|\\d\\d0[48]|[02468][048]00|[13579][26]00)-02-29|\\d{4}-(?:(?:0[13578]|1[02])-(?:0[1-9]|[12]\\d|3[01])|(?:0[469]|11)-(?:0[1-9]|[12]\\d|30)|(?:02)-(?:0[1-9]|1\\d|2[0-8])))",re=new RegExp(`^${ne}$`);function ae(t){const e="(?:[01]\\d|2[0-3]):[0-5]\\d";return"number"==typeof t.precision?-1===t.precision?`${e}`:0===t.precision?`${e}:[0-5]\\d`:`${e}:[0-5]\\d\\.\\d{${t.precision}}`:`${e}(?::[0-5]\\d(?:\\.\\d+)?)?`}const oe=/^-?\d+$/,he=/^-?\d+(?:\.\d+)?/,ce=/^(?:true|false)$/i,le=/^[^A-Z]*$/,de=/^[^a-z]*$/,ue=L("$ZodCheck",(t,e)=>{var s;t._zod??(t._zod={}),t._zod.def=e,(s=t._zod).onattach??(s.onattach=[])}),pe={number:"number",bigint:"bigint",object:"date"},me=L("$ZodCheckLessThan",(t,e)=>{ue.init(t,e);const s=pe[typeof e.value];t._zod.onattach.push(t=>{const s=t._zod.bag,i=(e.inclusive?s.maximum:s.exclusiveMaximum)??Number.POSITIVE_INFINITY;e.value<i&&(e.inclusive?s.maximum=e.value:s.exclusiveMaximum=e.value)}),t._zod.check=i=>{(e.inclusive?i.value<=e.value:i.value<e.value)||i.issues.push({origin:s,code:"too_big",maximum:e.value,input:i.value,inclusive:e.inclusive,inst:t,continue:!e.abort})}}),fe=L("$ZodCheckGreaterThan",(t,e)=>{ue.init(t,e);const s=pe[typeof e.value];t._zod.onattach.push(t=>{const s=t._zod.bag,i=(e.inclusive?s.minimum:s.exclusiveMinimum)??Number.NEGATIVE_INFINITY;e.value>i&&(e.inclusive?s.minimum=e.value:s.exclusiveMinimum=e.value)}),t._zod.check=i=>{(e.inclusive?i.value>=e.value:i.value>e.value)||i.issues.push({origin:s,code:"too_small",minimum:e.value,input:i.value,inclusive:e.inclusive,inst:t,continue:!e.abort})}}),ge=L("$ZodCheckMultipleOf",(t,e)=>{ue.init(t,e),t._zod.onattach.push(t=>{var s;(s=t._zod.bag).multipleOf??(s.multipleOf=e.value)}),t._zod.check=s=>{if(typeof s.value!=typeof e.value)throw new Error("Cannot mix number and bigint in multiple_of check.");("bigint"==typeof s.value?s.value%e.value===BigInt(0):0===function(t,e){const s=(t.toString().split(".")[1]||"").length,i=e.toString();let n=(i.split(".")[1]||"").length;if(0===n&&/\d?e-\d?/.test(i)){const t=i.match(/\d?e-(\d?)/);(null==t?void 0:t[1])&&(n=Number.parseInt(t[1]))}const r=s>n?s:n;return Number.parseInt(t.toFixed(r).replace(".",""))%Number.parseInt(e.toFixed(r).replace(".",""))/10**r}(s.value,e.value))||s.issues.push({origin:typeof s.value,code:"not_multiple_of",divisor:e.value,input:s.value,inst:t,continue:!e.abort})}}),ye=L("$ZodCheckNumberFormat",(t,e)=>{var s;ue.init(t,e),e.format=e.format||"float64";const i=null==(s=e.format)?void 0:s.includes("int"),n=i?"int":"number",[r,a]=gt[e.format];t._zod.onattach.push(t=>{const s=t._zod.bag;s.format=e.format,s.minimum=r,s.maximum=a,i&&(s.pattern=oe)}),t._zod.check=s=>{const o=s.value;if(i){if(!Number.isInteger(o))return void s.issues.push({expected:n,format:e.format,code:"invalid_type",continue:!1,input:o,inst:t});if(!Number.isSafeInteger(o))return void(o>0?s.issues.push({input:o,code:"too_big",maximum:Number.MAX_SAFE_INTEGER,note:"Integers must be within the safe integer range.",inst:t,origin:n,continue:!e.abort}):s.issues.push({input:o,code:"too_small",minimum:Number.MIN_SAFE_INTEGER,note:"Integers must be within the safe integer range.",inst:t,origin:n,continue:!e.abort}))}o<r&&s.issues.push({origin:"number",input:o,code:"too_small",minimum:r,inclusive:!0,inst:t,continue:!e.abort}),o>a&&s.issues.push({origin:"number",input:o,code:"too_big",maximum:a,inst:t})}}),ve=L("$ZodCheckMaxLength",(t,e)=>{var s;ue.init(t,e),(s=t._zod.def).when??(s.when=t=>{const e=t.value;return!tt(e)&&void 0!==e.length}),t._zod.onattach.push(t=>{const s=t._zod.bag.maximum??Number.POSITIVE_INFINITY;e.maximum<s&&(t._zod.bag.maximum=e.maximum)}),t._zod.check=s=>{const i=s.value;if(i.length<=e.maximum)return;const n=xt(i);s.issues.push({origin:n,code:"too_big",maximum:e.maximum,inclusive:!0,input:i,inst:t,continue:!e.abort})}}),be=L("$ZodCheckMinLength",(t,e)=>{var s;ue.init(t,e),(s=t._zod.def).when??(s.when=t=>{const e=t.value;return!tt(e)&&void 0!==e.length}),t._zod.onattach.push(t=>{const s=t._zod.bag.minimum??Number.NEGATIVE_INFINITY;e.minimum>s&&(t._zod.bag.minimum=e.minimum)}),t._zod.check=s=>{const i=s.value;if(i.length>=e.minimum)return;const n=xt(i);s.issues.push({origin:n,code:"too_small",minimum:e.minimum,inclusive:!0,input:i,inst:t,continue:!e.abort})}}),we=L("$ZodCheckLengthEquals",(t,e)=>{var s;ue.init(t,e),(s=t._zod.def).when??(s.when=t=>{const e=t.value;return!tt(e)&&void 0!==e.length}),t._zod.onattach.push(t=>{const s=t._zod.bag;s.minimum=e.length,s.maximum=e.length,s.length=e.length}),t._zod.check=s=>{const i=s.value,n=i.length;if(n===e.length)return;const r=xt(i),a=n>e.length;s.issues.push({origin:r,...a?{code:"too_big",maximum:e.length}:{code:"too_small",minimum:e.length},inclusive:!0,exact:!0,input:s.value,inst:t,continue:!e.abort})}}),xe=L("$ZodCheckStringFormat",(t,e)=>{var s,i;ue.init(t,e),t._zod.onattach.push(t=>{const s=t._zod.bag;s.format=e.format,e.pattern&&(s.patterns??(s.patterns=new Set),s.patterns.add(e.pattern))}),e.pattern?(s=t._zod).check??(s.check=s=>{e.pattern.lastIndex=0,e.pattern.test(s.value)||s.issues.push({origin:"string",code:"invalid_format",format:e.format,input:s.value,...e.pattern?{pattern:e.pattern.toString()}:{},inst:t,continue:!e.abort})}):(i=t._zod).check??(i.check=()=>{})}),ke=L("$ZodCheckRegex",(t,e)=>{xe.init(t,e),t._zod.check=s=>{e.pattern.lastIndex=0,e.pattern.test(s.value)||s.issues.push({origin:"string",code:"invalid_format",format:"regex",input:s.value,pattern:e.pattern.toString(),inst:t,continue:!e.abort})}}),_e=L("$ZodCheckLowerCase",(t,e)=>{e.pattern??(e.pattern=le),xe.init(t,e)}),Pe=L("$ZodCheckUpperCase",(t,e)=>{e.pattern??(e.pattern=de),xe.init(t,e)}),Se=L("$ZodCheckIncludes",(t,e)=>{ue.init(t,e);const s=pt(e.includes),i=new RegExp("number"==typeof e.position?`^.{${e.position}}${s}`:s);e.pattern=i,t._zod.onattach.push(t=>{const e=t._zod.bag;e.patterns??(e.patterns=new Set),e.patterns.add(i)}),t._zod.check=s=>{s.value.includes(e.includes,e.position)||s.issues.push({origin:"string",code:"invalid_format",format:"includes",includes:e.includes,input:s.value,inst:t,continue:!e.abort})}}),ze=L("$ZodCheckStartsWith",(t,e)=>{ue.init(t,e);const s=new RegExp(`^${pt(e.prefix)}.*`);e.pattern??(e.pattern=s),t._zod.onattach.push(t=>{const e=t._zod.bag;e.patterns??(e.patterns=new Set),e.patterns.add(s)}),t._zod.check=s=>{s.value.startsWith(e.prefix)||s.issues.push({origin:"string",code:"invalid_format",format:"starts_with",prefix:e.prefix,input:s.value,inst:t,continue:!e.abort})}}),Ie=L("$ZodCheckEndsWith",(t,e)=>{ue.init(t,e);const s=new RegExp(`.*${pt(e.suffix)}$`);e.pattern??(e.pattern=s),t._zod.onattach.push(t=>{const e=t._zod.bag;e.patterns??(e.patterns=new Set),e.patterns.add(s)}),t._zod.check=s=>{s.value.endsWith(e.suffix)||s.issues.push({origin:"string",code:"invalid_format",format:"ends_with",suffix:e.suffix,input:s.value,inst:t,continue:!e.abort})}}),Me=L("$ZodCheckOverwrite",(t,e)=>{ue.init(t,e),t._zod.check=t=>{t.value=e.tx(t.value)}});class Te{constructor(t=[]){this.content=[],this.indent=0,this&&(this.args=t)}indented(t){this.indent+=1,t(this),this.indent-=1}write(t){if("function"==typeof t)return t(this,{execution:"sync"}),void t(this,{execution:"async"});const e=t.split("\n").filter(t=>t),s=Math.min(...e.map(t=>t.length-t.trimStart().length)),i=e.map(t=>t.slice(s)).map(t=>" ".repeat(2*this.indent)+t);for(const n of i)this.content.push(n)}compile(){return new Function(...null==this?void 0:this.args,[...((null==this?void 0:this.content)??[""]).map(t=>`  ${t}`)].join("\n"))}}const Ee={major:4,minor:1,patch:11},Ae=L("$ZodType",(t,e)=>{var s,i;t??(t={}),t._zod.def=e,t._zod.bag=t._zod.bag||{},t._zod.version=Ee;const n=[...t._zod.def.checks??[]];t._zod.traits.has("$ZodCheck")&&n.unshift(t);for(const r of n)for(const e of r._zod.onattach)e(t);if(0===n.length)(i=t._zod).deferred??(i.deferred=[]),null==(s=t._zod.deferred)||s.push(()=>{t._zod.run=t._zod.parse});else{const e=(t,e,s)=>{let i,n=yt(t);for(const r of e){if(r._zod.def.when){if(!r._zod.def.when(t))continue}else if(n)continue;const e=t.issues.length,a=r._zod.check(t);if(a instanceof Promise&&!1===(null==s?void 0:s.async))throw new H;if(i||a instanceof Promise)i=(i??Promise.resolve()).then(async()=>{await a,t.issues.length!==e&&(n||(n=yt(t,e)))});else{if(t.issues.length===e)continue;n||(n=yt(t,e))}}return i?i.then(()=>t):t},s=(s,i,r)=>{if(yt(s))return s.aborted=!0,s;const a=e(i,n,r);if(a instanceof Promise){if(!1===r.async)throw new H;return a.then(e=>t._zod.parse(e,r))}return t._zod.parse(a,r)};t._zod.run=(i,r)=>{if(r.skipChecks)return t._zod.parse(i,r);if("backward"===r.direction){const e=t._zod.parse({value:i.value,issues:[]},{...r,skipChecks:!0});return e instanceof Promise?e.then(t=>s(t,i,r)):s(e,i,r)}const a=t._zod.parse(i,r);if(a instanceof Promise){if(!1===r.async)throw new H;return a.then(t=>e(t,n,r))}return e(a,n,r)}}t["~standard"]={validate:e=>{var s;try{const i=Tt(t,e);return i.success?{value:i.data}:{issues:null==(s=i.error)?void 0:s.issues}}catch(i){return At(t,e).then(t=>{var e;return t.success?{value:t.data}:{issues:null==(e=t.error)?void 0:e.issues}})}},vendor:"zod",version:1}}),Oe=L("$ZodString",(t,e)=>{var s;Ae.init(t,e),t._zod.pattern=[...(null==(s=null==t?void 0:t._zod.bag)?void 0:s.patterns)??[]].pop()??(t=>{const e=t?`[\\s\\S]{${(null==t?void 0:t.minimum)??0},${(null==t?void 0:t.maximum)??""}}`:"[\\s\\S]*";return new RegExp(`^${e}$`)})(t._zod.bag),t._zod.parse=(s,i)=>{if(e.coerce)try{s.value=String(s.value)}catch(n){}return"string"==typeof s.value||s.issues.push({expected:"string",code:"invalid_type",input:s.value,inst:t}),s}}),Ce=L("$ZodStringFormat",(t,e)=>{xe.init(t,e),Oe.init(t,e)}),De=L("$ZodGUID",(t,e)=>{e.pattern??(e.pattern=Lt),Ce.init(t,e)}),$e=L("$ZodUUID",(t,e)=>{if(e.version){const t={v1:1,v2:2,v3:3,v4:4,v5:5,v6:6,v7:7,v8:8}[e.version];if(void 0===t)throw new Error(`Invalid UUID version: "${e.version}"`);e.pattern??(e.pattern=Ht(t))}else e.pattern??(e.pattern=Ht());Ce.init(t,e)}),Re=L("$ZodEmail",(t,e)=>{e.pattern??(e.pattern=Xt),Ce.init(t,e)}),Ne=L("$ZodURL",(t,e)=>{Ce.init(t,e),t._zod.check=s=>{try{const i=s.value.trim(),n=new URL(i);return e.hostname&&(e.hostname.lastIndex=0,e.hostname.test(n.hostname)||s.issues.push({code:"invalid_format",format:"url",note:"Invalid hostname",pattern:se.source,input:s.value,inst:t,continue:!e.abort})),e.protocol&&(e.protocol.lastIndex=0,e.protocol.test(n.protocol.endsWith(":")?n.protocol.slice(0,-1):n.protocol)||s.issues.push({code:"invalid_format",format:"url",note:"Invalid protocol",pattern:e.protocol.source,input:s.value,inst:t,continue:!e.abort})),void(e.normalize?s.value=n.href:s.value=i)}catch(i){s.issues.push({code:"invalid_format",format:"url",input:s.value,inst:t,continue:!e.abort})}}}),je=L("$ZodEmoji",(t,e)=>{e.pattern??(e.pattern=new RegExp("^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$","u")),Ce.init(t,e)}),Fe=L("$ZodNanoID",(t,e)=>{e.pattern??(e.pattern=Ut),Ce.init(t,e)}),Ge=L("$ZodCUID",(t,e)=>{e.pattern??(e.pattern=Gt),Ce.init(t,e)}),Ze=L("$ZodCUID2",(t,e)=>{e.pattern??(e.pattern=Zt),Ce.init(t,e)}),Ve=L("$ZodULID",(t,e)=>{e.pattern??(e.pattern=Vt),Ce.init(t,e)}),Be=L("$ZodXID",(t,e)=>{e.pattern??(e.pattern=Bt),Ce.init(t,e)}),We=L("$ZodKSUID",(t,e)=>{e.pattern??(e.pattern=Wt),Ce.init(t,e)}),Ue=L("$ZodISODateTime",(t,e)=>{e.pattern??(e.pattern=function(t){const e=ae({precision:t.precision}),s=["Z"];t.local&&s.push(""),t.offset&&s.push("([+-](?:[01]\\d|2[0-3]):[0-5]\\d)");const i=`${e}(?:${s.join("|")})`;return new RegExp(`^${ne}T(?:${i})$`)}(e)),Ce.init(t,e)}),Ke=L("$ZodISODate",(t,e)=>{e.pattern??(e.pattern=re),Ce.init(t,e)}),Le=L("$ZodISOTime",(t,e)=>{e.pattern??(e.pattern=new RegExp(`^${ae(e)}$`)),Ce.init(t,e)}),He=L("$ZodISODuration",(t,e)=>{e.pattern??(e.pattern=Kt),Ce.init(t,e)}),Xe=L("$ZodIPv4",(t,e)=>{e.pattern??(e.pattern=Yt),Ce.init(t,e),t._zod.onattach.push(t=>{t._zod.bag.format="ipv4"})}),Ye=L("$ZodIPv6",(t,e)=>{e.pattern??(e.pattern=qt),Ce.init(t,e),t._zod.onattach.push(t=>{t._zod.bag.format="ipv6"}),t._zod.check=s=>{try{new URL(`http://[${s.value}]`)}catch{s.issues.push({code:"invalid_format",format:"ipv6",input:s.value,inst:t,continue:!e.abort})}}}),qe=L("$ZodCIDRv4",(t,e)=>{e.pattern??(e.pattern=Jt),Ce.init(t,e)}),Je=L("$ZodCIDRv6",(t,e)=>{e.pattern??(e.pattern=Qt),Ce.init(t,e),t._zod.check=s=>{const i=s.value.split("/");try{if(2!==i.length)throw new Error;const[t,e]=i;if(!e)throw new Error;const s=Number(e);if(`${s}`!==e)throw new Error;if(s<0||s>128)throw new Error;new URL(`http://[${t}]`)}catch{s.issues.push({code:"invalid_format",format:"cidrv6",input:s.value,inst:t,continue:!e.abort})}}});function Qe(t){if(""===t)return!0;if(t.length%4!=0)return!1;try{return atob(t),!0}catch{return!1}}const ts=L("$ZodBase64",(t,e)=>{e.pattern??(e.pattern=te),Ce.init(t,e),t._zod.onattach.push(t=>{t._zod.bag.contentEncoding="base64"}),t._zod.check=s=>{Qe(s.value)||s.issues.push({code:"invalid_format",format:"base64",input:s.value,inst:t,continue:!e.abort})}}),es=L("$ZodBase64URL",(t,e)=>{e.pattern??(e.pattern=ee),Ce.init(t,e),t._zod.onattach.push(t=>{t._zod.bag.contentEncoding="base64url"}),t._zod.check=s=>{(function(t){if(!ee.test(t))return!1;const e=t.replace(/[-_]/g,t=>"-"===t?"+":"/");return Qe(e.padEnd(4*Math.ceil(e.length/4),"="))})(s.value)||s.issues.push({code:"invalid_format",format:"base64url",input:s.value,inst:t,continue:!e.abort})}}),ss=L("$ZodE164",(t,e)=>{e.pattern??(e.pattern=ie),Ce.init(t,e)}),is=L("$ZodJWT",(t,e)=>{Ce.init(t,e),t._zod.check=s=>{(function(t,e=null){try{const s=t.split(".");if(3!==s.length)return!1;const[i]=s;if(!i)return!1;const n=JSON.parse(atob(i));return!("typ"in n&&"JWT"!==(null==n?void 0:n.typ)||!n.alg||e&&(!("alg"in n)||n.alg!==e))}catch{return!1}})(s.value,e.alg)||s.issues.push({code:"invalid_format",format:"jwt",input:s.value,inst:t,continue:!e.abort})}}),ns=L("$ZodNumber",(t,e)=>{Ae.init(t,e),t._zod.pattern=t._zod.bag.pattern??he,t._zod.parse=(s,i)=>{if(e.coerce)try{s.value=Number(s.value)}catch(a){}const n=s.value;if("number"==typeof n&&!Number.isNaN(n)&&Number.isFinite(n))return s;const r="number"==typeof n?Number.isNaN(n)?"NaN":Number.isFinite(n)?void 0:"Infinity":void 0;return s.issues.push({expected:"number",code:"invalid_type",input:n,inst:t,...r?{received:r}:{}}),s}}),rs=L("$ZodNumber",(t,e)=>{ye.init(t,e),ns.init(t,e)}),as=L("$ZodBoolean",(t,e)=>{Ae.init(t,e),t._zod.pattern=ce,t._zod.parse=(s,i)=>{if(e.coerce)try{s.value=Boolean(s.value)}catch(r){}const n=s.value;return"boolean"==typeof n||s.issues.push({expected:"boolean",code:"invalid_type",input:n,inst:t}),s}}),os=L("$ZodUnknown",(t,e)=>{Ae.init(t,e),t._zod.parse=t=>t}),hs=L("$ZodNever",(t,e)=>{Ae.init(t,e),t._zod.parse=(e,s)=>(e.issues.push({expected:"never",code:"invalid_type",input:e.value,inst:t}),e)});function cs(t,e,s){t.issues.length&&e.issues.push(...vt(s,t.issues)),e.value[s]=t.value}const ls=L("$ZodArray",(t,e)=>{Ae.init(t,e),t._zod.parse=(s,i)=>{const n=s.value;if(!Array.isArray(n))return s.issues.push({expected:"array",code:"invalid_type",input:n,inst:t}),s;s.value=Array(n.length);const r=[];for(let t=0;t<n.length;t++){const a=n[t],o=e.element._zod.run({value:a,issues:[]},i);o instanceof Promise?r.push(o.then(e=>cs(e,s,t))):cs(o,s,t)}return r.length?Promise.all(r).then(()=>s):s}});function ds(t,e,s,i){t.issues.length&&e.issues.push(...vt(s,t.issues)),void 0===t.value?s in i&&(e.value[s]=void 0):e.value[s]=t.value}function us(t){var e,s,i,n;const r=Object.keys(t.shape);for(const h of r)if(!(null==(n=null==(i=null==(s=null==(e=t.shape)?void 0:e[h])?void 0:s._zod)?void 0:i.traits)?void 0:n.has("$ZodType")))throw new Error(`Invalid element at key "${h}": expected a Zod schema`);const a=(o=t.shape,Object.keys(o).filter(t=>"optional"===o[t]._zod.optin&&"optional"===o[t]._zod.optout));var o;return{...t,keys:r,keySet:new Set(r),numKeys:r.length,optionalKeys:new Set(a)}}function ps(t,e,s,i,n,r){const a=[],o=n.keySet,h=n.catchall._zod,c=h.def.type;for(const l of Object.keys(e)){if(o.has(l))continue;if("never"===c){a.push(l);continue}const n=h.run({value:e[l],issues:[]},i);n instanceof Promise?t.push(n.then(t=>ds(t,s,l,e))):ds(n,s,l,e)}return a.length&&s.issues.push({code:"unrecognized_keys",keys:a,input:e,inst:r}),t.length?Promise.all(t).then(()=>s):s}const ms=L("$ZodObject",(t,e)=>{Ae.init(t,e);const s=Object.getOwnPropertyDescriptor(e,"shape");if(!(null==s?void 0:s.get)){const t=e.shape;Object.defineProperty(e,"shape",{get:()=>{const s={...t};return Object.defineProperty(e,"shape",{value:s}),s}})}const i=Q(()=>us(e));it(t._zod,"propValues",()=>{const t=e.shape,s={};for(const e in t){const i=t[e]._zod;if(i.values){s[e]??(s[e]=new Set);for(const t of i.values)s[e].add(t)}}return s});const n=ht,r=e.catchall;let a;t._zod.parse=(e,s)=>{a??(a=i.value);const o=e.value;if(!n(o))return e.issues.push({expected:"object",code:"invalid_type",input:o,inst:t}),e;e.value={};const h=[],c=a.shape;for(const t of a.keys){const i=c[t]._zod.run({value:o[t],issues:[]},s);i instanceof Promise?h.push(i.then(s=>ds(s,e,t,o))):ds(i,e,t,o)}return r?ps(h,o,e,s,i.value,t):h.length?Promise.all(h).then(()=>e):e}}),fs=L("$ZodObjectJIT",(t,e)=>{ms.init(t,e);const s=t._zod.parse,i=Q(()=>us(e));let n;const r=ht,a=!Y.jitless,o=a&&ct.value,h=e.catchall;let c;t._zod.parse=(l,d)=>{c??(c=i.value);const u=l.value;return r(u)?a&&o&&!1===(null==d?void 0:d.async)&&!0!==d.jitless?(n||(n=(t=>{const e=new Te(["shape","payload","ctx"]),s=i.value,n=t=>{const e=at(t);return`shape[${e}]._zod.run({ value: input[${e}], issues: [] }, ctx)`};e.write("const input = payload.value;");const r=Object.create(null);let a=0;for(const i of s.keys)r[i]="key_"+a++;e.write("const newResult = {};");for(const i of s.keys){const t=r[i],s=at(i);e.write(`const ${t} = ${n(i)};`),e.write(`\n        if (${t}.issues.length) {\n          payload.issues = payload.issues.concat(${t}.issues.map(iss => ({\n            ...iss,\n            path: iss.path ? [${s}, ...iss.path] : [${s}]\n          })));\n        }\n        \n        \n        if (${t}.value === undefined) {\n          if (${s} in input) {\n            newResult[${s}] = undefined;\n          }\n        } else {\n          newResult[${s}] = ${t}.value;\n        }\n        \n      `)}e.write("payload.value = newResult;"),e.write("return payload;");const o=e.compile();return(e,s)=>o(t,e,s)})(e.shape)),l=n(l,d),h?ps([],u,l,d,c,t):l):s(l,d):(l.issues.push({expected:"object",code:"invalid_type",input:u,inst:t}),l)}});function gs(t,e,s,i){for(const r of t)if(0===r.issues.length)return e.value=r.value,e;const n=t.filter(t=>!yt(t));return 1===n.length?(e.value=n[0].value,n[0]):(e.issues.push({code:"invalid_union",input:e.value,inst:s,errors:t.map(t=>t.issues.map(t=>wt(t,i,q())))}),e)}const ys=L("$ZodUnion",(t,e)=>{Ae.init(t,e),it(t._zod,"optin",()=>e.options.some(t=>"optional"===t._zod.optin)?"optional":void 0),it(t._zod,"optout",()=>e.options.some(t=>"optional"===t._zod.optout)?"optional":void 0),it(t._zod,"values",()=>{if(e.options.every(t=>t._zod.values))return new Set(e.options.flatMap(t=>Array.from(t._zod.values)))}),it(t._zod,"pattern",()=>{if(e.options.every(t=>t._zod.pattern)){const t=e.options.map(t=>t._zod.pattern);return new RegExp(`^(${t.map(t=>et(t.source)).join("|")})$`)}});const s=1===e.options.length,i=e.options[0]._zod.run;t._zod.parse=(n,r)=>{if(s)return i(n,r);let a=!1;const o=[];for(const t of e.options){const e=t._zod.run({value:n.value,issues:[]},r);if(e instanceof Promise)o.push(e),a=!0;else{if(0===e.issues.length)return e;o.push(e)}}return a?Promise.all(o).then(e=>gs(e,n,t,r)):gs(o,n,t,r)}}),vs=L("$ZodIntersection",(t,e)=>{Ae.init(t,e),t._zod.parse=(t,s)=>{const i=t.value,n=e.left._zod.run({value:i,issues:[]},s),r=e.right._zod.run({value:i,issues:[]},s);return n instanceof Promise||r instanceof Promise?Promise.all([n,r]).then(([e,s])=>ws(t,e,s)):ws(t,n,r)}});function bs(t,e){if(t===e)return{valid:!0,data:t};if(t instanceof Date&&e instanceof Date&&+t===+e)return{valid:!0,data:t};if(lt(t)&&lt(e)){const s=Object.keys(e),i=Object.keys(t).filter(t=>-1!==s.indexOf(t)),n={...t,...e};for(const r of i){const s=bs(t[r],e[r]);if(!s.valid)return{valid:!1,mergeErrorPath:[r,...s.mergeErrorPath]};n[r]=s.data}return{valid:!0,data:n}}if(Array.isArray(t)&&Array.isArray(e)){if(t.length!==e.length)return{valid:!1,mergeErrorPath:[]};const s=[];for(let i=0;i<t.length;i++){const n=bs(t[i],e[i]);if(!n.valid)return{valid:!1,mergeErrorPath:[i,...n.mergeErrorPath]};s.push(n.data)}return{valid:!0,data:s}}return{valid:!1,mergeErrorPath:[]}}function ws(t,e,s){if(e.issues.length&&t.issues.push(...e.issues),s.issues.length&&t.issues.push(...s.issues),yt(t))return t;const i=bs(e.value,s.value);if(!i.valid)throw new Error(`Unmergable intersection. Error path: ${JSON.stringify(i.mergeErrorPath)}`);return t.value=i.data,t}const xs=L("$ZodEnum",(t,e)=>{Ae.init(t,e);const s=function(t){const e=Object.values(t).filter(t=>"number"==typeof t);return Object.entries(t).filter(([t,s])=>-1===e.indexOf(+t)).map(([t,e])=>e)}(e.entries),i=new Set(s);t._zod.values=i,t._zod.pattern=new RegExp(`^(${s.filter(t=>ut.has(typeof t)).map(t=>"string"==typeof t?pt(t):t.toString()).join("|")})$`),t._zod.parse=(e,n)=>{const r=e.value;return i.has(r)||e.issues.push({code:"invalid_value",values:s,input:r,inst:t}),e}}),ks=L("$ZodTransform",(t,e)=>{Ae.init(t,e),t._zod.parse=(s,i)=>{if("backward"===i.direction)throw new X(t.constructor.name);const n=e.transform(s.value,s);if(i.async)return(n instanceof Promise?n:Promise.resolve(n)).then(t=>(s.value=t,s));if(n instanceof Promise)throw new H;return s.value=n,s}});function _s(t,e){return t.issues.length&&void 0===e?{issues:[],value:void 0}:t}const Ps=L("$ZodOptional",(t,e)=>{Ae.init(t,e),t._zod.optin="optional",t._zod.optout="optional",it(t._zod,"values",()=>e.innerType._zod.values?new Set([...e.innerType._zod.values,void 0]):void 0),it(t._zod,"pattern",()=>{const t=e.innerType._zod.pattern;return t?new RegExp(`^(${et(t.source)})?$`):void 0}),t._zod.parse=(t,s)=>{if("optional"===e.innerType._zod.optin){const i=e.innerType._zod.run(t,s);return i instanceof Promise?i.then(e=>_s(e,t.value)):_s(i,t.value)}return void 0===t.value?t:e.innerType._zod.run(t,s)}}),Ss=L("$ZodNullable",(t,e)=>{Ae.init(t,e),it(t._zod,"optin",()=>e.innerType._zod.optin),it(t._zod,"optout",()=>e.innerType._zod.optout),it(t._zod,"pattern",()=>{const t=e.innerType._zod.pattern;return t?new RegExp(`^(${et(t.source)}|null)$`):void 0}),it(t._zod,"values",()=>e.innerType._zod.values?new Set([...e.innerType._zod.values,null]):void 0),t._zod.parse=(t,s)=>null===t.value?t:e.innerType._zod.run(t,s)}),zs=L("$ZodDefault",(t,e)=>{Ae.init(t,e),t._zod.optin="optional",it(t._zod,"values",()=>e.innerType._zod.values),t._zod.parse=(t,s)=>{if("backward"===s.direction)return e.innerType._zod.run(t,s);if(void 0===t.value)return t.value=e.defaultValue,t;const i=e.innerType._zod.run(t,s);return i instanceof Promise?i.then(t=>Is(t,e)):Is(i,e)}});function Is(t,e){return void 0===t.value&&(t.value=e.defaultValue),t}const Ms=L("$ZodPrefault",(t,e)=>{Ae.init(t,e),t._zod.optin="optional",it(t._zod,"values",()=>e.innerType._zod.values),t._zod.parse=(t,s)=>("backward"===s.direction||void 0===t.value&&(t.value=e.defaultValue),e.innerType._zod.run(t,s))}),Ts=L("$ZodNonOptional",(t,e)=>{Ae.init(t,e),it(t._zod,"values",()=>{const t=e.innerType._zod.values;return t?new Set([...t].filter(t=>void 0!==t)):void 0}),t._zod.parse=(s,i)=>{const n=e.innerType._zod.run(s,i);return n instanceof Promise?n.then(e=>Es(e,t)):Es(n,t)}});function Es(t,e){return t.issues.length||void 0!==t.value||t.issues.push({code:"invalid_type",expected:"nonoptional",input:t.value,inst:e}),t}const As=L("$ZodCatch",(t,e)=>{Ae.init(t,e),it(t._zod,"optin",()=>e.innerType._zod.optin),it(t._zod,"optout",()=>e.innerType._zod.optout),it(t._zod,"values",()=>e.innerType._zod.values),t._zod.parse=(t,s)=>{if("backward"===s.direction)return e.innerType._zod.run(t,s);const i=e.innerType._zod.run(t,s);return i instanceof Promise?i.then(i=>(t.value=i.value,i.issues.length&&(t.value=e.catchValue({...t,error:{issues:i.issues.map(t=>wt(t,s,q()))},input:t.value}),t.issues=[]),t)):(t.value=i.value,i.issues.length&&(t.value=e.catchValue({...t,error:{issues:i.issues.map(t=>wt(t,s,q()))},input:t.value}),t.issues=[]),t)}}),Os=L("$ZodPipe",(t,e)=>{Ae.init(t,e),it(t._zod,"values",()=>e.in._zod.values),it(t._zod,"optin",()=>e.in._zod.optin),it(t._zod,"optout",()=>e.out._zod.optout),it(t._zod,"propValues",()=>e.in._zod.propValues),t._zod.parse=(t,s)=>{if("backward"===s.direction){const i=e.out._zod.run(t,s);return i instanceof Promise?i.then(t=>Cs(t,e.in,s)):Cs(i,e.in,s)}const i=e.in._zod.run(t,s);return i instanceof Promise?i.then(t=>Cs(t,e.out,s)):Cs(i,e.out,s)}});function Cs(t,e,s){return t.issues.length?(t.aborted=!0,t):e._zod.run({value:t.value,issues:t.issues},s)}const Ds=L("$ZodReadonly",(t,e)=>{Ae.init(t,e),it(t._zod,"propValues",()=>e.innerType._zod.propValues),it(t._zod,"values",()=>e.innerType._zod.values),it(t._zod,"optin",()=>e.innerType._zod.optin),it(t._zod,"optout",()=>e.innerType._zod.optout),t._zod.parse=(t,s)=>{if("backward"===s.direction)return e.innerType._zod.run(t,s);const i=e.innerType._zod.run(t,s);return i instanceof Promise?i.then($s):$s(i)}});function $s(t){return t.value=Object.freeze(t.value),t}const Rs=L("$ZodCustom",(t,e)=>{ue.init(t,e),Ae.init(t,e),t._zod.parse=(t,e)=>t,t._zod.check=s=>{const i=s.value,n=e.fn(i);if(n instanceof Promise)return n.then(e=>Ns(e,s,i,t));Ns(n,s,i,t)}});function Ns(t,e,s,i){if(!t){const t={code:"custom",input:s,inst:i,path:[...i._zod.def.path??[]],continue:!i._zod.def.abort};i._zod.def.params&&(t.params=i._zod.def.params),e.issues.push(kt(t))}}class js{constructor(){this._map=new WeakMap,this._idmap=new Map}add(t,...e){const s=e[0];if(this._map.set(t,s),s&&"object"==typeof s&&"id"in s){if(this._idmap.has(s.id))throw new Error(`ID ${s.id} already exists in the registry`);this._idmap.set(s.id,t)}return this}clear(){return this._map=new WeakMap,this._idmap=new Map,this}remove(t){const e=this._map.get(t);return e&&"object"==typeof e&&"id"in e&&this._idmap.delete(e.id),this._map.delete(t),this}get(t){const e=t._zod.parent;if(e){const s={...this.get(e)??{}};delete s.id;const i={...s,...this._map.get(t)};return Object.keys(i).length?i:void 0}return this._map.get(t)}has(t){return this._map.has(t)}}function Fs(){return new js}const Gs=Fs();function Zs(t,e){return new t({type:"string",format:"guid",check:"string_format",abort:!1,...ft(e)})}function Vs(t,e){return new me({check:"less_than",...ft(e),value:t,inclusive:!1})}function Bs(t,e){return new me({check:"less_than",...ft(e),value:t,inclusive:!0})}function Ws(t,e){return new fe({check:"greater_than",...ft(e),value:t,inclusive:!1})}function Us(t,e){return new fe({check:"greater_than",...ft(e),value:t,inclusive:!0})}function Ks(t,e){return new ge({check:"multiple_of",...ft(e),value:t})}function Ls(t,e){return new ve({check:"max_length",...ft(e),maximum:t})}function Hs(t,e){return new be({check:"min_length",...ft(e),minimum:t})}function Xs(t,e){return new we({check:"length_equals",...ft(e),length:t})}function Ys(t){return new Me({check:"overwrite",tx:t})}const qs=L("ZodISODateTime",(t,e)=>{Ue.init(t,e),vi.init(t,e)});const Js=L("ZodISODate",(t,e)=>{Ke.init(t,e),vi.init(t,e)});const Qs=L("ZodISOTime",(t,e)=>{Le.init(t,e),vi.init(t,e)});const ti=L("ZodISODuration",(t,e)=>{He.init(t,e),vi.init(t,e)});const ei=L("ZodError",(t,e)=>{Pt.init(t,e),t.name="ZodError",Object.defineProperties(t,{format:{value:e=>function(t,e){const s=e||function(t){return t.message},i={_errors:[]},n=t=>{for(const e of t.issues)if("invalid_union"===e.code&&e.errors.length)e.errors.map(t=>n({issues:t}));else if("invalid_key"===e.code)n({issues:e.issues});else if("invalid_element"===e.code)n({issues:e.issues});else if(0===e.path.length)i._errors.push(s(e));else{let t=i,n=0;for(;n<e.path.length;){const i=e.path[n];n===e.path.length-1?(t[i]=t[i]||{_errors:[]},t[i]._errors.push(s(e))):t[i]=t[i]||{_errors:[]},t=t[i],n++}}};return n(t),i}(t,e)},flatten:{value:e=>function(t,e=t=>t.message){const s={},i=[];for(const n of t.issues)n.path.length>0?(s[n.path[0]]=s[n.path[0]]||[],s[n.path[0]].push(e(n))):i.push(e(n));return{formErrors:i,fieldErrors:s}}(t,e)},addIssue:{value:e=>{t.issues.push(e),t.message=JSON.stringify(t.issues,J,2)}},addIssues:{value:e=>{t.issues.push(...e),t.message=JSON.stringify(t.issues,J,2)}},isEmpty:{get:()=>0===t.issues.length}})},{Parent:Error}),si=zt(ei),ii=It(ei),ni=Mt(ei),ri=Et(ei),ai=Ot(ei),oi=Ct(ei),hi=Dt(ei),ci=$t(ei),li=Rt(ei),di=Nt(ei),ui=jt(ei),pi=Ft(ei),mi=L("ZodType",(t,e)=>(Ae.init(t,e),t.def=e,t.type=e.type,Object.defineProperty(t,"_def",{value:e}),t.check=(...s)=>t.clone(rt(e,{checks:[...e.checks??[],...s.map(t=>"function"==typeof t?{_zod:{check:t,def:{check:"custom"},onattach:[]}}:t)]})),t.clone=(e,s)=>mt(t,e,s),t.brand=()=>t,t.register=(e,s)=>(e.add(t,s),t),t.parse=(e,s)=>si(t,e,s,{callee:t.parse}),t.safeParse=(e,s)=>ni(t,e,s),t.parseAsync=async(e,s)=>ii(t,e,s,{callee:t.parseAsync}),t.safeParseAsync=async(e,s)=>ri(t,e,s),t.spa=t.safeParseAsync,t.encode=(e,s)=>ai(t,e,s),t.decode=(e,s)=>oi(t,e,s),t.encodeAsync=async(e,s)=>hi(t,e,s),t.decodeAsync=async(e,s)=>ci(t,e,s),t.safeEncode=(e,s)=>li(t,e,s),t.safeDecode=(e,s)=>di(t,e,s),t.safeEncodeAsync=async(e,s)=>ui(t,e,s),t.safeDecodeAsync=async(e,s)=>pi(t,e,s),t.refine=(e,s)=>t.check(function(t,e={}){return function(t,e,s){return new pn({type:"custom",check:"custom",fn:e,...ft(s)})}(0,t,e)}(e,s)),t.superRefine=e=>t.check(function(t){const e=function(t){const e=new ue({check:"custom",...ft(void 0)});return e._zod.check=t,e}(s=>(s.addIssue=t=>{if("string"==typeof t)s.issues.push(kt(t,s.value,e._zod.def));else{const i=t;i.fatal&&(i.continue=!1),i.code??(i.code="custom"),i.input??(i.input=s.value),i.inst??(i.inst=e),i.continue??(i.continue=!e._zod.def.abort),s.issues.push(kt(i))}},t(s.value,s)));return e}(e)),t.overwrite=e=>t.check(Ys(e)),t.optional=()=>sn(t),t.nullable=()=>rn(t),t.nullish=()=>sn(rn(t)),t.nonoptional=e=>function(t,e){return new hn({type:"nonoptional",innerType:t,...ft(e)})}(t,e),t.array=()=>Hi(t),t.or=e=>new qi({type:"union",options:[t,e],...ft(undefined)}),t.and=e=>new Ji({type:"intersection",left:t,right:e}),t.transform=e=>dn(t,new tn({type:"transform",transform:e})),t.default=e=>{return s=e,new an({type:"default",innerType:t,get defaultValue(){return"function"==typeof s?s():dt(s)}});var s},t.prefault=e=>{return s=e,new on({type:"prefault",innerType:t,get defaultValue(){return"function"==typeof s?s():dt(s)}});var s},t.catch=e=>{return new cn({type:"catch",innerType:t,catchValue:"function"==typeof(s=e)?s:()=>s});var s},t.pipe=e=>dn(t,e),t.readonly=()=>new un({type:"readonly",innerType:t}),t.describe=e=>{const s=t.clone();return Gs.add(s,{description:e}),s},Object.defineProperty(t,"description",{get(){var e;return null==(e=Gs.get(t))?void 0:e.description},configurable:!0}),t.meta=(...e)=>{if(0===e.length)return Gs.get(t);const s=t.clone();return Gs.add(s,e[0]),s},t.isOptional=()=>t.safeParse(void 0).success,t.isNullable=()=>t.safeParse(null).success,t)),fi=L("_ZodString",(t,e)=>{Oe.init(t,e),mi.init(t,e);const s=t._zod.bag;t.format=s.format??null,t.minLength=s.minimum??null,t.maxLength=s.maximum??null,t.regex=(...e)=>t.check(function(t,e){return new ke({check:"string_format",format:"regex",...ft(e),pattern:t})}(...e)),t.includes=(...e)=>t.check(function(t,e){return new Se({check:"string_format",format:"includes",...ft(e),includes:t})}(...e)),t.startsWith=(...e)=>t.check(function(t,e){return new ze({check:"string_format",format:"starts_with",...ft(e),prefix:t})}(...e)),t.endsWith=(...e)=>t.check(function(t,e){return new Ie({check:"string_format",format:"ends_with",...ft(e),suffix:t})}(...e)),t.min=(...e)=>t.check(Hs(...e)),t.max=(...e)=>t.check(Ls(...e)),t.length=(...e)=>t.check(Xs(...e)),t.nonempty=(...e)=>t.check(Hs(1,...e)),t.lowercase=e=>t.check(function(t){return new _e({check:"string_format",format:"lowercase",...ft(t)})}(e)),t.uppercase=e=>t.check(function(t){return new Pe({check:"string_format",format:"uppercase",...ft(t)})}(e)),t.trim=()=>t.check(Ys(t=>t.trim())),t.normalize=(...e)=>t.check(function(t){return Ys(e=>e.normalize(t))}(...e)),t.toLowerCase=()=>t.check(Ys(t=>t.toLowerCase())),t.toUpperCase=()=>t.check(Ys(t=>t.toUpperCase()))}),gi=L("ZodString",(t,e)=>{Oe.init(t,e),fi.init(t,e),t.email=e=>t.check(function(t,e){return new bi({type:"string",format:"email",check:"string_format",abort:!1,...ft(e)})}(0,e)),t.url=e=>t.check(function(t,e){return new ki({type:"string",format:"url",check:"string_format",abort:!1,...ft(e)})}(0,e)),t.jwt=e=>t.check(function(t,e){return new Ni({type:"string",format:"jwt",check:"string_format",abort:!1,...ft(e)})}(0,e)),t.emoji=e=>t.check(function(t,e){return new _i({type:"string",format:"emoji",check:"string_format",abort:!1,...ft(e)})}(0,e)),t.guid=e=>t.check(Zs(wi,e)),t.uuid=e=>t.check(function(t,e){return new xi({type:"string",format:"uuid",check:"string_format",abort:!1,...ft(e)})}(0,e)),t.uuidv4=e=>t.check(function(t,e){return new xi({type:"string",format:"uuid",check:"string_format",abort:!1,version:"v4",...ft(e)})}(0,e)),t.uuidv6=e=>t.check(function(t,e){return new xi({type:"string",format:"uuid",check:"string_format",abort:!1,version:"v6",...ft(e)})}(0,e)),t.uuidv7=e=>t.check(function(t,e){return new xi({type:"string",format:"uuid",check:"string_format",abort:!1,version:"v7",...ft(e)})}(0,e)),t.nanoid=e=>t.check(function(t,e){return new Pi({type:"string",format:"nanoid",check:"string_format",abort:!1,...ft(e)})}(0,e)),t.guid=e=>t.check(Zs(wi,e)),t.cuid=e=>t.check(function(t,e){return new Si({type:"string",format:"cuid",check:"string_format",abort:!1,...ft(e)})}(0,e)),t.cuid2=e=>t.check(function(t,e){return new zi({type:"string",format:"cuid2",check:"string_format",abort:!1,...ft(e)})}(0,e)),t.ulid=e=>t.check(function(t,e){return new Ii({type:"string",format:"ulid",check:"string_format",abort:!1,...ft(e)})}(0,e)),t.base64=e=>t.check(function(t,e){return new Di({type:"string",format:"base64",check:"string_format",abort:!1,...ft(e)})}(0,e)),t.base64url=e=>t.check(function(t,e){return new $i({type:"string",format:"base64url",check:"string_format",abort:!1,...ft(e)})}(0,e)),t.xid=e=>t.check(function(t,e){return new Mi({type:"string",format:"xid",check:"string_format",abort:!1,...ft(e)})}(0,e)),t.ksuid=e=>t.check(function(t,e){return new Ti({type:"string",format:"ksuid",check:"string_format",abort:!1,...ft(e)})}(0,e)),t.ipv4=e=>t.check(function(t,e){return new Ei({type:"string",format:"ipv4",check:"string_format",abort:!1,...ft(e)})}(0,e)),t.ipv6=e=>t.check(function(t,e){return new Ai({type:"string",format:"ipv6",check:"string_format",abort:!1,...ft(e)})}(0,e)),t.cidrv4=e=>t.check(function(t,e){return new Oi({type:"string",format:"cidrv4",check:"string_format",abort:!1,...ft(e)})}(0,e)),t.cidrv6=e=>t.check(function(t,e){return new Ci({type:"string",format:"cidrv6",check:"string_format",abort:!1,...ft(e)})}(0,e)),t.e164=e=>t.check(function(t,e){return new Ri({type:"string",format:"e164",check:"string_format",abort:!1,...ft(e)})}(0,e)),t.datetime=e=>t.check(function(t){return function(t,e){return new qs({type:"string",format:"datetime",check:"string_format",offset:!1,local:!1,precision:null,...ft(e)})}(0,t)}(e)),t.date=e=>t.check(function(t){return function(t,e){return new Js({type:"string",format:"date",check:"string_format",...ft(e)})}(0,t)}(e)),t.time=e=>t.check(function(t){return function(t,e){return new Qs({type:"string",format:"time",check:"string_format",precision:null,...ft(e)})}(0,t)}(e)),t.duration=e=>t.check(function(t){return function(t,e){return new ti({type:"string",format:"duration",check:"string_format",...ft(e)})}(0,t)}(e))});function yi(t){return function(t,e){return new gi({type:"string",...ft(e)})}(0,t)}const vi=L("ZodStringFormat",(t,e)=>{Ce.init(t,e),fi.init(t,e)}),bi=L("ZodEmail",(t,e)=>{Re.init(t,e),vi.init(t,e)}),wi=L("ZodGUID",(t,e)=>{De.init(t,e),vi.init(t,e)}),xi=L("ZodUUID",(t,e)=>{$e.init(t,e),vi.init(t,e)}),ki=L("ZodURL",(t,e)=>{Ne.init(t,e),vi.init(t,e)}),_i=L("ZodEmoji",(t,e)=>{je.init(t,e),vi.init(t,e)}),Pi=L("ZodNanoID",(t,e)=>{Fe.init(t,e),vi.init(t,e)}),Si=L("ZodCUID",(t,e)=>{Ge.init(t,e),vi.init(t,e)}),zi=L("ZodCUID2",(t,e)=>{Ze.init(t,e),vi.init(t,e)}),Ii=L("ZodULID",(t,e)=>{Ve.init(t,e),vi.init(t,e)}),Mi=L("ZodXID",(t,e)=>{Be.init(t,e),vi.init(t,e)}),Ti=L("ZodKSUID",(t,e)=>{We.init(t,e),vi.init(t,e)}),Ei=L("ZodIPv4",(t,e)=>{Xe.init(t,e),vi.init(t,e)}),Ai=L("ZodIPv6",(t,e)=>{Ye.init(t,e),vi.init(t,e)}),Oi=L("ZodCIDRv4",(t,e)=>{qe.init(t,e),vi.init(t,e)}),Ci=L("ZodCIDRv6",(t,e)=>{Je.init(t,e),vi.init(t,e)}),Di=L("ZodBase64",(t,e)=>{ts.init(t,e),vi.init(t,e)}),$i=L("ZodBase64URL",(t,e)=>{es.init(t,e),vi.init(t,e)}),Ri=L("ZodE164",(t,e)=>{ss.init(t,e),vi.init(t,e)}),Ni=L("ZodJWT",(t,e)=>{is.init(t,e),vi.init(t,e)}),ji=L("ZodNumber",(t,e)=>{ns.init(t,e),mi.init(t,e),t.gt=(e,s)=>t.check(Ws(e,s)),t.gte=(e,s)=>t.check(Us(e,s)),t.min=(e,s)=>t.check(Us(e,s)),t.lt=(e,s)=>t.check(Vs(e,s)),t.lte=(e,s)=>t.check(Bs(e,s)),t.max=(e,s)=>t.check(Bs(e,s)),t.int=e=>t.check(Zi(e)),t.safe=e=>t.check(Zi(e)),t.positive=e=>t.check(Ws(0,e)),t.nonnegative=e=>t.check(Us(0,e)),t.negative=e=>t.check(Vs(0,e)),t.nonpositive=e=>t.check(Bs(0,e)),t.multipleOf=(e,s)=>t.check(Ks(e,s)),t.step=(e,s)=>t.check(Ks(e,s)),t.finite=()=>t;const s=t._zod.bag;t.minValue=Math.max(s.minimum??Number.NEGATIVE_INFINITY,s.exclusiveMinimum??Number.NEGATIVE_INFINITY)??null,t.maxValue=Math.min(s.maximum??Number.POSITIVE_INFINITY,s.exclusiveMaximum??Number.POSITIVE_INFINITY)??null,t.isInt=(s.format??"").includes("int")||Number.isSafeInteger(s.multipleOf??.5),t.isFinite=!0,t.format=s.format??null});function Fi(t){return function(t,e){return new ji({type:"number",checks:[],...ft(e)})}(0,t)}const Gi=L("ZodNumberFormat",(t,e)=>{rs.init(t,e),ji.init(t,e)});function Zi(t){return function(t,e){return new Gi({type:"number",check:"number_format",abort:!1,format:"safeint",...ft(e)})}(0,t)}const Vi=L("ZodBoolean",(t,e)=>{as.init(t,e),mi.init(t,e)});function Bi(t){return function(t,e){return new Vi({type:"boolean",...ft(e)})}(0,t)}const Wi=L("ZodUnknown",(t,e)=>{os.init(t,e),mi.init(t,e)});function Ui(){return new Wi({type:"unknown"})}const Ki=L("ZodNever",(t,e)=>{hs.init(t,e),mi.init(t,e)});const Li=L("ZodArray",(t,e)=>{ls.init(t,e),mi.init(t,e),t.element=e.element,t.min=(e,s)=>t.check(Hs(e,s)),t.nonempty=e=>t.check(Hs(1,e)),t.max=(e,s)=>t.check(Ls(e,s)),t.length=(e,s)=>t.check(Xs(e,s)),t.unwrap=()=>t.element});function Hi(t,e){return function(t,e,s){return new Li({type:"array",element:e,...ft(s)})}(0,t,e)}const Xi=L("ZodObject",(t,e)=>{fs.init(t,e),mi.init(t,e),it(t,"shape",()=>e.shape),t.keyof=()=>function(t){const e=Array.isArray(t)?Object.fromEntries(t.map(t=>[t,t])):t;return new Qi({type:"enum",entries:e,...ft(void 0)})}(Object.keys(t._zod.def.shape)),t.catchall=e=>t.clone({...t._zod.def,catchall:e}),t.passthrough=()=>t.clone({...t._zod.def,catchall:Ui()}),t.loose=()=>t.clone({...t._zod.def,catchall:Ui()}),t.strict=()=>{return t.clone({...t._zod.def,catchall:function(t,e){return new Ki({type:"never",...ft(e)})}(0,e)});var e},t.strip=()=>t.clone({...t._zod.def,catchall:void 0}),t.extend=e=>function(t,e){if(!lt(e))throw new Error("Invalid input to extend: expected a plain object");const s=t._zod.def.checks;if(s&&s.length>0)throw new Error("Object schemas containing refinements cannot be extended. Use `.safeExtend()` instead.");const i=rt(t._zod.def,{get shape(){const s={...t._zod.def.shape,...e};return nt(this,"shape",s),s},checks:[]});return mt(t,i)}(t,e),t.safeExtend=e=>function(t,e){if(!lt(e))throw new Error("Invalid input to safeExtend: expected a plain object");const s={...t._zod.def,get shape(){const s={...t._zod.def.shape,...e};return nt(this,"shape",s),s},checks:t._zod.def.checks};return mt(t,s)}(t,e),t.merge=e=>function(t,e){const s=rt(t._zod.def,{get shape(){const s={...t._zod.def.shape,...e._zod.def.shape};return nt(this,"shape",s),s},get catchall(){return e._zod.def.catchall},checks:[]});return mt(t,s)}(t,e),t.pick=e=>function(t,e){const s=t._zod.def;return mt(t,rt(t._zod.def,{get shape(){const t={};for(const i in e){if(!(i in s.shape))throw new Error(`Unrecognized key: "${i}"`);e[i]&&(t[i]=s.shape[i])}return nt(this,"shape",t),t},checks:[]}))}(t,e),t.omit=e=>function(t,e){const s=t._zod.def,i=rt(t._zod.def,{get shape(){const i={...t._zod.def.shape};for(const t in e){if(!(t in s.shape))throw new Error(`Unrecognized key: "${t}"`);e[t]&&delete i[t]}return nt(this,"shape",i),i},checks:[]});return mt(t,i)}(t,e),t.partial=(...e)=>function(t,e,s){const i=rt(e._zod.def,{get shape(){const i=e._zod.def.shape,n={...i};if(s)for(const e in s){if(!(e in i))throw new Error(`Unrecognized key: "${e}"`);s[e]&&(n[e]=t?new t({type:"optional",innerType:i[e]}):i[e])}else for(const e in i)n[e]=t?new t({type:"optional",innerType:i[e]}):i[e];return nt(this,"shape",n),n},checks:[]});return mt(e,i)}(en,t,e[0]),t.required=(...e)=>function(t,e,s){const i=rt(e._zod.def,{get shape(){const i=e._zod.def.shape,n={...i};if(s)for(const e in s){if(!(e in n))throw new Error(`Unrecognized key: "${e}"`);s[e]&&(n[e]=new t({type:"nonoptional",innerType:i[e]}))}else for(const e in i)n[e]=new t({type:"nonoptional",innerType:i[e]});return nt(this,"shape",n),n},checks:[]});return mt(e,i)}(hn,t,e[0])});function Yi(t,e){const s={type:"object",shape:t??{},...ft(e)};return new Xi(s)}const qi=L("ZodUnion",(t,e)=>{ys.init(t,e),mi.init(t,e),t.options=e.options}),Ji=L("ZodIntersection",(t,e)=>{vs.init(t,e),mi.init(t,e)}),Qi=L("ZodEnum",(t,e)=>{xs.init(t,e),mi.init(t,e),t.enum=e.entries,t.options=Object.values(e.entries);const s=new Set(Object.keys(e.entries));t.extract=(t,i)=>{const n={};for(const r of t){if(!s.has(r))throw new Error(`Key ${r} not found in enum`);n[r]=e.entries[r]}return new Qi({...e,checks:[],...ft(i),entries:n})},t.exclude=(t,i)=>{const n={...e.entries};for(const e of t){if(!s.has(e))throw new Error(`Key ${e} not found in enum`);delete n[e]}return new Qi({...e,checks:[],...ft(i),entries:n})}}),tn=L("ZodTransform",(t,e)=>{ks.init(t,e),mi.init(t,e),t._zod.parse=(s,i)=>{if("backward"===i.direction)throw new X(t.constructor.name);s.addIssue=i=>{if("string"==typeof i)s.issues.push(kt(i,s.value,e));else{const e=i;e.fatal&&(e.continue=!1),e.code??(e.code="custom"),e.input??(e.input=s.value),e.inst??(e.inst=t),s.issues.push(kt(e))}};const n=e.transform(s.value,s);return n instanceof Promise?n.then(t=>(s.value=t,s)):(s.value=n,s)}}),en=L("ZodOptional",(t,e)=>{Ps.init(t,e),mi.init(t,e),t.unwrap=()=>t._zod.def.innerType});function sn(t){return new en({type:"optional",innerType:t})}const nn=L("ZodNullable",(t,e)=>{Ss.init(t,e),mi.init(t,e),t.unwrap=()=>t._zod.def.innerType});function rn(t){return new nn({type:"nullable",innerType:t})}const an=L("ZodDefault",(t,e)=>{zs.init(t,e),mi.init(t,e),t.unwrap=()=>t._zod.def.innerType,t.removeDefault=t.unwrap}),on=L("ZodPrefault",(t,e)=>{Ms.init(t,e),mi.init(t,e),t.unwrap=()=>t._zod.def.innerType}),hn=L("ZodNonOptional",(t,e)=>{Ts.init(t,e),mi.init(t,e),t.unwrap=()=>t._zod.def.innerType}),cn=L("ZodCatch",(t,e)=>{As.init(t,e),mi.init(t,e),t.unwrap=()=>t._zod.def.innerType,t.removeCatch=t.unwrap}),ln=L("ZodPipe",(t,e)=>{Os.init(t,e),mi.init(t,e),t.in=e.in,t.out=e.out});function dn(t,e){return new ln({type:"pipe",in:t,out:e})}const un=L("ZodReadonly",(t,e)=>{Ds.init(t,e),mi.init(t,e),t.unwrap=()=>t._zod.def.innerType}),pn=L("ZodCustom",(t,e)=>{Rs.init(t,e),mi.init(t,e)});class mn extends Error{constructor(){super("function param was incorrectly typed")}}class fn extends Error{constructor(t){super(t=void 0!==t?`missing player object in class: ${t}`:"missing player object in class")}}const gn=()=>{const t=new WeakMap;return(e,s,i)=>{const n=i.value;if(!1===((t,e)=>"update"!==e?(console.error(new Error("must be used on update")),!1):"function"==typeof t&&2===t.length)(n,s))throw new Error("you fucked up a decorator dawg");return i.value=function(e,s){const i=t.get(this)??0;e>3e4*i&&(t.set(this,i+1),this.constructor.name),n.call(this,e,s)},i}},yn=Yi({base:Yi({voidGems:Fi()}),player:Yi({plants:Hi(yi()),voidGems:Fi()})}),vn=Yi({difficulty:Fi(),email:yi().optional(),inventory:yn,lastPlayed:Fi(),music:Bi(),soundEffects:Bi(),time:Fi()}),bn={difficulty:1,inventory:{base:{voidGems:0},player:{plants:[],voidGems:0}},lastPlayed:0,music:!0,soundEffects:!0,time:0},wn=class t extends Phaser.Plugins.BasePlugin{constructor(t){super(t),this.pluginManager=t}load(){const e=localStorage.getItem(t.key);if(null===e)return bn;try{return vn.parse(JSON.parse(e))}catch(s){return bn}}save(e){const s={...this.load(),...e},i=JSON.stringify(s);return localStorage.setItem(t.key,i),JSON.stringify(this.load())===JSON.stringify(s)}saveInventory(e){const s=this.load(),i=s.inventory,n={...s,inventory:{...i,...e}},r=JSON.stringify(n);return localStorage.setItem(t.key,r),JSON.stringify(this.load())===JSON.stringify(n)}};j(wn,"key","ConfigManager"),j(wn,"mapping","_config");let xn=wn;const kn={key:xn.key,mapping:xn.mapping,plugin:xn,start:!0},_n="ActionScene",Pn="AnimationManager",Sn="IdleScene",zn="MainScene",In="MainMenu",Mn="Preloader";class Tn{constructor(t,e,s){j(this,"tween"),j(this,"target"),this.tween=t.tweens.addCounter({duration:200,from:e,onUpdate:t=>{if(!this.target)return;let e=t.getValue();if(null===e)throw new Error("invalid tween");e=Math.floor(e),this.target.setTint(Phaser.Display.Color.GetColor(e,e,e))},paused:!0,persist:!0,to:s})}restart(t){this.target=t,this.tween.resume()}pause(){this.target=void 0,this.tween.pause().seek(0)}}let En=(t=class extends Phaser.GameObjects.Image{constructor(t,e,s,i){var n,r;super(t.scene,e,s,"menu-item"),j(this,"text"),j(this,"tween"),j(this,"onClick",()=>{}),j(this,"focused",!1),this.container=t,this.idx=i,t.scene.add.existing(this),this.setInteractive(),this.tween=new Tn(this.scene,255,204),this.text=t.scene.add.text(this.width/2+e,this.height/2+s,"",{align:"center",color:"#ffffff",fontSize:40,stroke:"#000000",strokeThickness:8}).setOrigin(.5,.5).setShadow(5,5,"#5588EE",0,!0,!0),t.add(this.text),this.on("pointerup",t=>{if(!(t instanceof Phaser.Input.Pointer))throw new mn;this.onClick(t)}),this.on("pointerover",()=>{this.container.idx=void 0,this.pointerover()}),this.on("pointerout",()=>{this.container.idx=void 0,this.pointerout()}),null==(n=this.preFX)||n.setPadding(16),null==(r=this.preFX)||r.addShadow()}pointerout(){this.focused&&(this.tween.pause(),this.setRotation(0).setTint(16777215),this.focused=!1)}pointerover(){this.focused||(this.tween.restart(this),this.setRotation(Math.PI/32),setTimeout(()=>{this.setRotation(0)},50),this.focused=!0)}update(t,e){void 0!==this.container.idx&&(this.container.idx===this.idx?this.pointerover():this.pointerout())}},j(t,"texture","menu-item"),t);const An=class t extends Phaser.GameObjects.Container{constructor(e,s){var i,n,r;super(e,s.x,s.y),j(this,"width"),j(this,"tween"),j(this,"prompts",[{kbm:{color:16711935,frame:"mouse_move"},text:"navigate",xbox:{color:16777215,frame:"xbox_dpad_vertical"}},{kbm:{color:16711935,frame:"mouse_left"},text:"select",xbox:{color:16777215,frame:"xbox_button_color_a"}},{kbm:{color:16711935,frame:"keyboard_escape"},text:"exit",xbox:{color:16777215,frame:"xbox_button_color_b"}}]),j(this,"idx",0),j(this,"buttonWidth"),j(this,"buttonHeight"),j(this,"bg"),j(this,"buttons",[]),this.scene=e,this.scene.add.existing(this),this.setVisible(!1);const a=this.scene.textures.get(En.texture).getFrameBounds();this.buttonHeight=a.height,this.buttonWidth=a.width,this.width=this.buttonWidth+t.PADDING.left+t.PADDING.right,this.bg=this.scene.add.tileSprite(0,0,this.menuWidth(1),this.menuHeight(2),"repeating-background").setOrigin(0,0),this.add(this.bg),null==(i=this.bg.preFX)||i.setPadding(32),null==(n=this.bg.preFX)||n.addGlow(16777215,100),null==(r=this.bg.preFX)||r.addShadow(),this.tween=new Tn(this.scene,255,204)}open(e,s,i){if(!yr.instance)throw new fn;this.idx=0;const n=yr.instance.cameras.main.width-this.width-t.MARGIN;i.x>n?this.setPosition(0+t.MARGIN,s+t.MARGIN):this.setPosition(n,s+t.MARGIN),this.setVisible(!0),i.inputProvider.setOnInteract(this)}close(t){this.setVisible(!1),t.inputProvider.removeOnInteract(this)}onInteract(t){this.idx=0}onCancel(t){this.close(t)}onSelect(t){var e;null==(e=this.buttons[this.idx??0])||e.onClick()}onMovement(t,e){0!==e&&(this.idx=(this.idx??0)+e,-1===this.idx?this.idx=this.buttons.length-1:this.idx=this.idx%this.buttons.length)}setButtons(t){for(let e=0;e<t.length;e++){const s=t[e];if(!s)throw new Error("invalid type");const i=this.buttons[e]??this.createButton(e);i.onClick=s.onClick,i.text.text=s.text}this.bg.setSize(this.menuWidth(1),this.menuHeight(t.length));for(let e=t.length;e<this.buttons.length;e++){const t=this.buttons[e];if(!t)return;t.setVisible(!1).text.setVisible(!1)}}update(t,e){for(const s of this.buttons)s.update(t,e)}menuWidth(e){return this.width=this.buttonWidth+t.PADDING.left+t.PADDING.right,this.width}menuHeight(e){const s=Math.max(e-1,0)*t.GAP,i=e*this.buttonHeight,n=t.PADDING.top;return i+s+t.PADDING.bottom+t.PADDING.bottom+n}createButton(e){const s=new En(this,t.PADDING.right,t.GAP+(this.buttonHeight+t.GAP)*e+t.PADDING.top,e);return s.setPosition(s.width/2+t.PADDING.right,s.height/2+(this.buttonHeight+t.GAP)*e+t.PADDING.top),this.buttons.push(s),this.add(s),s.text.setAbove(s),s}};j(An,"PADDING",{bottom:10,left:10,right:10,top:10}),j(An,"GAP",10),j(An,"MARGIN",100);let On=An;const Cn=()=>{},Dn={align:"center",color:"#ffffff",fontFamily:"MarcellusSC",fontSize:40,stroke:"#000000",strokeThickness:8};class $n{constructor(t,e=[],s){var i,n;j(this,"player"),j(this,"background"),j(this,"kbm",[]),j(this,"key"),j(this,"last"),j(this,"text",[]),j(this,"width",0),j(this,"xbox",[]),this.scene=t,this.player=s;const r=this.scene.scale.width/4*(2*s.num+1),a=this.scene.scale.height-200;this.background=this.scene.add.rectangle(r,a,256,128,0,.75).setVisible(!1).setOrigin(.5).setScrollFactor(0);for(const o of e){const t=this.scene.add.image(r,a,"kbm",o.kbm.frame).setVisible(!1).setScale(.75).setOrigin(0,.5).setScrollFactor(0);null==(i=t.preFX)||i.addShadow(-.25,-.25,.1,1,o.kbm.color),this.kbm.push(t);const e=this.scene.add.image(r,a,"xbox",o.xbox.frame).setVisible(!1).setScale(.75).setOrigin(0,.5).setScrollFactor(0);null==(n=e.preFX)||n.addShadow(-.5,-.5,.1,1,o.xbox.color),this.xbox.push(e);const s=this.scene.add.text(r,a,o.text,Dn).setVisible(!1).setOrigin(0,.5).setScrollFactor(0);if(this.text.push(s),t.displayWidth!==e.displayWidth)throw new Error("invalid assumption");this.width+=10+t.displayWidth+20+s.displayWidth+10}this.width+=20}destroy(){this.background.destroy();for(let t=0;t<this.kbm.length;t++){const e=this.kbm[t],s=this.text[t],i=this.xbox[t];if(!e||!s||!i)throw new Error;e.destroy(),s.destroy(),i.destroy()}}disable(){this.key=void 0,this.hide()}enable(t,e){if(this.last===e&&this.key===t)return;this.key=t,this.last=e,this.hide();const s=this.button(e);this.background.setSize(this.width,128).setVisible(!0);const{left:i}=this.background.getBounds();let n=i+10;for(let r=0;r<s.length;r++){const t=s[r],e=this.text[r];if(!t||!e)throw new Error;n+=10,t.x=n,n+=t.displayWidth,n+=20,e.x=n,n+=e.displayWidth,n+=10,t.setVisible(!0),e.setVisible(!0)}}button(t){return"xbox"===t||"ps4"===t?this.xbox:this.kbm}hide(){this.background.setVisible(!1);for(let t=0;t<this.kbm.length;t++){const e=this.kbm[t],s=this.text[t],i=this.xbox[t];if(!e||!s||!i)throw new Error;e.setVisible(!1),s.setVisible(!1),i.setVisible(!1)}}}const Rn=t=>Phaser.Input.Keyboard.KeyCodes[t],Nn=class t{constructor(t,i,n={interactionKeys:{dash:"SPACE",interact:"E"},movementKeys:{down:"S",left:"A",right:"D",up:"W"}}){if(j(this,"active",!1),Z(this,e,[!1,!1,!1,!1]),j(this,"connected",!1),j(this,"dashing",!1),j(this,"last","kbm"),j(this,"player"),j(this,"scene"),j(this,"config"),j(this,"framesMoved",0),j(this,"framesUnmoved",0),j(this,"gamepad"),j(this,"interactTarget",[]),j(this,"isSetup",!1),j(this,"lastPos",[[0,0]]),j(this,"moved",!1),j(this,"onInteract",()=>{const t=this.interactTarget[this.interactTarget.length-1];t&&this.player&&t.onInteract(this.player)}),j(this,"onPause",Cn),j(this,"onTab",Cn),j(this,"prevTarget"),j(this,"prompt"),j(this,"prompts",new Map),j(this,"setup",!1),Z(this,s),j(this,"_gamepadPlugin"),j(this,"_keyboardPlugin"),j(this,"_keys"),j(this,"_movement"),j(this,"_systemKeys"),this.scene=t,this.player=i,this.config=n,this.player){const t=[{kbm:{color:16777215,frame:"keyboard_wasd"},text:"move",xbox:{color:16711935,frame:"xbox_stick_l"}}];this.prompt=new $n(this.scene,t,this.player),this.prompts.set("move",this.prompt)}}get aiming(){let t=this.keys.aim.kbm.isDown;return this.gamepad&&(t=t||this.gamepad.L2>.5),t}destroy(){this.prompts.forEach(t=>{t.destroy()}),this.prompt=void 0,this.prompts=new Map}position(){let{x:t,y:e}=this.axes("left");const s=t**2+e**2;s>1&&(t/=Math.sqrt(s),e/=Math.sqrt(s));const i=this.movement.left.kbm.isDown,n=this.movement.right.kbm.isDown;i&&(t-=1),n&&(t+=1);const r=this.movement.up.kbm.isDown,a=this.movement.down.kbm.isDown;return r&&(e-=1),a&&(e+=1),(r||i||a||n)&&(this.last="kbm"),this.focus instanceof sr?(Math.abs(t)+Math.abs(e)>1&&(t*=Math.SQRT1_2,e*=Math.SQRT1_2),0===t&&0===e||(this.moved=!0,this.active=!0,this.lastPos.push([t,e]),this.lastPos.length>30&&this.lastPos.shift()),[t,e]):[0,0]}refresh(){this.setupKBM(),this.updateConnection()}removeAllInteract(){var t;this.interactTarget=[],null==(t=this.prompt)||t.disable()}removeOnInteract(t){var e;if(0===this.interactTarget.length)return;const s=this.interactTarget.findIndex(e=>e===t);-1!==s&&(this.interactTarget.splice(s),void 0===this.interactTarget[this.interactTarget.length-1]&&(null==(e=this.prompt)||e.disable()),0===this.interactTarget.length&&(this.scene instanceof sr?this.focus=this.scene:this.focus=null))}setOnInteract(t){if(t instanceof On&&(this.focus=t),-1!==this.interactTarget.findIndex(e=>e===t))return;let e=this.prompts.get(t.constructor.name);this.player&&!e&&t.prompts.length>0&&(e=new $n(this.scene,t.prompts,this.player),this.prompts.set(t.constructor.name,e)),this.prompt=e,this.prevTarget=this.interactTarget[this.interactTarget.length-1],this.interactTarget.push(t)}setOnPause(t){this.onPause=t}setOnTab(t){this.onTab=t}target(t,s){var i;if(this.player&&G(this,e)[this.player.num]&&null!==s){const e=this.scene.physics.closest(t,s.getMatching("visible",!0));if(e instanceof Vr)return{angle:Phaser.Math.Angle.Between(t.x,t.y,e.x,e.y),x:t.x,y:t.y}}const n=t.scene.input.activePointer,r=t.x-t.scene.cameras.main.scrollX,a=t.y-t.scene.cameras.main.scrollY;let o=n.x,h=n.y,c=Phaser.Math.Angle.Between(r,a,n.worldX,n.worldY);3!==(null==(i=this.player)?void 0:i.num)&&([o,h]=this.lastPosition(),c=Phaser.Math.Angle.Between(0,0,o,h));const{x:l,y:d}=this.axes("right");return 0===l&&0===d||(c=Phaser.Math.Angle.Between(0,0,l,d),o=t.x,h=t.y),{angle:c,x:o,y:h}}update(t,e){var s,i;if(this.setupKBM(),null===this.player)return;const n=this.interactTarget[this.interactTarget.length-1];if(n&&this.prompt&&(n!==this.prevTarget&&(this.prevTarget&&(null==(s=this.prompts.get(this.prevTarget.constructor.name))||s.disable()),this.prevTarget=n),this.prompt.enable(n.constructor.name,this.last)),this.framesUnmoved<600)this.framesUnmoved++;else if(this.moved&&this.framesMoved<100)this.framesMoved++;else if(this.framesMoved<100){const t=this.prompts.get("move");null==t||t.enable("move",this.last)}else 100===this.framesMoved&&(null==(i=this.prompts.get("move"))||i.disable());this.updateConnection()}updateConnection(){this.connected||this.player&&(this.gamepad=this.gamepadPlugin.gamepads[this.player.num],this.gamepad&&this.setupController()&&(this.connected=!0))}axes(t){if(!this.gamepad)return{x:0,y:0};const e="left"===t?0:2,s=this.gamepad.axes[0+e],i=this.gamepad.axes[1+e];let n=0,r=0;return void 0!==s&&void 0!==i&&(s.threshold=.15,i.threshold=.15,n=s.getValue(),r=i.getValue()),0===n&&0===r||(this.last="xbox"),{x:n,y:r}}set focus(t){V(this,s,t)}get focus(){return G(this,s)||(this.scene instanceof On||this.scene instanceof sr?V(this,s,this.scene):V(this,s,null)),G(this,s)}get gamepadPlugin(){if(null===this.scene.input.gamepad)throw new Error("missing gamepad plugin");return this._gamepadPlugin??(this._gamepadPlugin=this.scene.input.gamepad),this._gamepadPlugin}get keyboardPlugin(){if(null===this.scene.input.keyboard)throw new Error("missing keyboard plugin");return this._keyboardPlugin??(this._keyboardPlugin=this.scene.input.keyboard),this._keyboardPlugin}get keys(){return this._keys??(this._keys={aim:{button:6,kbm:this.keyboardPlugin.addKey(Phaser.Input.Keyboard.KeyCodes.SHIFT),onInteract:Cn},cancel:{button:1,kbm:this.keyboardPlugin.addKey(Phaser.Input.Keyboard.KeyCodes.Q),onInteract:()=>{const t=this.interactTarget[this.interactTarget.length-1];t&&this.player&&t.onCancel(this.player),this.removeOnInteract(this.interactTarget[this.interactTarget.length-1])}},dash:{button:0,kbm:this.keyboardPlugin.addKey(Rn(this.config.interactionKeys.dash)),onInteract:()=>{this.dashing=!0}},interact:{button:2,kbm:this.keyboardPlugin.addKey(Rn(this.config.interactionKeys.interact)),onInteract:()=>{const t=this.interactTarget[this.interactTarget.length-1];this.focus instanceof On&&t&&this.player?t.onSelect(this.player):this.onInteract()}},select:{button:0,kbm:null,onInteract:()=>{const t=this.interactTarget[this.interactTarget.length-1];t&&this.player&&t.onSelect(this.player)}},toggle:{button:3,kbm:this.keyboardPlugin.addKey(Phaser.Input.Keyboard.KeyCodes.F),onInteract:()=>{this.player&&(G(this,e)[this.player.num]=!G(this,e)[this.player.num])}}}),this._keys}lastPosition(){let e=[];this.lastPos.reduce((s,i)=>(t.allowedTransitions(s,i)?e.push(i):e=[i],i));const s=[0,0],i=e.length;return e.forEach(t=>{s[0]+=t[0]/i,s[1]+=t[1]/i}),s}get movement(){return this._movement??(this._movement={down:{button:-1,kbm:this.keyboardPlugin.addKey(Rn(this.config.movementKeys.down)),onInteract:this.onMenu(0,1)},left:{button:-1,kbm:this.keyboardPlugin.addKey(Rn(this.config.movementKeys.left)),onInteract:this.onMenu(-1,0)},right:{button:-1,kbm:this.keyboardPlugin.addKey(Rn(this.config.movementKeys.right)),onInteract:this.onMenu(1,0)},up:{button:-1,kbm:this.keyboardPlugin.addKey(Rn(this.config.movementKeys.up)),onInteract:this.onMenu(0,-1)}}),this._movement}onMenu(t,e){return()=>{var s;const i=this.interactTarget[this.interactTarget.length-1];i&&(null==(s=i.onMovement)||s.call(i,t,e))}}setupController(){return!!this.setup||!!this.gamepad&&(this.gamepad.on("down",(t,e,s)=>{if("number"!=typeof t)throw new mn;if("number"!=typeof e)throw new mn;if(!(s instanceof Phaser.Input.Gamepad.Button))throw new mn;s.pad.id.toLowerCase().includes("xbox")?this.last="xbox":this.last="ps4";for(const[,i]of Object.entries(this.keys))s.index===i.button&&i.onInteract();s.index!==Phaser.Input.Gamepad.Configs.XBOX_360.START&&s.index!==Phaser.Input.Gamepad.Configs.XBOX_360.A||(this.active=!0),s.index,Phaser.Input.Gamepad.Configs.XBOX_360.BACK,s.index,Phaser.Input.Gamepad.Configs.XBOX_360.START,s.index,Phaser.Input.Gamepad.Configs.XBOX_360.X}),this.gamepadPlugin.on("down",(t,e)=>{if(!(t instanceof Phaser.Input.Gamepad.Gamepad))throw new mn;if(!(e instanceof Phaser.Input.Gamepad.Button))throw new mn;t.id.toLowerCase().includes("xbox")?this.last="xbox":this.last="ps4",e.index===Phaser.Input.Gamepad.Configs.XBOX_360.BACK&&this.onTab(),e.index===Phaser.Input.Gamepad.Configs.XBOX_360.START&&this.onPause(),e.index===Phaser.Input.Gamepad.Configs.XBOX_360.X&&this.onInteract()}),this.setup=!0,!0)}setupKBM(){var t,e;if(!this.isSetup){for(const[,t]of Object.entries(this.systemKeys))t.kbm.on("up",()=>{this.last="kbm",t.onInteract()});if(0===(null==(t=this.player)?void 0:t.num))for(const[,t]of Object.entries(this.systemKeys))t.kbm.on("up",()=>{this.last="kbm",t.onInteract()});for(const[,t]of Object.entries(this.keys))null==(e=t.kbm)||e.on("up",()=>{this.last="kbm",t.onInteract()});for(const[,t]of Object.entries(this.movement))t.kbm.on("up",()=>{this.last="kbm",t.onInteract()});this.isSetup=!0}}get systemKeys(){return this._systemKeys??(this._systemKeys={pause:{button:9,kbm:this.keyboardPlugin.addKey(Phaser.Input.Keyboard.KeyCodes.ESC),onInteract:()=>{const t=this.interactTarget[this.interactTarget.length-1];t&&this.player?(t.onCancel(this.player),this.removeOnInteract(this.interactTarget[this.interactTarget.length-1])):this.onPause()}},upgrade:{button:16,kbm:this.keyboardPlugin.addKey(Phaser.Input.Keyboard.KeyCodes.TAB),onInteract:this.onTab}}),this._systemKeys}};e=new WeakMap,s=new WeakMap,j(Nn,"allowedTransitions",(t,e)=>{const[s,i]=t,[n,r]=e;return s===n&&i===r||(Nn.isCardinal(s,i)&&Nn.isDiagonal(n,r)||!(!Nn.isDiagonal(s,i)||!Nn.isCardinal(n,r)))&&(Math.sign(s)===Math.sign(n)||Math.sign(i)===Math.sign(r))}),j(Nn,"isCardinal",(t,e)=>0===t&&1===Math.abs(e)||0===e&&1===Math.abs(t)),j(Nn,"isDiagonal",(t,e)=>Math.abs(t)===Math.SQRT1_2&&Math.abs(e)===Math.SQRT1_2);let jn=Nn;Phaser.Physics.Arcade.Sprite;Phaser.Physics.Arcade.Sprite;Phaser.Physics.Arcade.Sprite;Phaser.Physics.Arcade.Sprite;Math.max(20,0);const Fn=t=>{const e=[];for(let i=0;i<t;i++){const s=Math.random()*((i+1)/t),n=160+80*Math.random();e.push({position:s,speed:n})}let s=1;return e.reduce((t,e)=>(s=Math.min(s,Math.abs(t.position-e.position)),e)),s<.1?(console.log("retrying"),Fn(t)):e},Gn=class t{constructor(){for(let e=0;e<240;e++){if(e%2!=0){t.table.push([]);continue}const s=Math.ceil(2+2*Math.random());t.table.push(Fn(s))}}static next(){t.instance||(t.instance=new t),t.idx>=t.table.length&&(console.warn("random numbers exhausted"),t.idx=0);const e=t.table[t.idx++];if(void 0===e)throw new Error;return e}};j(Gn,"idx",0),j(Gn,"table",[]),j(Gn,"instance");Phaser.Scene;const Zn=["bat.png","blob.png","blob_1.png","blobie-walk copy.png","blobie-walk.png","brawler48x48.png","char.png","drone.png","portal-particles_240_340.png","portal_240_340.png","rat.png","stick-head.png","stick.png","thickius.png"],Vn=[1,5,25,125,625],Bn="xp",Wn=["grid","castle","pebble","menu-item","border","border-wide","close-icon","pickaxe","sword","bow","arrow","reticle","menu","menu-border","drop-agility","drop-strength","drop-endurance"],Un=new Map([["grid","grid-ps2.png"],["castle","castle.png"],["pebble","pebble.gif"],["menu-item","border-wide.png"],["close-icon","close-icon.png"]]),Kn=[{config:{end:23,start:0},delay:0,frameRate:24,key:"float",repeat:-1,repeatDelay:0,yoyo:!0}],Ln=[];for(const ba of Vn){const t="animations/xp",e=`${Bn}${ba}`;Ln.push({animations:Kn,frameConfig:{frameHeight:128,frameWidth:80},key:e,url:`${t}/${e}.png`})}const Hn=[{config:{end:23,start:0},delay:0,frameRate:24,key:"float",repeat:-1,repeatDelay:100,yoyo:!0}],Xn=[{animations:Hn,frameConfig:{frameHeight:128,frameWidth:80},key:"void-gem",url:"animations/void-gem.png"},{animations:Hn,frameConfig:{frameHeight:128,frameWidth:80},key:"stat-drop",url:"animations/stat-drop.png"},{animations:Hn,frameConfig:{frameHeight:128,frameWidth:80},key:"sword-pickup",url:"animations/items/sword-pickup.png"},{animations:Hn,frameConfig:{frameHeight:128,frameWidth:80},key:"arrow-pickup",url:"animations/items/arrow-pickup.png"},...Ln];class Yn extends K.Scene{constructor(){super({key:Mn,plugins:Phaser.Plugins.DefaultPlugins.DefaultScene})}create(){this.scene.start(Pn),this.scene.start(zn)}init(){this.add.rectangle(1920,1824,3072,128).setOrigin(.5).setStrokeStyle(1,16777215);const t=this.add.rectangle(384,1824,4,124,16777215).setOrigin(.5);let e;this.load.on("progress",s=>{if("number"!=typeof s)throw new Error("");0===s&&(e=performance.now()),1===s&&performance.now(),t.width=4+3072*s})}preload(){this.load.setPath("assets"),this.load.image("logo","logo.png"),this.load.font("Roboto","fonts/Roboto/Roboto-VariableFont_wdth,wght.ttf"),this.load.font("MarcellusSC","fonts/Marcellus_SC/MarcellusSC-Regular.ttf"),this.load.bitmapFont("MarcellusSCBitmap","fonts/Marcellus_SC/MarcellusSC-Regular.png","fonts/Marcellus_SC/MarcellusSC-Regular.xml"),this.load.spritesheet("brawler","animations/brawler48x48.png",{frameHeight:48,frameWidth:48}),this.preloadTexture(),this.load.spritesheet("fullscreen","ui/fullscreen.png",{frameHeight:64,frameWidth:64}),this.load.atlas("xbox","ui/xbox.png","ui/xbox.json"),this.load.atlas("kbm","ui/kbm.png","ui/kbm.json"),this.load.image("cursor-attack","ui/cursor-attack.png"),this.load.image("cursor-default","ui/cursor-default.png"),this.load.atlas("flares","particles/flares.png","particles/flares.json"),this.load.spritesheet("stick","animations/stick.png",{frameHeight:339.375,frameWidth:180}),this.load.spritesheet("stick-head","animations/stick-head.png",{frameHeight:18,frameWidth:18}),this.load.spritesheet("drone","animations/drone.png",{frameHeight:34,frameWidth:34}),this.load.spritesheet("blobie-walk","animations/blobie-walk.png",{frameHeight:34,frameWidth:34}),this.load.spritesheet("char","animations/char.png",{frameHeight:34,frameWidth:34}),this.load.spritesheet("rat","animations/rat.png",{frameHeight:34,frameWidth:34}),this.load.spritesheet("blob","animations/blob.png",{frameHeight:34,frameWidth:34}),this.load.spritesheet("bat","animations/bat.png",{frameHeight:34,frameWidth:34}),this.load.spritesheet("torch","animations/torch.png",{frameHeight:192,frameWidth:192}),this.load.spritesheet("barrel","animations/barrel.png",{frameHeight:128,frameWidth:128}),this.load.spritesheet("tnt","animations/tnt.png",{frameHeight:192,frameWidth:192}),Xn.forEach(({frameConfig:t,key:e,url:s})=>{this.load.spritesheet(e,s,t)}),this.load.spritesheet("player1","animations/warrior.png",{frameHeight:192,frameWidth:192}),this.load.spritesheet("player2","animations/warrior2.png",{frameHeight:192,frameWidth:192}),this.load.atlas("crops","textures/crops.png","textures/crops.json"),this.load.atlas("drops","textures/drops.png","textures/drops.json"),Zn.forEach(t=>{const[e,s,i]=t.replace(".png","").split("_");void 0!==e&&void 0!==s&&void 0!==i&&this.load.spritesheet(e,`animations/${t}`,{frameHeight:parseInt(i),frameWidth:parseInt(s)})}),this.load.glsl("fire","shaders/fire.glsl"),this.load.glsl("lightshaft","shaders/lightshaft.glsl.js"),this.load.image("repeating-background","textures/tile.png"),this.load.image("tileset-grass","textures/tileset-grass.png")}preloadTexture(){const t="textures";for(const e of Wn){const s=Un.get(e);void 0===s?this.load.image(e,`${t}/${e}.png`):this.load.image(e,`${t}/${s}`)}this.load.atlas("ores","textures/ores.png","textures/ores.json")}preloadXP(){for(const t of Vn)this.load.image(`${Bn}${t}`,`textures/xp/${t}.png`)}}var qn,Jn;const Qn=U(Jn?qn:(Jn=1,qn=function t(e,s){if(e===s)return!0;if(e&&s&&"object"==typeof e&&"object"==typeof s){if(e.constructor!==s.constructor)return!1;var i,n,r;if(Array.isArray(e)){if((i=e.length)!=s.length)return!1;for(n=i;0!==n--;)if(!t(e[n],s[n]))return!1;return!0}if(e.constructor===RegExp)return e.source===s.source&&e.flags===s.flags;if(e.valueOf!==Object.prototype.valueOf)return e.valueOf()===s.valueOf();if(e.toString!==Object.prototype.toString)return e.toString()===s.toString();if((i=(r=Object.keys(e)).length)!==Object.keys(s).length)return!1;for(n=i;0!==n--;)if(!Object.prototype.hasOwnProperty.call(s,r[n]))return!1;for(n=i;0!==n--;){var a=r[n];if(!t(e[a],s[a]))return!1}return!0}return e!=e&&s!=s}));class tr extends Phaser.Scene{}class er extends tr{constructor(){super(...arguments),j(this,"debugging",!1),j(this,"_inputPlugin",null),Z(this,i,null),j(this,"_layers"),Z(this,n),j(this,"_playerPlugin",null)}get config(){if(!G(this,i)){const t=this.game.plugins.get(xn.key);if(!(t instanceof xn))throw new Error("misconfigured plugin");V(this,i,t)}return G(this,i)}init(){this.physics.world.drawDebug=!1,this.events.on("update",(t,e)=>{if("number"!=typeof t||"number"!=typeof e)throw new mn;this.inputProvider.update(t,e)})}get layers(){var t;if(!this._layers){const e=this.scale.height/2,s=this.scale.width/2,i=Math.max(e,s)/2,n=((t,e)=>{const s=t/96,i=e/96,n=Math.max(s,i);return{data:((t,e,s)=>{var i,n,r;const a=[];for(let o=-s;o<=s;o+=1){a[i=o+t]??(a[i]=new Array(e));const h=a[o+t];if(!h)throw new Error;for(let t=-s;t<=s;t+=1)Math.round(Math.sqrt(o*o+t*t))<=s?h[n=t+e]??(h[n]=Math.floor(64*Math.random())):h[r=t+e]??(h[r]=void 0)}return a})(n,n,n),height:i,tileHeight:32,tileWidth:32,width:s}})(e,s),r=this.make.tilemap(n),a=r.addTilesetImage("tileset-grass");if(null===a)throw new Error("tileset problems");this._layers={map:r.createLayer(0,a,0,-i),resource:this.add.layer().setDepth(1),game:this.add.layer().setDepth(5),player:this.add.layer().setDepth(6),ui:this.add.layer().setDepth(10),menu:this.add.layer().setVisible(!1).setDepth(15)},null==(t=this._layers.map)||t.setScale(3)}return this._layers}shutdown(){V(this,n,void 0),this._layers=void 0}get inputProvider(){return G(this,n)??V(this,n,new jn(this,null)),G(this,n)}get inputv2(){if(!this._inputPlugin)throw this.load.scenePlugin(ma.key,ma,ma.mapping),new Error("misconfigured scene plugin");return this._inputPlugin}get playerPlugin(){if(!this._playerPlugin){const t=this.game.plugins.get(da.key);if(!(t instanceof da))throw new Error("misconfigured plugin");this._playerPlugin=t}return this._playerPlugin}}i=new WeakMap,n=new WeakMap;class sr extends er{constructor(){super(...arguments),j(this,"_debugGraphics"),Z(this,r),Z(this,a),Z(this,o)}get debugGraphics(){var t;return this.debugging?(this._debugGraphics??(this._debugGraphics=this.add.graphics()),this._debugGraphics):(null==(t=this._debugGraphics)||t.clear(),null)}get drops(){return G(this,r)||(V(this,r,this.physics.add.group()),G(this,r).runChildUpdate=!0),G(this,r)}init(){super.init()}get player1(){return G(this,a)??V(this,a,new Er(this,"player1",void 0,0)),G(this,a)}get player2(){return G(this,o)??V(this,o,new Er(this,"player2",{interactionKeys:{dash:"FORWARD_SLASH",interact:"P"},movementKeys:{down:"DOWN",left:"LEFT",right:"RIGHT",up:"UP"}},1).setVisible(!1)),G(this,o)}shutdown(){var t,e,s;super.shutdown(),null==(t=G(this,a))||t.destroy(),V(this,a,void 0),null==(e=G(this,o))||e.destroy(),V(this,o,void 0),null==(s=G(this,r))||s.destroy(),V(this,r,void 0)}}r=new WeakMap,a=new WeakMap,o=new WeakMap;class ir{constructor(t){j(this,"lastDeps",[]),j(this,"lastValue"),this.fn=t}run(t){return void 0!==this.lastValue&&Qn(this.lastDeps,t)||(this.lastValue=this.fn(),this.lastDeps=structuredClone(t)),this.lastValue}}class nr extends sr{constructor(){super(...arguments),j(this,"border",{curr:0,prev:0}),j(this,"graphics"),j(this,"split",!1),j(this,"_cameraMasks"),j(this,"_maskShapes"),j(this,"_playercams"),j(this,"_centers")}init(){super.init(),this.cameras.main.startFollow(this.player1),this.events.on("update",()=>{this.updateScreen()})}shutdown(){super.shutdown()}get cameraMasks(){if(!this._cameraMasks){const t=this.maskShapes.p1.createGeometryMask(),e=this.maskShapes.p2.createGeometryMask();this._cameraMasks={p1:t,p2:e}}return this._cameraMasks}get maskShapes(){if(!this._maskShapes){const t=this.add.graphics({x:0,y:0}),e=this.add.graphics({x:0,y:0});this.layers.ui.add(t),this.layers.ui.add(e),this._maskShapes={p1:t,p2:e}}return this._maskShapes}get playercams(){if(!this._playercams){const t=this.cameras.add(0,0,this.scale.width,this.scale.height,!1).setVisible(!1),e=this.cameras.add(0,0,this.scale.width,this.scale.height,!1).setVisible(!1);this._playercams={p1:t,p2:e}}return this._playercams}get centers(){return this._centers??(this._centers=new ir(()=>{const t=(this.player1.x+this.player2.x)/2,e=(this.player1.y+this.player2.y)/2,s=new Phaser.Math.Vector2(t,e),i=this.player2.x-this.player1.x,n=this.player2.y-this.player1.y,r=new Phaser.Math.Vector2(i,n),a=new Phaser.Math.Vector2(this.player1.x,this.player1.y),o=new Phaser.Math.Vector2(this.player2.x,this.player2.y),h=r.angle(),c=Math.sin(h)*this.scale.height/4,l=Math.cos(h)*this.scale.width/4,d=Math.sqrt(c**2+l**2);return{center1:r.clone().normalize().multiply({x:d,y:d}).add(this.player1),center2:r.clone().normalize().multiply({x:-d,y:-d}).add(this.player2),d:r,midpoint:s,p1:a,p2:o}})),this._centers.run([this.player1.x,this.player1.y,this.player2.x,this.player2.y])}draw(t,e){t.clear();const s=this.centers.d.clone();0===s.length()&&s.set(1,0);const i=s.clone().normalize(),n=new Phaser.Math.Vector2(-i.y,i.x),r=2*Math.max(this.scale.width,this.scale.height),a=4*Math.max(this.scale.width,this.scale.height);let o,h;1===e?(o=this.centers.center1.clone().add(n.clone().scale(r)),h=this.centers.center1.clone().add(n.clone().scale(-r))):(o=this.centers.center2.clone().add(n.clone().scale(r)),h=this.centers.center2.clone().add(n.clone().scale(-r)));const c=i.clone().scale(1===e?-a:a),l=o.clone().add(c),d=h.clone().add(c);this.debugging&&t.lineStyle(5*this.border.curr,0,1),t.lineStyle(this.border.curr,986895,1),t.beginPath(),t.moveTo(o.x,o.y),t.lineTo(l.x,l.y),t.lineTo(d.x,d.y),t.lineTo(h.x,h.y),t.closePath();const u=this.debugging?.5:0;this.maskShapes.p1.fillStyle(16711935,u),this.maskShapes.p2.fillStyle(16776960,u),t.fillPath(),t.strokePath()}drawDebug(){this.debugging&&(this.graphics??(this.graphics={center1:this.add.graphics({}),center2:this.add.graphics({}),d:this.add.graphics({}),midpoint:this.add.graphics({}),p1:this.add.graphics({}),p2:this.add.graphics({})}),this.graphics.p1.clear(),this.graphics.p1.fillStyle(16711680,1),this.graphics.p1.fillCircle(this.centers.p1.x,this.centers.p1.y,15),this.graphics.center1.clear(),this.graphics.center1.fillStyle(16711935,1),this.graphics.center1.fillCircle(this.centers.center1.x,this.centers.center1.y,5),this.graphics.p2.clear(),this.graphics.p2.fillStyle(65280,1),this.graphics.p2.fillCircle(this.centers.p2.x,this.centers.p2.y,15),this.graphics.center2.clear(),this.graphics.center2.fillStyle(16776960,1),this.graphics.center2.fillCircle(this.centers.center2.x,this.centers.center2.y,5),this.graphics.midpoint.clear(),this.graphics.midpoint.fillStyle(255,1),this.graphics.midpoint.fillCircle(this.centers.midpoint.x,this.centers.midpoint.y,5),this.graphics.d.clear(),this.graphics.d.fillStyle(65535,1),this.graphics.d.fillCircle(this.centers.d.x,this.centers.d.y,5))}onConnect(){this.player2.visible||(this.cameras.main.stopFollow(),this.player2.setVisible(!0))}onDisconnect(){this.player2.visible&&(this.cameras.main.startFollow(this.player1),this.player2.setVisible(!1))}onJoin(){!1!==this.split&&(this.cameras.main.setVisible(!0),this.playercams.p1.setVisible(!1),this.playercams.p2.setVisible(!1),this.split=!1)}onSplit(){this.split||(this.debugging||(this.cameras.main.stopFollow(),this.playercams.p1.setVisible(!0),this.playercams.p2.setVisible(!0)),this.split=!0)}updateScreen(){if(this.drawDebug(),this.player2.inputProvider.active&&!this.player2.visible&&this.onConnect(),!this.player2.inputProvider.active&&this.player2.visible&&this.onDisconnect(),!this.player2.visible)return;const t=this.centers.p1.distance(this.centers.center2)-this.centers.p1.distance(this.centers.center1);this.border.curr=t>2e3?20:t>0?.01*t:0,this.maskShapes.p1.clear(),this.maskShapes.p2.clear(),this.border.curr!==this.border.prev&&this.border.curr>0&&(this.border.prev=this.border.curr,this.maskShapes.p1.lineStyle(this.border.curr,16777215),this.maskShapes.p2.lineStyle(this.border.curr,16777215),this.playercams.p1.setZoom(40/(40+this.border.curr)),this.playercams.p2.setZoom(40/(40+this.border.curr)),this.debugging&&(this.maskShapes.p1.lineStyle(this.border.curr,16711935),this.maskShapes.p2.lineStyle(this.border.curr,16776960))),this.border.curr>0?this.onSplit():t<0&&this.onJoin(),this.split?(this.debugging?(this.cameras.main.setVisible(!0),this.playercams.p1.clearMask(),this.playercams.p2.clearMask(),this.cameras.main.centerOn(this.centers.midpoint.x,this.centers.midpoint.y)):(this.cameras.main.setVisible(!1),this.playercams.p1.setMask(this.cameraMasks.p2,!1),this.playercams.p2.setMask(this.cameraMasks.p1,!1)),this.playercams.p1.centerOn(this.centers.center2.x,this.centers.center2.y),this.playercams.p2.centerOn(this.centers.center1.x,this.centers.center1.y),this.draw(this.maskShapes.p1,1),this.draw(this.maskShapes.p2,2)):this.cameras.main.centerOn(this.centers.midpoint.x,this.centers.midpoint.y)}}const rr=320,ar=(t,e,s=1)=>{if(e){if("strength"===e&&(t.stats.attack=t.stats.attack*(1.05*s)),"agility"===e&&(t.stats.attackspeed=t.stats.attackspeed*(1.05*s)),"charisma"===e&&(t.health.max=t.health.max+20*s),"endurance"===e&&(t.stats.regen=t.stats.regen+.2*s),"speed"===e&&(t.stats.speed=Math.min(1.1*t.stats.speed*s,2)),"critchance"===e&&void 0!==t.hitbox.magnet&&t.scene instanceof Yr){const e={height:1.1*t.hitbox.magnet.height*s,width:1.1*t.hitbox.magnet.width*s};t.hitbox.magnet.destroy(),t.hitbox.magnet=t.scene.physics.add.body(t.x-e.width/2,t.y-e.height/2,e.width,e.height),t.scene.physics.add.overlap(t.hitbox.magnet,t.scene.drops,(e,s)=>{!1!==t.visible&&s instanceof Cr&&s.moveTo(t)})}}else t.stats.attack=1.05*t.stats.attack,t.stats.attackspeed=1.05*t.stats.attackspeed,t.stats.speed=Math.min(1.025*t.stats.speed,2),t.stats.accuracy=1.1*t.stats.accuracy,t.stats.range=1.1*t.stats.range,t.stats.regen=t.stats.regen+.2;for(const[,i]of t.weapons)i.levelUp(t.stats)};Phaser.Renderer.WebGL.Pipelines.MultiPipeline;class or extends Phaser.Renderer.WebGL.Pipelines.SinglePipeline{constructor(t,e="lightshaft"){const s=t.cache.shader.get(e);if(!(s instanceof Phaser.Display.BaseShader))throw new Error(`${e} shader missing from cache`);super({fragShader:s.fragmentSrc,game:t,name:e})}onBind(t){if(super.onBind(),console.log(t),t instanceof Phaser.GameObjects.Sprite){const e=2*t.width,s=10*t.height;this.set2f("spriteDimensions",e,s),console.log(`Sprite width: ${e}, Height: ${s}`)}this.set3f("glowColor",1,.8,.3)}}class hr extends Phaser.GameObjects.Text{constructor(t,e,s,i){super(t,t.scale.width/2,t.scale.height/3,s,{...Dn,fontSize:60}),j(this,"defaultText"),j(this,"timer"),this.setOrigin(.5),this.scene.add.existing(this),this.setPosition(t.scale.width/2,t.scale.height/3+e*this.height*1.5),this.defaultText=s,i&&this.setInteraction(i)}show(){this.setVisible(!0),this.setActive(!0)}hide(){this.setVisible(!1),this.setActive(!1)}setInteraction(t){this.setInteractive().on("pointerdown",t).on("pointerover",t=>{var e;if(!(t instanceof Phaser.Input.Pointer))throw new mn;null==(e=this.timer)||e.destroy(),this.setColor("rgba(68,192,141,128)")}).on("pointerout",t=>{if(!(t instanceof Phaser.Input.Pointer))throw new mn;this.setColor("rgba(255,255,255,128)"),this.timer=this.scene.time.addEvent({callback:()=>this.text=this.defaultText,delay:1e3})})}}const cr=class t{constructor(t){var e,s;j(this,"items",[]),j(this,"wipeMenu"),j(this,"wipeBorder"),j(this,"bounds"),j(this,"menu"),j(this,"border"),this.scene=t,this.border=this.scene.add.image(0,0,"menu-border",void 0).setVisible(!0),this.menu=this.scene.add.image(0,0,"menu",void 0).setVisible(!0),this.wipeBorder=null==(e=this.border.preFX)?void 0:e.addReveal(.1,0,0),this.wipeMenu=null==(s=this.menu.preFX)?void 0:s.addReveal(.1,0,0),this.bounds={bottom:0,left:this.scene.scale.baseSize.width,right:0,top:this.scene.scale.baseSize.height}}add(t,e,s){var i;(i=this.items)[e]??(i[e]=[]);let n=this.items[e].length;for(let o=0;o<e;o++){const t=this.items[o];if(!t)throw new Error;n+=t.length+1}const r=new hr(this.scene,n,t,s),a=r.getBounds();return this.bounds.top=Math.min(a.top,this.bounds.top),this.bounds.left=Math.min(a.left,this.bounds.left),this.bounds.right=Math.max(a.right,this.bounds.right),this.bounds.bottom=Math.max(a.bottom,this.bounds.bottom),this.items[e].push(r),this.upsize(),r}resize(){let e=0,s=this.scene.scale.baseSize.width,i=0,n=this.scene.scale.baseSize.height;for(const t of this.items)for(const r of t){const t=r.getBounds();n=Math.min(t.top,n),s=Math.min(t.left,s),i=Math.max(t.right,i),e=Math.max(t.bottom,e)}n-=t.MARGIN.y,s-=t.MARGIN.x,i+=t.MARGIN.x,e+=t.MARGIN.y;const r=e-n,a=i-s;this.menu.setDisplaySize(a-10,r-10),this.menu.setPosition(s+5,n+5).setOrigin(0),this.border.setDisplaySize(a,r),this.border.setPosition(s,n).setOrigin(0),this.menu.setVisible(!0),this.border.setVisible(!0)}setVisible(t){this.menu.setVisible(t),this.border.setVisible(t)}upsize(){const e=this.bounds.top-t.MARGIN.y,s=this.bounds.left-t.MARGIN.x,i=this.bounds.right+t.MARGIN.x,n=this.bounds.bottom+t.MARGIN.y-e,r=i-s;this.menu.setDisplaySize(r-10,n-10),this.menu.setPosition(s+5,e+5).setOrigin(0),this.border.setDisplaySize(r,n),this.border.setPosition(s,e).setOrigin(0),this.menu.setVisible(!0),this.border.setVisible(!0)}};j(cr,"MARGIN",{x:400,y:200});let lr=cr;const dr=class t{constructor(t){j(this,"background"),j(this,"_buttons"),this.scene=t,this.background=new lr(this.scene),console.log(this.buttons)}get buttons(){if(!this._buttons){const t=this.background.add("Resume",0,t=>{if(!(t instanceof Phaser.Input.Pointer))throw new mn;this.close(()=>{const t=this.scene.scene.get(zn);t instanceof yr&&t.resume()})}),e=this.background.add("Options",1,()=>{e.text="I don't have any right now\ntry the full screen button "}),s=this.background.add("Fullscreen",1,()=>{"Fullscreen"===s.defaultText?(this.scene.scale.startFullscreen(),s.defaultText="Windowed"):(this.scene.scale.stopFullscreen(),s.defaultText="Fullscreen")}),i=this.background.add("Restart",2,()=>{const t=this.scene.scene.get(zn);t instanceof yr&&t.launch(_n)}),n=this.background.add("Switch",2);n.setInteraction(t=>{if(!(t instanceof Phaser.Input.Pointer))throw new mn;const e=this.scene.scene.get(zn);e instanceof yr&&(console.log(e.activeScene),e.activeScene===_n?"to the useless page?"===n.text?(e.launch(Sn),n.text="Switch"):n.text="to the useless page?":"to the action?"===n.text?(e.launch(_n),n.text="Switch"):n.text="to the action?")});const r="I was hoping you wouldn't click this one.",a="Are you sure?\nthis only works on the electron app",o=this.background.add("Exit",3);o.setInteraction(()=>{o.text===r||o.text===a?o.text===a?window.electronAPI.exit():o.text=a:o.text=r}),this._buttons={change:n,exit:o,fullscreen:s,options:e,restart:i,resume:t}}return this._buttons}open(){this.background.wipeMenu&&this.background.wipeBorder&&(this.background.wipeMenu.direction=0,this.background.wipeBorder.direction=0,this.background.wipeMenu.progress=0,this.background.wipeBorder.progress=0,this.scene.tweens.add({duration:t.WIPE_DURATION-50,hold:0,onComplete:()=>{for(const[,t]of Object.entries(this.buttons))t.setVisible(!0)},progress:1,repeat:0,repeatDelay:0,targets:this.background.wipeMenu,yoyo:!1}),this.scene.tweens.add({duration:t.WIPE_DURATION,hold:0,progress:1,repeat:0,repeatDelay:0,targets:this.background.wipeBorder,yoyo:!1}))}close(e){for(const[,t]of Object.entries(this.buttons))t.setVisible(!1);this.background.wipeMenu&&this.background.wipeBorder&&(this.background.wipeMenu.direction=1,this.background.wipeBorder.direction=1,this.background.wipeMenu.progress=1,this.background.wipeBorder.progress=1,this.scene.tweens.add({duration:t.WIPE_DURATION,hold:0,onComplete:e,progress:0,repeat:0,repeatDelay:0,targets:this.background.wipeMenu,yoyo:!1}),this.scene.tweens.add({duration:t.WIPE_DURATION-50,hold:0,progress:0,repeat:0,repeatDelay:0,targets:this.background.wipeBorder,yoyo:!1}))}};j(dr,"WIPE_DURATION",200);let ur=dr;class pr extends Phaser.Scene{constructor(){super({active:!1,key:In,plugins:Phaser.Plugins.DefaultPlugins.DefaultScene,visible:!1}),j(this,"background"),j(this,"logo"),j(this,"title"),j(this,"shine"),j(this,"switcher",()=>{}),j(this,"switchers",[]),j(this,"weapon",()=>{this.scene.get(_n),this.scene.getStatus(_n)}),j(this,"_menu")}close(){this.menu.close(()=>{const t=this.scene.get(zn);t instanceof yr&&t.resume()})}create(){this.weapon(),this.switcher(),this.menu.open(),this.events.on(Phaser.Scenes.Events.CREATE,t=>{}),this.events.on(Phaser.Scenes.Events.RESUME,(t,e)=>{t instanceof Phaser.Scenes.Systems&&t.scene instanceof pr&&(console.log("resuming main menu"),console.log(e)),this.menu.open()},this),this.events.on(Phaser.Scenes.Events.PAUSE,(t,e)=>{t instanceof Phaser.Scenes.Systems&&t.scene},this),this.cameras.main.setBackgroundColor("rgba(0,0,0,128)")}get menu(){return this._menu??(this._menu=new ur(this)),this._menu}shimmer(){this.time.addEvent({callback:()=>{if(!this.shine)return;const t=.25+.5*Math.random();this.shine.speed=t,this.menuBorder.postFX.add(this.shine),this.time.addEvent({callback:()=>{console.trace("stack"),this.shine&&this.menuBorder.postFX.remove(this.shine)},delay:2e3/t})},delay:1e3,loop:!0})}}var mr=Object.defineProperty,fr=Object.getOwnPropertyDescriptor;const gr=(h=class extends er{constructor(){if(super({key:zn,plugins:Phaser.Plugins.DefaultPlugins.DefaultScene}),j(this,"_debugGraphics"),j(this,"activeScene",Sn),j(this,"enemies",null),j(this,"GameLayer",null),j(this,"MenuLayer",null),j(this,"shouldDrawCursor",!0),j(this,"UILayer",null),j(this,"cursors",{}),j(this,"fpses",[]),j(this,"fpsGraphic"),j(this,"fpsHistory",[[]]),j(this,"menuInit",!1),j(this,"menuOpen",!1),h.instance)return h.instance;h.instance=this}create(){var t;if(this.GameLayer=this.add.layer(),this.UILayer=this.add.layer(),this.MenuLayer=this.add.layer().setVisible(!1).setDepth(10),this.input.setDefaultCursor("none"),null==(t=this.input.mouse)||t.disableContextMenu(),this.game.events.on(Phaser.Core.Events.FOCUS,()=>{this.input.setDefaultCursor("none"),this.shouldDrawCursor=!0}),this.game.events.on(Phaser.Core.Events.BLUR,()=>{this.shouldDrawCursor=!1}),!this.input.keyboard)throw new Error("why no keyboard?");if(this.renderer instanceof Phaser.Renderer.WebGL.WebGLRenderer){const t=new or(this.game);this.renderer.pipelines.add("lightshaft",t)}const{lastPlayed:e}=this.config.load();0===e&&(this.activeScene=_n),this.scene.launch(this.activeScene),this.inputProvider.setOnPause(()=>{this.onMenu()})}get debugGraphics(){var t;return this.debugging?(this._debugGraphics??(this._debugGraphics=this.add.graphics()),this._debugGraphics):(null==(t=this._debugGraphics)||t.clear(),null)}drawCursor(){var t,e;(t=this.cursors).attack??(t.attack=this.add.sprite(0,0,"cursor-attack").setOrigin(0).setScale(.5).setVisible(!1)),(e=this.cursors).default??(e.default=this.add.sprite(0,0,"cursor-default").setOrigin(0).setScale(.5).setVisible(!1)),5===this.scene.getStatus(In)||this.activeScene!==_n?(this.cursors.attack.setVisible(!1),this.cursors.default.setVisible(this.shouldDrawCursor)):(this.cursors.attack.setVisible(this.shouldDrawCursor),this.cursors.default.setVisible(!1)),this.cursors.default.setPosition(this.input.activePointer.x,this.input.activePointer.y),this.cursors.attack.setPosition(this.input.activePointer.x,this.input.activePointer.y)}follow(t){this.cameras.main.setBounds(-1e3,-1e3,this.scale.width+2e3,this.scale.height+2e3)}launch(t){this.menuOpen&&this.onResume(),this.scene.key===zn?(this.scene.stop(this.activeScene),this.scene.launch(t)):this.scene.start(t),this.activeScene=t}onPause(){this.menuInit||(this.scene.launch(In),this.menuInit=!0),this.scene.setActive(!0,In),this.scene.setVisible(!0,In),this.scene.setActive(!1,this.activeScene),this.menuOpen=!0}resume(){this.onResume()}update(t,e){this.drawCursor(),this.fpses.push(this.game.loop.actualFps),this.fpses.length>61&&this.fpses.shift(),this.fpsGraphic??(this.fpsGraphic=this.add.graphics().lineStyle(2,16711680,1)),this.fpsGraphic.clear().lineStyle(2,16711680,1),this.fpsGraphic.lineStyle(1,16777215,1).strokeRect(20,120,300,150),this.fpsGraphic.lineStyle(2,16711680,1).strokePoints(this.fpses.map((t,e)=>new Phaser.Geom.Point(20+5*e,120+5*(60-t))))}onMenu(){if(this.menuOpen){const t=this.scene.get(In);if(!(t instanceof pr))throw new Error;t.close()}else this.onPause()}onResume(){this.scene.setActive(!1,In),this.scene.setVisible(!1,In),this.scene.setActive(!0,this.activeScene),this.menuOpen=!1}},j(h,"instance"),h);((t,e,s)=>{for(var i,n=fr(e,s),r=t.length-1;r>=0;r--)(i=t[r])&&(n=i(e,s,n)||n);n&&mr(e,s,n)})([gn()],gr.prototype,"update");let yr=gr;const vr={attached:!1,bgColor:2236962,color:65280,maxValue:100,percision:0,text:!0,value:100};class br{constructor(t,e={}){var s;j(this,"bar"),j(this,"config"),j(this,"percision"),j(this,"player"),j(this,"text"),this.player=t;const i=.025*t.scene.scale.height,n=t.scene.scale.width/3.5-i;this.config={...vr,height:i,width:n,x:i,y:t.scene.scale.height-i,...e,lineStyle:{alpha:.5,color:0,lineWidth:6}},this.config.lineStyle.lineWidth=Math.min(this.config.lineStyle.lineWidth,this.config.height/4),this.bar=t.scene.add.graphics(),this.config.text&&(this.text=t.scene.add.text(0,0,"",Dn).setOrigin(.5),this.text.x=this.config.x+this.config.width/2,this.text.y=this.config.y+this.config.height/2),this.config.attached?this.player.add(this.bar):(this.bar.setScrollFactor(0),null==(s=this.text)||s.setScrollFactor(0)),this.percision=10**this.config.percision,this.draw()}destroy(){var t;this.bar.destroy(),null==(t=this.text)||t.destroy()}setVisible(t){var e;this.bar.setVisible(t),null==(e=this.text)||e.setVisible(t)}update(t,e){(this.config.value!==t||this.config.maxValue!==e)&&(this.config.maxValue=e,this.config.value=Phaser.Math.Clamp(t,0,this.config.maxValue),this.draw())}draw(){this.bar.clear();const{alpha:t,color:e,lineWidth:s}=this.config.lineStyle;this.bar.lineStyle(s,e,t),this.bar.strokeRect(this.config.x-s/2,this.config.y-s/2,this.config.width+s,this.config.height+s),this.bar.fillStyle(this.config.bgColor),this.bar.fillRect(this.config.x,this.config.y,this.config.width,this.config.height);const i=this.config.value/this.config.maxValue*this.config.width;this.bar.fillStyle(this.config.color),this.bar.fillRect(this.config.x,this.config.y,i,this.config.height),this.text&&(this.text.text=`${Math.round(this.config.value*this.percision)/this.percision} / ${this.config.maxValue}`)}}class wr extends Phaser.Physics.Arcade.Sprite{constructor(t,e,s,i,n,r,a){super(t,e,s,r.key),j(this,"hitbox"),j(this,"created",!1),j(this,"size"),j(this,"enemiesDamaged",new Set),j(this,"pierce",0),this.scene=t,this.direction=n,this.stats=r,this.player=a,this.size=Math.min(this.width,this.height),this.setRotation(i).setScale(1.5),t.add.existing(this),t.physics.add.existing(this),this.setCollideWorldBounds(!0)}create(){throw new Error}destroy(){var t;null==(t=this.hitbox)||t.destroy(),super.destroy()}update(t,e){var s;if(this.pierce>=this.stats.attack.projectile.pierce)return void this.destroy();this.create(),this.updateHitbox();const{height:i,left:n,top:r,width:a}=this.getBounds(),o=this.scene.physics.overlapRect(n,r,a,i);for(const h of o){const t=h.gameObject;if(t instanceof Vr&&!1!==(null==(s=t.body)?void 0:s.enable)&&!this.enemiesDamaged.has(t)){if(this.enemiesDamaged.size>=this.stats.attack.projectile.pierce)return;if(this.pierce>=this.stats.attack.projectile.pierce)break;t.dealDamage(Math.trunc(this.stats.attack.projectile.damage)),this.enemiesDamaged.add(t),this.pierce++}}}updateHitbox(){this.hitbox??(this.hitbox=this.scene.physics.add.body(this.x,this.y,this.size,this.size));const t=Math.cos(this.rotation)*(this.width/2),e=Math.sin(this.rotation)*(this.width/2);this.hitbox.x=this.x+t-this.hitbox.width/2,this.hitbox.y=this.y+e-this.hitbox.height/2}}const xr={attack:{cooldown:2e3,damage:{max:40,min:30},delta:0,deviation:Math.PI/64,projectile:{damage:40,delay:400,fired:0,lifetime:2e6/1920,offsetAngle:0,pierce:2,range:{arc:Math.PI/32,distance:2e3},speed:1920,total:2,vangular:0,vx:0,vy:0}},key:"arrow"};class kr extends wr{create(){if(this.created)return;const t=Math.cos(this.rotation),e=Math.sin(this.rotation),s=t*this.stats.attack.projectile.speed,i=e*this.stats.attack.projectile.speed;this.setVelocity(s,i),this.scene.time.addEvent({callback:()=>{this.destroy()},delay:this.stats.attack.projectile.lifetime}),this.created=!0}}const _r={attack:{cooldown:2e3,damage:{max:40,min:30},delta:0,deviation:0,projectile:{damage:40,delay:400,fired:0,lifetime:150,offsetAngle:800*Phaser.Math.DEG_TO_RAD*.15/2,pierce:Number.POSITIVE_INFINITY,range:{arc:2/3*Math.PI,distance:200},speed:3840,total:2,vangular:800,vx:0,vy:0}},key:"sword"};console.log(800*Phaser.Math.DEG_TO_RAD*.15/2,2/3*Math.PI);class Pr extends wr{create(){if(this.created)return;this.setOrigin(-.5,.5),this.setPosition(this.x-this.player.x,this.y-this.player.y),this.player.add(this),this.setVelocityX(this.stats.attack.projectile.vx),this.setVelocityY(this.stats.attack.projectile.vy),this.body instanceof Phaser.Physics.Arcade.Body&&(this.body.maxAngular=2160);const t=this.stats.attack.projectile.vangular*this.direction,e=t*(this.stats.attack.projectile.lifetime/1e3),s=Phaser.Math.DEG_TO_RAD*(e/2);this.setRotation(this.rotation-s),this.setAngularVelocity(t),this.scene.time.addEvent({callback:()=>{this.destroy()},delay:this.stats.attack.projectile.lifetime}),this.created=!0}}class Sr{constructor(t){switch(j(this,"stats"),j(this,"defaultStats"),t){case"arrow":this.defaultStats=xr,this.stats=structuredClone(xr);break;case"sword":this.defaultStats=_r,this.stats=structuredClone(_r);break;default:throw new Error("invalid projectile")}}levelUp(t){this.stats.attack.projectile.damage=this.defaultStats.attack.projectile.damage*t.attack,this.stats.attack.projectile.offsetAngle=this.defaultStats.attack.projectile.offsetAngle/t.accuracy,this.stats.attack.projectile.delay=this.defaultStats.attack.projectile.delay/t.attackspeed,this.stats.attack.cooldown=this.defaultStats.attack.cooldown/t.attackspeed;const e=1e3*this.stats.attack.projectile.range.arc/(this.stats.attack.projectile.vangular*Phaser.Math.DEG_TO_RAD),s=1e3*this.stats.attack.projectile.range.distance/this.stats.attack.projectile.speed;this.stats.attack.projectile.lifetime=Math.max(e,s)}}class zr extends Sr{constructor(t,e,s){super(e),j(this,"arc"),j(this,"cone"),j(this,"projectiles"),this.scene=t,this.projectile=e,this.player=s,this.projectiles=this.scene.physics.add.group(),this.projectiles.runChildUpdate=!0,this.cone=this.scene.add.graphics({fillStyle:{alpha:.05,color:0},lineStyle:{alpha:.1,color:16711935,width:4}}),this.arc=this.scene.add.graphics({fillStyle:{alpha:0,color:0},lineStyle:{alpha:.5,color:16777215,width:4}})}cooldown({targetX:t,targetY:e}){if(this.arc.clear(),!this.player.inputProvider.aiming)return;const{attack:s}=this.stats,i=s.cooldown,n=1-Math.min(s.delta/i,1),r=2*Math.PI*n;this.arc.arc(t,e,50,0,r,!1).strokePath().fillPath()}update(t,e){const{attack:s}=this.stats,{projectile:i}=s;s.delta+=e;const n=i.fired%2==0?-1:1,r=this.position(n*this.stats.attack.projectile.offsetAngle,t);this.aim(r),s.delta>=s.cooldown+i.delay*i.fired&&(i.fired++,this.attack(r),i.fired>=i.total&&(s.delta=0,i.fired=0)),this.cooldown(r)}aim({angles:{target:t}}){if(this.cone.clear(),!this.player.inputProvider.aiming)return;const{arc:e,distance:s}=this.stats.attack.projectile.range;this.cone.beginPath(),this.cone.arc(this.player.x,this.player.y,s,t-e/2,t+e/2,!1).strokePath().lineTo(this.player.x,this.player.y).fillPath()}attack({angles:{actual:t},x:e,y:s}){const{projectile:i}=this.stats.attack,n=i.fired%2==0?-1:1;if("sword"===this.projectile){const i=new Pr(this.scene,e,s,t,n,this.stats,this.player);this.projectiles.add(i)}else{const i=new kr(this.scene,e,s,t,0,this.stats,this.player);this.projectiles.add(i)}}position(t,e){const{angle:s,x:i,y:n}=this.player.target(e),r=t+s,a=Math.random()*this.stats.attack.deviation*2-this.stats.attack.deviation,o=s+a,h=Math.cos(o),c=Math.sin(o);return{angles:{actual:o,deviation:a,offset:r,target:s},targetX:i,targetY:n,vx:h*this.stats.attack.projectile.speed,vy:c*this.stats.attack.projectile.speed,x:this.player.x+40*h,y:this.player.y+40*c}}}class Ir{constructor(t){j(this,"items",new Set),Z(this,c),Z(this,l),this.player=t,this.player.scene.time.addEvent({callback:()=>{var t,e;null==(t=G(this,c))||t.clear(),null==(e=G(this,l))||e.setVisible(!1),this.player.inputProvider.removeAllInteract();for(const s of this.items)s.setAlpha(.5)},delay:100,loop:!0})}set text(t){this.lootText.text=t}clear(){this.lootMenu.clear(),this.lootText.setVisible(!1)}link(t){var e;this.lootMenu.clear(),t.siblings.forEach(t=>{this.lootMenu.lineStyle(5,16711680);const e=t.getBounds();this.lootMenu.lineBetween(e.centerX-24,e.centerY-24,e.centerX+24,e.centerY+24),this.lootMenu.lineBetween(e.centerX+24,e.centerY-24,e.centerX-24,e.centerY+24),t.siblings.forEach(e=>{this.lootMenu.lineStyle(5,0,.25),this.lootMenu.lineBetween(t.x,t.y,e.x,e.y)})}),null==(e=G(this,c))||e.stroke();const s=200;this.lootMenu.fillStyle(0,1),this.lootMenu.lineStyle(5,16777215),this.lootMenu.fillRect(t.x-175,t.y-s-100,350,s),this.lootMenu.strokeRect(t.x-175,t.y-s-100,350,s),this.lootText.setPosition(t.x,t.y-s),this.lootText.setVisible(!0),t.alpha=1,t.siblings.forEach(t=>{t.alpha=.25,this.items.add(t)}),this.items.add(t)}get lootMenu(){return void 0===G(this,c)&&(V(this,c,this.player.scene.add.graphics()),this.player.scene.layers.ui.add(G(this,c))),G(this,c)}get lootText(){return void 0===G(this,l)&&(V(this,l,this.player.scene.add.text(0,0,"",Dn).setOrigin(.5)),this.player.scene.layers.ui.add(G(this,l))),G(this,l)}}c=new WeakMap,l=new WeakMap;let Mr=class extends Phaser.Physics.Arcade.Sprite{constructor(t,e,s,i){super(t,e,s,i,void 0),this.scene=t,this.scene.add.existing(this),this.scene.layers.player.add(this),this.setOrigin(.5)}};const Tr=class t extends Phaser.GameObjects.Container{constructor(e,s,i,n){super(e,e.scale.baseSize.width/2+128*n,e.scale.baseSize.height/2),j(this,"active_weapon"),j(this,"alive",!0),j(this,"damagedAt",0),j(this,"dashing",!1),j(this,"health",{curr:100,max:100}),j(this,"hitbox",{}),Z(this,d,0-t.IFRAME_DURATION),Z(this,u,!1),j(this,"inventory"),j(this,"level",1),j(this,"num"),j(this,"stats",{accuracy:1,attack:1,attackspeed:1,range:1,regen:0,speed:1}),Z(this,p,new Map),Z(this,m),j(this,"weapons",new Map),j(this,"xp",{curr:0,max:5}),j(this,"dashCooldown",t.DASH_COOLDOWN),j(this,"dashStart",-5e3),j(this,"graphics"),j(this,"lastHpUpdate",0),Z(this,f),Z(this,g),Z(this,y,null),j(this,"_inventoryUI"),Z(this,v),j(this,"_player"),j(this,"_reticle"),j(this,"_spawnCurves"),j(this,"_curve"),Z(this,b),Z(this,w),this.scene=e,this.textureKey=s,this.config=i,this.scene instanceof Yr&&this.add(this.reticle),this.add(this.player),this.num=n,this.graphics=this.scene.add.graphics(),this.graphics.lineStyle(2,16711680,1),this.add(this.graphics),e instanceof Yr&&(this.weapons.set("sword",new zr(e,"sword",this)),this.weapons.set("arrow",new zr(e,"arrow",this)));const{inventory:r}=this.scene.config.load();this.inventory=r.player,this.scene.physics.add.existing(this),this.scene.layers.player.add(this)}applyDamage(e,s){this.health.curr-=s,V(this,d,e),this.flickerSprite(this.player,t.IFRAME_DURATION/2)}destroy(t){var e,s;null==(e=this._player)||e.destroy(t),null==(s=this._reticle)||s.destroy(t),this._reticle=void 0,this._player=void 0,V(this,u,!1),super.destroy(t)}die(){this.scene.config.saveInventory({player:this.inventory}),this.scene.scene.start(Sn),yr.instance&&(yr.instance.activeScene=Sn),this.alive&&(this.alive=!1)}getBounds(t){return this.player.getBounds(t)}getInterceptionVector(t,e){if(e<0)throw new Error("this breaks all of physics");const s={x:this.x,y:this.y};if(t<80)return s;const i=Math.min(4,Math.trunc(t/80)-1),n=this.getTargetCurve(80*i).getPointAt(e);return s.x+=n.x,s.y+=n.y,s}getTargetCurve(t){G(this,m)||(V(this,m,this.scene.add.graphics().lineStyle(1,16711680)),this.add(G(this,m)));let e=G(this,p).get(t);return e||(e=new Phaser.Curves.Ellipse(0,0,t,t),G(this,p).set(t,e)),this.scene.debugging&&e.draw(G(this,m)),e}get hpbar(){if(!(this.scene instanceof Yr))return null;if(!1===this.visible)return null;if(!G(this,f)){const t=26,e=52,s=this.scene.scale.width/3.5-t,i="player1"===this.textureKey?0:130-this.scene.scale.height,n=("player1"===this.textureKey?0:this.scene.scale.width-s-2*t)+t,r=i+this.scene.scale.height-2*t-e;V(this,f,new br(this,{color:16711680,height:e,percision:1,width:s,x:n,y:r}))}return G(this,f)}initialize(){G(this,u)||!1!==this.visible&&(this.scene instanceof Yr&&this.scene.lootManager.spawn({x:this.x,y:this.y-128},[{owner:this,type:ca.SwordPickup}]),V(this,u,!0))}get inputProvider(){return G(this,g)??V(this,g,new jn(this.scene,this,this.config)),G(this,g)}get interceptionPoint(){return G(this,y)}get inventoryUI(){return this.scene instanceof Yr?(this._inventoryUI??(this._inventoryUI=this.scene.add.container()),this._inventoryUI):null}levelUp(t,e=1){this.xp.curr>=this.xp.max&&(this.xp.curr=this.xp.curr%this.xp.max,this.xp.max=this.xp.max+5,this.level+=1,this.scene instanceof Yr&&this.scene.lootManager.spawn({x:this.x,y:this.y-200},[{owner:this,type:ca.StatDrop}]),ar(this,t,e))}get lootMenu(){return G(this,v)??V(this,v,new Ir(this)),G(this,v)}get player(){return this._player??(this._player=new Mr(this.scene,0,0,this.textureKey)),this._player}get reticle(){return this._reticle||(this._reticle=this.scene.add.sprite(0,0,"reticle").setOrigin(.5),this.scene.layers.game.add(this._reticle)),this._reticle.setVisible(void 0!==this.active_weapon),this._reticle}get spawnCurves(){return this._spawnCurves??(this._spawnCurves=[new Phaser.Curves.Ellipse(0,0,this.scene.scale.height/2,this.scene.scale.height/2),new Phaser.Curves.Ellipse(0,0,this.scene.scale.height/2+100,this.scene.scale.height/2+100),new Phaser.Curves.Ellipse(0,0,this.scene.scale.height/2+200,this.scene.scale.height/2+200)]),this._spawnCurves}target(t){if(!(this.scene instanceof Yr))throw new Error("shouldn't be getting called in this scene");const e=this.inputProvider.target(this,this.scene.enemies);this.scene.debugging&&this.curve.draw(this.graphics,64);const{x:s,y:i}=this.curve.getPoint(e.angle/(2*Math.PI));return this.reticle.setRotation(e.angle).setPosition(s,i),e}update(e,s){var i;if(this.initialize(),this.physics(),this.updateInterceptionPoint(),!1===this.visible?this.inputProvider.refresh():(this.scene.debugging&&console.log(this.body&&!0===this.body.enable),this.inputProvider.update(e,s)),this.updateResources(),this.hp(e,s),void 0!==this.active_weapon){const t=this.weapons.get(this.active_weapon);t&&this.visible&&t.update(e,s)}if(!(this.body instanceof Phaser.Physics.Arcade.Body))return;const[n,r]=this.inputProvider.position();this.inputProvider.dashing&&(this.inputProvider.dashing=!1,this.dashStart+this.dashCooldown<e&&(0!==n||0!==r)&&(this.dashStart=e)),null==(i=this.dashbar)||i.update(e-this.dashStart,this.dashCooldown),this.dashing=this.dashStart+200>e,this.body.checkCollision.none=G(this,d)+t.IFRAME_DURATION>e,this.dashing&&!this.body.checkCollision.none&&(this.body.checkCollision.none=!0,V(this,d,e));let a=rr*this.stats.speed;this.dashing&&(a*=5),n<0?this.player.flipX=!0:n>0&&(this.player.flipX=!1),0===n&&0===r?this.player.play(`${this.textureKey}-idle`,!0):this.player.play(`${this.textureKey}-move`,!0);const o=a*n,h=a*r;this.body instanceof Phaser.Physics.Arcade.Body&&this.body.setVelocity(o,h)}updateInventory(t){var e;const s="player1"===this.textureKey?-150:150-this.scene.scale.height,i="player1"===this.textureKey?40:this.scene.scale.width-40,n="player1"===this.textureKey?-1:1,r="player1"===this.textureKey?1:-1,a=this.scene.add.sprite(i+40*r*(this.inventory.plants.length%30),s+this.scene.scale.height+40*n*Math.floor(this.inventory.plants.length/30),"crops",t).setScale(3).setScrollFactor(0);null==(e=this.inventoryUI)||e.add(a),this.inventory.plants.push(t),this.scene.config.save({lastPlayed:Date.now()})}updateResources(){var t,e;this.scene instanceof Yr&&(this.levelUp(),null==(t=this.xpbar)||t.update(this.xp.curr,this.xp.max),null==(e=this.hpbar)||e.update(this.health.curr,this.health.max),this.health.curr<=0&&this.die())}get curve(){return this._curve??(this._curve=new Phaser.Curves.Ellipse(0,20,50,20)),this._curve}get dashbar(){if(!1===this.visible)return null;if(!G(this,b)){const{height:t,width:e}=this.getBounds();V(this,b,new br(this,{attached:!0,color:16777215,height:e/32,text:!1,width:e/4,x:-e/8,y:t/4}))}return G(this,b)}flickerSprite(t,e){let s=0;const i=this.scene.time.addEvent({callback:()=>{t.visible=!t.visible,t.tint=16711680,s+=50,s>=e&&(t.visible=!0,t.tint=16777215,i.remove())},callbackScope:this,delay:50,loop:!0})}hp(t,e){this.health.curr<this.health.max?this.health.curr+=this.stats.regen*(e/1e3):(this.lastHpUpdate+=e,this.lastHpUpdate>1e3&&this.health.curr<this.health.max&&(this.health.curr+=this.stats.regen,this.lastHpUpdate=0))}physics(){if(!(this.body instanceof Phaser.Physics.Arcade.Body))throw new Error;if(this.body.enable!==this.visible&&(this.body.enable=this.visible),!1===this.body.enable)return;if(void 0===this.hitbox.loot){this.body.setOffset(-32,-32),this.body.setCircle(32),this.body.setImmovable(!0);const t=this.scene.physics.add.body(this.x-16,this.y-16,32,32).setCircle(16);this.hitbox.loot=t,this.scene instanceof Yr&&this.scene.physics.add.overlap(t,this.scene.drops,(t,e)=>{!1!==this.visible&&e instanceof Cr&&e.handleCollision(this)})}else this.hitbox.loot.x=this.x-16,this.hitbox.loot.y=this.y-16;if(this.scene instanceof Yr){if(void 0===this.hitbox.magnet){const t={height:256,width:256},e=this.scene.physics.add.body(this.x-t.width/2,this.y-t.height/2,t.width,t.height).setCircle(t.width/2);this.hitbox.magnet=e,this.scene.physics.add.overlap(e,this.scene.drops,(t,e)=>{!1!==this.visible&&e instanceof Cr&&e.moveTo(this)})}this.hitbox.magnet.x=this.x-this.hitbox.magnet.width/2,this.hitbox.magnet.y=this.y-this.hitbox.magnet.height/2}}updateInterceptionPoint(){if(!this.body)return;if(0===this.body.velocity.x&&0===this.body.velocity.y)return void V(this,y,null);const t=Math.atan2(this.body.velocity.y,this.body.velocity.x);V(this,y,(t/(2*Math.PI)+1)%1)}get xpbar(){if(!(this.scene instanceof Yr))return null;if(!1===this.visible)return null;const t="player1"===this.textureKey?0:130-this.scene.scale.height;if(!G(this,w)){const e=52,s=26,i=26,n=e,r=t+this.scene.scale.height-s-i,a=this.scene.scale.width-2*e;V(this,w,new br(this,{color:16777215,height:i,percision:0,width:a,x:n,y:r}))}return G(this,w)}};d=new WeakMap,u=new WeakMap,p=new WeakMap,m=new WeakMap,f=new WeakMap,g=new WeakMap,y=new WeakMap,v=new WeakMap,b=new WeakMap,w=new WeakMap,j(Tr,"DASH_COOLDOWN",5e3),j(Tr,"IFRAME_DURATION",500),j(Tr,"SPEED",rr);let Er=Tr;const Ar=["strength","endurance","agility","critchance","charisma","speed"];class Or{constructor(t,e,s,i,n,r,a){j(this,"drop"),this.scene=t,this.drop=new Cr({frame:n,handleCollision:a,handleInteraction:void 0,key:i,scene:t,type:r,x:e,y:s})}}class Cr extends Phaser.Physics.Arcade.Sprite{constructor({frame:t,handleCollision:e,handleInteraction:s,key:i,scene:n,type:r,x:a,y:o}){super(n,a,o,i,t),j(this,"handleCollision"),j(this,"handleInteraction"),j(this,"onCancel",t=>{}),j(this,"onInteract",t=>{this.handleInteraction&&this.handleInteraction(t)}),j(this,"onSelect",t=>{}),j(this,"owner"),Z(this,x,!1),j(this,"prompts",[{kbm:{color:16711935,frame:"keyboard_e"},text:"Select",xbox:{color:16777215,frame:"xbox_button_color_x"}}]),j(this,"rarity",1),j(this,"scene"),j(this,"siblings",[]),j(this,"subtype"),j(this,"target",null),j(this,"type"),j(this,"travelRemaining",2e3),this.subtype=i,this.scene=n,this.type=r,this.handleCollision=t=>{e(t,this)},s&&(this.handleInteraction=t=>{s(t,this)}),this.scene.drops.add(this),this.scene.layers.game.add(this),this.setDepth(this.getBottomCenter().y),this.body,Phaser.Physics.Arcade.Body}destroy(t=!1){t&&this.siblings.forEach(t=>{t.destroy(!1)}),this.setActive(!1),this.body&&(this.body.enable=!1),this.setVisible(!1),this.target=null,super.destroy()}moveTo(t){if(null!==this.target)return;if(void 0!==this.handleInteraction)return;this.target=t;const e=Phaser.Math.Distance.Between(t.x,t.y,this.x,this.y);this.travelRemaining=Math.min(e,2e3)}update(t,e){if(this.physics(),this.target){if(25===this.travelRemaining)return this.scene.physics.moveToObject(this,this.target,0,0),void(this.target=null);this.scene.physics.moveToObject(this,this.target,300,this.travelRemaining),this.travelRemaining=Math.max(25,this.travelRemaining-e)}}physics(){if(G(this,x))return;if(!(this.body instanceof Phaser.Physics.Arcade.Body))return;this.scene instanceof Yr?this.body.setDrag(640):(this.body.setDamping(!0),this.body.setDrag(.5),this.body.setBounce(.75));let t=Math.min(this.width,this.height);void 0===this.handleInteraction?t*=.25:t*=.75;const e=this.width/2-t,s=this.height/2-t;this.body.setCircle(t,e,s),V(this,x,!0)}}x=new WeakMap;class Dr{constructor(t){j(this,"getSiblingUsed",()=>0),j(this,"DropClass",Cr),j(this,"group"),j(this,"handleCollision"),j(this,"handleInteraction"),j(this,"keys"),j(this,"metadata"),j(this,"scene"),this.scene=t.scene,this.group=this.scene.physics.add.group({maxSize:t.metadata.maxSize}),this.handleCollision=t.handleCollision,this.handleInteraction=t.handleInteraction,this.keys=t.keys,this.metadata=t.metadata}clear(){this.group.clear(!0,!0)}get items(){const t=[],e=this.group.getMatching();for(const s of e)s instanceof this.DropClass&&t.push(s);return t}get size(){return this.group.getTotalUsed()}spawn(t,e,s,i,n,r){let a=this.getFirstDead(e,s);if(!a){const r=this.group.getTotalUsed()+this.getSiblingUsed();if(!(!0===t&&r<this.metadata.maxSize))return a;a=this.create(e,s,i,n)}return a.setActive(!0),""!==this.keys.play&&a.play(this.keys.play),void 0!==r&&a.play(r),a.setVisible(!0),a}spawnGroup(t,e){const s=[];for(const i of t){const t=this.spawn(!0,i.x,i.y,i.frame,i.type,i.play);t&&s.push(t)}for(const i of s){i.owner=e;for(const t of s)i!==t&&i.siblings.push(t)}return s}create(t,e,s,i){const n=new this.DropClass({frame:s,handleCollision:this.handleCollision,handleInteraction:this.handleInteraction,key:this.keys.sprite,scene:this.scene,type:i,x:t,y:e});return n.setScale(this.metadata.scale),this.group.add(n),this.items.push(n),n}getFirstDead(t,e){const s=this.group.getFirstDead(!1,t,e);if(s instanceof this.DropClass)return s}}class $r extends Or{constructor(t,e,s,i){if(!1===Vn.includes(i))throw new Error("invalid xp amount");const n=`${Bn}${i}`;super(t,e,s,n,"",n,(t,e)=>{t.xp.curr+=this.amount,e.destroy()}),this.scene=t,this.amount=i,this.drop.setScale(.5),this.drop.play(`${n}-float`)}collapse(){const t=this.scene.physics.overlapCirc(this.x,this.y,250),e=new Set;for(const s of t){const t=s.gameObject;if(t instanceof $r&&t.amount===this.amount&&(e.add(t),5===e.size)){const t=5*this.amount;this.drop.setTexture(`${Bn}${t}`),this.drop.play(`${Bn}${t}-float`),this.amount=t;for(const s of e)s!==this&&s.destroy();e.clear(),this.collapse()}}}}const Rr=[{chance:.73375,chanceLoot:0,dmg:1,glow:16777215,health:1,prefxPadding:16,rarity:"common",required:5,size:1},{chance:.195,chanceLoot:.25,dmg:1.2,glow:2031360,health:1.2,prefxPadding:16,rarity:"uncommon",required:10,size:1.5},{chance:.0525,chanceLoot:.5,dmg:1.5,glow:28927,health:1.5,prefxPadding:16,rarity:"rare",required:25,size:1.8},{chance:.014,chanceLoot:.75,dmg:2,glow:10696174,health:2,prefxPadding:16,rarity:"epic",required:100,size:1.8},{chance:.00375,chanceLoot:1,dmg:3,glow:16744448,health:3,prefxPadding:16,rarity:"legendary",required:500,size:2},{chance:.001,chanceLoot:1,dmg:5,glow:16711680,health:5,prefxPadding:16,rarity:"mythic",required:1e3,size:2.5}];let Nr=0;const jr=new Set(["common","uncommon","rare","epic","legendary"]);for(const ba of Rr){jr.delete(ba.rarity);const t=Math.round(1e5*(Nr+ba.chance))/1e5;ba.rand=[Nr,t],Nr=t}if(1!==Nr)throw new Error(`sum ${Nr} is incorrect`);if(0!==jr.size)throw new Error("missing rarity");var Fr=Object.defineProperty,Gr=Object.getOwnPropertyDescriptor;const Zr=(k=class extends Phaser.GameObjects.Container{constructor(t,e,s){if(super(t,0,0),j(this,"applyDamage",null),j(this,"body",null),j(this,"dmg",{max:0,min:0}),j(this,"health",{curr:0,max:0,prev:0}),j(this,"healthBar",null),j(this,"id",crypto.randomUUID().slice(-4)),Z(this,_,Math.random()),j(this,"glow",{common:void 0,epic:void 0,legendary:void 0,mythic:void 0,rare:void 0,uncommon:void 0}),j(this,"hp"),j(this,"lastDmgTime",0),j(this,"rarities"),j(this,"rarity"),j(this,"sprite"),j(this,"target",null),j(this,"updated",k.UPDATE_FREQ),this.scene=t,this.info=e,this.manager=s,this.sprite=this.scene.add.sprite(0,0,e.TEXTURE_KEY).setOrigin(.5),this.hp=this.scene.add.graphics(),this.add(this.sprite),this.add(this.hp),this.health={curr:e.stats.health,max:e.stats.health,prev:e.stats.health},this.dmg={max:this.info.stats.damage,min:this.info.stats.damage},this.scene.layers.game.add(this),!Rr[0])throw new Error("RARITIES is not set?");this.rarities=[{...Rr[0]}],this.rarity=Rr[0],this.scene.enemies.add(this)}damage(t){!this.scene.debugging&&this.applyDamage&&(this.lastDmgTime<t-this.info.stats.attackSpeed&&(this.lastDmgTime=t,this.scene[this.applyDamage].applyDamage(t,this.dmg.min)),this.applyDamage=null)}dealDamage(t){this.health.curr-=t;const e=this.scene.damageText.getFirstDead(!0,this.x,this.y-40);e instanceof Phaser.GameObjects.Text&&(e.text=t.toString()),this.healthbar()}die(){this.id;const t=this.x,e=this.y;this.toggle(!1);const s=1-this.rarity.chance,i=(this.rarity.chance,this.rarity.chanceLoot,Math.random()),n=[];i<this.info.loot.loot&&n.push({owner:1===this.info.loot.loot?this.manager.player:void 0,type:ca.StatDrop}),i<this.info.loot.void&&n.push({type:ca.VoidDrop}),this.scene.lootManager.spawn(this,n),i>s&&(Math.random(),new $r(this.scene,t,e+1,this.info.loot.xp))}findPlayer(t,e){this.target=this.scene.player1}move(t,e){if(this.updated<k.UPDATE_FREQ)return void(this.updated+=e);if(this.findPlayer(t,e),!this.target)return;const s=Phaser.Math.Distance.BetweenPoints(this,this.target);if(s<this.info.stats.range)return;this.updated=0;const i=this.target.getInterceptionVector(s,G(this,_)),n=Phaser.Math.Clamp(s/(2*Er.SPEED),1,1.5);this.scene.physics.moveToObject(this,i,this.info.stats.moveSpeed*n),this.body instanceof Phaser.Physics.Arcade.Body&&(this.sprite.flipX=this.body.velocity.x<0)}spawn(t,e,s,i=1){var n,r;this.updateRarityData(),V(this,_,s),this.target=t;const a=Math.random(),o=this.rarities.find(t=>void 0!==t.rand&&a>t.rand[0]&&a<t.rand[1])??this.rarities[0];if(!o)throw new Error(`${a}`);for(const[c,l]of Object.entries(this.glow))l&&(c===o.rarity?l.setActive(!0):l.setActive(!1));this.glow[o.rarity]||16777215===o.glow||(null==(n=this.sprite.preFX)||n.setPadding(o.prefxPadding),this.glow[o.rarity]=null==(r=this.sprite.preFX)?void 0:r.addGlow(o.glow));const h=this.info.stats.health*1.02**(i-1)*o.health;this.dmg={max:this.info.stats.damage*o.dmg,min:this.info.stats.damage*o.dmg},this.health.curr=h,this.health.max=h,this.sprite.setScale(o.size),this.scene.time.delayedCall(100,()=>{if(!(this.body instanceof Phaser.Physics.Arcade.Body))throw new Error("this makes life hard");{const t=this.sprite.width/3;this.body.setSize(t/2,t/2),this.body.setOffset(-t/4,-t/4),this.hp.setPosition(-t/4,-t/2)}}),this.setPosition(this.target.x+e.x,this.target.y+e.y),this.toggle(!0)}update(t,e){var s;!1!==(null==(s=this.body)?void 0:s.enable)&&(this.move(t,e),this.damage(t),this.sprite.anims.getName()!==this.info.FRAMES.MOVE.key&&this.sprite.play(this.info.FRAMES.MOVE,!0))}healthbar(){if(this.hp.clear(),this.health.curr<=0)return void this.die();if(this.health.curr===this.health.max||this.health.curr<=0)return;this.hp.fillStyle(2236962,1),this.hp.fillRect(this.hp.x,this.hp.y,k.HEALTH_WIDTH,k.HEALTH_HEIGHT);const t=k.HEALTH_WIDTH/this.health.max;this.hp.fillStyle(16711680,.5),this.hp.fillRect(this.hp.x,this.hp.y,Phaser.Math.Clamp(this.health.curr*t,0,k.HEALTH_WIDTH),k.HEALTH_HEIGHT)}toggle(t){this.setActive(t),this.setVisible(t),this.body instanceof Phaser.Physics.Arcade.Body&&(this.body.setVelocity(0,0),this.body.setEnable(t),this.body.debugShowBody=t)}updateRarityData(){const t=this.rarities[this.rarities.length-1];if(!t)throw new Error("");if("mythic"!==t.rarity)if(0===t.required){const t=Rr[this.rarities.length];if(!t)throw new Error("");this.rarities.push({...t})}else t.required--}},_=new WeakMap,j(k,"HEALTH_HEIGHT",10),j(k,"HEALTH_WIDTH",64),j(k,"UPDATE_FREQ",100),k);((t,e,s)=>{for(var i,n=Gr(e,s),r=t.length-1;r>=0;r--)(i=t[r])&&(n=i(e,s,n)||n);n&&Fr(e,s,n)})([(()=>{const t=new WeakMap;return(e,s,i)=>{const n=i.value;if(0==("function"==typeof(r=n)&&2===r.length))throw new Error("you fucked up a decorator dawg");var r;return i.value=function(e,s){const i=t.get(this)??0;e>5e3*i&&(t.set(this,i+1),this.constructor.name),n.call(this,e,s)},i}})()],Zr.prototype,"findPlayer");let Vr=Zr;class Br extends Phaser.Physics.Arcade.Group{constructor(t,e){super(t.scene.physics.world,t.scene,e.config),Z(this,P),j(this,"info"),j(this,"manager"),j(this,"scene"),j(this,"ROW_SIZE",4),this.manager=t,this.info=e,this.scene=t.scene,this.runChildUpdate=!0}spawn(t,e){let s;s=null!==e.interceptionPoint?(e.interceptionPoint+.1*Math.random())%1:Math.random();const i=Math.PI/256;let n=e.spawnCurves[0];for(let r=0;r<t;r++){r>=this.ROW_SIZE?n=e.spawnCurves[1]:r>=2*this.ROW_SIZE&&(n=e.spawnCurves[2]);const t=B(this,P,S).call(this),a=(s+i*Math.trunc(r/this.ROW_SIZE))%1,o=n.getPoint(a);console.log(s,e,o,a),t.spawn(e,o,a)}return this}}P=new WeakSet,S=function(){const t=this.getFirstDead(!1);if(t instanceof Vr)return t;if(this.isFull())throw new Error("factory fulll");const e=new Vr(this.scene,this.info,this.manager);return this.add(e),e};const Wr=[{config:{maxSize:200},frameRate:10,FRAMES:{ATTACK:{config:{end:18,start:13},key:"torch-attack"},IDLE:{config:{end:6,start:0},key:"torch-idle"},MOVE:{config:{end:11,start:7},key:"torch-move"}},loot:{loot:.01,void:.05,xp:1},metadata:{lastSpawn:-5e3,spawn:[{count:[2,2,2,3,3],max:25,rate:5e3,start:5},{count:[1],max:50,rate:2e3,start:5},{count:[3,5,7],max:50,rate:2500,start:20},{count:[3,3,4,5,5,5,6,7,7],max:100,rate:2500,start:40},{count:[1,1,2,3,3],max:100,rate:500,start:60},{count:[4,6,8],max:150,rate:1e3,start:90},{count:[2,3,3,4,5,5,6],max:200,rate:1e3,start:120},{count:[2,2,3,3,3],max:200,rate:2500,start:150},{count:[3],max:200,rate:1e3,start:180},{count:[3],max:200,rate:750,start:240},{count:[3],max:200,rate:500,start:300}]},stats:{attackSpeed:400,damage:5,health:80,level:1,moveSpeed:288,range:100},TEXTURE_KEY:"torch"},{config:{maxSize:50},frameRate:10,FRAMES:{ATTACK:{config:{end:18,start:13},key:"barrel-attack"},IDLE:{config:{frames:[0]},key:"barrel-idle"},MOVE:{config:{frames:[6,7,8,9,10,11,12,18,19,20,21,22,23]},key:"barrel-move"}},loot:{loot:.1,void:.15,xp:5},metadata:{lastSpawn:0,spawn:[{count:[0],max:0,rate:Number.POSITIVE_INFINITY,start:120},{count:[0],max:0,rate:Number.POSITIVE_INFINITY,start:180},{count:[1],max:15,rate:2e3,start:240},{count:[1],max:25,rate:1e3,start:300},{count:[1],max:50,rate:100,start:360},{count:[1],max:75,rate:750,start:420},{count:[1],max:100,rate:500,start:480}]},stats:{attackSpeed:800,damage:20,health:250,level:2,moveSpeed:rr/3,range:100},TEXTURE_KEY:"barrel"},{config:{maxSize:25},frameRate:10,FRAMES:{ATTACK:{config:{end:20,start:14},key:"tnt-attack"},IDLE:{config:{end:5,start:0},key:"tnt-idle"},MOVE:{config:{end:12,start:7},key:"tnt-move"}},loot:{loot:.1,void:.15,xp:25},metadata:{lastSpawn:0,spawn:[{count:[0],max:0,rate:Number.POSITIVE_INFINITY,start:240},{count:[0],max:0,rate:Number.POSITIVE_INFINITY,start:300},{count:[0],max:0,rate:Number.POSITIVE_INFINITY,start:360},{count:[0],max:0,rate:Number.POSITIVE_INFINITY,start:420},{count:[1],max:15,rate:2e3,start:480},{count:[1],max:25,rate:1e3,start:540},{count:[1],max:50,rate:1e3,start:600},{count:[1],max:75,rate:750,start:660},{count:[1],max:100,rate:500,start:720}]},stats:{attackSpeed:200,damage:5,health:50,level:3,moveSpeed:rr,range:250},TEXTURE_KEY:"tnt"}];for(const ba of Wr){let t={};for(const e of ba.metadata.spawn)t.end=e.start,t=e}console.log(Wr[0].metadata.spawn);const Ur=structuredClone(Wr[0]),Kr={...Ur,loot:{...Ur.loot,loot:1,void:1,xp:1},metadata:{...Ur.metadata,spawn:[{count:[1],max:1,rate:1e3,start:0}]}};class Lr{constructor(t,e){j(this,"firstEnemySpawned",!1),j(this,"groups",new Map),j(this,"elapsed",0),this.scene=t,this.player=e;for(const s of Wr)this.groups.set(s.TEXTURE_KEY,new Br(this,structuredClone(s)));this.groups.set("first",new Br(this,Kr)),this.elapsed=0}spawn(t,e){const s=this.groups.get(t);null==s||s.spawn(e,this.player)}update(t,e){if(this.elapsed+=e,!1===this.player.visible)return;const s=Math.floor(this.elapsed/1e3);for(const[i,n]of this.groups){n.preUpdate(t,e);const{info:{metadata:r}}=n,{spawn:a}=r,o=a.find(t=>s>t.start&&(void 0===t.end||s<t.end));if(o&&("first"!==i||!this.firstEnemySpawned)&&r.lastSpawn+o.rate<this.elapsed){const t=o.max-n.countActive(),e=Math.trunc(Math.random()*o.count.length),s=o.count[e]??1,a=Math.min(t,s);console.log(t,e,s,a,this.elapsed),n.spawn(a,this.player),r.lastSpawn=this.elapsed,"first"===i&&(this.firstEnemySpawned=!0)}}}}var Hr=Object.defineProperty,Xr=Object.getOwnPropertyDescriptor;class Yr extends nr{constructor(){super({key:_n,plugins:[...Phaser.Plugins.DefaultPlugins.DefaultScene,fa.key]}),j(this,"active",!0),j(this,"enemyManager1"),j(this,"enemyManager2"),j(this,"displayTimeTime",0),j(this,"enemyCollider"),j(this,"p1Collider"),j(this,"p2Collider"),Z(this,z),Z(this,I),Z(this,M)}create(){this.enemyCollider=this.physics.add.collider(this.enemies,this.enemies),this.p1Collider=this.physics.add.collider(this.enemies,this.player1,(t,e)=>{e instanceof Vr&&(e.applyDamage="player1")}),this.p2Collider=this.physics.add.collider(this.enemies,this.player2,(t,e)=>{e instanceof Vr&&this.player2.visible&&(e.applyDamage="player2")}),this.enemyManager1=new Lr(this,this.player1),this.enemyManager2=new Lr(this,this.player2),this.events.once(Phaser.Scenes.Events.SHUTDOWN,()=>{this.shutdown()},this),this.time.addEvent({callback:()=>{this.debugging&&(console.log("Enemies:",this.enemies.countActive(),this.enemies.countActive(!1)),console.log(this.enemies.getChildren().map(t=>({bodyPos:t.body&&{x:t.body.x,y:t.body.y},hasBody:!!t.body,name:t.name,worldPos:{x:t.x,y:t.y}}))),this.enemies.children.entries.forEach(t=>{t.body||console.warn("Enemy missing body:",t)}),console.log("Colliders active:",this.physics.world.colliders))},delay:5e3,loop:!0})}get damageText(){return G(this,z)||(G(this,z)??V(this,z,this.add.group({active:!0,classType:Phaser.GameObjects.Text,createCallback:t=>{this.layers.ui.add(t),t instanceof Phaser.GameObjects.Text&&(t.setStyle(Dn),this.time.delayedCall(250,()=>{t.destroy()}))},createMultipleCallback:null,defaultFrame:null,defaultKey:null,maxSize:200,removeCallback:null,runChildUpdate:!1}))),G(this,z)}get displayTime(){return G(this,I)??V(this,I,this.add.bitmapText(this.scale.width/2,200,"MarcellusSCBitmap","").setFontSize(40).setScrollFactor(0)),G(this,I)}get enemies(){return G(this,M)??V(this,M,this.physics.add.group()),G(this,M)}get lootManager(){if(!(la.mapping in this))throw new Error("this.load.scenePlugin(LootManager.mapping, LootManager) required in preload()");const t=this[la.mapping];if(!(t instanceof la))throw new Error;return t}preload(){this.load.scenePlugin(la.mapping,la)}shutdown(){var t,e;super.shutdown(),null==(t=G(this,I))||t.destroy(),V(this,I,void 0),null==(e=G(this,z))||e.destroy(),V(this,z,void 0),this.displayTimeTime=0}update(t,e){var s,i;this.active&&(this.player1.update(t,e),this.player2.update(t,e),this.player1.active_weapon?(null==(s=this.enemyManager1)||s.update(t,e),this.player2.visible&&(null==(i=this.enemyManager2)||i.update(t,e)),this.displayTimeTime+=e,this.displayTime.setText(`${Math.round(this.displayTimeTime/1e3)}`)):0===this.drops.countActive(!0)?this.config.save({lastPlayed:Date.now()}):this.config.load().lastPlayed)}}z=new WeakMap,I=new WeakMap,M=new WeakMap,j(Yr,"key",""),((t,e,s)=>{for(var i,n=Xr(e,s),r=t.length-1;r>=0;r--)(i=t[r])&&(n=i(e,s,n)||n);n&&Hr(e,s,n)})([gn()],Yr.prototype,"update");class qr extends Phaser.Scene{constructor(){super({key:Pn,plugins:Phaser.Plugins.DefaultPlugins.DefaultScene})}create(){performance.now();this.createPlayerAnimations(),this.createIncrementalAnimations(),this.createEnemyAnimations(),this.createEffectsAnimations();performance.now();this.scene.stop()}preload(){}createEffectsAnimations(){this.anims.create({frameRate:60,frames:this.anims.generateFrameNumbers("portal-particles",{end:59,start:0}),key:"portal-start",repeat:0}),this.anims.create({frameRate:60,frames:this.anims.generateFrameNumbers("portal-particles",{start:60}),key:"portal-enabled",repeat:-1}),this.anims.create({frameRate:60,frames:this.anims.generateFrameNumbers("portal",{end:0,start:0}),key:"portal",repeat:0})}createEnemyAnimations(){const t=this.anims;for(const{animations:e,key:s}of Xn)for(const t of e){const{frameRate:e,repeat:i,yoyo:n}=t;this.anims.create({delay:t.delay,frameRate:e,frames:this.anims.generateFrameNumbers(s,t.config),key:`${s}-${t.key}`,repeat:i,repeatDelay:t.repeatDelay,yoyo:n})}for(const e of Wr)for(const{config:s,key:i}of Object.values(e.FRAMES))t.exists(i)||t.create({frameRate:e.frameRate,frames:t.generateFrameNumbers(e.TEXTURE_KEY,s),key:i,repeat:-1})}createIncrementalAnimations(){this.anims.create({frameRate:8,frames:this.anims.generateFrameNumbers("drone",{frames:[4,5]}),key:"move",repeat:-1}),this.anims.create({frameRate:4,frames:this.anims.generateFrameNumbers("drone",{frames:[0,2]}),key:"idle",repeat:-1}),this.anims.create({frameRate:4,frames:this.anims.generateFrameNumbers("drone",{frames:[1,3]}),key:"idle2",repeat:-1}),this.anims.create({frameRate:8,frames:this.anims.generateFrameNumbers("drone",{frames:[0,2]}),key:"mine",repeat:-1}),this.anims.create({frameRate:8,frames:this.anims.generateFrameNumbers("drone",{frames:[8,9]}),key:"deliver",repeat:-1})}createPlayerAnimations(){const t=this.anims;t.exists("player1-idle")||t.create({frameRate:1,frames:t.generateFrameNumbers("player1",{end:5,start:0}),key:"player1-idle",repeat:-1}),t.exists("player1-move")||t.create({frameRate:10,frames:t.generateFrameNumbers("player1",{end:11,start:6}),key:"player1-move",repeat:-1}),t.exists("player2-idle")||t.create({frameRate:1,frames:t.generateFrameNumbers("player2",{end:5,start:0}),key:"player2-idle",repeat:-1}),t.exists("player2-move")||t.create({frameRate:10,frames:t.generateFrameNumbers("player2",{end:11,start:6}),key:"player2-move",repeat:-1})}}var Jr=Object.defineProperty,Qr=Object.getOwnPropertyDescriptor;class ta extends Phaser.Scene{constructor(){super({key:"Boot",plugins:Phaser.Plugins.DefaultPlugins.DefaultScene}),j(this,"gameScene"),j(this,"sceneRunning",null),j(this,"sceneStopped",!0)}preload(){}create(){this.cameras.main.setBackgroundColor("#FFF000"),this.cameras.main.setBackgroundColor("#CDD7E1"),this.launchScene(Mn)}launchScene(t,e){this.scene.launch(t,e),this.gameScene=this.scene.get(t)}updateResize(t){t.scale.on("resize",this.resize,t);const e=t.scale.gameSize.width,s=t.scale.gameSize.height;t.parent=new Phaser.Structs.Size(e,s),t.sizer=new Phaser.Structs.Size(t.width,t.height,Phaser.Structs.Size.FIT,t.parent),t.parent.setSize(e,s),t.sizer.setSize(e,s),this.updateCamera(t)}resize(t){if(!this.sceneStopped){const e=t.width,s=t.height;this.parent.setSize(e,s),this.sizer.setSize(e,s);const i=this.cameras.main,n=this.sizer.width/this.game.screenBaseSize.width,r=this.sizer.height/this.game.screenBaseSize.height;i.setZoom(Math.max(n,r)),i.centerOn(this.game.screenBaseSize.width/2,this.game.screenBaseSize.height/2)}}updateCamera(t){const e=t.cameras.main,s=t.sizer.width/this.game.screenBaseSize.width,i=t.sizer.height/this.game.screenBaseSize.height;e.setZoom(Math.max(s,i)),e.centerOn(this.game.screenBaseSize.width/2,this.game.screenBaseSize.height/2)}update(t,e){}}((t,e,s)=>{for(var i,n=Qr(e,s),r=t.length-1;r>=0;r--)(i=t[r])&&(n=i(e,s,n)||n);n&&Jr(e,s,n)})([gn()],ta.prototype,"update");class ea extends Phaser.Physics.Arcade.Sprite{constructor(t,e,s){super(t,s.x,s.y,"pickaxe"),j(this,"amount",0),j(this,"amountText"),j(this,"prompts",[{kbm:{color:16711935,frame:"keyboard_e"},text:"manage drones",xbox:{color:16777215,frame:"xbox_button_color_x"}}]),j(this,"container"),j(this,"glow"),j(this,"interactionBox"),j(this,"new",!0),j(this,"newTween"),this.scene=t,this.resourceType=e,this.scene.add.existing(this),this.scene.physics.add.existing(this);const{height:i,width:n,x:r,y:a}=this.getBounds();this.interactionBox=new Phaser.Geom.Rectangle(r-20,a-20,n+40,i+40),this.setImmovable(!0).setScale(.5);const{centerX:o,top:h}=this.getBounds();this.amountText=this.scene.add.text(o,h-20,"",Dn).setOrigin(.5),this.container=new On(t,s),this.setInteractive(),this.enableNew()}onCancel(){}onInteract(t){this.container.visible?this.container.setVisible(!1):this.container.open(0,0,t)}onSelect(){}setButtons(t){this.container.setButtons(t)}update(t,e){this.container.update(t,e);for(const s of[this.scene.player1,this.scene.player2]){if(!s.visible)continue;const t=s.x,e=s.y;this.interactionBox.contains(t,e)?s.inputProvider.setOnInteract(this):s.inputProvider.removeOnInteract(this)}}attention(){!1!==this.new&&(this.setRotation(Math.PI/32),this.scene.time.delayedCall(50,()=>{this.setRotation(0)}),Math.random()<.3&&(this.scene.time.delayedCall(100,()=>{this.setRotation(Math.PI/32)}),this.scene.time.delayedCall(150,()=>{this.setRotation(0)})),this.scene.time.delayedCall(1750+500*Math.random(),()=>{this.attention()}))}disableNew(){var t,e,s,i;this.new&&(this.new=!1,this.glow&&(null==(t=this.preFX)||t.remove(this.glow)),null==(e=this.preFX)||e.setPadding(16),this.glow=null==(s=this.preFX)?void 0:s.addGlow(16777215,100),null==(i=this.preFX)||i.addShadow(),this.newTween.stop())}enableNew(){var t,e,s;null==(t=this.preFX)||t.setPadding(32),null==(e=this.preFX)||e.addShadow(),this.glow=null==(s=this.preFX)?void 0:s.addGlow(16762624),this.newTween=this.scene.tweens.add({duration:1e3,ease:"sine.inout",loop:-1,outerStrength:100,targets:this.glow,yoyo:!0})}}class sa{constructor(t,e,s,i=1){var n;j(this,"resourceTarget"),j(this,"sprite"),j(this,"carrying",0),j(this,"debugText"),j(this,"distance",0),j(this,"level"),j(this,"miningElapsed",0),j(this,"miningTime",500),j(this,"resourceContainer"),j(this,"speed",100),j(this,"task","idle"),j(this,"travelElapsed",0),j(this,"travelTime",1e4),j(this,"xp"),j(this,"xpBase",1.2),j(this,"xpRequired"),this.scene=t,this.base=e,this.sprite=this.scene.physics.add.sprite(e.x,e.y,"").setOrigin(.5,.5).setScale(2),null==(n=this.sprite.body)||n.setSize(this.sprite.width/4,this.sprite.height/4,!0),this.scene.physics.add.collider(this.scene.player1.body,this.sprite),this.scene.physics.add.collider(this.scene.player2.body,this.sprite),this.sprite.setBounce(.25),this.resourceContainer=s,this.level=i,this.xp=this.xpBase**i,this.xpRequired=this.xpBase**(i+1),this.resourceTarget=void 0,this.debugText=this.scene.add.text(this.sprite.x,this.sprite.y,"",{align:"center",color:"#ffffff",fontFamily:"Arial Black",fontSize:20,stroke:"#000000",strokeThickness:4}),this.sprite.play("idle")}assignResource(t){if(this.resourceTarget=t,t){const e=this.base.x-t.x,s=this.base.y-t.y;this.distance=Math.sqrt(e*e+s*s)}}moveTo(t,e,s){const i=t-this.sprite.x,n=e-this.sprite.y,r=Math.sqrt(i*i+n*n),a=this.travelTime-this.travelElapsed;if(r>10){let t=r/a*1e3;t=Math.max(t,100);const e=Math.atan2(n,i),s=Math.cos(e)*t,o=Math.sin(e)*t;this.sprite.flipX=s<0,this.sprite.body instanceof Phaser.Physics.Arcade.Body&&(this.sprite.body.velocity.x/s<.1||this.sprite.body.velocity.y/o<.1)&&this.sprite.setVelocity(s,o)}else this.sprite.setVelocity(0,0);this.travelElapsed+=s}moveToPosition(t,e,s){const i=t-this.sprite.x,n=e-this.sprite.y,r=Math.sqrt(i*i+n*n),a=this.travelTime-this.travelElapsed;if(r>1){let t=r/a*1e3;t=Math.max(t,100);const e=Math.atan2(n,i),o=Math.cos(e)*t*(s/1e3),h=Math.sin(e)*t*(s/1e3);this.sprite.flipX=o<0,this.sprite.x+=o,this.sprite.y+=h,this.sprite.setVelocity(t,t)}}reached(t){const e=t.x-this.sprite.x,s=t.y-this.sprite.y;return e*e+s*s<100}update(t,e){switch(this.task){case"move":if(void 0===this.resourceTarget){this.task="deliver",this.sprite.play("deliver");break}this.moveTo(this.resourceTarget.x,this.resourceTarget.y,e),this.reached(this.resourceTarget)&&(this.task="mine",this.sprite.play("mine"),this.travelElapsed=0,this.miningElapsed=0);break;case"mine":if(void 0===this.resourceTarget){this.task="deliver",this.sprite.play("deliver");break}if(!this.reached(this.resourceTarget)){this.task="move",this.sprite.play("move");break}if(this.miningElapsed+=e,this.miningElapsed>=this.miningTime){if(this.carrying+=this.resourceTarget.mine(this.level-this.carrying),this.carrying<this.level)return this.resourceTarget=void 0,this.task="move",void this.sprite.play("move");this.task="deliver",this.sprite.play("move")}break;case"celebrate":if("deliver"===this.sprite.anims.getName())break;this.handleXp(),this.sprite.play("deliver"),setTimeout(()=>{this.task="move",this.sprite.play("move")},250);break;case"deliver":if(this.moveTo(this.base.x,this.base.y,e),this.reached(this.base)){if(this.resourceContainer.addResource(this.carrying),this.carrying=0,this.travelElapsed=0,void 0===this.resourceTarget){this.task="idle",this.sprite.play("idle");break}this.task="celebrate"}break;case"idle":void 0!==this.resourceTarget&&(this.task="move",this.sprite.play("move"))}}handleXp(){this.xp+=this.level,this.xp>=this.xpRequired&&(this.level+=1,this.xpRequired=this.xpBase**(this.level+1),this.travelTime=Math.max(Math.trunc(.9*this.travelTime),500),this.miningTime=Math.max(Math.trunc(.9*this.miningTime),100))}}class ia extends Phaser.Physics.Arcade.Image{constructor(t,e,s,i,n=1e3){const r=["00","16","32","48","64"],a=`${e}${r[Math.floor(Math.random()*r.length)]??"00"}`;super(t,s.x,s.y,"ores",a),j(this,"text"),this.scene=t,this.resourceType=e,this.position=s,this.size=i,this.amountLeft=n;const o=this.size/this.width;this.setScale(o),this.scene.physics.add.existing(this),this.text=this.scene.add.text(this.position.x,this.position.y,`${this.amountLeft}`,{fontSize:40}).setOrigin(.5,2),t.add.existing(this)}mine(t){const e=Math.min(t,this.amountLeft);return this.amountLeft-=e,this.text.setText(`${this.amountLeft}`),e}}class na extends Phaser.GameObjects.Text{constructor(t,e,s,i,n){super(t,e,s,i,n),j(this,"tween"),this.setVisible(!1),this.setAlpha(0)}}class ra{constructor(t,e,s){j(this,"amount",0),j(this,"amountVoidGems"),j(this,"baseCost",10),j(this,"building"),j(this,"costExponent",1.05),j(this,"costMultiplier",1.2),j(this,"droneGroup"),j(this,"drones",[]),j(this,"nodes"),j(this,"notificationText"),j(this,"resourceNodes",[]),j(this,"resourceSize",64),this.scene=t,this.type=e,this.probeBody=s,this.nodes=this.scene.physics.add.group(this.resourceNodes),this.droneGroup=this.scene.physics.add.group(),this.scene.physics.add.collider(this.droneGroup,this.droneGroup);const{inventory:i}=this.scene.config.load();this.amountVoidGems=i.voidGems;const n=this.scene.add.rectangle(0,0,this.scene.scale.baseSize.width,this.scene.scale.baseSize.height,255,255).setInteractive().on("pointerdown",t=>{if(!(t instanceof Phaser.Input.Pointer))throw new mn;t.rightButtonDown()&&this.createNode(t)}).setOrigin(0);for(this.scene.layers.game.add(n),this.building=new ea(this.scene,this.type,{x:1920,y:2e3}),this.building.setButtons([{onClick:()=>{this.createDrone()},text:`Spawn Drone\n(${this.amountVoidGems}/${this.cost})`,tooltip:"1"},{onClick:()=>{},text:"I'm a button",tooltip:"1"},{onClick:()=>{},text:"I'm also a button",tooltip:"1"}]),this.notificationText=this.scene.add.group({maxSize:15});15!==this.notificationText.children.size;){const t=new na(this.scene,this.building.x,this.building.y,"+1",{align:"center",color:aa[this.type].toString(16),fontSize:40,strokeThickness:8});t.tween=this.scene.tweens.add({alpha:[1,.95,.9,.85,.8,.75,.7,.6,.5,0],duration:500,paused:!0,persist:!0,targets:t,x:{from:this.building.x,to:this.building.x+50},y:{from:this.building.y-50,to:this.building.y-150}}),this.notificationText.add(t,!0)}this.createNode({x:this.scene.scale.baseSize.width*(3/4),y:this.scene.scale.baseSize.height*(3/4)})}addResource(t){var e;this.amount+=t;const s=this.notificationText.getMatching("alpha",0),i=s[Math.trunc(s.length*Math.random())];let n;i instanceof na&&(n=i,n.text=`+${t}`,n.setVisible(!0),null==(e=n.tween)||e.restart())}consumeResource(t){return this.amount>=t&&(this.amount-=t,!0)}createDrone(){if(this.amountVoidGems<this.cost)return;const t=new sa(this.scene,this.building,this,1);this.amountVoidGems-=this.cost,this.drones.push(t),this.droneGroup.add(t.sprite),this.building.setButtons([{onClick:()=>{this.createDrone()},text:`Spawn Drone\n(${this.amountVoidGems}/${this.cost})`,tooltip:"1"},{onClick:()=>{alert("button")},text:"I'm a button",tooltip:"1"},{onClick:()=>{alert("also a button")},text:"I'm also a button",tooltip:"1"}])}createNode(t){var e;t??(t={x:600,y:200}),this.probeBody.setEnable(!0).reset(t.x,t.y);const s=this.scene.physics.overlap(this.probeBody,this.nodes);if(this.probeBody.setEnable(!1),s)return;const i=new ia(this.scene,this.type,t,this.resourceSize);return this.resourceNodes.push(i),null==(e=this.scene.ResourceLayer)||e.add(i),this.nodes.add(i),i}update(t,e){var s;for(const i of this.drones){if(0===(null==(s=i.resourceTarget)?void 0:s.amountLeft)&&(i.resourceTarget.text.destroy(),this.nodes.remove(i.resourceTarget,!0,!0),i.assignResource(void 0)),!i.resourceTarget){const t=this.scene.physics.closest({x:i.sprite.x,y:i.sprite.y},this.nodes.getChildren());t&&t instanceof ia&&i.assignResource(t)}i.update(t,e)}this.building.update(t,e),this.building.amountText.setText(`${this.amount}`)}get cost(){const t=this.droneGroup.countActive(),e=this.costMultiplier*t,s=this.costExponent**t-1;return Math.trunc(this.baseCost*(e+s))}}const aa={copper:13857085,gold:16634896,silver:14869218,stone:5855577};class oa{constructor(t){j(this,"probeBody"),j(this,"resources",new Map),this.scene=t,this.probeBody=this.scene.physics.add.body(0,0,0,0).setEnable(!1)}addResource(t,e){const s=this.resources.get(t);if(!s)throw new Error("meow");s.addResource(e)}consumeResource(t,e){const s=this.resources.get(t);if(!s)throw new Error("meow");return s.consumeResource(e)}createDrone(t){const e=this.resources.get(t);if(!e)throw new Error("meow");e.createDrone()}createNode(t){const e=this.resources.get(t);if(!e)throw new Error("meow");e.createNode()}initialize(t){const e=new ra(this.scene,t,this.probeBody);this.resources.set(t,e)}update(t,e){for(const[,s]of this.resources)s.update(t,e)}}class ha{constructor(t){var e,s,i;j(this,"ellipse"),j(this,"particles"),j(this,"portal"),j(this,"prompts",[{kbm:{color:16711935,frame:"keyboard_e"},text:"enter",xbox:{color:16777215,frame:"xbox_button_color_x"}}]),this.scene=t;const n=t.scale.baseSize.width/2,r=t.scale.baseSize.height/4;this.portal=this.scene.add.sprite(n,r,"portal").setOrigin(.5),this.particles=this.scene.add.sprite(n,r,"portal-particles").setOrigin(.5).setZ(10),this.particles.play("portal-start"),this.particles.on("animationcomplete",t=>{if(!(t instanceof Phaser.Animations.Animation))throw new Error("not an animation?");"portal-start"===t.key&&this.particles.play("portal-enabled")});const{height:a,width:o,x:h,y:c}=this.portal;if(this.ellipse=new Phaser.Geom.Ellipse(h,c,o-20,a-20),!0===this.scene.physics.config.debug){const t=this.scene.add.ellipse(h,c,o-20,a-20,15790320);null==(e=this.scene.ResourceLayer)||e.add(t)}null==(s=this.scene.ResourceLayer)||s.add(this.portal),null==(i=this.scene.ResourceLayer)||i.add(this.particles)}onInteract(){var t;this.scene.scene.start(_n),this.scene.player1.inputProvider.removeOnInteract(this),null==(t=this.scene.player2)||t.inputProvider.removeOnInteract(this),yr.instance&&(yr.instance.activeScene=_n)}onSelect(){}onCancel(){}update(){for(const t of[this.scene.player1,this.scene.player2]){if(!t)continue;const e=t.x,s=t.y;Phaser.Geom.Ellipse.Contains(this.ellipse,e,s)?t.inputProvider.setOnInteract(this):t.inputProvider.removeOnInteract(this)}}}T=new WeakMap;var ca=(t=>(t.VoidDrop="void-gem",t.StatDrop="stat-drop",t.SwordPickup="sword-pickup",t.ArrowPickup="arrow-pickup",t))(ca||{});class la extends Phaser.Plugins.ScenePlugin{constructor(t,e,s){if(super(t,e,s),Z(this,E),j(this,"scene"),Z(this,O),Z(this,C),Z(this,D),Z(this,$),!(t instanceof Yr)){if("Scene2"===t.constructor.name)throw new Error("what is 'Scene2'");throw new Error}this.scene=t}spawn(t,e){const s={curr:0},i={curr:0};for(const n of e){const e=t.x+10*s.curr,r=t.y+10*i.curr;B(this,E,A).call(this,e,r,n.type,n.owner),i.curr<s.curr?i.curr+=2:s.curr+=2}}get lootGemGroup(){return G(this,O)||(V(this,O,new Dr({handleCollision:(t,e)=>{let s=125,i=Math.sqrt(62500-s**2);s*=2,i/=2;const n=[...Ar].sort(()=>Math.random()-.5).slice(0,3),r=[{x:t.x,y:t.y-i},{x:t.x+s,y:t.y},{x:t.x-s,y:t.y}],a=n.map((t,e)=>{if(!r[e])throw new Error;return{frame:t,type:t,...r[e]}});this.statUpgrade.spawnGroup(a,e.owner).forEach(t=>{var e,s;t.alpha=.5;let i=16777215,n=16777215;0===(null==(e=t.owner)?void 0:e.num)&&(i=255),1===(null==(s=t.owner)?void 0:s.num)&&(n=16711680),t.setTint(i,n,16777215,16777215)}),e.destroy()},handleInteraction:void 0,keys:{play:"stat-drop-float",sprite:"stat-drop"},metadata:{maxSize:3,scale:1},scene:this.scene})),G(this,O).getSiblingUsed=()=>this.statUpgrade.size/3),G(this,O)}get statUpgrade(){return G(this,C)??V(this,C,new Dr({handleCollision:(t,e)=>{void 0!==e.owner&&e.owner!==t||(t.lootMenu.link(e),t.lootMenu.text=((t,e,s)=>"strength"===e?`${5*s}% attack\n(current: ${t.stats.attack.toFixed(2)})`:"agility"===e?`${5*s}% attack speed\n(current: ${t.stats.attackspeed.toFixed(2)})`:"charisma"===e?`${20*s} health\n(current: ${t.health.max.toFixed(0)})`:"critchance"===e?"crit chance + 1%\n(for now increases magnet)":"endurance"===e?`${.2*s} regen\n(current: ${t.stats.regen.toFixed(1)})`:"speed"===e?`${10*s}% movespeed\n(max is 100%)\n(current: ${t.stats.speed.toFixed(2)})`:"N/A")(t,e.type,e.rarity),t.inputProvider.setOnInteract(e))},handleInteraction:(t,e)=>{ar(t,e.type,e.rarity),t.inputProvider.removeAllInteract(),e.destroy(!0),t.lootMenu.clear()},keys:{play:"",sprite:"drops"},metadata:{maxSize:9,scale:.5},scene:this.scene})),G(this,C)}get voidGemGroup(){return G(this,D)??V(this,D,new Dr({handleCollision:(t,e)=>{t.inventory.voidGems+=1,e.destroy()},handleInteraction:void 0,keys:{play:"void-gem-float",sprite:"void-gem"},metadata:{maxSize:100,scale:.5},scene:this.scene})),G(this,D)}get weaponPickup(){return G(this,$)??V(this,$,new Dr({handleCollision:(t,e)=>{void 0!==e.owner&&e.owner!==t||(t.lootMenu.link(e),t.lootMenu.text=e.type.slice(0,e.type.indexOf("-")),t.inputProvider.setOnInteract(e))},handleInteraction:(t,e)=>{const s=e.type.slice(0,e.type.indexOf("-")).toLowerCase();t.active_weapon="sword"===s||"arrow"===s?s:"arrow",t.inputProvider.removeAllInteract(),e.destroy(!0),t.lootMenu.clear()},keys:{play:"sword-pickup-float",sprite:"weapon-pickup"},metadata:{maxSize:9,scale:1},scene:this.scene})),G(this,$)}}E=new WeakSet,A=function(t,e,s,i){switch(s){case ca.VoidDrop:this.voidGemGroup.spawnGroup([{frame:"",type:"void-gem",x:t,y:e}],i);break;case ca.StatDrop:this.lootGemGroup.spawnGroup([{frame:"",type:"stat-drop",x:t,y:e}],i);break;case ca.SwordPickup:1===(null==i?void 0:i.num)&&(e+=512),this.weaponPickup.spawnGroup([{frame:"",play:"sword-pickup-float",type:"sword-pickup",x:t-128,y:e},{frame:"",play:"arrow-pickup-float",type:"arrow-pickup",x:t+128,y:e}],i),this.weaponPickup.items.forEach(t=>t.alpha=.5)}},O=new WeakMap,C=new WeakMap,D=new WeakMap,$=new WeakMap,j(la,"key","LootManager"),j(la,"mapping","_lootManager");class da extends Phaser.Plugins.BasePlugin{constructor(t){super(t),j(this,"alive"),this.alive=!0}isAlive(){return this.alive}}j(da,"key","PlayerManager"),j(da,"mapping","_playerplugin");const ua={key:da.key,mapping:da.mapping,plugin:da,start:!1},pa=class t extends Phaser.Plugins.ScenePlugin{constructor(e,s,i){if(super(e,s,i),j(this,"_bounds"),this.scene=e,console.log("input plugin",e.constructor.name),"Scene2"===e.constructor.name)return;if(!(e instanceof er))return;if(!t.config){const e=s.get(xn.key);e instanceof xn&&(t.config=e)}const n=e.input.keyboard;if(n){n.addKey(Phaser.Input.Keyboard.KeyCodes.H).on("up",(t,e)=>{if(!(t instanceof Phaser.Input.Keyboard.Key))throw new mn;if(!(e instanceof KeyboardEvent))throw new mn});const t=n.createCombo([Phaser.Input.Keyboard.KeyCodes.ALT,Phaser.Input.Keyboard.KeyCodes.H],{resetOnMatch:!0}),e=n.createCombo([Phaser.Input.Keyboard.KeyCodes.ALT,Phaser.Input.Keyboard.KeyCodes.K],{resetOnMatch:!0});n.addKey(Phaser.Input.Keyboard.KeyCodes.BACKTICK).on("up",(t,e)=>{if(!(t instanceof Phaser.Input.Keyboard.Key))throw new mn;if(!(e instanceof KeyboardEvent))throw new mn;if(e.altKey){const t=!this.scene.physics.world.drawDebug;if(console.log("toggling debug to",t),console.log(this.scene),!(this.scene instanceof er))return;this.scene.debugging=t,t||this.scene.physics.world.debugGraphic.clear(),this.scene.physics.world.drawDebug=t}}),n.on("keycombomatch",(s,i)=>{if(!(s instanceof Phaser.Input.Keyboard.KeyCombo))throw new mn;if(!(i instanceof KeyboardEvent))throw new mn;s===t&&console.log(this.scene),s===e&&console.log("combo!")})}}static get alpha(){return t._alpha??(t._alpha=!1),t._alpha}updateMapping(){var e;null==(e=t.config)||e.save({time:performance.now()})}};j(pa,"beta",!0),j(pa,"config",null),j(pa,"key","SceneInput"),j(pa,"mapping","_inputPlugin"),j(pa,"_alpha");let ma=pa;const fa={key:ma.key,mapping:ma.mapping,plugin:ma,start:!1},ga=[ta,Yn,qr,Yr,class extends nr{constructor(){super({key:Sn,plugins:[...Phaser.Plugins.DefaultPlugins.DefaultScene,fa.key]}),j(this,"GameLayer",null),Z(this,T,!1),j(this,"MenuLayer",null),j(this,"portal"),j(this,"portalEnabled",!1),j(this,"ResourceLayer",null),j(this,"UILayer",null),j(this,"inventory",{base:{voidGems:0},player:{plants:[],voidGems:0}}),j(this,"loot"),j(this,"resourceManager")}create(){var t;this.ResourceLayer=this.add.layer(),this.GameLayer=this.add.layer(),this.UILayer=this.add.layer(),this.MenuLayer=this.add.layer(),null==(t=this.input.mouse)||t.disableContextMenu(),this.resourceManager=new oa(this);const{inventory:e}=this.config.load();this.inventory=e,this.loot=new Dr({handleCollision:(t,e)=>{e.target=null},handleInteraction:void 0,keys:{play:"void-gem-float",sprite:"void-gem"},metadata:{maxSize:512,scale:.25},scene:this}),this.player1.body instanceof Phaser.Physics.Arcade.Body&&this.physics.add.collider(this.player1.body,this.drops),this.player2.body instanceof Phaser.Physics.Arcade.Body&&this.physics.add.collider(this.player2.body,this.drops),this.physics.add.collider(this.drops,this.drops),this.portal=new ha(this),this.resourceManager.initialize("stone"),this.events.once(Phaser.Scenes.Events.SHUTDOWN,()=>{this.shutdown()},this)}shutdown(){super.shutdown()}update(t,e){var s,i;null==(s=this.resourceManager)||s.update(t,e),this.player1.update(t,e),this.player2.update(t,e),null==(i=this.portal)||i.update(),this.spawnGems()}initialize(){V(this,T,!0)}spawnGems(){if(G(this,T)){if(this.loot&&this.loot.size<this.inventory.player.voidGems){const t=Math.random(),e=this.player1.getTargetCurve(64).getPoint(t).add(this.player1),s=this.loot.spawn(!0,e.x,e.y,"","void-gem");if(s){const e=this.player1.getTargetCurve(256).getPoint(t).add(this.player1);s.moveTo(e)}}}else this.initialize()}},pr,yr],ya=K.Scale.FIT,va={fps:{forceSetTimeOut:!0,limit:120},height:2160,input:{gamepad:!0},min:{height:480,width:720},parent:"game-container",physics:{arcade:{debug:!1,gravity:{x:0,y:0}},default:"arcade"},plugins:{global:[ua,kn],scene:[fa]},scale:{autoCenter:K.Scale.CENTER_BOTH,mode:ya},scene:ga,type:K.AUTO,width:3840};document.addEventListener("DOMContentLoaded",()=>{new K.Game({...va,parent:"game-container"})}),document.addEventListener("fullscreenchange",()=>{var t;"keyboard"in(t=navigator)&&null!==t.keyboard&&"object"==typeof t.keyboard&&"lock"in t.keyboard&&"function"==typeof t.keyboard.lock&&navigator.keyboard.lock(["Escape"])});
