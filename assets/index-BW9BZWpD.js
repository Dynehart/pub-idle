import{r as e,g as t}from"./phaser-BUlrDfUd.js";!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver(e=>{for(const s of e)if("childList"===s.type)for(const e of s.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&t(e)}).observe(document,{childList:!0,subtree:!0})}function t(e){if(e.ep)return;e.ep=!0;const t=function(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerPolicy&&(t.referrerPolicy=e.referrerPolicy),"use-credentials"===e.crossOrigin?t.credentials="include":"anonymous"===e.crossOrigin?t.credentials="omit":t.credentials="same-origin",t}(e);fetch(e.href,t)}}();var s=e();const i=e=>{if("object"==typeof e&&null!==e){if("function"==typeof Object.getPrototypeOf){const t=Object.getPrototypeOf(e);return t===Object.prototype||null===t}return"[object Object]"===Object.prototype.toString.call(e)}return!1},n=(...e)=>e.reduce((e,t)=>{if(void 0===t)return e;if(Array.isArray(t))throw new TypeError("Arguments provided to ts-deepmerge must be objects, not arrays.");return Object.keys(t).forEach(s=>{["__proto__","constructor","prototype"].includes(s)||(Array.isArray(e[s])&&Array.isArray(t[s])?e[s]=n.options.mergeArrays?n.options.uniqueArrayItems?Array.from(new Set(e[s].concat(t[s]))):[...e[s],...t[s]]:t[s]:i(e[s])&&i(t[s])?e[s]=n(e[s],t[s]):!i(e[s])&&i(t[s])?e[s]=n(t[s],void 0):e[s]=void 0===t[s]?n.options.allowUndefinedOverrides?t[s]:e[s]:t[s])}),e},{}),r={allowUndefinedOverrides:!0,mergeArrays:!0,uniqueArrayItems:!0};n.options=r,n.withOptions=(e,...t)=>{n.options=Object.assign(Object.assign({},r),e);const s=n(...t);return n.options=r,s};const a=(e,t,s)=>{if(e>t)throw new Error("if the divisor is able to reach 0, this results in NaN as well as unexpected behavior with the growth");let i;return i=5,(e+4*t)/(5*t)};class o extends Error{constructor(){super("function param was incorrectly typed")}}const h=()=>{const e=new WeakMap;return(t,s,i)=>{const n=i.value;if(!1===((e,t)=>"update"!==t?(console.error(new Error("must be used on update")),!1):"function"==typeof e&&2===e.length)(n,s))throw new Error("you fucked up a decorator dawg");return i.value=function(t,s){const i=e.get(this)??0;t>3e4*i&&(e.set(this,i+1),this.constructor.name),n.call(this,t,s)},i}};function c(e,t,s){function i(s,i){var n;Object.defineProperty(s,"_zod",{value:s._zod??{},enumerable:!1}),(n=s._zod).traits??(n.traits=new Set),s._zod.traits.add(e),t(s,i);for(const e in a.prototype)e in s||Object.defineProperty(s,e,{value:a.prototype[e].bind(s)});s._zod.constr=a,s._zod.def=i}const n=s?.Parent??Object;class r extends n{}function a(e){var t;const n=s?.Parent?new r:this;i(n,e),(t=n._zod).deferred??(t.deferred=[]);for(const s of n._zod.deferred)s();return n}return Object.defineProperty(r,"name",{value:e}),Object.defineProperty(a,"init",{value:i}),Object.defineProperty(a,Symbol.hasInstance,{value:t=>!!(s?.Parent&&t instanceof s.Parent)||t?._zod?.traits?.has(e)}),Object.defineProperty(a,"name",{value:e}),a}class l extends Error{constructor(){super("Encountered Promise during synchronous parse. Use .parseAsync() instead.")}}class d extends Error{constructor(e){super(`Encountered unidirectional transform during encode: ${e}`),this.name="ZodEncodeError"}}const u={};function p(e){return u}function g(e,t){return"bigint"==typeof t?t.toString():t}function m(e){return{get value(){{const t=e();return Object.defineProperty(this,"value",{value:t}),t}}}}function y(e){return null==e}function f(e){const t=e.startsWith("^")?1:0,s=e.endsWith("$")?e.length-1:e.length;return e.slice(t,s)}const b=Symbol("evaluating");function v(e,t,s){let i;Object.defineProperty(e,t,{get(){if(i!==b)return void 0===i&&(i=b,i=s()),i},set(s){Object.defineProperty(e,t,{value:s})},configurable:!0})}function w(e,t,s){Object.defineProperty(e,t,{value:s,writable:!0,enumerable:!0,configurable:!0})}function x(...e){const t={};for(const s of e){const e=Object.getOwnPropertyDescriptors(s);Object.assign(t,e)}return Object.defineProperties({},t)}function k(e){return JSON.stringify(e)}const _="captureStackTrace"in Error?Error.captureStackTrace:(...e)=>{};function P(e){return"object"==typeof e&&null!==e&&!Array.isArray(e)}const S=m(()=>{if("undefined"!=typeof navigator&&navigator?.userAgent?.includes("Cloudflare"))return!1;try{return new Function(""),!0}catch(e){return!1}});function M(e){if(!1===P(e))return!1;const t=e.constructor;if(void 0===t)return!0;const s=t.prototype;return!1!==P(s)&&!1!==Object.prototype.hasOwnProperty.call(s,"isPrototypeOf")}function z(e){return M(e)?{...e}:Array.isArray(e)?[...e]:e}const I=new Set(["string","number","symbol"]);function T(e){return e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function E(e,t,s){const i=new e._zod.constr(t??e._zod.def);return t&&!s?.parent||(i._zod.parent=e),i}function A(e){const t=e;if(!t)return{};if("string"==typeof t)return{error:()=>t};if(void 0!==t?.message){if(void 0!==t?.error)throw new Error("Cannot specify both `message` and `error` params");t.error=t.message}return delete t.message,"string"==typeof t.error?{...t,error:()=>t.error}:t}const C={safeint:[Number.MIN_SAFE_INTEGER,Number.MAX_SAFE_INTEGER],int32:[-2147483648,2147483647],uint32:[0,4294967295],float32:[-34028234663852886e22,34028234663852886e22],float64:[-Number.MAX_VALUE,Number.MAX_VALUE]};function O(e,t=0){if(!0===e.aborted)return!0;for(let s=t;s<e.issues.length;s++)if(!0!==e.issues[s]?.continue)return!0;return!1}function D(e,t){return t.map(t=>{var s;return(s=t).path??(s.path=[]),t.path.unshift(e),t})}function R(e){return"string"==typeof e?e:e?.message}function $(e,t,s){const i={...e,path:e.path??[]};if(!e.message){const n=R(e.inst?._zod.def?.error?.(e))??R(t?.error?.(e))??R(s.customError?.(e))??R(s.localeError?.(e))??"Invalid input";i.message=n}return delete i.inst,delete i.continue,t?.reportInput||delete i.input,i}function G(e){return Array.isArray(e)?"array":"string"==typeof e?"string":"unknown"}function B(...e){const[t,s,i]=e;return"string"==typeof t?{message:t,code:"custom",input:s,inst:i}:{...t}}const F=(e,t)=>{e.name="$ZodError",Object.defineProperty(e,"_zod",{value:e._zod,enumerable:!1}),Object.defineProperty(e,"issues",{value:t,enumerable:!1}),e.message=JSON.stringify(t,g,2),Object.defineProperty(e,"toString",{value:()=>e.message,enumerable:!1})},N=c("$ZodError",F),j=c("$ZodError",F,{Parent:Error}),V=e=>(t,s,i,n)=>{const r=i?Object.assign(i,{async:!1}):{async:!1},a=t._zod.run({value:s,issues:[]},r);if(a instanceof Promise)throw new l;if(a.issues.length){const t=new(n?.Err??e)(a.issues.map(e=>$(e,r,p())));throw _(t,n?.callee),t}return a.value},U=e=>async(t,s,i,n)=>{const r=i?Object.assign(i,{async:!0}):{async:!0};let a=t._zod.run({value:s,issues:[]},r);if(a instanceof Promise&&(a=await a),a.issues.length){const t=new(n?.Err??e)(a.issues.map(e=>$(e,r,p())));throw _(t,n?.callee),t}return a.value},Z=e=>(t,s,i)=>{const n=i?{...i,async:!1}:{async:!1},r=t._zod.run({value:s,issues:[]},n);if(r instanceof Promise)throw new l;return r.issues.length?{success:!1,error:new(e??N)(r.issues.map(e=>$(e,n,p())))}:{success:!0,data:r.value}},W=Z(j),K=e=>async(t,s,i)=>{const n=i?Object.assign(i,{async:!0}):{async:!0};let r=t._zod.run({value:s,issues:[]},n);return r instanceof Promise&&(r=await r),r.issues.length?{success:!1,error:new e(r.issues.map(e=>$(e,n,p())))}:{success:!0,data:r.value}},X=K(j),H=e=>(t,s,i)=>{const n=i?Object.assign(i,{direction:"backward"}):{direction:"backward"};return V(e)(t,s,n)},L=e=>(t,s,i)=>V(e)(t,s,i),q=e=>async(t,s,i)=>{const n=i?Object.assign(i,{direction:"backward"}):{direction:"backward"};return U(e)(t,s,n)},Y=e=>async(t,s,i)=>U(e)(t,s,i),Q=e=>(t,s,i)=>{const n=i?Object.assign(i,{direction:"backward"}):{direction:"backward"};return Z(e)(t,s,n)},J=e=>(t,s,i)=>Z(e)(t,s,i),ee=e=>async(t,s,i)=>{const n=i?Object.assign(i,{direction:"backward"}):{direction:"backward"};return K(e)(t,s,n)},te=e=>async(t,s,i)=>K(e)(t,s,i),se=/^[cC][^\s-]{8,}$/,ie=/^[0-9a-z]+$/,ne=/^[0-9A-HJKMNP-TV-Za-hjkmnp-tv-z]{26}$/,re=/^[0-9a-vA-V]{20}$/,ae=/^[A-Za-z0-9]{27}$/,oe=/^[a-zA-Z0-9_-]{21}$/,he=/^P(?:(\d+W)|(?!.*W)(?=\d|T\d)(\d+Y)?(\d+M)?(\d+D)?(T(?=\d)(\d+H)?(\d+M)?(\d+([.,]\d+)?S)?)?)$/,ce=/^([0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{12})$/,le=e=>e?new RegExp(`^([0-9a-fA-F]{8}-[0-9a-fA-F]{4}-${e}[0-9a-fA-F]{3}-[89abAB][0-9a-fA-F]{3}-[0-9a-fA-F]{12})$`):/^([0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[1-8][0-9a-fA-F]{3}-[89abAB][0-9a-fA-F]{3}-[0-9a-fA-F]{12}|00000000-0000-0000-0000-000000000000|ffffffff-ffff-ffff-ffff-ffffffffffff)$/,de=/^(?!\.)(?!.*\.\.)([A-Za-z0-9_'+\-\.]*)[A-Za-z0-9_+-]@([A-Za-z0-9][A-Za-z0-9\-]*\.)+[A-Za-z]{2,}$/,ue=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,pe=/^(([0-9a-fA-F]{1,4}:){7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:))$/,ge=/^((25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/([0-9]|[1-2][0-9]|3[0-2])$/,me=/^(([0-9a-fA-F]{1,4}:){7}[0-9a-fA-F]{1,4}|::|([0-9a-fA-F]{1,4})?::([0-9a-fA-F]{1,4}:?){0,6})\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,ye=/^$|^(?:[0-9a-zA-Z+/]{4})*(?:(?:[0-9a-zA-Z+/]{2}==)|(?:[0-9a-zA-Z+/]{3}=))?$/,fe=/^[A-Za-z0-9_-]*$/,be=/^(?=.{1,253}\.?$)[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[-0-9a-zA-Z]{0,61}[0-9a-zA-Z])?)*\.?$/,ve=/^\+(?:[0-9]){6,14}[0-9]$/,we="(?:(?:\\d\\d[2468][048]|\\d\\d[13579][26]|\\d\\d0[48]|[02468][048]00|[13579][26]00)-02-29|\\d{4}-(?:(?:0[13578]|1[02])-(?:0[1-9]|[12]\\d|3[01])|(?:0[469]|11)-(?:0[1-9]|[12]\\d|30)|(?:02)-(?:0[1-9]|1\\d|2[0-8])))",xe=new RegExp(`^${we}$`);function ke(e){const t="(?:[01]\\d|2[0-3]):[0-5]\\d";return"number"==typeof e.precision?-1===e.precision?`${t}`:0===e.precision?`${t}:[0-5]\\d`:`${t}:[0-5]\\d\\.\\d{${e.precision}}`:`${t}(?::[0-5]\\d(?:\\.\\d+)?)?`}const _e=/^-?\d+$/,Pe=/^-?\d+(?:\.\d+)?/,Se=/^(?:true|false)$/i,Me=/^[^A-Z]*$/,ze=/^[^a-z]*$/,Ie=c("$ZodCheck",(e,t)=>{var s;e._zod??(e._zod={}),e._zod.def=t,(s=e._zod).onattach??(s.onattach=[])}),Te={number:"number",bigint:"bigint",object:"date"},Ee=c("$ZodCheckLessThan",(e,t)=>{Ie.init(e,t);const s=Te[typeof t.value];e._zod.onattach.push(e=>{const s=e._zod.bag,i=(t.inclusive?s.maximum:s.exclusiveMaximum)??Number.POSITIVE_INFINITY;t.value<i&&(t.inclusive?s.maximum=t.value:s.exclusiveMaximum=t.value)}),e._zod.check=i=>{(t.inclusive?i.value<=t.value:i.value<t.value)||i.issues.push({origin:s,code:"too_big",maximum:t.value,input:i.value,inclusive:t.inclusive,inst:e,continue:!t.abort})}}),Ae=c("$ZodCheckGreaterThan",(e,t)=>{Ie.init(e,t);const s=Te[typeof t.value];e._zod.onattach.push(e=>{const s=e._zod.bag,i=(t.inclusive?s.minimum:s.exclusiveMinimum)??Number.NEGATIVE_INFINITY;t.value>i&&(t.inclusive?s.minimum=t.value:s.exclusiveMinimum=t.value)}),e._zod.check=i=>{(t.inclusive?i.value>=t.value:i.value>t.value)||i.issues.push({origin:s,code:"too_small",minimum:t.value,input:i.value,inclusive:t.inclusive,inst:e,continue:!t.abort})}}),Ce=c("$ZodCheckMultipleOf",(e,t)=>{Ie.init(e,t),e._zod.onattach.push(e=>{var s;(s=e._zod.bag).multipleOf??(s.multipleOf=t.value)}),e._zod.check=s=>{if(typeof s.value!=typeof t.value)throw new Error("Cannot mix number and bigint in multiple_of check.");("bigint"==typeof s.value?s.value%t.value===BigInt(0):0===function(e,t){const s=(e.toString().split(".")[1]||"").length,i=t.toString();let n=(i.split(".")[1]||"").length;if(0===n&&/\d?e-\d?/.test(i)){const e=i.match(/\d?e-(\d?)/);e?.[1]&&(n=Number.parseInt(e[1]))}const r=s>n?s:n;return Number.parseInt(e.toFixed(r).replace(".",""))%Number.parseInt(t.toFixed(r).replace(".",""))/10**r}(s.value,t.value))||s.issues.push({origin:typeof s.value,code:"not_multiple_of",divisor:t.value,input:s.value,inst:e,continue:!t.abort})}}),Oe=c("$ZodCheckNumberFormat",(e,t)=>{Ie.init(e,t),t.format=t.format||"float64";const s=t.format?.includes("int"),i=s?"int":"number",[n,r]=C[t.format];e._zod.onattach.push(e=>{const i=e._zod.bag;i.format=t.format,i.minimum=n,i.maximum=r,s&&(i.pattern=_e)}),e._zod.check=a=>{const o=a.value;if(s){if(!Number.isInteger(o))return void a.issues.push({expected:i,format:t.format,code:"invalid_type",continue:!1,input:o,inst:e});if(!Number.isSafeInteger(o))return void(o>0?a.issues.push({input:o,code:"too_big",maximum:Number.MAX_SAFE_INTEGER,note:"Integers must be within the safe integer range.",inst:e,origin:i,continue:!t.abort}):a.issues.push({input:o,code:"too_small",minimum:Number.MIN_SAFE_INTEGER,note:"Integers must be within the safe integer range.",inst:e,origin:i,continue:!t.abort}))}o<n&&a.issues.push({origin:"number",input:o,code:"too_small",minimum:n,inclusive:!0,inst:e,continue:!t.abort}),o>r&&a.issues.push({origin:"number",input:o,code:"too_big",maximum:r,inst:e})}}),De=c("$ZodCheckMaxLength",(e,t)=>{var s;Ie.init(e,t),(s=e._zod.def).when??(s.when=e=>{const t=e.value;return!y(t)&&void 0!==t.length}),e._zod.onattach.push(e=>{const s=e._zod.bag.maximum??Number.POSITIVE_INFINITY;t.maximum<s&&(e._zod.bag.maximum=t.maximum)}),e._zod.check=s=>{const i=s.value;if(i.length<=t.maximum)return;const n=G(i);s.issues.push({origin:n,code:"too_big",maximum:t.maximum,inclusive:!0,input:i,inst:e,continue:!t.abort})}}),Re=c("$ZodCheckMinLength",(e,t)=>{var s;Ie.init(e,t),(s=e._zod.def).when??(s.when=e=>{const t=e.value;return!y(t)&&void 0!==t.length}),e._zod.onattach.push(e=>{const s=e._zod.bag.minimum??Number.NEGATIVE_INFINITY;t.minimum>s&&(e._zod.bag.minimum=t.minimum)}),e._zod.check=s=>{const i=s.value;if(i.length>=t.minimum)return;const n=G(i);s.issues.push({origin:n,code:"too_small",minimum:t.minimum,inclusive:!0,input:i,inst:e,continue:!t.abort})}}),$e=c("$ZodCheckLengthEquals",(e,t)=>{var s;Ie.init(e,t),(s=e._zod.def).when??(s.when=e=>{const t=e.value;return!y(t)&&void 0!==t.length}),e._zod.onattach.push(e=>{const s=e._zod.bag;s.minimum=t.length,s.maximum=t.length,s.length=t.length}),e._zod.check=s=>{const i=s.value,n=i.length;if(n===t.length)return;const r=G(i),a=n>t.length;s.issues.push({origin:r,...a?{code:"too_big",maximum:t.length}:{code:"too_small",minimum:t.length},inclusive:!0,exact:!0,input:s.value,inst:e,continue:!t.abort})}}),Ge=c("$ZodCheckStringFormat",(e,t)=>{var s,i;Ie.init(e,t),e._zod.onattach.push(e=>{const s=e._zod.bag;s.format=t.format,t.pattern&&(s.patterns??(s.patterns=new Set),s.patterns.add(t.pattern))}),t.pattern?(s=e._zod).check??(s.check=s=>{t.pattern.lastIndex=0,t.pattern.test(s.value)||s.issues.push({origin:"string",code:"invalid_format",format:t.format,input:s.value,...t.pattern?{pattern:t.pattern.toString()}:{},inst:e,continue:!t.abort})}):(i=e._zod).check??(i.check=()=>{})}),Be=c("$ZodCheckRegex",(e,t)=>{Ge.init(e,t),e._zod.check=s=>{t.pattern.lastIndex=0,t.pattern.test(s.value)||s.issues.push({origin:"string",code:"invalid_format",format:"regex",input:s.value,pattern:t.pattern.toString(),inst:e,continue:!t.abort})}}),Fe=c("$ZodCheckLowerCase",(e,t)=>{t.pattern??(t.pattern=Me),Ge.init(e,t)}),Ne=c("$ZodCheckUpperCase",(e,t)=>{t.pattern??(t.pattern=ze),Ge.init(e,t)}),je=c("$ZodCheckIncludes",(e,t)=>{Ie.init(e,t);const s=T(t.includes),i=new RegExp("number"==typeof t.position?`^.{${t.position}}${s}`:s);t.pattern=i,e._zod.onattach.push(e=>{const t=e._zod.bag;t.patterns??(t.patterns=new Set),t.patterns.add(i)}),e._zod.check=s=>{s.value.includes(t.includes,t.position)||s.issues.push({origin:"string",code:"invalid_format",format:"includes",includes:t.includes,input:s.value,inst:e,continue:!t.abort})}}),Ve=c("$ZodCheckStartsWith",(e,t)=>{Ie.init(e,t);const s=new RegExp(`^${T(t.prefix)}.*`);t.pattern??(t.pattern=s),e._zod.onattach.push(e=>{const t=e._zod.bag;t.patterns??(t.patterns=new Set),t.patterns.add(s)}),e._zod.check=s=>{s.value.startsWith(t.prefix)||s.issues.push({origin:"string",code:"invalid_format",format:"starts_with",prefix:t.prefix,input:s.value,inst:e,continue:!t.abort})}}),Ue=c("$ZodCheckEndsWith",(e,t)=>{Ie.init(e,t);const s=new RegExp(`.*${T(t.suffix)}$`);t.pattern??(t.pattern=s),e._zod.onattach.push(e=>{const t=e._zod.bag;t.patterns??(t.patterns=new Set),t.patterns.add(s)}),e._zod.check=s=>{s.value.endsWith(t.suffix)||s.issues.push({origin:"string",code:"invalid_format",format:"ends_with",suffix:t.suffix,input:s.value,inst:e,continue:!t.abort})}}),Ze=c("$ZodCheckOverwrite",(e,t)=>{Ie.init(e,t),e._zod.check=e=>{e.value=t.tx(e.value)}});class We{constructor(e=[]){this.content=[],this.indent=0,this&&(this.args=e)}indented(e){this.indent+=1,e(this),this.indent-=1}write(e){if("function"==typeof e)return e(this,{execution:"sync"}),void e(this,{execution:"async"});const t=e.split("\n").filter(e=>e),s=Math.min(...t.map(e=>e.length-e.trimStart().length)),i=t.map(e=>e.slice(s)).map(e=>" ".repeat(2*this.indent)+e);for(const n of i)this.content.push(n)}compile(){const e=Function,t=this?.args;return new e(...t,[...(this?.content??[""]).map(e=>`  ${e}`)].join("\n"))}}const Ke={major:4,minor:1,patch:11},Xe=c("$ZodType",(e,t)=>{var s;e??(e={}),e._zod.def=t,e._zod.bag=e._zod.bag||{},e._zod.version=Ke;const i=[...e._zod.def.checks??[]];e._zod.traits.has("$ZodCheck")&&i.unshift(e);for(const n of i)for(const t of n._zod.onattach)t(e);if(0===i.length)(s=e._zod).deferred??(s.deferred=[]),e._zod.deferred?.push(()=>{e._zod.run=e._zod.parse});else{const t=(e,t,s)=>{let i,n=O(e);for(const r of t){if(r._zod.def.when){if(!r._zod.def.when(e))continue}else if(n)continue;const t=e.issues.length,a=r._zod.check(e);if(a instanceof Promise&&!1===s?.async)throw new l;if(i||a instanceof Promise)i=(i??Promise.resolve()).then(async()=>{await a,e.issues.length!==t&&(n||(n=O(e,t)))});else{if(e.issues.length===t)continue;n||(n=O(e,t))}}return i?i.then(()=>e):e},s=(s,n,r)=>{if(O(s))return s.aborted=!0,s;const a=t(n,i,r);if(a instanceof Promise){if(!1===r.async)throw new l;return a.then(t=>e._zod.parse(t,r))}return e._zod.parse(a,r)};e._zod.run=(n,r)=>{if(r.skipChecks)return e._zod.parse(n,r);if("backward"===r.direction){const t=e._zod.parse({value:n.value,issues:[]},{...r,skipChecks:!0});return t instanceof Promise?t.then(e=>s(e,n,r)):s(t,n,r)}const a=e._zod.parse(n,r);if(a instanceof Promise){if(!1===r.async)throw new l;return a.then(e=>t(e,i,r))}return t(a,i,r)}}e["~standard"]={validate:t=>{try{const s=W(e,t);return s.success?{value:s.data}:{issues:s.error?.issues}}catch(s){return X(e,t).then(e=>e.success?{value:e.data}:{issues:e.error?.issues})}},vendor:"zod",version:1}}),He=c("$ZodString",(e,t)=>{var s;Xe.init(e,t),e._zod.pattern=[...e?._zod.bag?.patterns??[]].pop()??(s=e._zod.bag,new RegExp(`^${s?`[\\s\\S]{${s?.minimum??0},${s?.maximum??""}}`:"[\\s\\S]*"}$`)),e._zod.parse=(s,i)=>{if(t.coerce)try{s.value=String(s.value)}catch(n){}return"string"==typeof s.value||s.issues.push({expected:"string",code:"invalid_type",input:s.value,inst:e}),s}}),Le=c("$ZodStringFormat",(e,t)=>{Ge.init(e,t),He.init(e,t)}),qe=c("$ZodGUID",(e,t)=>{t.pattern??(t.pattern=ce),Le.init(e,t)}),Ye=c("$ZodUUID",(e,t)=>{if(t.version){const e={v1:1,v2:2,v3:3,v4:4,v5:5,v6:6,v7:7,v8:8}[t.version];if(void 0===e)throw new Error(`Invalid UUID version: "${t.version}"`);t.pattern??(t.pattern=le(e))}else t.pattern??(t.pattern=le());Le.init(e,t)}),Qe=c("$ZodEmail",(e,t)=>{t.pattern??(t.pattern=de),Le.init(e,t)}),Je=c("$ZodURL",(e,t)=>{Le.init(e,t),e._zod.check=s=>{try{const i=s.value.trim(),n=new URL(i);return t.hostname&&(t.hostname.lastIndex=0,t.hostname.test(n.hostname)||s.issues.push({code:"invalid_format",format:"url",note:"Invalid hostname",pattern:be.source,input:s.value,inst:e,continue:!t.abort})),t.protocol&&(t.protocol.lastIndex=0,t.protocol.test(n.protocol.endsWith(":")?n.protocol.slice(0,-1):n.protocol)||s.issues.push({code:"invalid_format",format:"url",note:"Invalid protocol",pattern:t.protocol.source,input:s.value,inst:e,continue:!t.abort})),void(t.normalize?s.value=n.href:s.value=i)}catch(i){s.issues.push({code:"invalid_format",format:"url",input:s.value,inst:e,continue:!t.abort})}}}),et=c("$ZodEmoji",(e,t)=>{t.pattern??(t.pattern=new RegExp("^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$","u")),Le.init(e,t)}),tt=c("$ZodNanoID",(e,t)=>{t.pattern??(t.pattern=oe),Le.init(e,t)}),st=c("$ZodCUID",(e,t)=>{t.pattern??(t.pattern=se),Le.init(e,t)}),it=c("$ZodCUID2",(e,t)=>{t.pattern??(t.pattern=ie),Le.init(e,t)}),nt=c("$ZodULID",(e,t)=>{t.pattern??(t.pattern=ne),Le.init(e,t)}),rt=c("$ZodXID",(e,t)=>{t.pattern??(t.pattern=re),Le.init(e,t)}),at=c("$ZodKSUID",(e,t)=>{t.pattern??(t.pattern=ae),Le.init(e,t)}),ot=c("$ZodISODateTime",(e,t)=>{t.pattern??(t.pattern=function(e){const t=ke({precision:e.precision}),s=["Z"];e.local&&s.push(""),e.offset&&s.push("([+-](?:[01]\\d|2[0-3]):[0-5]\\d)");const i=`${t}(?:${s.join("|")})`;return new RegExp(`^${we}T(?:${i})$`)}(t)),Le.init(e,t)}),ht=c("$ZodISODate",(e,t)=>{t.pattern??(t.pattern=xe),Le.init(e,t)}),ct=c("$ZodISOTime",(e,t)=>{t.pattern??(t.pattern=new RegExp(`^${ke(t)}$`)),Le.init(e,t)}),lt=c("$ZodISODuration",(e,t)=>{t.pattern??(t.pattern=he),Le.init(e,t)}),dt=c("$ZodIPv4",(e,t)=>{t.pattern??(t.pattern=ue),Le.init(e,t),e._zod.onattach.push(e=>{e._zod.bag.format="ipv4"})}),ut=c("$ZodIPv6",(e,t)=>{t.pattern??(t.pattern=pe),Le.init(e,t),e._zod.onattach.push(e=>{e._zod.bag.format="ipv6"}),e._zod.check=s=>{try{new URL(`http://[${s.value}]`)}catch{s.issues.push({code:"invalid_format",format:"ipv6",input:s.value,inst:e,continue:!t.abort})}}}),pt=c("$ZodCIDRv4",(e,t)=>{t.pattern??(t.pattern=ge),Le.init(e,t)}),gt=c("$ZodCIDRv6",(e,t)=>{t.pattern??(t.pattern=me),Le.init(e,t),e._zod.check=s=>{const i=s.value.split("/");try{if(2!==i.length)throw new Error;const[e,t]=i;if(!t)throw new Error;const s=Number(t);if(`${s}`!==t)throw new Error;if(s<0||s>128)throw new Error;new URL(`http://[${e}]`)}catch{s.issues.push({code:"invalid_format",format:"cidrv6",input:s.value,inst:e,continue:!t.abort})}}});function mt(e){if(""===e)return!0;if(e.length%4!=0)return!1;try{return atob(e),!0}catch{return!1}}const yt=c("$ZodBase64",(e,t)=>{t.pattern??(t.pattern=ye),Le.init(e,t),e._zod.onattach.push(e=>{e._zod.bag.contentEncoding="base64"}),e._zod.check=s=>{mt(s.value)||s.issues.push({code:"invalid_format",format:"base64",input:s.value,inst:e,continue:!t.abort})}}),ft=c("$ZodBase64URL",(e,t)=>{t.pattern??(t.pattern=fe),Le.init(e,t),e._zod.onattach.push(e=>{e._zod.bag.contentEncoding="base64url"}),e._zod.check=s=>{(function(e){if(!fe.test(e))return!1;const t=e.replace(/[-_]/g,e=>"-"===e?"+":"/");return mt(t.padEnd(4*Math.ceil(t.length/4),"="))})(s.value)||s.issues.push({code:"invalid_format",format:"base64url",input:s.value,inst:e,continue:!t.abort})}}),bt=c("$ZodE164",(e,t)=>{t.pattern??(t.pattern=ve),Le.init(e,t)}),vt=c("$ZodJWT",(e,t)=>{Le.init(e,t),e._zod.check=s=>{(function(e,t=null){try{const s=e.split(".");if(3!==s.length)return!1;const[i]=s;if(!i)return!1;const n=JSON.parse(atob(i));return!("typ"in n&&"JWT"!==n?.typ||!n.alg||t&&(!("alg"in n)||n.alg!==t))}catch{return!1}})(s.value,t.alg)||s.issues.push({code:"invalid_format",format:"jwt",input:s.value,inst:e,continue:!t.abort})}}),wt=c("$ZodNumber",(e,t)=>{Xe.init(e,t),e._zod.pattern=e._zod.bag.pattern??Pe,e._zod.parse=(s,i)=>{if(t.coerce)try{s.value=Number(s.value)}catch(a){}const n=s.value;if("number"==typeof n&&!Number.isNaN(n)&&Number.isFinite(n))return s;const r="number"==typeof n?Number.isNaN(n)?"NaN":Number.isFinite(n)?void 0:"Infinity":void 0;return s.issues.push({expected:"number",code:"invalid_type",input:n,inst:e,...r?{received:r}:{}}),s}}),xt=c("$ZodNumber",(e,t)=>{Oe.init(e,t),wt.init(e,t)}),kt=c("$ZodBoolean",(e,t)=>{Xe.init(e,t),e._zod.pattern=Se,e._zod.parse=(s,i)=>{if(t.coerce)try{s.value=Boolean(s.value)}catch(r){}const n=s.value;return"boolean"==typeof n||s.issues.push({expected:"boolean",code:"invalid_type",input:n,inst:e}),s}}),_t=c("$ZodUnknown",(e,t)=>{Xe.init(e,t),e._zod.parse=e=>e}),Pt=c("$ZodNever",(e,t)=>{Xe.init(e,t),e._zod.parse=(t,s)=>(t.issues.push({expected:"never",code:"invalid_type",input:t.value,inst:e}),t)});function St(e,t,s){e.issues.length&&t.issues.push(...D(s,e.issues)),t.value[s]=e.value}const Mt=c("$ZodArray",(e,t)=>{Xe.init(e,t),e._zod.parse=(s,i)=>{const n=s.value;if(!Array.isArray(n))return s.issues.push({expected:"array",code:"invalid_type",input:n,inst:e}),s;s.value=Array(n.length);const r=[];for(let e=0;e<n.length;e++){const a=n[e],o=t.element._zod.run({value:a,issues:[]},i);o instanceof Promise?r.push(o.then(t=>St(t,s,e))):St(o,s,e)}return r.length?Promise.all(r).then(()=>s):s}});function zt(e,t,s,i){e.issues.length&&t.issues.push(...D(s,e.issues)),void 0===e.value?s in i&&(t.value[s]=void 0):t.value[s]=e.value}function It(e){const t=Object.keys(e.shape);for(const n of t)if(!e.shape?.[n]?._zod?.traits?.has("$ZodType"))throw new Error(`Invalid element at key "${n}": expected a Zod schema`);const s=(i=e.shape,Object.keys(i).filter(e=>"optional"===i[e]._zod.optin&&"optional"===i[e]._zod.optout));var i;return{...e,keys:t,keySet:new Set(t),numKeys:t.length,optionalKeys:new Set(s)}}function Tt(e,t,s,i,n,r){const a=[],o=n.keySet,h=n.catchall._zod,c=h.def.type;for(const l of Object.keys(t)){if(o.has(l))continue;if("never"===c){a.push(l);continue}const n=h.run({value:t[l],issues:[]},i);n instanceof Promise?e.push(n.then(e=>zt(e,s,l,t))):zt(n,s,l,t)}return a.length&&s.issues.push({code:"unrecognized_keys",keys:a,input:t,inst:r}),e.length?Promise.all(e).then(()=>s):s}const Et=c("$ZodObject",(e,t)=>{Xe.init(e,t);const s=Object.getOwnPropertyDescriptor(t,"shape");if(!s?.get){const e=t.shape;Object.defineProperty(t,"shape",{get:()=>{const s={...e};return Object.defineProperty(t,"shape",{value:s}),s}})}const i=m(()=>It(t));v(e._zod,"propValues",()=>{const e=t.shape,s={};for(const t in e){const i=e[t]._zod;if(i.values){s[t]??(s[t]=new Set);for(const e of i.values)s[t].add(e)}}return s});const n=P,r=t.catchall;let a;e._zod.parse=(t,s)=>{a??(a=i.value);const o=t.value;if(!n(o))return t.issues.push({expected:"object",code:"invalid_type",input:o,inst:e}),t;t.value={};const h=[],c=a.shape;for(const e of a.keys){const i=c[e]._zod.run({value:o[e],issues:[]},s);i instanceof Promise?h.push(i.then(s=>zt(s,t,e,o))):zt(i,t,e,o)}return r?Tt(h,o,t,s,i.value,e):h.length?Promise.all(h).then(()=>t):t}}),At=c("$ZodObjectJIT",(e,t)=>{Et.init(e,t);const s=e._zod.parse,i=m(()=>It(t));let n;const r=P,a=!u.jitless,o=a&&S.value,h=t.catchall;let c;e._zod.parse=(l,d)=>{c??(c=i.value);const u=l.value;return r(u)?a&&o&&!1===d?.async&&!0!==d.jitless?(n||(n=(e=>{const t=new We(["shape","payload","ctx"]),s=i.value,n=e=>{const t=k(e);return`shape[${t}]._zod.run({ value: input[${t}], issues: [] }, ctx)`};t.write("const input = payload.value;");const r=Object.create(null);let a=0;for(const i of s.keys)r[i]="key_"+a++;t.write("const newResult = {};");for(const i of s.keys){const e=r[i],s=k(i);t.write(`const ${e} = ${n(i)};`),t.write(`\n        if (${e}.issues.length) {\n          payload.issues = payload.issues.concat(${e}.issues.map(iss => ({\n            ...iss,\n            path: iss.path ? [${s}, ...iss.path] : [${s}]\n          })));\n        }\n        \n        \n        if (${e}.value === undefined) {\n          if (${s} in input) {\n            newResult[${s}] = undefined;\n          }\n        } else {\n          newResult[${s}] = ${e}.value;\n        }\n        \n      `)}t.write("payload.value = newResult;"),t.write("return payload;");const o=t.compile();return(t,s)=>o(e,t,s)})(t.shape)),l=n(l,d),h?Tt([],u,l,d,c,e):l):s(l,d):(l.issues.push({expected:"object",code:"invalid_type",input:u,inst:e}),l)}});function Ct(e,t,s,i){for(const r of e)if(0===r.issues.length)return t.value=r.value,t;const n=e.filter(e=>!O(e));return 1===n.length?(t.value=n[0].value,n[0]):(t.issues.push({code:"invalid_union",input:t.value,inst:s,errors:e.map(e=>e.issues.map(e=>$(e,i,p())))}),t)}const Ot=c("$ZodUnion",(e,t)=>{Xe.init(e,t),v(e._zod,"optin",()=>t.options.some(e=>"optional"===e._zod.optin)?"optional":void 0),v(e._zod,"optout",()=>t.options.some(e=>"optional"===e._zod.optout)?"optional":void 0),v(e._zod,"values",()=>{if(t.options.every(e=>e._zod.values))return new Set(t.options.flatMap(e=>Array.from(e._zod.values)))}),v(e._zod,"pattern",()=>{if(t.options.every(e=>e._zod.pattern)){const e=t.options.map(e=>e._zod.pattern);return new RegExp(`^(${e.map(e=>f(e.source)).join("|")})$`)}});const s=1===t.options.length,i=t.options[0]._zod.run;e._zod.parse=(n,r)=>{if(s)return i(n,r);let a=!1;const o=[];for(const e of t.options){const t=e._zod.run({value:n.value,issues:[]},r);if(t instanceof Promise)o.push(t),a=!0;else{if(0===t.issues.length)return t;o.push(t)}}return a?Promise.all(o).then(t=>Ct(t,n,e,r)):Ct(o,n,e,r)}}),Dt=c("$ZodIntersection",(e,t)=>{Xe.init(e,t),e._zod.parse=(e,s)=>{const i=e.value,n=t.left._zod.run({value:i,issues:[]},s),r=t.right._zod.run({value:i,issues:[]},s);return n instanceof Promise||r instanceof Promise?Promise.all([n,r]).then(([t,s])=>$t(e,t,s)):$t(e,n,r)}});function Rt(e,t){if(e===t)return{valid:!0,data:e};if(e instanceof Date&&t instanceof Date&&+e===+t)return{valid:!0,data:e};if(M(e)&&M(t)){const s=Object.keys(t),i=Object.keys(e).filter(e=>-1!==s.indexOf(e)),n={...e,...t};for(const r of i){const s=Rt(e[r],t[r]);if(!s.valid)return{valid:!1,mergeErrorPath:[r,...s.mergeErrorPath]};n[r]=s.data}return{valid:!0,data:n}}if(Array.isArray(e)&&Array.isArray(t)){if(e.length!==t.length)return{valid:!1,mergeErrorPath:[]};const s=[];for(let i=0;i<e.length;i++){const n=Rt(e[i],t[i]);if(!n.valid)return{valid:!1,mergeErrorPath:[i,...n.mergeErrorPath]};s.push(n.data)}return{valid:!0,data:s}}return{valid:!1,mergeErrorPath:[]}}function $t(e,t,s){if(t.issues.length&&e.issues.push(...t.issues),s.issues.length&&e.issues.push(...s.issues),O(e))return e;const i=Rt(t.value,s.value);if(!i.valid)throw new Error(`Unmergable intersection. Error path: ${JSON.stringify(i.mergeErrorPath)}`);return e.value=i.data,e}const Gt=c("$ZodRecord",(e,t)=>{Xe.init(e,t),e._zod.parse=(s,i)=>{const n=s.value;if(!M(n))return s.issues.push({expected:"record",code:"invalid_type",input:n,inst:e}),s;const r=[];if(t.keyType._zod.values){const a=t.keyType._zod.values;s.value={};for(const e of a)if("string"==typeof e||"number"==typeof e||"symbol"==typeof e){const a=t.valueType._zod.run({value:n[e],issues:[]},i);a instanceof Promise?r.push(a.then(t=>{t.issues.length&&s.issues.push(...D(e,t.issues)),s.value[e]=t.value})):(a.issues.length&&s.issues.push(...D(e,a.issues)),s.value[e]=a.value)}let o;for(const e in n)a.has(e)||(o=o??[],o.push(e));o&&o.length>0&&s.issues.push({code:"unrecognized_keys",input:n,inst:e,keys:o})}else{s.value={};for(const a of Reflect.ownKeys(n)){if("__proto__"===a)continue;const o=t.keyType._zod.run({value:a,issues:[]},i);if(o instanceof Promise)throw new Error("Async schemas not supported in object keys currently");if(o.issues.length){s.issues.push({code:"invalid_key",origin:"record",issues:o.issues.map(e=>$(e,i,p())),input:a,path:[a],inst:e}),s.value[o.value]=o.value;continue}const h=t.valueType._zod.run({value:n[a],issues:[]},i);h instanceof Promise?r.push(h.then(e=>{e.issues.length&&s.issues.push(...D(a,e.issues)),s.value[o.value]=e.value})):(h.issues.length&&s.issues.push(...D(a,h.issues)),s.value[o.value]=h.value)}}return r.length?Promise.all(r).then(()=>s):s}}),Bt=c("$ZodEnum",(e,t)=>{Xe.init(e,t);const s=function(e){const t=Object.values(e).filter(e=>"number"==typeof e);return Object.entries(e).filter(([e,s])=>-1===t.indexOf(+e)).map(([e,t])=>t)}(t.entries),i=new Set(s);e._zod.values=i,e._zod.pattern=new RegExp(`^(${s.filter(e=>I.has(typeof e)).map(e=>"string"==typeof e?T(e):e.toString()).join("|")})$`),e._zod.parse=(t,n)=>{const r=t.value;return i.has(r)||t.issues.push({code:"invalid_value",values:s,input:r,inst:e}),t}}),Ft=c("$ZodTransform",(e,t)=>{Xe.init(e,t),e._zod.parse=(s,i)=>{if("backward"===i.direction)throw new d(e.constructor.name);const n=t.transform(s.value,s);if(i.async)return(n instanceof Promise?n:Promise.resolve(n)).then(e=>(s.value=e,s));if(n instanceof Promise)throw new l;return s.value=n,s}});function Nt(e,t){return e.issues.length&&void 0===t?{issues:[],value:void 0}:e}const jt=c("$ZodOptional",(e,t)=>{Xe.init(e,t),e._zod.optin="optional",e._zod.optout="optional",v(e._zod,"values",()=>t.innerType._zod.values?new Set([...t.innerType._zod.values,void 0]):void 0),v(e._zod,"pattern",()=>{const e=t.innerType._zod.pattern;return e?new RegExp(`^(${f(e.source)})?$`):void 0}),e._zod.parse=(e,s)=>{if("optional"===t.innerType._zod.optin){const i=t.innerType._zod.run(e,s);return i instanceof Promise?i.then(t=>Nt(t,e.value)):Nt(i,e.value)}return void 0===e.value?e:t.innerType._zod.run(e,s)}}),Vt=c("$ZodNullable",(e,t)=>{Xe.init(e,t),v(e._zod,"optin",()=>t.innerType._zod.optin),v(e._zod,"optout",()=>t.innerType._zod.optout),v(e._zod,"pattern",()=>{const e=t.innerType._zod.pattern;return e?new RegExp(`^(${f(e.source)}|null)$`):void 0}),v(e._zod,"values",()=>t.innerType._zod.values?new Set([...t.innerType._zod.values,null]):void 0),e._zod.parse=(e,s)=>null===e.value?e:t.innerType._zod.run(e,s)}),Ut=c("$ZodDefault",(e,t)=>{Xe.init(e,t),e._zod.optin="optional",v(e._zod,"values",()=>t.innerType._zod.values),e._zod.parse=(e,s)=>{if("backward"===s.direction)return t.innerType._zod.run(e,s);if(void 0===e.value)return e.value=t.defaultValue,e;const i=t.innerType._zod.run(e,s);return i instanceof Promise?i.then(e=>Zt(e,t)):Zt(i,t)}});function Zt(e,t){return void 0===e.value&&(e.value=t.defaultValue),e}const Wt=c("$ZodPrefault",(e,t)=>{Xe.init(e,t),e._zod.optin="optional",v(e._zod,"values",()=>t.innerType._zod.values),e._zod.parse=(e,s)=>("backward"===s.direction||void 0===e.value&&(e.value=t.defaultValue),t.innerType._zod.run(e,s))}),Kt=c("$ZodNonOptional",(e,t)=>{Xe.init(e,t),v(e._zod,"values",()=>{const e=t.innerType._zod.values;return e?new Set([...e].filter(e=>void 0!==e)):void 0}),e._zod.parse=(s,i)=>{const n=t.innerType._zod.run(s,i);return n instanceof Promise?n.then(t=>Xt(t,e)):Xt(n,e)}});function Xt(e,t){return e.issues.length||void 0!==e.value||e.issues.push({code:"invalid_type",expected:"nonoptional",input:e.value,inst:t}),e}const Ht=c("$ZodCatch",(e,t)=>{Xe.init(e,t),v(e._zod,"optin",()=>t.innerType._zod.optin),v(e._zod,"optout",()=>t.innerType._zod.optout),v(e._zod,"values",()=>t.innerType._zod.values),e._zod.parse=(e,s)=>{if("backward"===s.direction)return t.innerType._zod.run(e,s);const i=t.innerType._zod.run(e,s);return i instanceof Promise?i.then(i=>(e.value=i.value,i.issues.length&&(e.value=t.catchValue({...e,error:{issues:i.issues.map(e=>$(e,s,p()))},input:e.value}),e.issues=[]),e)):(e.value=i.value,i.issues.length&&(e.value=t.catchValue({...e,error:{issues:i.issues.map(e=>$(e,s,p()))},input:e.value}),e.issues=[]),e)}}),Lt=c("$ZodPipe",(e,t)=>{Xe.init(e,t),v(e._zod,"values",()=>t.in._zod.values),v(e._zod,"optin",()=>t.in._zod.optin),v(e._zod,"optout",()=>t.out._zod.optout),v(e._zod,"propValues",()=>t.in._zod.propValues),e._zod.parse=(e,s)=>{if("backward"===s.direction){const i=t.out._zod.run(e,s);return i instanceof Promise?i.then(e=>qt(e,t.in,s)):qt(i,t.in,s)}const i=t.in._zod.run(e,s);return i instanceof Promise?i.then(e=>qt(e,t.out,s)):qt(i,t.out,s)}});function qt(e,t,s){return e.issues.length?(e.aborted=!0,e):t._zod.run({value:e.value,issues:e.issues},s)}const Yt=c("$ZodReadonly",(e,t)=>{Xe.init(e,t),v(e._zod,"propValues",()=>t.innerType._zod.propValues),v(e._zod,"values",()=>t.innerType._zod.values),v(e._zod,"optin",()=>t.innerType._zod.optin),v(e._zod,"optout",()=>t.innerType._zod.optout),e._zod.parse=(e,s)=>{if("backward"===s.direction)return t.innerType._zod.run(e,s);const i=t.innerType._zod.run(e,s);return i instanceof Promise?i.then(Qt):Qt(i)}});function Qt(e){return e.value=Object.freeze(e.value),e}const Jt=c("$ZodCustom",(e,t)=>{Ie.init(e,t),Xe.init(e,t),e._zod.parse=(e,t)=>e,e._zod.check=s=>{const i=s.value,n=t.fn(i);if(n instanceof Promise)return n.then(t=>es(t,s,i,e));es(n,s,i,e)}});function es(e,t,s,i){if(!e){const e={code:"custom",input:s,inst:i,path:[...i._zod.def.path??[]],continue:!i._zod.def.abort};i._zod.def.params&&(e.params=i._zod.def.params),t.issues.push(B(e))}}class ts{constructor(){this._map=new WeakMap,this._idmap=new Map}add(e,...t){const s=t[0];if(this._map.set(e,s),s&&"object"==typeof s&&"id"in s){if(this._idmap.has(s.id))throw new Error(`ID ${s.id} already exists in the registry`);this._idmap.set(s.id,e)}return this}clear(){return this._map=new WeakMap,this._idmap=new Map,this}remove(e){const t=this._map.get(e);return t&&"object"==typeof t&&"id"in t&&this._idmap.delete(t.id),this._map.delete(e),this}get(e){const t=e._zod.parent;if(t){const s={...this.get(t)??{}};delete s.id;const i={...s,...this._map.get(e)};return Object.keys(i).length?i:void 0}return this._map.get(e)}has(e){return this._map.has(e)}}function ss(){return new ts}const is=ss();function ns(e,t){return new e({type:"string",format:"guid",check:"string_format",abort:!1,...A(t)})}function rs(e,t){return new Ee({check:"less_than",...A(t),value:e,inclusive:!1})}function as(e,t){return new Ee({check:"less_than",...A(t),value:e,inclusive:!0})}function os(e,t){return new Ae({check:"greater_than",...A(t),value:e,inclusive:!1})}function hs(e,t){return new Ae({check:"greater_than",...A(t),value:e,inclusive:!0})}function cs(e,t){return new Ce({check:"multiple_of",...A(t),value:e})}function ls(e,t){return new De({check:"max_length",...A(t),maximum:e})}function ds(e,t){return new Re({check:"min_length",...A(t),minimum:e})}function us(e,t){return new $e({check:"length_equals",...A(t),length:e})}function ps(e){return new Ze({check:"overwrite",tx:e})}const gs=c("ZodISODateTime",(e,t)=>{ot.init(e,t),Rs.init(e,t)});const ms=c("ZodISODate",(e,t)=>{ht.init(e,t),Rs.init(e,t)});const ys=c("ZodISOTime",(e,t)=>{ct.init(e,t),Rs.init(e,t)});const fs=c("ZodISODuration",(e,t)=>{lt.init(e,t),Rs.init(e,t)});const bs=c("ZodError",(e,t)=>{N.init(e,t),e.name="ZodError",Object.defineProperties(e,{format:{value:t=>function(e,t){const s=t||function(e){return e.message},i={_errors:[]},n=e=>{for(const t of e.issues)if("invalid_union"===t.code&&t.errors.length)t.errors.map(e=>n({issues:e}));else if("invalid_key"===t.code)n({issues:t.issues});else if("invalid_element"===t.code)n({issues:t.issues});else if(0===t.path.length)i._errors.push(s(t));else{let e=i,n=0;for(;n<t.path.length;){const i=t.path[n];n===t.path.length-1?(e[i]=e[i]||{_errors:[]},e[i]._errors.push(s(t))):e[i]=e[i]||{_errors:[]},e=e[i],n++}}};return n(e),i}(e,t)},flatten:{value:t=>function(e,t=e=>e.message){const s={},i=[];for(const n of e.issues)n.path.length>0?(s[n.path[0]]=s[n.path[0]]||[],s[n.path[0]].push(t(n))):i.push(t(n));return{formErrors:i,fieldErrors:s}}(e,t)},addIssue:{value:t=>{e.issues.push(t),e.message=JSON.stringify(e.issues,g,2)}},addIssues:{value:t=>{e.issues.push(...t),e.message=JSON.stringify(e.issues,g,2)}},isEmpty:{get:()=>0===e.issues.length}})},{Parent:Error}),vs=V(bs),ws=U(bs),xs=Z(bs),ks=K(bs),_s=H(bs),Ps=L(bs),Ss=q(bs),Ms=Y(bs),zs=Q(bs),Is=J(bs),Ts=ee(bs),Es=te(bs),As=c("ZodType",(e,t)=>(Xe.init(e,t),e.def=t,e.type=t.type,Object.defineProperty(e,"_def",{value:t}),e.check=(...s)=>e.clone(x(t,{checks:[...t.checks??[],...s.map(e=>"function"==typeof e?{_zod:{check:e,def:{check:"custom"},onattach:[]}}:e)]})),e.clone=(t,s)=>E(e,t,s),e.brand=()=>e,e.register=(t,s)=>(t.add(e,s),e),e.parse=(t,s)=>vs(e,t,s,{callee:e.parse}),e.safeParse=(t,s)=>xs(e,t,s),e.parseAsync=async(t,s)=>ws(e,t,s,{callee:e.parseAsync}),e.safeParseAsync=async(t,s)=>ks(e,t,s),e.spa=e.safeParseAsync,e.encode=(t,s)=>_s(e,t,s),e.decode=(t,s)=>Ps(e,t,s),e.encodeAsync=async(t,s)=>Ss(e,t,s),e.decodeAsync=async(t,s)=>Ms(e,t,s),e.safeEncode=(t,s)=>zs(e,t,s),e.safeDecode=(t,s)=>Is(e,t,s),e.safeEncodeAsync=async(t,s)=>Ts(e,t,s),e.safeDecodeAsync=async(t,s)=>Es(e,t,s),e.refine=(t,s)=>e.check(function(e,t={}){return function(e,t,s){return new Ci({type:"custom",check:"custom",fn:t,...A(s)})}(0,e,t)}(t,s)),e.superRefine=t=>e.check(function(e){const t=function(e){const t=new Ie({check:"custom",...A(void 0)});return t._zod.check=e,t}(s=>(s.addIssue=e=>{if("string"==typeof e)s.issues.push(B(e,s.value,t._zod.def));else{const i=e;i.fatal&&(i.continue=!1),i.code??(i.code="custom"),i.input??(i.input=s.value),i.inst??(i.inst=t),i.continue??(i.continue=!t._zod.def.abort),s.issues.push(B(i))}},e(s.value,s)));return t}(t)),e.overwrite=t=>e.check(ps(t)),e.optional=()=>ki(e),e.nullable=()=>Pi(e),e.nullish=()=>ki(Pi(e)),e.nonoptional=t=>function(e,t){return new zi({type:"nonoptional",innerType:e,...A(t)})}(e,t),e.array=()=>di(e),e.or=t=>new gi({type:"union",options:[e,t],...A(undefined)}),e.and=t=>new mi({type:"intersection",left:e,right:t}),e.transform=t=>Ei(e,new wi({type:"transform",transform:t})),e.default=t=>{return s=t,new Si({type:"default",innerType:e,get defaultValue(){return"function"==typeof s?s():z(s)}});var s},e.prefault=t=>{return s=t,new Mi({type:"prefault",innerType:e,get defaultValue(){return"function"==typeof s?s():z(s)}});var s},e.catch=t=>{return new Ii({type:"catch",innerType:e,catchValue:"function"==typeof(s=t)?s:()=>s});var s},e.pipe=t=>Ei(e,t),e.readonly=()=>new Ai({type:"readonly",innerType:e}),e.describe=t=>{const s=e.clone();return is.add(s,{description:t}),s},Object.defineProperty(e,"description",{get:()=>is.get(e)?.description,configurable:!0}),e.meta=(...t)=>{if(0===t.length)return is.get(e);const s=e.clone();return is.add(s,t[0]),s},e.isOptional=()=>e.safeParse(void 0).success,e.isNullable=()=>e.safeParse(null).success,e)),Cs=c("_ZodString",(e,t)=>{He.init(e,t),As.init(e,t);const s=e._zod.bag;e.format=s.format??null,e.minLength=s.minimum??null,e.maxLength=s.maximum??null,e.regex=(...t)=>e.check(function(e,t){return new Be({check:"string_format",format:"regex",...A(t),pattern:e})}(...t)),e.includes=(...t)=>e.check(function(e,t){return new je({check:"string_format",format:"includes",...A(t),includes:e})}(...t)),e.startsWith=(...t)=>e.check(function(e,t){return new Ve({check:"string_format",format:"starts_with",...A(t),prefix:e})}(...t)),e.endsWith=(...t)=>e.check(function(e,t){return new Ue({check:"string_format",format:"ends_with",...A(t),suffix:e})}(...t)),e.min=(...t)=>e.check(ds(...t)),e.max=(...t)=>e.check(ls(...t)),e.length=(...t)=>e.check(us(...t)),e.nonempty=(...t)=>e.check(ds(1,...t)),e.lowercase=t=>e.check(function(e){return new Fe({check:"string_format",format:"lowercase",...A(e)})}(t)),e.uppercase=t=>e.check(function(e){return new Ne({check:"string_format",format:"uppercase",...A(e)})}(t)),e.trim=()=>e.check(ps(e=>e.trim())),e.normalize=(...t)=>e.check(function(e){return ps(t=>t.normalize(e))}(...t)),e.toLowerCase=()=>e.check(ps(e=>e.toLowerCase())),e.toUpperCase=()=>e.check(ps(e=>e.toUpperCase()))}),Os=c("ZodString",(e,t)=>{He.init(e,t),Cs.init(e,t),e.email=t=>e.check(function(e,t){return new $s({type:"string",format:"email",check:"string_format",abort:!1,...A(t)})}(0,t)),e.url=t=>e.check(function(e,t){return new Fs({type:"string",format:"url",check:"string_format",abort:!1,...A(t)})}(0,t)),e.jwt=t=>e.check(function(e,t){return new ei({type:"string",format:"jwt",check:"string_format",abort:!1,...A(t)})}(0,t)),e.emoji=t=>e.check(function(e,t){return new Ns({type:"string",format:"emoji",check:"string_format",abort:!1,...A(t)})}(0,t)),e.guid=t=>e.check(ns(Gs,t)),e.uuid=t=>e.check(function(e,t){return new Bs({type:"string",format:"uuid",check:"string_format",abort:!1,...A(t)})}(0,t)),e.uuidv4=t=>e.check(function(e,t){return new Bs({type:"string",format:"uuid",check:"string_format",abort:!1,version:"v4",...A(t)})}(0,t)),e.uuidv6=t=>e.check(function(e,t){return new Bs({type:"string",format:"uuid",check:"string_format",abort:!1,version:"v6",...A(t)})}(0,t)),e.uuidv7=t=>e.check(function(e,t){return new Bs({type:"string",format:"uuid",check:"string_format",abort:!1,version:"v7",...A(t)})}(0,t)),e.nanoid=t=>e.check(function(e,t){return new js({type:"string",format:"nanoid",check:"string_format",abort:!1,...A(t)})}(0,t)),e.guid=t=>e.check(ns(Gs,t)),e.cuid=t=>e.check(function(e,t){return new Vs({type:"string",format:"cuid",check:"string_format",abort:!1,...A(t)})}(0,t)),e.cuid2=t=>e.check(function(e,t){return new Us({type:"string",format:"cuid2",check:"string_format",abort:!1,...A(t)})}(0,t)),e.ulid=t=>e.check(function(e,t){return new Zs({type:"string",format:"ulid",check:"string_format",abort:!1,...A(t)})}(0,t)),e.base64=t=>e.check(function(e,t){return new Ys({type:"string",format:"base64",check:"string_format",abort:!1,...A(t)})}(0,t)),e.base64url=t=>e.check(function(e,t){return new Qs({type:"string",format:"base64url",check:"string_format",abort:!1,...A(t)})}(0,t)),e.xid=t=>e.check(function(e,t){return new Ws({type:"string",format:"xid",check:"string_format",abort:!1,...A(t)})}(0,t)),e.ksuid=t=>e.check(function(e,t){return new Ks({type:"string",format:"ksuid",check:"string_format",abort:!1,...A(t)})}(0,t)),e.ipv4=t=>e.check(function(e,t){return new Xs({type:"string",format:"ipv4",check:"string_format",abort:!1,...A(t)})}(0,t)),e.ipv6=t=>e.check(function(e,t){return new Hs({type:"string",format:"ipv6",check:"string_format",abort:!1,...A(t)})}(0,t)),e.cidrv4=t=>e.check(function(e,t){return new Ls({type:"string",format:"cidrv4",check:"string_format",abort:!1,...A(t)})}(0,t)),e.cidrv6=t=>e.check(function(e,t){return new qs({type:"string",format:"cidrv6",check:"string_format",abort:!1,...A(t)})}(0,t)),e.e164=t=>e.check(function(e,t){return new Js({type:"string",format:"e164",check:"string_format",abort:!1,...A(t)})}(0,t)),e.datetime=t=>e.check(function(e){return function(e,t){return new gs({type:"string",format:"datetime",check:"string_format",offset:!1,local:!1,precision:null,...A(t)})}(0,e)}(t)),e.date=t=>e.check(function(e){return function(e,t){return new ms({type:"string",format:"date",check:"string_format",...A(t)})}(0,e)}(t)),e.time=t=>e.check(function(e){return function(e,t){return new ys({type:"string",format:"time",check:"string_format",precision:null,...A(t)})}(0,e)}(t)),e.duration=t=>e.check(function(e){return function(e,t){return new fs({type:"string",format:"duration",check:"string_format",...A(t)})}(0,e)}(t))});function Ds(e){return function(e,t){return new Os({type:"string",...A(t)})}(0,e)}const Rs=c("ZodStringFormat",(e,t)=>{Le.init(e,t),Cs.init(e,t)}),$s=c("ZodEmail",(e,t)=>{Qe.init(e,t),Rs.init(e,t)}),Gs=c("ZodGUID",(e,t)=>{qe.init(e,t),Rs.init(e,t)}),Bs=c("ZodUUID",(e,t)=>{Ye.init(e,t),Rs.init(e,t)}),Fs=c("ZodURL",(e,t)=>{Je.init(e,t),Rs.init(e,t)}),Ns=c("ZodEmoji",(e,t)=>{et.init(e,t),Rs.init(e,t)}),js=c("ZodNanoID",(e,t)=>{tt.init(e,t),Rs.init(e,t)}),Vs=c("ZodCUID",(e,t)=>{st.init(e,t),Rs.init(e,t)}),Us=c("ZodCUID2",(e,t)=>{it.init(e,t),Rs.init(e,t)}),Zs=c("ZodULID",(e,t)=>{nt.init(e,t),Rs.init(e,t)}),Ws=c("ZodXID",(e,t)=>{rt.init(e,t),Rs.init(e,t)}),Ks=c("ZodKSUID",(e,t)=>{at.init(e,t),Rs.init(e,t)}),Xs=c("ZodIPv4",(e,t)=>{dt.init(e,t),Rs.init(e,t)}),Hs=c("ZodIPv6",(e,t)=>{ut.init(e,t),Rs.init(e,t)}),Ls=c("ZodCIDRv4",(e,t)=>{pt.init(e,t),Rs.init(e,t)}),qs=c("ZodCIDRv6",(e,t)=>{gt.init(e,t),Rs.init(e,t)}),Ys=c("ZodBase64",(e,t)=>{yt.init(e,t),Rs.init(e,t)}),Qs=c("ZodBase64URL",(e,t)=>{ft.init(e,t),Rs.init(e,t)}),Js=c("ZodE164",(e,t)=>{bt.init(e,t),Rs.init(e,t)}),ei=c("ZodJWT",(e,t)=>{vt.init(e,t),Rs.init(e,t)}),ti=c("ZodNumber",(e,t)=>{wt.init(e,t),As.init(e,t),e.gt=(t,s)=>e.check(os(t,s)),e.gte=(t,s)=>e.check(hs(t,s)),e.min=(t,s)=>e.check(hs(t,s)),e.lt=(t,s)=>e.check(rs(t,s)),e.lte=(t,s)=>e.check(as(t,s)),e.max=(t,s)=>e.check(as(t,s)),e.int=t=>e.check(ni(t)),e.safe=t=>e.check(ni(t)),e.positive=t=>e.check(os(0,t)),e.nonnegative=t=>e.check(hs(0,t)),e.negative=t=>e.check(rs(0,t)),e.nonpositive=t=>e.check(as(0,t)),e.multipleOf=(t,s)=>e.check(cs(t,s)),e.step=(t,s)=>e.check(cs(t,s)),e.finite=()=>e;const s=e._zod.bag;e.minValue=Math.max(s.minimum??Number.NEGATIVE_INFINITY,s.exclusiveMinimum??Number.NEGATIVE_INFINITY)??null,e.maxValue=Math.min(s.maximum??Number.POSITIVE_INFINITY,s.exclusiveMaximum??Number.POSITIVE_INFINITY)??null,e.isInt=(s.format??"").includes("int")||Number.isSafeInteger(s.multipleOf??.5),e.isFinite=!0,e.format=s.format??null});function si(e){return function(e,t){return new ti({type:"number",checks:[],...A(t)})}(0,e)}const ii=c("ZodNumberFormat",(e,t)=>{xt.init(e,t),ti.init(e,t)});function ni(e){return function(e,t){return new ii({type:"number",check:"number_format",abort:!1,format:"safeint",...A(t)})}(0,e)}const ri=c("ZodBoolean",(e,t)=>{kt.init(e,t),As.init(e,t)});function ai(e){return function(e,t){return new ri({type:"boolean",...A(t)})}(0,e)}const oi=c("ZodUnknown",(e,t)=>{_t.init(e,t),As.init(e,t)});function hi(){return new oi({type:"unknown"})}const ci=c("ZodNever",(e,t)=>{Pt.init(e,t),As.init(e,t)});const li=c("ZodArray",(e,t)=>{Mt.init(e,t),As.init(e,t),e.element=t.element,e.min=(t,s)=>e.check(ds(t,s)),e.nonempty=t=>e.check(ds(1,t)),e.max=(t,s)=>e.check(ls(t,s)),e.length=(t,s)=>e.check(us(t,s)),e.unwrap=()=>e.element});function di(e,t){return function(e,t,s){return new li({type:"array",element:t,...A(s)})}(0,e,t)}const ui=c("ZodObject",(e,t)=>{At.init(e,t),As.init(e,t),v(e,"shape",()=>t.shape),e.keyof=()=>vi(Object.keys(e._zod.def.shape)),e.catchall=t=>e.clone({...e._zod.def,catchall:t}),e.passthrough=()=>e.clone({...e._zod.def,catchall:hi()}),e.loose=()=>e.clone({...e._zod.def,catchall:hi()}),e.strict=()=>{return e.clone({...e._zod.def,catchall:function(e,t){return new ci({type:"never",...A(t)})}(0,t)});var t},e.strip=()=>e.clone({...e._zod.def,catchall:void 0}),e.extend=t=>function(e,t){if(!M(t))throw new Error("Invalid input to extend: expected a plain object");const s=e._zod.def.checks;if(s&&s.length>0)throw new Error("Object schemas containing refinements cannot be extended. Use `.safeExtend()` instead.");const i=x(e._zod.def,{get shape(){const s={...e._zod.def.shape,...t};return w(this,"shape",s),s},checks:[]});return E(e,i)}(e,t),e.safeExtend=t=>function(e,t){if(!M(t))throw new Error("Invalid input to safeExtend: expected a plain object");const s={...e._zod.def,get shape(){const s={...e._zod.def.shape,...t};return w(this,"shape",s),s},checks:e._zod.def.checks};return E(e,s)}(e,t),e.merge=t=>function(e,t){const s=x(e._zod.def,{get shape(){const s={...e._zod.def.shape,...t._zod.def.shape};return w(this,"shape",s),s},get catchall(){return t._zod.def.catchall},checks:[]});return E(e,s)}(e,t),e.pick=t=>function(e,t){const s=e._zod.def;return E(e,x(e._zod.def,{get shape(){const e={};for(const i in t){if(!(i in s.shape))throw new Error(`Unrecognized key: "${i}"`);t[i]&&(e[i]=s.shape[i])}return w(this,"shape",e),e},checks:[]}))}(e,t),e.omit=t=>function(e,t){const s=e._zod.def,i=x(e._zod.def,{get shape(){const i={...e._zod.def.shape};for(const e in t){if(!(e in s.shape))throw new Error(`Unrecognized key: "${e}"`);t[e]&&delete i[e]}return w(this,"shape",i),i},checks:[]});return E(e,i)}(e,t),e.partial=(...t)=>function(e,t,s){const i=x(t._zod.def,{get shape(){const i=t._zod.def.shape,n={...i};if(s)for(const t in s){if(!(t in i))throw new Error(`Unrecognized key: "${t}"`);s[t]&&(n[t]=e?new e({type:"optional",innerType:i[t]}):i[t])}else for(const t in i)n[t]=e?new e({type:"optional",innerType:i[t]}):i[t];return w(this,"shape",n),n},checks:[]});return E(t,i)}(xi,e,t[0]),e.required=(...t)=>function(e,t,s){const i=x(t._zod.def,{get shape(){const i=t._zod.def.shape,n={...i};if(s)for(const t in s){if(!(t in n))throw new Error(`Unrecognized key: "${t}"`);s[t]&&(n[t]=new e({type:"nonoptional",innerType:i[t]}))}else for(const t in i)n[t]=new e({type:"nonoptional",innerType:i[t]});return w(this,"shape",n),n},checks:[]});return E(t,i)}(zi,e,t[0])});function pi(e,t){const s={type:"object",shape:e??{},...A(t)};return new ui(s)}const gi=c("ZodUnion",(e,t)=>{Ot.init(e,t),As.init(e,t),e.options=t.options}),mi=c("ZodIntersection",(e,t)=>{Dt.init(e,t),As.init(e,t)}),yi=c("ZodRecord",(e,t)=>{Gt.init(e,t),As.init(e,t),e.keyType=t.keyType,e.valueType=t.valueType});function fi(e,t,s){return new yi({type:"record",keyType:e,valueType:t,...A(s)})}const bi=c("ZodEnum",(e,t)=>{Bt.init(e,t),As.init(e,t),e.enum=t.entries,e.options=Object.values(t.entries);const s=new Set(Object.keys(t.entries));e.extract=(e,i)=>{const n={};for(const r of e){if(!s.has(r))throw new Error(`Key ${r} not found in enum`);n[r]=t.entries[r]}return new bi({...t,checks:[],...A(i),entries:n})},e.exclude=(e,i)=>{const n={...t.entries};for(const t of e){if(!s.has(t))throw new Error(`Key ${t} not found in enum`);delete n[t]}return new bi({...t,checks:[],...A(i),entries:n})}});function vi(e,t){const s=Array.isArray(e)?Object.fromEntries(e.map(e=>[e,e])):e;return new bi({type:"enum",entries:s,...A(t)})}const wi=c("ZodTransform",(e,t)=>{Ft.init(e,t),As.init(e,t),e._zod.parse=(s,i)=>{if("backward"===i.direction)throw new d(e.constructor.name);s.addIssue=i=>{if("string"==typeof i)s.issues.push(B(i,s.value,t));else{const t=i;t.fatal&&(t.continue=!1),t.code??(t.code="custom"),t.input??(t.input=s.value),t.inst??(t.inst=e),s.issues.push(B(t))}};const n=t.transform(s.value,s);return n instanceof Promise?n.then(e=>(s.value=e,s)):(s.value=n,s)}}),xi=c("ZodOptional",(e,t)=>{jt.init(e,t),As.init(e,t),e.unwrap=()=>e._zod.def.innerType});function ki(e){return new xi({type:"optional",innerType:e})}const _i=c("ZodNullable",(e,t)=>{Vt.init(e,t),As.init(e,t),e.unwrap=()=>e._zod.def.innerType});function Pi(e){return new _i({type:"nullable",innerType:e})}const Si=c("ZodDefault",(e,t)=>{Ut.init(e,t),As.init(e,t),e.unwrap=()=>e._zod.def.innerType,e.removeDefault=e.unwrap}),Mi=c("ZodPrefault",(e,t)=>{Wt.init(e,t),As.init(e,t),e.unwrap=()=>e._zod.def.innerType}),zi=c("ZodNonOptional",(e,t)=>{Kt.init(e,t),As.init(e,t),e.unwrap=()=>e._zod.def.innerType}),Ii=c("ZodCatch",(e,t)=>{Ht.init(e,t),As.init(e,t),e.unwrap=()=>e._zod.def.innerType,e.removeCatch=e.unwrap}),Ti=c("ZodPipe",(e,t)=>{Lt.init(e,t),As.init(e,t),e.in=t.in,e.out=t.out});function Ei(e,t){return new Ti({type:"pipe",in:e,out:t})}const Ai=c("ZodReadonly",(e,t)=>{Yt.init(e,t),As.init(e,t),e.unwrap=()=>e._zod.def.innerType}),Ci=c("ZodCustom",(e,t)=>{Jt.init(e,t),As.init(e,t)}),Oi=["strength","endurance","agility","critchance","charisma","speed"],Di=vi(Oi),Ri=pi({add:si(),expo:si(),flat:si(),level:si(),max:si(),multi:si()}),$i=pi({x:si(),y:si()}).optional(),Gi=fi(Di,Ri),Bi=fi(Di,Ri.partial()),Fi=pi({plants:di(Ds()),voidGems:si()}),Ni=fi(Ds(),Fi),ji=pi({base:Fi,player:Fi,players:Ni}),Vi=pi({base:Fi.optional(),player:Fi.optional(),players:Ni.optional()}),Ui=pi({buildings:fi(Di,$i),difficulty:si(),email:Ds().optional(),inventory:ji,lastPlayed:si(),music:ai(),p2:ai(),seed:si().optional(),soundEffects:ai(),time:si(),upgrades:Gi}),Zi=pi({buildings:fi(Di,$i).optional(),difficulty:si(),email:Ds().optional(),inventory:Vi.optional(),lastPlayed:si(),music:ai(),seed:si().optional(),soundEffects:ai(),time:si(),upgrades:Bi.optional()}),Wi={add:0,expo:0,flat:0,level:0,max:0,multi:0},Ki={buildings:{agility:void 0,charisma:void 0,critchance:void 0,endurance:void 0,speed:void 0,strength:void 0},difficulty:1,inventory:{base:{plants:[],voidGems:0},player:{plants:[],voidGems:2},players:{p1:{plants:[],voidGems:0}}},lastPlayed:0,music:!0,p2:!1,soundEffects:!0,time:0,upgrades:{agility:{...Wi},charisma:{...Wi},critchance:{...Wi},endurance:{...Wi},speed:{...Wi},strength:{...Wi}}};class Xi extends Phaser.Plugins.BasePlugin{constructor(e){super(e),this.pluginManager=e}static key="ConfigManager";static mapping="_config";load(){const e=localStorage.getItem(Xi.key);if(null===e)return Ki;try{Zi.safeParse(JSON.parse(e));return Ui.parse(JSON.parse(e))}catch(t){return Ki}}save(e){const t=this.load(),s=n(t,e),i=JSON.stringify(s);return localStorage.setItem(Xi.key,i),JSON.stringify(this.load())===JSON.stringify(s)}saveInventory(e,t){const s=this.load(),i=s.inventory;let n;const r=s.inventory.players[e];n=r?{...r,...t}:{...Ki.inventory.player,...t};const a={...s,inventory:{...i,...t,players:{[e]:n}}},o=JSON.stringify(a);return localStorage.setItem(Xi.key,o),JSON.stringify(this.load())===JSON.stringify(a)}}const Hi={key:Xi.key,mapping:Xi.mapping,plugin:Xi,start:!0},Li=()=>{};class qi extends Phaser.Plugins.ScenePlugin{constructor(e,t,s){super(e,t,s),this.pluginManager=t,this.scene=e}static key="InputPlugin";static mapping="_input";last="kbm";scene;target;gamepad;onButtonDownPlugin=(e,t)=>{if(console.log(e,t),!(e instanceof Phaser.Input.Gamepad.Gamepad))throw new o;if(!(t instanceof Phaser.Input.Gamepad.Button))throw new o;e.index===this.player&&(e.id.toLowerCase().includes("xbox")?this.last="xbox":this.last="ps4",t.index===Phaser.Input.Gamepad.Configs.XBOX_360.DOWN&&this.onMenu(0,1),t.index===Phaser.Input.Gamepad.Configs.XBOX_360.UP&&this.onMenu(0,-1),t.index===Phaser.Input.Gamepad.Configs.XBOX_360.LEFT&&this.onMenu(-1,0),t.index===Phaser.Input.Gamepad.Configs.XBOX_360.RIGHT&&this.onMenu(1,0),t.index===Phaser.Input.Gamepad.Configs.XBOX_360.BACK&&this.onTab(),t.index===Phaser.Input.Gamepad.Configs.XBOX_360.START&&this.onPause(),t.index===Phaser.Input.Gamepad.Configs.XBOX_360.X&&this.onInteract(),t.index===Phaser.Input.Gamepad.Configs.XBOX_360.A&&this.onSelect(),t.index===Phaser.Input.Gamepad.Configs.XBOX_360.B&&this.onCancel())};onInteract=()=>{this.target&&this.target.onInteract(this.player)};onPause=Li;onSelect=()=>{this.target&&this.target.onSelect(this.player)};onTab=Li;player=0;prev={leftStick:{x:0,y:0}};setup=!1;get gamepadPlugin(){if(null===this.scene.input.gamepad)throw new Error("missing gamepad plugin");return this.scene.input.gamepad}setOnInteract(e,t){this.target=e,this.player=t,this.player!==t&&(this.setup=!1)}setOnPause(e){this.onPause=e}setOnTab(e){this.onTab=e}update(){if(this.setupController(),this.gamepad){const e=this.gamepad.leftStick;0===this.prev.leftStick.y&&(1===e.y?(this.onMenu(0,1),this.prev.leftStick.y=e.y):-1===e.y&&(this.onMenu(0,-1),this.prev.leftStick.y=e.y)),0===e.y&&(this.prev.leftStick.y=e.y)}}onCancel(){this.target&&this.target.onCancel(this.player)}onMenu(e,t){this.target&&this.target.onMovement?.(e,t)}setupController(){if(this.setup)return;const e=this.gamepadPlugin.gamepads[this.player];e&&(this.gamepadPlugin.on("down",this.onButtonDownPlugin),this.gamepad=e,this.setup=!0)}}const Yi={key:qi.key,mapping:qi.mapping,plugin:qi,start:!0},Qi="ActionScene",Ji="AnimationManager",en="IdleScene",tn="MainScene",sn="MainMenu",nn="Preloader";Phaser.Physics.Arcade.Sprite;Phaser.Physics.Arcade.Sprite;Phaser.Physics.Arcade.Sprite;Phaser.Physics.Arcade.Sprite;Math.max(20,0);Phaser.Scene;const rn=["bat.png","blob.png","blob_1.png","blobie-walk copy.png","blobie-walk.png","brawler48x48.png","char.png","drone.png","portal-particles_240_340.png","portal_240_340.png","rat.png","stick-head.png","stick.png","thickius.png"],an=[1,5,25,125,625],on=["grid","pebble","menu-item","border","border-wide","close-icon","pickaxe","sword","bow","arrow","ninja-star","needler","reticle","menu","menu-border","drop-agility","drop-strength","drop-endurance","shotgun","static-void-gem"],hn=new Map([["grid","grid-ps2.png"],["castle","castle.png"],["pebble","pebble.gif"],["menu-item","border-wide.png"],["close-icon","close-icon.png"]]),cn=[{config:{end:23,start:0},delay:0,frameRate:24,key:"float",repeat:-1,repeatDelay:0,yoyo:!0}],ln=[];for(const Fa of an){const e="animations/xp",t=`xp${Fa}`;ln.push({animations:cn,frameConfig:{frameHeight:128,frameWidth:80},key:t,url:`${e}/${t}.png`})}const dn=[{config:{end:23,start:0},delay:0,frameRate:24,key:"float",repeat:-1,repeatDelay:100,yoyo:!0}],un=[{animations:dn,frameConfig:{frameHeight:128,frameWidth:60},key:"void-gem",url:"animations/void-gem.png"},{animations:dn,frameConfig:{frameHeight:128,frameWidth:60},key:"health-drop",url:"animations/health-drop.png"},{animations:dn,frameConfig:{frameHeight:128,frameWidth:80},key:"stat-drop",url:"animations/stat-drop.png"},...ln];[{animations:dn,frameConfig:{frameHeight:128,frameWidth:60},key:"sword-p0-pickup",url:"animations/items/sword-p0-pickup.png"},{animations:dn,frameConfig:{frameHeight:128,frameWidth:60},key:"arrow-p0-pickup",url:"animations/items/arrow-p0-pickup.png"},{animations:dn,frameConfig:{frameHeight:128,frameWidth:60},key:"needler-p0-pickup",url:"animations/items/needler-p0-pickup.png"},{animations:dn,frameConfig:{frameHeight:128,frameWidth:60},key:"shotgun-p0-pickup",url:"animations/items/shotgun-p0-pickup.png"},{animations:dn,frameConfig:{frameHeight:128,frameWidth:48},key:"fireball-p0-pickup",url:"animations/items/fireball-p0-pickup.png"},{animations:dn,frameConfig:{frameHeight:128,frameWidth:60},key:"upgrade-pickup-p0",url:"animations/items/upgrade-pickup-p0.png"}].forEach(e=>{const t=e.key,s=e.url;un.push({...structuredClone(e),key:t.replace("p0","p1"),url:s.replace("p0","p1")}),un.push({...structuredClone(e),key:t.replace("p0","p2"),url:s.replace("p0","p2")}),un.push(structuredClone(e))}),un.push({animations:[{config:{end:214,start:211},delay:0,frameRate:10,key:"travel",repeat:-1,repeatDelay:0,yoyo:!0}],frameConfig:{frameHeight:32,frameWidth:32},key:"fireball",url:"animations/fireball.png"});class pn extends s.Scene{constructor(){super({key:nn,plugins:Phaser.Plugins.DefaultPlugins.DefaultScene})}create(){this.scene.start(Ji),this.scene.start(tn)}init(){this.add.rectangle(1920,1824,3072,128).setOrigin(.5).setStrokeStyle(1,16777215);const e=this.add.rectangle(384,1824,4,124,16777215).setOrigin(.5);let t;this.load.on("progress",s=>{if("number"!=typeof s)throw new Error("");0===s&&(t=performance.now()),1===s&&performance.now(),e.width=4+3072*s})}preload(){this.load.setPath("assets"),this.load.image("logo","logo.png"),this.load.font("Roboto","fonts/Roboto/Roboto-VariableFont_wdth,wght.ttf"),this.load.font("MarcellusSC","fonts/Marcellus_SC/MarcellusSC-Regular.ttf"),this.load.bitmapFont("MarcellusSCBitmap","fonts/Marcellus_SC/MarcellusSC-Regular.png","fonts/Marcellus_SC/MarcellusSC-Regular.xml"),this.load.spritesheet("brawler","animations/brawler48x48.png",{frameHeight:48,frameWidth:48}),this.preloadTexture(),this.load.spritesheet("fullscreen","ui/fullscreen.png",{frameHeight:64,frameWidth:64}),this.load.atlas("xbox","ui/xbox.png","ui/xbox.json"),this.load.atlas("kbm","ui/kbm.png","ui/kbm.json"),this.load.image("cursor-attack","ui/cursor-attack.png"),this.load.image("cursor-default","ui/cursor-default.png"),this.load.atlas("flares","particles/flares.png","particles/flares.json"),this.load.spritesheet("stick","animations/stick.png",{frameHeight:339.375,frameWidth:180}),this.load.spritesheet("stick-head","animations/stick-head.png",{frameHeight:18,frameWidth:18}),this.load.spritesheet("drone","animations/drone.png",{frameHeight:34,frameWidth:34}),this.load.spritesheet("blobie-walk","animations/blobie-walk.png",{frameHeight:34,frameWidth:34}),this.load.spritesheet("char","animations/char.png",{frameHeight:34,frameWidth:34}),this.load.spritesheet("rat","animations/rat.png",{frameHeight:34,frameWidth:34}),this.load.spritesheet("blob","animations/blob.png",{frameHeight:34,frameWidth:34}),this.load.spritesheet("bat","animations/bat.png",{frameHeight:34,frameWidth:34}),this.load.spritesheet("torch","animations/torch.png",{frameHeight:192,frameWidth:192}),this.load.spritesheet("barrel","animations/barrel.png",{frameHeight:128,frameWidth:128}),this.load.spritesheet("tnt","animations/tnt.png",{frameHeight:192,frameWidth:192}),un.forEach(({frameConfig:e,key:t,url:s})=>{this.load.spritesheet(t,s,e)});for(let e=1;e<101;e++)this.load.image(`blocks_${e}`,`textures/Blocks/blocks_${e}.png`),this.load.image(`iso_block_${e}`,`textures/Blocks/iso_block_${e}.png`);this.load.spritesheet("player1","animations/warrior.png",{frameHeight:192,frameWidth:192}),this.load.spritesheet("player2","animations/warrior2.png",{frameHeight:192,frameWidth:192}),this.load.spritesheet("red_archer_idle","Tiny Swords/Units/Red Units/Archer/Archer_Idle.png",{frameHeight:192,frameWidth:192}),this.load.spritesheet("red_archer_run","Tiny Swords/Units/Red Units/Archer/Archer_Run.png",{frameHeight:192,frameWidth:192}),this.load.spritesheet("red_archer_shoot","Tiny Swords/Units/Red Units/Archer/Archer_Shoot.png",{frameHeight:192,frameWidth:192}),this.load.spritesheet("red_warrior_idle","Tiny Swords/Units/Red Units/Warrior/Warrior_Idle.png",{frameHeight:192,frameWidth:192}),this.load.spritesheet("red_warrior_run","Tiny Swords/Units/Red Units/Warrior/Warrior_Run.png",{frameHeight:192,frameWidth:192}),this.load.spritesheet("red_warrior_attack1","Tiny Swords/Units/Red Units/Warrior/Warrior_Attack1.png",{frameHeight:192,frameWidth:192}),this.load.spritesheet("red_warrior_attack2","Tiny Swords/Units/Red Units/Warrior/Warrior_Attack2.png",{frameHeight:192,frameWidth:192}),this.load.spritesheet("blue_archer_idle","Tiny Swords/Units/Blue Units/Archer/Archer_Idle.png",{frameHeight:192,frameWidth:192}),this.load.spritesheet("blue_archer_run","Tiny Swords/Units/Blue Units/Archer/Archer_Run.png",{frameHeight:192,frameWidth:192}),this.load.spritesheet("blue_archer_shoot","Tiny Swords/Units/Blue Units/Archer/Archer_Shoot.png",{frameHeight:192,frameWidth:192}),this.load.spritesheet("blue_warrior_idle","Tiny Swords/Units/Blue Units/Warrior/Warrior_Idle.png",{frameHeight:192,frameWidth:192}),this.load.spritesheet("blue_warrior_run","Tiny Swords/Units/Blue Units/Warrior/Warrior_Run.png",{frameHeight:192,frameWidth:192}),this.load.spritesheet("blue_warrior_attack1","Tiny Swords/Units/Blue Units/Warrior/Warrior_Attack1.png",{frameHeight:192,frameWidth:192}),this.load.spritesheet("blue_warrior_attack2","Tiny Swords/Units/Blue Units/Warrior/Warrior_Attack2.png",{frameHeight:192,frameWidth:192}),this.load.spritesheet("tree1","Tiny Swords/Decorations/Trees/Tree1.png",{frameHeight:256,frameWidth:192}),this.load.spritesheet("tree2","Tiny Swords/Decorations/Trees/Tree2.png",{frameHeight:256,frameWidth:192}),this.load.spritesheet("tree3","Tiny Swords/Decorations/Trees/Tree3.png",{frameHeight:192,frameWidth:192}),this.load.spritesheet("tree4","Tiny Swords/Decorations/Trees/Tree4.png",{frameHeight:192,frameWidth:192}),this.load.spritesheet("rock1","Tiny Swords/Decorations/Rocks/Rock1.png",{frameHeight:64,frameWidth:64}),this.load.spritesheet("rock2","Tiny Swords/Decorations/Rocks/Rock2.png",{frameHeight:64,frameWidth:64}),this.load.spritesheet("rock3","Tiny Swords/Decorations/Rocks/Rock3.png",{frameHeight:64,frameWidth:64}),this.load.spritesheet("rock4","Tiny Swords/Decorations/Rocks/Rock4.png",{frameHeight:64,frameWidth:64}),this.load.image("barracks","Tiny Swords/Buildings/Black Buildings/Barracks.png"),this.load.image("monastery","Tiny Swords/Buildings/Black Buildings/Monastery.png"),this.load.image("archery","Tiny Swords/Buildings/Black Buildings/Archery.png"),this.load.image("castle","Tiny Swords/Buildings/Black Buildings/Castle.png"),this.load.spritesheet("portal2","animations/Isometric_Portal.png",{frameHeight:128,frameWidth:112}),this.load.atlas("crops","textures/crops.png","textures/crops.json"),this.load.atlas("drops","textures/drops.png","textures/drops.json"),rn.forEach(e=>{const[t,s,i]=e.replace(".png","").split("_");void 0!==t&&void 0!==s&&void 0!==i&&this.load.spritesheet(t,`animations/${e}`,{frameHeight:parseInt(i),frameWidth:parseInt(s)})}),this.load.glsl("fire","shaders/fire.glsl"),this.load.glsl("lightshaft","shaders/lightshaft.glsl.js"),this.load.image("repeating-background","textures/tile.png"),this.load.image("tileset-grass","textures/tileset-grass.png"),this.load.image("tileset-wall","textures/tileset-wall.png"),this.load.spritesheet("sq_block_0","textures/tileset-grass.png",{frameHeight:32,frameWidth:32}),this.load.image("tilemap_color1","Tiny Swords/Terrain/Tilemap_color1.png"),this.load.image("tilemap_color5","Tiny Swords/Terrain/Tilemap_color5.png")}preloadTexture(){const e="textures";for(const t of on){const s=hn.get(t);void 0===s?this.load.image(t,`${e}/${t}.png`):this.load.image(t,`${e}/${s}`)}this.load.atlas("ores","textures/ores.png","textures/ores.json"),this.load.atlas("TXProps","textures/TX Props.png","textures/TX Props.json")}preloadXP(){for(const e of an)this.load.image(`xp${e}`,`textures/xp/${e}.png`)}}var gn,mn;const yn=t(mn?gn:(mn=1,gn=function e(t,s){if(t===s)return!0;if(t&&s&&"object"==typeof t&&"object"==typeof s){if(t.constructor!==s.constructor)return!1;var i,n,r;if(Array.isArray(t)){if((i=t.length)!=s.length)return!1;for(n=i;0!==n--;)if(!e(t[n],s[n]))return!1;return!0}if(t.constructor===RegExp)return t.source===s.source&&t.flags===s.flags;if(t.valueOf!==Object.prototype.valueOf)return t.valueOf()===s.valueOf();if(t.toString!==Object.prototype.toString)return t.toString()===s.toString();if((i=(r=Object.keys(t)).length)!==Object.keys(s).length)return!1;for(n=i;0!==n--;)if(!Object.prototype.hasOwnProperty.call(s,r[n]))return!1;for(n=i;0!==n--;){var a=r[n];if(!e(t[a],s[a]))return!1}return!0}return t!=t&&s!=s}));let fn=class extends Phaser.GameObjects.Text{defaultText;timer;constructor(e,t,s,i){super(e,e.scale.width/2,e.scale.height/3,s,{...Ia,fontSize:60}),this.setOrigin(.5),this.scene.add.existing(this),this.setPosition(e.scale.width/2,e.scale.height/3+t*this.height*1.5),this.defaultText=s,i&&this.setInteraction(i)}hide(){this.setVisible(!1),this.setActive(!1)}onBlur(){this.setColor("rgba(255,255,255,128)"),this.timer=this.scene.time.addEvent({callback:()=>this.text=this.defaultText,delay:1e3})}onFocus(){this.timer?.destroy(),this.setColor("rgba(68,192,141,128)")}onSelect(){throw new Error}setInteraction(e){this.onSelect=e,this.setInteractive().on("pointerdown",e=>{this.pointerdown(e)}).on("pointerover",e=>{this.pointerover(e)}).on("pointerout",e=>{this.pointerout(e)})}show(){this.setVisible(!0),this.setActive(!0)}pointerdown(e){if(!(e instanceof Phaser.Input.Pointer))throw new o;this.onSelect()}pointerout(e){if(!(e instanceof Phaser.Input.Pointer))throw new o;this.onBlur()}pointerover(e){if(!(e instanceof Phaser.Input.Pointer))throw new o;this.onFocus()}};class bn{constructor(e){this.scene=e,this.border=this.scene.add.image(0,0,"menu-border",void 0).setVisible(!0),this.menu=this.scene.add.image(0,0,"menu",void 0).setVisible(!0),this.wipeBorder=this.border.preFX?.addReveal(.1,0,0),this.wipeMenu=this.menu.preFX?.addReveal(.1,0,0),this.bounds={bottom:0,left:this.scene.scale.baseSize.width,right:0,top:this.scene.scale.baseSize.height}}static MARGIN={x:400,y:200};items=[];wipeBorder;wipeMenu;border;bounds;menu;add(e,t,s){this.items[t]??=[];let i=this.items[t].length;for(let a=0;a<t;a++){const e=this.items[a];if(!e)throw new Error;i+=e.length+1}const n=new fn(this.scene,i,e,s),r=n.getBounds();return this.bounds.top=Math.min(r.top,this.bounds.top),this.bounds.left=Math.min(r.left,this.bounds.left),this.bounds.right=Math.max(r.right,this.bounds.right),this.bounds.bottom=Math.max(r.bottom,this.bounds.bottom),this.items[t].push(n),this.upsize(),n}resize(){let e=0,t=this.scene.scale.baseSize.width,s=0,i=this.scene.scale.baseSize.height;for(const a of this.items)for(const n of a){const r=n.getBounds();i=Math.min(r.top,i),t=Math.min(r.left,t),s=Math.max(r.right,s),e=Math.max(r.bottom,e)}i-=bn.MARGIN.y,t-=bn.MARGIN.x,s+=bn.MARGIN.x,e+=bn.MARGIN.y;const n=e-i,r=s-t;this.menu.setDisplaySize(r-10,n-10),this.menu.setPosition(t+5,i+5).setOrigin(0),this.border.setDisplaySize(r,n),this.border.setPosition(t,i).setOrigin(0),this.menu.setVisible(!0),this.border.setVisible(!0)}setVisible(e){this.menu.setVisible(e),this.border.setVisible(e)}upsize(){const e=this.bounds.top-bn.MARGIN.y,t=this.bounds.left-bn.MARGIN.x,s=this.bounds.right+bn.MARGIN.x,i=this.bounds.bottom+bn.MARGIN.y-e,n=s-t;this.menu.setDisplaySize(n-10,i-10),this.menu.setPosition(t+5,e+5).setOrigin(0),this.border.setDisplaySize(n,i),this.border.setPosition(t,e).setOrigin(0),this.menu.setVisible(!0),this.border.setVisible(!0)}}class vn{constructor(e,t){this.scene=e,this.background=new bn(this.scene),this.onClose=t,console.log(this.buttons)}static WIPE_DURATION=200;background;promptKey;idx=0;onClose;_buttons;get buttons(){if(!this._buttons){const e=this.background.add("Resume",0,()=>{this.close()}),t=this.background.add("Options",1,()=>{t.text="I don't have any right now\ntry the full screen button "}),s=this.background.add(this.scene.scale.isFullscreen?"Windowed":"Fullscreen",1,()=>{"Fullscreen"===s.defaultText?(this.scene.scale.startFullscreen(),s.defaultText="Windowed",s.text="Windowed"):(this.scene.scale.stopFullscreen(),s.defaultText="Fullscreen",s.text="Fullscreen")}),i=this.background.add("Restart",2,()=>{const e=this.scene.scene.get(tn);e instanceof Rn&&e.launch(Qi)}),n=this.background.add("Switch",2);n.setInteraction(()=>{const e=this.scene.scene.get(tn);e instanceof Rn&&(console.log(e.activeScene),e.activeScene===Qi?"to the useless page?"===n.text?(e.launch(en),n.text="Switch"):n.text="to the useless page?":"to the action?"===n.text?(e.launch(Qi),n.text="Switch"):n.text="to the action?")});const r="I was hoping you wouldn't click this one.",a="Are you sure?\nthis only works on the electron app",o=this.background.add("Exit",3);o.setInteraction(()=>{o.text===r||o.text===a?o.text===a?window.electronAPI.exit():o.text=a:o.text=r}),this._buttons=[{button:e,key:"resume"},{button:t,key:"options"},{button:s,key:"fullscreen"},{button:i,key:"restart"},{button:n,key:"change"},{button:o,key:"exit"}]}return this._buttons}close(e){for(const{button:t}of this.buttons)t.setVisible(!1);this.buttons[this.idx]?.button.onBlur(),this.idx=0,this.background.wipeMenu&&this.background.wipeBorder&&(this.background.wipeMenu.direction=1,this.background.wipeBorder.direction=1,this.background.wipeMenu.progress=1,this.background.wipeBorder.progress=1,this.scene.tweens.add({duration:vn.WIPE_DURATION,hold:0,onComplete:this.onClose,progress:0,repeat:0,repeatDelay:0,targets:this.background.wipeMenu,yoyo:!1}),this.scene.tweens.add({duration:vn.WIPE_DURATION-50,hold:0,progress:0,repeat:0,repeatDelay:0,targets:this.background.wipeBorder,yoyo:!1}))}onCancel(e){console.log("onCancel"),this.close()}onInteract(e){console.log("onInteract")}onMovement(e,t){console.log("onMovement"),0!==t&&(this.idx=(this.idx??0)+t,-1===this.idx?this.idx=this.buttons.length-1:this.idx=this.idx%this.buttons.length,this.buttons.forEach(({button:e},t)=>{t===this.idx?e.onFocus():e.onBlur()}))}onSelect(e){this.buttons[this.idx]?.button.onSelect()}open(){this.buttons[this.idx]?.button.onBlur(),this.idx=0,this.buttons[0].button.onFocus(),this.background.wipeMenu&&this.background.wipeBorder&&(this.background.wipeMenu.direction=0,this.background.wipeBorder.direction=0,this.background.wipeMenu.progress=0,this.background.wipeBorder.progress=0,this.scene.tweens.add({duration:vn.WIPE_DURATION-50,hold:0,onComplete:()=>{for(const{button:e}of this.buttons)e.setVisible(!0)},progress:1,repeat:0,repeatDelay:0,targets:this.background.wipeMenu,yoyo:!1}),this.scene.tweens.add({duration:vn.WIPE_DURATION,hold:0,progress:1,repeat:0,repeatDelay:0,targets:this.background.wipeBorder,yoyo:!1}))}}class wn{tween;target;constructor(e,t,s){this.tween=e.tweens.addCounter({duration:200,from:t,onUpdate:e=>{if(!this.target)return;let t=e.getValue();if(null===t)throw new Error("invalid tween");t=Math.floor(t),this.target.setTint(Phaser.Display.Color.GetColor(t,t,t))},paused:!0,persist:!0,to:s})}restart(e){this.target=e,this.tween.resume()}pause(){this.target=void 0,this.tween.pause().seek(0)}}class xn extends Phaser.GameObjects.Image{constructor(e,t,s,i){super(e.scene,t,s,"menu-item"),this.container=e,this.idx=i,e.scene.add.existing(this),this.setInteractive(),this.tween=new wn(this.scene,255,204),this.text=e.scene.add.text(this.width/2+t,this.height/2+s,"",{align:"center",color:"#ffffff",fontSize:40,stroke:"#000000",strokeThickness:8}).setOrigin(.5,.5).setShadow(5,5,"#5588EE",0,!0,!0),e.add(this.text),this.on("pointerup",e=>{e instanceof Phaser.Input.Pointer&&this.onClick(this.container.scene.player1)}),this.on("pointerover",()=>{this.container.idx=void 0,this.pointerover()}),this.on("pointerout",()=>{this.container.idx=void 0,this.pointerout()}),this.preFX?.setPadding(16),this.preFX?.addShadow()}static texture="menu-item";onClick=e=>{};text;focused=!1;tween;update(e,t){void 0!==this.container.idx&&(this.container.idx===this.idx?this.pointerover():this.pointerout())}pointerout(){this.focused&&(this.tween.pause(),this.setRotation(0).setTint(16777215),this.focused=!1)}pointerover(){this.focused||(this.tween.restart(this),this.setRotation(Math.PI/32),setTimeout(()=>{this.setRotation(0)},50),this.focused=!0)}}class kn extends Phaser.GameObjects.Container{static GAP=10;static MARGIN=100;static PADDING={bottom:10,left:10,right:10,top:10};idx=0;promptKey="menu";prompts=[{kbm:{color:16711935,frame:"keyboard_q"},text:"exit",xbox:{color:16777215,frame:"xbox_button_color_b"}},{kbm:{color:16777215,frame:"keyboard_arrows_vertical"},text:"navigate",xbox:{color:16711935,frame:"xbox_stick_l"}},{kbm:{color:16711935,frame:"keyboard_e"},text:"select",xbox:{color:16777215,frame:"xbox_button_color_a"}}];scene;tween;width;bg;buttonHeight;buttons=[];buttonWidth;constructor(e,t){super(e,t.x,t.y),this.scene=e,this.scene.layers.ui.add(this),this.setVisible(!1);const s=this.scene.textures.get(xn.texture).getFrameBounds();this.buttonHeight=s.height,this.buttonWidth=s.width,this.width=this.buttonWidth+kn.PADDING.left+kn.PADDING.right,this.bg=this.scene.add.tileSprite(0,0,this.menuWidth(1),this.menuHeight(2),"repeating-background").setOrigin(0,0),this.add(this.bg),this.bg.preFX?.setPadding(32),this.bg.preFX?.addGlow(16777215,100),this.bg.preFX?.addShadow(),this.tween=new wn(this.scene,255,204)}close(e){this.setVisible(!1)}onCancel(e){this.close(e),e.inputProvider.removeAllInteract()}onInteract(e){this.idx=0}onMovement(e,t){0!==t&&(this.idx=(this.idx??0)+t,-1===this.idx?this.idx=this.buttons.length-1:this.idx=this.idx%this.buttons.length)}onSelect(e){this.buttons[this.idx??0]?.onClick(e)}open(e){this.idx=0,this.setPosition(kn.MARGIN+e.x,kn.MARGIN+e.y),this.setVisible(!0)}setButtons(e){for(let t=0;t<e.length;t++){const s=e[t];if(!s)throw new Error("invalid type");const i=this.buttons[t]??this.createButton(t);i.onClick=s.onClick,i.text.text=s.text}this.bg.setSize(this.menuWidth(1),this.menuHeight(e.length));for(let t=e.length;t<this.buttons.length;t++){const e=this.buttons[t];if(!e)return;e.setVisible(!1).text.setVisible(!1)}}update(e,t){for(const s of this.buttons)s.update(e,t)}createButton(e){const t=new xn(this,kn.PADDING.right,kn.GAP+(this.buttonHeight+kn.GAP)*e+kn.PADDING.top,e);return t.setPosition(t.width/2+kn.PADDING.right,t.height/2+(this.buttonHeight+kn.GAP)*e+kn.PADDING.top),this.buttons.push(t),this.add(t),t.text.setAbove(t),t}menuHeight(e){const t=Math.max(e-1,0)*kn.GAP,s=e*this.buttonHeight,i=kn.PADDING.top;return s+t+kn.PADDING.bottom+kn.PADDING.bottom+i}menuWidth(e){return this.width=this.buttonWidth+kn.PADDING.left+kn.PADDING.right,this.width}}class _n{player;background;kbm=[];key;last;scene;text=[];width=0;xbox=[];constructor(e=[],t){this.player=t,this.scene=t.scene,this.create(e)}destroy(){this.background.destroy();for(let e=0;e<this.kbm.length;e++){const t=this.kbm[e],s=this.text[e],i=this.xbox[e];if(!t||!s||!i)throw new Error;t.destroy(),s.destroy(),i.destroy()}this.kbm=[],this.text=[],this.xbox=[]}disable(){this.key=void 0,this.setVisible(!1)}enable(e,t){if(this.last===t&&this.key===e)return;this.key=e,this.last=t;const s=this.button(t);this.background.setSize(this.width,128).setVisible(!0);const{left:i}=this.background.getBounds();let n=i+10;for(let r=0;r<s.length;r++){const e=s[r],t=this.text[r];if(!e||!t)throw new Error;n+=10,e.x=n,n+=e.displayWidth,n+=20,t.x=n,n+=t.displayWidth,n+=10,e.setVisible(!0),t.setVisible(!0)}}refresh(e){this.destroy(),this.create(e)}button(e){return"xbox"===e||"ps4"===e?this.xbox:this.kbm}create(e){let t=0;const s=this.scene.scale.width/4*(2*this.player.num+1),i=this.scene.scale.height-200;this.background=this.scene.add.rectangle(s,i,256,128,0,.75).setVisible(!1).setOrigin(.5).setScrollFactor(0),this.scene.layers.ui.add(this.background);for(const n of e){const e=this.scene.add.image(s,i,"kbm",n.kbm.frame).setVisible(!1).setScale(.75).setOrigin(0,.5).setScrollFactor(0);e.preFX?.addShadow(-.25,-.25,.1,1,n.kbm.color),this.kbm.push(e);const r=this.scene.add.image(s,i,"xbox",n.xbox.frame).setVisible(!1).setScale(.75).setOrigin(0,.5).setScrollFactor(0);r.preFX?.addShadow(-.5,-.5,.1,1,n.xbox.color),this.xbox.push(r);const a=this.scene.add.text(s,i,n.text,Ia).setVisible(!1).setOrigin(0,.5).setScrollFactor(0);if(this.text.push(a),this.scene.layers.ui.add(e),this.scene.layers.ui.add(r),this.scene.layers.ui.add(a),e.displayWidth!==r.displayWidth)throw new Error("invalid assumption");t+=10+e.displayWidth+20+a.displayWidth+10}this.width=t+10+10}setVisible(e){this.background.setVisible(e);for(let t=0;t<this.kbm.length;t++){const s=this.kbm[t],i=this.text[t],n=this.xbox[t];if(!s||!i||!n)throw new Error;s.setVisible(e),i.setVisible(e),n.setVisible(e)}return this}}const Pn=e=>Phaser.Input.Keyboard.KeyCodes[e];class Sn{static allowedTransitions=(e,t)=>{const[s,i]=e,[n,r]=t;return s===n&&i===r||(Sn.isCardinal(s,i)&&Sn.isDiagonal(n,r)||!(!Sn.isDiagonal(s,i)||!Sn.isCardinal(n,r)))&&(Math.sign(s)===Math.sign(n)||Math.sign(i)===Math.sign(r))};static isCardinal=(e,t)=>0===e&&1===Math.abs(t)||0===t&&1===Math.abs(e);static isDiagonal=(e,t)=>Math.abs(e)===Math.SQRT1_2&&Math.abs(t)===Math.SQRT1_2;active=!1;activity={active:!1,activeCount:0,inactiveCount:0};#e=!0;connected=!1;dashing=!1;last="kbm";player;prompt;scene;targets={};config;elapsed={moving:0,unmoving:0};framesMoved=0;gamepad;gamepadInfo={product:void 0,vendor:void 0};interactTarget=[];isSetup=!1;lastPos=[[0,0]];moved=!1;onButtonDownPlugin=(e,t)=>{if(!(e instanceof Phaser.Input.Gamepad.Gamepad))throw new o;if(!(t instanceof Phaser.Input.Gamepad.Button))throw new o;e.id.toLowerCase().includes("xbox")?this.last="xbox":this.last="ps4",t.index===Phaser.Input.Gamepad.Configs.XBOX_360.DOWN&&this.onMenu(0,1),t.index===Phaser.Input.Gamepad.Configs.XBOX_360.UP&&this.onMenu(0,-1),t.index===Phaser.Input.Gamepad.Configs.XBOX_360.LEFT&&this.onMenu(-1,0),t.index===Phaser.Input.Gamepad.Configs.XBOX_360.RIGHT&&this.onMenu(1,0),t.index===Phaser.Input.Gamepad.Configs.XBOX_360.BACK&&this.onTab(),t.index===Phaser.Input.Gamepad.Configs.XBOX_360.START&&this.onPause(),t.index===Phaser.Input.Gamepad.Configs.XBOX_360.X&&this.onInteract()};onCancel=()=>{const e=this.targets.curr;e&&this.player&&e.onCancel(this.player)};onInteract=()=>{const e=this.targets.curr;console.log(e),e&&this.player&&(console.log(e),e.onInteract(this.player))};onPause=Li;onTab=Li;prompts=new Map;setup=!1;constructor(e,t,s={interactionKeys:{cancel:"Q",dash:"SPACE",interact:"E"},movementKeys:{down:"S",left:"A",right:"D",up:"W"}}){this.scene=e,this.player=t,this.config=s;let i=!1;if(0===t?.num?i=!0:1===t?.num&&(i=e.config.load().p2),this.active=i,this.player){const e=[{kbm:{color:16777215,frame:"keyboard_wasd"},text:"move",xbox:{color:16711935,frame:"xbox_stick_l"}}];this.prompt=new _n(e,this.player),this.prompts.set("move",this.prompt)}}get aiming(){let e=this.keys.aim.kbm.isDown;return this.gamepad&&(e=e||this.gamepad.L2>.5),e}_gamepadPlugin;get gamepadPlugin(){if(null===this.scene.input.gamepad)throw new Error("missing gamepad plugin");return this._gamepadPlugin||(this._gamepadPlugin??=this.scene.input.gamepad,null===this.player&&this.gamepadPlugin.on("down",this.onButtonDownPlugin)),this._gamepadPlugin}_keyboardPlugin;get keyboardPlugin(){if(null===this.scene.input.keyboard)throw new Error("missing keyboard plugin");return this._keyboardPlugin??=this.scene.input.keyboard,this._keyboardPlugin}_keys;get keys(){return this._keys??={aim:{button:6,kbm:this.keyboardPlugin.addKey(Phaser.Input.Keyboard.KeyCodes.SHIFT),onInteract:Li},build:{button:3,kbm:this.keyboardPlugin.addKey(Phaser.Input.Keyboard.KeyCodes.B),onInteract:()=>{this.player?.buildManager&&(this.player.buildManager.isBuilding?this.player.buildManager.construct():void 0!==this.targets.curr?.setEditing?(this.player.buildManager.buildingKey=this.targets.curr.promptKey,this.player.buildManager.isBuilding=!0):this.player.buildManager.isBuilding=!0)}},cancel:{button:1,kbm:this.keyboardPlugin.addKey(Pn(this.config.interactionKeys.cancel)),onInteract:()=>{this.onCancel()}},dash:{button:0,kbm:this.keyboardPlugin.addKey(Pn(this.config.interactionKeys.dash)),onInteract:()=>{this.dashing=!0}},interact:{button:2,kbm:this.keyboardPlugin.addKey(Pn(this.config.interactionKeys.interact)),onInteract:()=>{const e=this.targets.curr;this.focus instanceof kn&&e&&this.player?e.onSelect(this.player):this.onInteract()}},select:{button:0,kbm:null,onInteract:()=>{const e=this.targets.curr;e&&this.player&&e.onSelect(this.player)}},toggle:{button:3,kbm:this.keyboardPlugin.addKey(Phaser.Input.Keyboard.KeyCodes.F),onInteract:()=>{this.player&&this.scene instanceof xa&&(this.#e=!this.#e)}}},this._keys}_movement;get movement(){return this._movement??={down:{button:-1,kbm:this.keyboardPlugin.addKey(Pn(this.config.movementKeys.down)),onInteract:()=>{this.onMenu(0,1)}},left:{button:-1,kbm:this.keyboardPlugin.addKey(Pn(this.config.movementKeys.left)),onInteract:()=>{this.onMenu(-1,0)}},right:{button:-1,kbm:this.keyboardPlugin.addKey(Pn(this.config.movementKeys.right)),onInteract:()=>{this.onMenu(1,0)}},up:{button:-1,kbm:this.keyboardPlugin.addKey(Pn(this.config.movementKeys.up)),onInteract:()=>{this.onMenu(0,-1)}}},this._movement}_systemKeys;get systemKeys(){return this._systemKeys??={pause:{button:9,kbm:this.keyboardPlugin.addKey(Phaser.Input.Keyboard.KeyCodes.ESC),onInteract:()=>{const e=this.interactTarget[this.interactTarget.length-1];e&&this.player?e.onCancel(this.player):this.onPause()}},upgrade:{button:16,kbm:this.keyboardPlugin.addKey(Phaser.Input.Keyboard.KeyCodes.TAB),onInteract:this.onTab}},this._systemKeys}destroy(){this.prompts.forEach(e=>{e.destroy()}),this.prompt=void 0,this.prompts=new Map}position(){if(!this.active){const e=Phaser.Input.Gamepad.Configs.XBOX_360.A;return!0===this.gamepad?.buttons[e]?.pressed||this.keys.dash.kbm.isDown?(this.activity.activeCount++,this.activity.activeCount>50&&(this.active=!0)):this.activity.activeCount=0,[0,0]}{const e=Phaser.Input.Gamepad.Configs.XBOX_360.B;!0===this.gamepad?.buttons[e]?.pressed||this.keys.cancel.kbm.isDown?(this.activity.inactiveCount++,this.activity.inactiveCount>50&&(this.active=!1)):this.activity.inactiveCount=0}let{x:e,y:t}=this.axes("left");const s=e**2+t**2;s>1&&(e/=Math.sqrt(s),t/=Math.sqrt(s));const i=this.movement.left.kbm.isDown,n=this.movement.right.kbm.isDown;i&&(e-=1),n&&(e+=1);const r=this.movement.up.kbm.isDown,a=this.movement.down.kbm.isDown;return r&&(t-=1),a&&(t+=1),(r||i||a||n)&&(this.last="kbm"),this.focus instanceof In?(Math.abs(e)+Math.abs(t)>1&&(e*=Math.SQRT1_2,t*=Math.SQRT1_2),0===e&&0===t||(this.framesMoved++,this.moved=!0,this.active=!0,this.lastPos.push([e,t]),this.lastPos.length>30&&this.lastPos.shift()),[e,t]):[0,0]}refresh(){this.setupKBM(),this.updateConnection()}refreshPrompt(e){if(e!==this.targets.curr)return;const t=this.prompts.get(e.promptKey);if(console.log(t,this.prompt),t!==this.prompt)throw console.log(t,this.prompt),new Error("these should match");void 0!==t&&t.refresh(e.prompts)}removeAllInteract(){this.interactTarget=[],this.focus=this.scene,this.targets.curr=void 0,this.prompt!==this.prompts.get("move")&&this.prompt?.disable()}setOnInteract(e){e instanceof kn&&(this.focus=e),this.targets.next=e;let t=this.prompts.get(e.promptKey);this.player&&!t&&e.prompts.length>0&&(t=new _n(e.prompts,this.player),this.prompts.set(e.promptKey,t)),this.prompt=t}setOnPause(e){this.onPause=e}setOnTab(e){this.onTab=e}target(e){if(!(this.scene instanceof xa))throw new Error("what are you trying to target?");if(this.player!==e)throw new Error("who is trying to target???");const t=this.#e,s=void 0!==this.gamepad&&0!==this.gamepad.rightStick.lengthSq();if(t&&!s){const t=this.scene.enemies.getMatching("visible",!0),s=this.scene.physics.closest(e,t);if(s instanceof la){if(!s.body)throw new Error("no enemy body or no player body");if(!(e.body instanceof Phaser.Physics.Arcade.Body))throw new Error(" no player body");return{angle:Phaser.Math.Angle.Between(e.x,e.y,s.body.center.x,s.body.center.y),x:e.x,y:e.y}}}const i=e.scene.input.activePointer,n=e.x-e.scene.cameras.main.scrollX,r=e.y-e.scene.cameras.main.scrollY;let a=i.x,o=i.y,h=Phaser.Math.Angle.Between(n,r,i.worldX,i.worldY);3!==this.player?.num&&([a,o]=this.lastPosition(),h=Phaser.Math.Angle.Between(0,0,a,o));const{x:c,y:l}=this.axes("right");return 0===c&&0===l||(h=Phaser.Math.Angle.Between(0,0,c,l),a=e.x,o=e.y),{angle:h,x:a,y:o}}update(e,t){if(this.setupKBM(),this.updateConnection(),null===this.player)return;this.targets.prev=this.targets.curr,this.targets.curr=this.targets.next,this.targets.next=void 0;const s=this.targets.curr;s&&this.prompt&&(s!==this.targets.prev&&this.targets.prev&&this.prompts.get(this.targets.prev.promptKey)?.disable(),this.prompt.enable(s.promptKey,this.last)),void 0===s&&void 0===this.targets.next&&this.removeAllInteract(),this.elapsed.unmoving<5e3?this.elapsed.unmoving+=t:this.moved&&this.elapsed.moving<2e3?(this.elapsed.moving+=t,this.framesMoved++):this.elapsed.moving<2e3?(this.prompt=this.prompts.get("move"),this.prompt?.enable("move",this.last)):this.elapsed.moving>=2e3&&this.prompts.get("move")?.disable()}updateConnection(){if(this.connected)return;const e=this.gamepadPlugin.gamepads;this.player&&(this.gamepad=e[this.player.num],this.gamepad&&this.setupController()&&(this.connected=!0))}axes(e){if(!this.gamepad)return{x:0,y:0};const t="left"===e?0:2,s=this.gamepad.axes[0+t],i=this.gamepad.axes[1+t];let n=0,r=0;return void 0!==s&&void 0!==i&&(s.threshold=.15,i.threshold=.15,n=s.getValue(),r=i.getValue()),0===n&&0===r||(this.last="xbox"),{x:n,y:r}}#t;get focus(){return this.#t||(this.scene instanceof kn||this.scene instanceof In?this.#t=this.scene:this.#t=null),this.#t}set focus(e){this.#t=e}lastPosition(){let e=[];this.lastPos.reduce((t,s)=>(Sn.allowedTransitions(t,s)?e.push(s):e=[s],s));const t=[0,0],s=e.length;return e.forEach(e=>{t[0]+=e[0]/s,t[1]+=e[1]/s}),t}onMenu(e,t){const s=this.targets.curr;s&&s.onMovement?.(e,t)}setupController(){if(this.setup)return!0;if(!this.gamepad)return!1;const e=/Vendor: ([\d+\w+]{4}) Product: ([\d+\w+]{4})/gm.exec(this.gamepad.id);return e&&(this.gamepadInfo={product:e[2],vendor:e[1]},console.log(this.gamepadInfo)),this.gamepad.on("down",(e,t,s)=>{if("number"!=typeof e)throw new o;if("number"!=typeof t)throw new o;if(!(s instanceof Phaser.Input.Gamepad.Button))throw new o;s.pad.id.toLowerCase().includes("xbox")?this.last="xbox":this.last="ps4";for(const[,i]of Object.entries(this.keys))s.index===i.button&&i.onInteract();s.index===Phaser.Input.Gamepad.Configs.XBOX_360.DOWN&&this.onMenu(0,1),s.index===Phaser.Input.Gamepad.Configs.XBOX_360.UP&&this.onMenu(0,-1),s.index===Phaser.Input.Gamepad.Configs.XBOX_360.LEFT&&this.onMenu(-1,0),s.index===Phaser.Input.Gamepad.Configs.XBOX_360.RIGHT&&this.onMenu(1,0)}),this.setup=!0,!0}setupKBM(){if(!this.isSetup){for(const[,e]of Object.entries(this.systemKeys))e.kbm.on("up",()=>{this.last="kbm",e.onInteract()});if(0===this.player?.num)for(const[,e]of Object.entries(this.systemKeys))e.kbm.on("up",()=>{this.last="kbm",e.onInteract()});for(const[,e]of Object.entries(this.keys))e.kbm?.on("up",()=>{this.last="kbm",e.onInteract()});if(this.player)for(const[,e]of Object.entries(this.movement))e.kbm.on("up",()=>{this.last="kbm",e.onInteract()});this.isSetup=!0}}}class Mn extends Phaser.Physics.Arcade.Sprite{promptKey=this.constructor.name;prompts=[];onCancel(e){throw new Error("onCancel not implemented")}onCollision(e){throw new Error("onCollision not implemented")}onFocus(e){throw new Error("onFocus not implemented")}onInteract(e){throw new Error("onInteract not implemented")}onMovement(e,t){throw new Error("onMovement not implemented")}onSelect(e){throw new Error("onSelect not implemented")}}Phaser.GameObjects.Group;class zn extends Phaser.GameObjects.Container{promptKey=this.constructor.name;prompts=[];onCancel(e){throw new Error("onCancel not implemented")}onCollision(e){throw new Error("onCollision not implemented")}onFocus(e){throw new Error("onFocus not implemented")}onInteract(e){throw new Error("onInteract not implemented")}onMovement(e,t){throw new Error("onMovement not implemented")}onSelect(e){throw new Error("onSelect not implemented")}}class In extends Phaser.Scene{debugging=!1;key;#s;get config(){if(!this.#s){const e=this.game.plugins.get(Xi.key);if(!(e instanceof Xi))throw new Error("misconfigured plugin");this.#s=e}return this.#s}_inputPlugin;get inputPlugin(){if(!this._inputPlugin)throw new Error;return this._inputPlugin}#i;get inputProvider(){return this.#i??=new Sn(this,null),this.#i}_playerPlugin=null;get playerPlugin(){if(!this._playerPlugin){const e=this.game.plugins.get(Ca.key);if(!(e instanceof Ca))throw new Error("misconfigured plugin");this._playerPlugin=e}return this._playerPlugin}getScene(e){return this.scene.get(e)}init(){if(!this.key)throw new Error("gotta set the key");this.key,this.physics.world.drawDebug=!1,this.events.on("update",(e,t)=>{if("number"!=typeof e||"number"!=typeof t)throw new o;this.inputProvider.update(e,t)})}shutdown(){this.#i=void 0,this.#s=void 0}}Phaser.Renderer.WebGL.Pipelines.MultiPipeline;class Tn extends Phaser.Renderer.WebGL.Pipelines.SinglePipeline{constructor(e,t="lightshaft"){const s=e.cache.shader.get(t);if(!(s instanceof Phaser.Display.BaseShader))throw new Error(`${t} shader missing from cache`);super({fragShader:s.fragmentSrc,game:e,name:t})}onBind(e){if(super.onBind(),console.log(e),e instanceof Phaser.GameObjects.Sprite){const t=2*e.width,s=10*e.height;this.set2f("spriteDimensions",t,s),console.log(`Sprite width: ${t}, Height: ${s}`)}this.set3f("glowColor",1,.8,.3)}}const En=en,An=[];class Cn extends Phaser.Scene{background;logo;title;player;shine;switcher=()=>{};switchers=[];weapon=()=>{this.scene.get(Qi),this.scene.getStatus(Qi)};constructor(){super({active:!1,key:sn,plugins:[...Phaser.Plugins.DefaultPlugins.DefaultScene,qi.key],visible:!1})}get globalInputProvider(){if(!(qi.mapping in this))throw new Error("this.load.scenePlugin(InputPlugin.mapping, InputPlugin) required in preload()");const e=this[qi.mapping];if(!(e instanceof qi))throw new Error;return e}get MainScene(){const e=this.scene.get(tn);if(!(e instanceof Rn))throw new Error("Missing MainScene");return e}_menu;get menu(){return this._menu??=new vn(this,()=>{const e=this.scene.get(tn);e instanceof Rn&&e.resume()}),this._menu}close(){this.menu.close(()=>{const e=this.scene.get(tn);e instanceof Rn&&e.resume()})}create(){this.weapon(),this.switcher(),this.menu.open(),this.events.on(Phaser.Scenes.Events.CREATE,(e,t)=>{e instanceof Cn&&console.log("creating main menu",t),this.resume()}),this.events.on(Phaser.Scenes.Events.READY,(e,t)=>{e instanceof Cn&&console.log("starting main menu",t),this.resume()}),this.events.on(Phaser.Scenes.Events.RESUME,(e,t)=>{e instanceof Phaser.Scenes.Systems&&(e.scene instanceof Cn&&console.log("resuming main menu",t),this.init(t),this.resume()),this.menu.open()},this),this.events.on(Phaser.Scenes.Events.PAUSE,(e,t)=>{e instanceof Phaser.Scenes.Systems&&e.scene instanceof Cn&&console.log("pausing main menu",t)},this),this.cameras.main.setBackgroundColor("rgba(0,0,0,128)")}init(e){if(!(e=>"object"==typeof e&&null!==e&&"player"in e&&"number"==typeof e.player)(e))throw new Error("expected player data");if(0!==e.player&&1!==e.player&&2!==e.player&&3!==e.player)throw new Error("expected player.data to be 0,1,2,3");this.player=e.player}preload(){this.load.scenePlugin(qi.mapping,qi)}resume(){this.globalInputProvider.setOnInteract(this.menu,this.player)}update(e,t){this.globalInputProvider.update()}shimmer(){this.time.addEvent({callback:()=>{if(!this.shine)return;const e=.25+.5*Math.random();this.shine.speed=e,this.menuBorder.postFX.add(this.shine),this.time.addEvent({callback:()=>{console.trace("stack"),this.shine&&this.menuBorder.postFX.remove(this.shine)},delay:2e3/e})},delay:1e3,loop:!0})}}var On=Object.defineProperty,Dn=Object.getOwnPropertyDescriptor;class Rn extends In{static instance;activeScene=En;enemies=null;GameLayer=null;MenuLayer=null;shouldDrawCursor=!0;UILayer=null;key=tn;cursors={};fpses=[];fpsGraphic;fpsHistory=[[]];menuInit=!1;menuOpen=!1;constructor(){super({key:tn,plugins:Phaser.Plugins.DefaultPlugins.DefaultScene})}_debugGraphics;get debugGraphics(){return this.debugging?(this._debugGraphics??=this.add.graphics(),this._debugGraphics):(this._debugGraphics?.clear(),null)}#n;get debugTooltip(){return this.#n??=this.add.text(0,0,"",Ia),this.#n}create(){if(this.GameLayer=this.add.layer(),this.UILayer=this.add.layer(),this.MenuLayer=this.add.layer().setVisible(!1).setDepth(10),this.input.setDefaultCursor("none"),this.input.mouse?.disableContextMenu(),this.game.events.on(Phaser.Core.Events.FOCUS,()=>{"Portal"===this.activeScene?(this.input.setDefaultCursor("none"),this.shouldDrawCursor=!0):(this.input.setDefaultCursor("auto"),this.shouldDrawCursor=!1)}),this.game.events.on(Phaser.Core.Events.BLUR,()=>{this.shouldDrawCursor=!1}),!this.input.keyboard)throw new Error("why no keyboard?");if(this.renderer instanceof Phaser.Renderer.WebGL.WebGLRenderer){const e=new Tn(this.game);this.renderer.pipelines.add("lightshaft",e)}const{lastPlayed:e}=this.config.load(),t=Date.now();this.config.save({lastPlayed:t,p2:!1}),e<t-18e5&&(this.activeScene=Qi),this.scene.launch(this.activeScene),this.inputProvider.setOnPause(()=>{this.onMenu()})}drawCursor(){this.cursors.attack??=this.add.sprite(0,0,"cursor-attack").setOrigin(0).setScale(.5).setVisible(!1),this.cursors.default??=this.add.sprite(0,0,"cursor-default").setOrigin(0).setScale(.5).setVisible(!1),5===this.scene.getStatus(sn)||this.activeScene!==Qi?(this.cursors.attack.setVisible(!1),this.cursors.default.setVisible(this.shouldDrawCursor)):(this.cursors.attack.setVisible(this.shouldDrawCursor),this.cursors.default.setVisible(!1)),this.cursors.default.setPosition(this.input.activePointer.x,this.input.activePointer.y),this.cursors.attack.setPosition(this.input.activePointer.x,this.input.activePointer.y)}follow(e){this.cameras.main.setBounds(-1e3,-1e3,this.scale.width+2e3,this.scale.height+2e3)}launch(e){this.menuOpen&&this.onResume(),this.scene.key===tn?(this.scene.stop(this.activeScene),this.scene.launch(e)):this.scene.start(e),this.activeScene=e}onPause(){this.menuInit||(this.scene.launch(sn,{player:0}),this.menuInit=!0),this.scene.setActive(!0,sn,{player:0,pp:2}),this.scene.setVisible(!0,sn),this.scene.setActive(!1,this.activeScene),this.menuOpen=!0}resume(){this.onResume()}update(e,t){this.drawCursor(),this.fpses.push(this.game.loop.actualFps),this.fpses.length>61&&this.fpses.shift(),this.fpsGraphic??=this.add.graphics().lineStyle(2,16711680,1),this.fpsGraphic.clear().lineStyle(2,16711680,1),this.fpsGraphic.lineStyle(1,16777215,1).strokeRect(20,120,300,150),this.fpsGraphic.lineStyle(2,16711680,1).strokePoints(this.fpses.map((e,t)=>new Phaser.Geom.Point(20+5*t,120+5*(60-e))))}onMenu(){if(this.menuOpen){const e=this.scene.get(sn);if(!(e instanceof Cn))throw new Error;e.close()}else this.onPause()}onResume(){this.scene.setActive(!1,sn),this.scene.setVisible(!1,sn),this.scene.setActive(!0,this.activeScene),this.menuOpen=!1}}((e,t,s)=>{for(var i,n=Dn(t,s),r=e.length-1;r>=0;r--)(i=e[r])&&(n=i(t,s,n)||n);n&&On(t,s,n)})([h()],Rn.prototype,"update");const $n=Math.sqrt(3),Gn=.5*($n-1),Bn=(3-$n)/6,Fn=e=>0|Math.floor(e),Nn=new Float64Array([1,1,-1,1,1,-1,-1,-1,1,0,-1,0,1,0,-1,0,0,1,0,-1,0,1,0,-1]);function jn(e=Math.random){const t=function(e){const t=512,s=new Uint8Array(t);for(let i=0;i<256;i++)s[i]=i;for(let i=0;i<255;i++){const t=i+~~(e()*(256-i)),n=s[i];s[i]=s[t],s[t]=n}for(let i=256;i<t;i++)s[i]=s[i-256];return s}(e),s=new Float64Array(t).map(e=>Nn[e%12*2]),i=new Float64Array(t).map(e=>Nn[e%12*2+1]);return function(e,n){let r=0,a=0,o=0;const h=(e+n)*Gn,c=Fn(e+h),l=Fn(n+h),d=(c+l)*Bn,u=e-(c-d),p=n-(l-d);let g,m;u>p?(g=1,m=0):(g=0,m=1);const y=u-g+Bn,f=p-m+Bn,b=u-1+2*Bn,v=p-1+2*Bn,w=255&c,x=255&l;let k=.5-u*u-p*p;if(k>=0){const e=w+t[x];k*=k,r=k*k*(s[e]*u+i[e]*p)}let _=.5-y*y-f*f;if(_>=0){const e=w+g+t[x+m];_*=_,a=_*_*(s[e]*y+i[e]*f)}let P=.5-b*b-v*v;if(P>=0){const e=w+1+t[x+1];P*=P,o=P*P*(s[e]*b+i[e]*v)}return 70*(r+a+o)}}const Vn="SQUARE",Un={ISO:{x:64,y:32},SQUARE:{x:32,y:32}},Zn=0,Wn=16,Kn=0,Xn=0,Hn={ISO:{x:2*(Un.ISO.x-Zn),y:2*(Un.ISO.y-Wn)},SQUARE:{x:2*(Un.SQUARE.x-Kn),y:2*(Un.SQUARE.y-Xn)}},Ln={ISO:{x:Hn.ISO.x/2,y:0},SQUARE:{x:0,y:0}},qn=Math.ceil(3840/Hn.ISO.x),Yn=Math.ceil(2160/Hn.ISO.y),Qn=Math.ceil(3840/Hn.SQUARE.x),Jn=Math.ceil(2160/Hn.SQUARE.y),er={ISO:{x:2*Math.ceil(qn/4/2),y:2*Math.ceil(Yn/4/2)},SQUARE:{x:2*Math.ceil(Qn/4/2),y:2*Math.ceil(Jn/4/2)}},tr={ISO:{x:er.ISO.x*Hn.ISO.x,y:er.ISO.y*Hn.ISO.y},SQUARE:{x:er.SQUARE.x*Hn.SQUARE.x,y:er.SQUARE.y*Hn.SQUARE.y}},sr=[88,89,90,91,92],ir={blocks:[1],frequency:2,range:{end:1,start:.5}},nr={blocks:[73,74,75,76,77,78,79],frequency:2,range:{end:ir.range.start,start:-.2}},rr={blocks:[80,81,82,83,84,85,86,87],frequency:1,range:{end:nr.range.start,start:-.8}},ar={blocks:sr,frequency:1,range:{end:rr.range.start,start:-.9}},or=[ir,nr,rr,ar,{blocks:sr,frequency:1,range:{end:ar.range.start,start:-1}}].sort((e,t)=>t.range.start-e.range.start),hr=(e=>{const t=e.reduce((e,t)=>e+t.frequency,0);let s=-1;return e.map(({blocks:e,frequency:i})=>{const n=s+2*i/t,r={blocks:e,frequency:i,range:{end:n,start:s}};return s=n,r}).sort((e,t)=>t.range.start-e.range.start)})([{blocks:[0,1,2,3,8,9,10,11,16,17,18,19,24,25,26,27],frequency:2},{blocks:[32,33,40,41,48,49,56,57],frequency:1},{blocks:[0,1,2,3,8,9,10,11,16,17,18,19,24,25,26,27,4,5,6,7,12,13,14,15,20,21,22,23,28,29,30,31],frequency:2}]);class cr extends Phaser.GameObjects.Image{id=crypto.randomUUID().slice(-4);scene;blockKey;constructor(e,t,s,i,n){super(e,t,s,i,n),this.scene=e,this.blockKey=i}get activeKey(){return this.active?null:this.blockKey}}class lr extends cr{coords;frameKey;constructor(e,t,s,i,n){super(e,t,s,i,n),this.frameKey=n,this.setOrigin(.5),this.setDepth(s),this.setScale(2),this.scene.layers.isoMap.add(this),this.scene.debugging&&(this.setInteractive(),this.on("pointerover",()=>{this.scene.mainScene.debugTooltip.text=`${t},${s},${this.frameKey}`,this.alpha=.5}),this.on("pointerout",()=>{this.scene.debugging&&(this.alpha=1)}))}}class dr extends cr{impassable=!1;scene;constructor(e,t,s,i){super(e,t,s,i),this.scene=e,this.setOrigin(.5),this.setScale(br),this.scene.layers.player.add(this),this.scene.buildings.add(this),this.body,Phaser.Physics.Arcade.StaticBody,this.setDepth(this.y-64)}create(e,t){const s=this.displayWidth;if(this.setActive(!0),this.setVisible(!0),this.setPosition(e,t),this.body instanceof Phaser.Physics.Arcade.StaticBody){const e=this.getCenter();this.body.x=e.x-s,this.body.y=e.y-2*s}}}class ur extends cr{impassable=!1;scene;constructor(e,t,s,i){super(e,t,s,i),this.scene=e,this.setOrigin(.5,1),this.scene.layers.player.add(this),this.scene.buildings.add(this);const n=192===this.height?128:192;this.body instanceof Phaser.Physics.Arcade.StaticBody&&this.body.setCircle(32).setOffset(64,n),this.setDepth(this.y-64)}create(e,t){if(this.setActive(!0),this.setVisible(!0),this.setPosition(e,t),this.body instanceof Phaser.Physics.Arcade.StaticBody){const e=this.getCenter();this.body.x=e.x-32,this.body.y=e.y-64}}}class pr{isLoaded=!1;x;y;noise2D;noiseTree2D;offsetX;offsetY;scene;startX;startY;tiles;tint=255*Math.random()+255*Math.random()*1e3+1e6*Math.random();constructor(e,t,s,i){this.scene=e,this.x=t,this.y=s,this.noise2D=jn(i),this.noiseTree2D=jn(i),this.startX=this.x*tr[Vn].x,this.startY=this.y*tr[Vn].y,this.offsetX=this.x*tr[Vn].x/Hn[Vn].x,this.offsetY=this.y*tr[Vn].y/Hn[Vn].y,this.tiles=this.scene.add.group()}load(){if(this.isLoaded)return;performance.now();this.populate(),performance.now(),this.isLoaded=!0}unload(){this.isLoaded&&(this.tiles.clear(!0,!0),this.isLoaded=!1)}create(e,t){const s=t%2==0?Ln[Vn].x:0,i=e*Hn[Vn].x+s,n=t*Hn[Vn].y,r=this.startX+i,a=this.startY+n,o=this.offsetX+e,h=this.offsetY+t,c=this.noise2D(o/25,h/25),l=Un[Vn].x/Un[Vn].y,d=Phaser.Math.Distance.Between(0,0,r/l,a);if(d>4096){const e=Math.trunc(4*Math.abs(c))+1,t=this.getDeadRock(r,a,`rock${e}`);t.impassable=!0,t.setVisible(!1),this.tiles.add(t)}else{const e=this.getDeadBlock(r,a,a,c);if(c>.75||c>-.2&&c<0){const e=this.noiseTree2D(o/25,h/25);if(e>0&&!(d<512)){const t=Math.trunc(4*Math.abs(e))+1,s=this.getDeadTree(r,a,`tree${t}`);s.impassable=!1,this.tiles.add(s)}}e.setDepth(a).setScale(2),this.tiles.add(e)}}generateIsoKey(e){return`iso_block_${this.generateKey(e,or)}`}generateKey(e,t){const s=t.findIndex(t=>e>=t.range.start),i=t[s];if(!i)throw new Error(`${e} could not be found in ${t}`);const n=(i.range.end-i.range.start)/i.blocks.length,r=e-i.range.start,a=Math.trunc(r/n);void 0===i.blocks[a]&&console.log({idx:a,noiseValue:e,normalizedNoise:r});const o=i.blocks[a]??i.blocks.at(-1);if(void 0===o)throw new Error;return o}generateSqKey(e){return{frame:this.generateKey(e,hr),key:"sq_block_0"}}getDeadBlock(e,t,s,i){let n;{let s;const r="sq_block_0";s=-2===i?90:this.generateSqKey(i).frame,n=new lr(this.scene,e,t,r,s)}return this.scene.debugging&&(n.setTint(this.tint),n.setTintFill(this.tint)),n.setDepth(s).setScale(2),this.tiles.add(n),n}getDeadRock(e,t,s){return new dr(this.scene,e,t,s)}getDeadTree(e,t,s){return new ur(this.scene,e,t,s)}populate(){for(let e=-er[Vn].x/2;e<er[Vn].x/2;e++)for(let t=-er[Vn].y/2;t<er[Vn].y/2;t++)this.create(e,t)}}class gr{chunks=[];scene;seed;constructor(e,t){this.scene=e,t&&(this.seed=t)}update(e,t){const s=new Set,i=new Set,n=Math.round(this.scene.player1.x/tr[Vn].x),r=Math.round(this.scene.player1.y/tr[Vn].y);for(let l=n-2;l<n+2+1;l++)s.add(l);for(let l=r-2;l<r+2+1;l++)i.add(l);const a=Math.round(this.scene.player2.x/tr[Vn].x),o=Math.round(this.scene.player2.y/tr[Vn].y);if(this.scene.player2.visible){for(let e=a-2;e<a+2+1;e++)s.add(e);for(let e=o-2;e<o+2+1;e++)i.add(e)}for(const l of Array.from(s))for(const e of Array.from(i))if(null===this.chunkAt(l,e)){const t=new pr(this.scene,l,e,this.seed);this.chunks.push(t)}let h=Number.MAX_SAFE_INTEGER,c=Number.MIN_SAFE_INTEGER;for(const l of this.chunks)Phaser.Math.Distance.Between(n,r,l.x,l.y)<5||this.scene.player2.visible&&Phaser.Math.Distance.Between(a,o,l.x,l.y)<5?(h=Math.min(h,l.x),c=Math.max(c,l.x),l.load()):l.unload()}chunkAt(e,t){for(const s of this.chunks)if(s.x===e&&s.y===t)return s;return null}}class mr extends In{#r;get buildings(){return this.#r||(this.#r=this.physics.add.staticGroup().setName("buildingGroup"),this.#r.runChildUpdate=!0,this.physics.add.overlap(this.#r,[this.player1,this.player2],(e,t)=>{e instanceof aa&&t instanceof zn&&t.onCollision(e)}).setName("buildingOverlap"),this.physics.add.collider(this.#r,[this.player1,this.player2],(e,t)=>{if(!(e instanceof aa))throw new Error("expected player");if(t instanceof zn)throw new Error("unexpected building");t instanceof Mn&&t.onCollision(e)},(e,t)=>{if(!(e instanceof aa))throw new Error("expected player");return t instanceof Mn||!(t instanceof zn)&&(!(t instanceof ur||t instanceof dr)||t.impassable||!e.iframe)}).setName("buildingCollider")),this.#r}#a;get debugGraphics(){return this.debugging?(this.#a??=this.add.graphics(),this.#a):(this.#a?.clear(),null)}#o;get drops(){return this.#o||(this.#o=this.physics.add.group().setName("dropGroup"),this.#o.runChildUpdate=!0),this.#o}#h;get layers(){if(!this.#h){const e={map:void 0,walls:void 0,isoMap:this.add.layer().setDepth(1),buildings:this.add.layer().setDepth(2),resource:this.add.layer().setDepth(3),game:this.add.layer().setDepth(5),player:this.add.layer().setDepth(6),ui:this.add.layer().setDepth(10),menu:this.add.layer().setVisible(!1).setDepth(1500)};this.#h=e}return this.#h}get mainScene(){const e=this.scene.get(tn);if(!(e instanceof Rn))throw new Error("missing main scene");return e}#c;get player1(){return this.#c??=new aa(this,"blue",{interactionKeys:{cancel:"Q",dash:"SPACE",interact:"E"},movementKeys:{down:"S",left:"A",right:"D",up:"W"}},0),this.#c}#l;get player2(){if(!this.#l){const{p2:e}=this.config.load();this.#l??=new aa(this,"red",{interactionKeys:{cancel:"BACKSPACE",dash:"FORWARD_SLASH",interact:"P"},movementKeys:{down:"DOWN",left:"LEFT",right:"RIGHT",up:"UP"}},1).setVisible(e)}return this.#l}#d;get tiles(){return this.#d??=this.add.group(),this.#d}#u;get chunkManager(){if(this.key===en){let{seed:e}=this.config.load();void 0===e&&(e=Math.random(),this.config.save({seed:e})),this.#u??=new gr(this,()=>e)}return this.#u??=new gr(this),this.#u}init(){super.init()}shutdown(){this.#c?.destroy(),this.#c=void 0,this.#l?.destroy(),this.#l=void 0,this.#o?.destroy(),this.#o=void 0,this.#r?.destroy(),this.#r=void 0,this.#h&&(this.#h.map?.destroy(),this.#h.walls?.destroy(),this.#h.buildings.destroy(),this.#h.resource.destroy(),this.#h.game.destroy(),this.#h.player.destroy(),this.#h.ui.destroy(),this.#h.isoMap.destroy(),this.#h.menu.destroy()),this.#h=void 0,this.#u=void 0,super.shutdown()}switch(e){const t=this.scene.get(tn);if(!(t instanceof Rn))throw new Error("there must always be a MainScene");t.launch(e)}update(e,t){this.chunkManager.update(e,t)}}class yr{constructor(e){this.fn=e}lastDeps=[];lastValue;run(e){return void 0!==this.lastValue&&yn(this.lastDeps,e)||(this.lastValue=this.fn(),this.lastDeps=structuredClone(e)),this.lastValue}}class fr extends mr{border={curr:0,prev:0};graphics;split=!1;#p;get cameraMasks(){if(!this.#p){const e=this.maskShapes.p1.createGeometryMask(),t=this.maskShapes.p2.createGeometryMask();this.#p={p1:e,p2:t}}return this.#p}#g;get maskShapes(){if(!this.#g){const e=this.add.graphics({x:0,y:0}),t=this.add.graphics({x:0,y:0});this.layers.ui.add(e),this.layers.ui.add(t),this.#g={p1:e,p2:t}}return this.#g}#m;get playercams(){if(!this.#m){const e=this.cameras.add(0,0,this.scale.width,this.scale.height,!1).setVisible(!1),t=this.cameras.add(0,0,this.scale.width,this.scale.height,!1).setVisible(!1);this.#m={p1:e,p2:t}}return this.#m}_centers;get centers(){return this._centers??=new yr(()=>{const e=(this.player1.x+this.player2.x)/2,t=(this.player1.y+this.player2.y)/2,s=new Phaser.Math.Vector2(e,t),i=this.player2.x-this.player1.x,n=this.player2.y-this.player1.y,r=new Phaser.Math.Vector2(i,n),a=new Phaser.Math.Vector2(this.player1.x,this.player1.y),o=new Phaser.Math.Vector2(this.player2.x,this.player2.y),h=r.angle(),c=Math.sin(h)*this.scale.height/4,l=Math.cos(h)*this.scale.width/4,d=Math.sqrt(c**2+l**2);return{center1:r.clone().normalize().multiply({x:d,y:d}).add(this.player1),center2:r.clone().normalize().multiply({x:-d,y:-d}).add(this.player2),d:r,midpoint:s,p1:a,p2:o}}),this._centers.run([this.player1.x,this.player1.y,this.player2.x,this.player2.y])}init(){super.init(),this.cameras.main.startFollow(this.player1),this.events.on("update",()=>{this.updateScreen()})}shutdown(){this.#p?.p1.destroy(),this.#p?.p2.destroy(),this.#p=void 0,this.#g?.p1.destroy(),this.#g?.p2.destroy(),this.#g=void 0,this.#m?.p1.destroy(),this.#m?.p2.destroy(),this.#m=void 0,super.shutdown()}draw(e,t){e.clear();const s=this.centers.d.clone();0===s.length()&&s.set(1,0);const i=s.clone().normalize(),n=new Phaser.Math.Vector2(-i.y,i.x),r=2*Math.max(this.scale.width,this.scale.height),a=4*Math.max(this.scale.width,this.scale.height);let o,h;1===t?(o=this.centers.center1.clone().add(n.clone().scale(r)),h=this.centers.center1.clone().add(n.clone().scale(-r))):(o=this.centers.center2.clone().add(n.clone().scale(r)),h=this.centers.center2.clone().add(n.clone().scale(-r)));const c=i.clone().scale(1===t?-a:a),l=o.clone().add(c),d=h.clone().add(c);this.debugging&&e.lineStyle(5*this.border.curr,0,1),e.lineStyle(this.border.curr,986895,1),e.beginPath(),e.moveTo(o.x,o.y),e.lineTo(l.x,l.y),e.lineTo(d.x,d.y),e.lineTo(h.x,h.y),e.closePath();const u=this.debugging?.5:0;this.maskShapes.p1.fillStyle(16711935,u),this.maskShapes.p2.fillStyle(16776960,u),e.fillPath(),e.strokePath()}drawDebug(){this.debugging&&(this.graphics??={center1:this.add.graphics({}),center2:this.add.graphics({}),d:this.add.graphics({}),midpoint:this.add.graphics({}),p1:this.add.graphics({}),p2:this.add.graphics({})},this.graphics.p1.clear(),this.graphics.p1.fillStyle(16711680,1),this.graphics.p1.fillCircle(this.centers.p1.x,this.centers.p1.y,15),this.graphics.center1.clear(),this.graphics.center1.fillStyle(16711935,1),this.graphics.center1.fillCircle(this.centers.center1.x,this.centers.center1.y,5),this.graphics.p2.clear(),this.graphics.p2.fillStyle(65280,1),this.graphics.p2.fillCircle(this.centers.p2.x,this.centers.p2.y,15),this.graphics.center2.clear(),this.graphics.center2.fillStyle(16776960,1),this.graphics.center2.fillCircle(this.centers.center2.x,this.centers.center2.y,5),this.graphics.midpoint.clear(),this.graphics.midpoint.fillStyle(255,1),this.graphics.midpoint.fillCircle(this.centers.midpoint.x,this.centers.midpoint.y,5),this.graphics.d.clear(),this.graphics.d.fillStyle(65535,1),this.graphics.d.fillCircle(this.centers.d.x,this.centers.d.y,5))}onConnect(){this.player2.visible||(this.cameras.main.stopFollow(),this.player2.setVisible(!0),this.config.save({p2:!0}))}onDisconnect(){this.player2.visible&&(this.cameras.main.startFollow(this.player1),this.player2.setVisible(!1))}onJoin(){!1!==this.split&&(this.cameras.main.setVisible(!0),this.playercams.p1.setVisible(!1),this.playercams.p2.setVisible(!1),this.split=!1)}onSplit(){this.split||(this.debugging||(this.cameras.main.stopFollow(),this.playercams.p1.setVisible(!0),this.playercams.p2.setVisible(!0)),this.split=!0)}updateScreen(){if(this.drawDebug(),this.player2.inputProvider.active&&!this.player2.visible&&(this.onConnect(),this.config.save({p2:!0})),!this.player2.inputProvider.active&&this.player2.visible&&this.onDisconnect(),!this.player2.visible)return;const e=this.centers.p1.distance(this.centers.center2)-this.centers.p1.distance(this.centers.center1);if(this.border.curr=e>2e3?20:e>0?.01*e:0,this.maskShapes.p1.clear(),this.maskShapes.p2.clear(),this.border.curr!==this.border.prev&&this.border.curr>0){this.border.prev=this.border.curr,this.maskShapes.p1.lineStyle(this.border.curr,16777215),this.maskShapes.p2.lineStyle(this.border.curr,16777215);const e=60/(60+this.border.curr);this.playercams.p1.setZoom(e),this.playercams.p2.setZoom(e),this.player1.setZoom(e),this.player2.setZoom(e),this.debugging&&(this.maskShapes.p1.lineStyle(this.border.curr,16711935),this.maskShapes.p2.lineStyle(this.border.curr,16776960))}this.border.curr>0?this.onSplit():e<0&&this.onJoin(),this.split?(this.debugging?(this.cameras.main.setVisible(!0),this.playercams.p1.clearMask(),this.playercams.p2.clearMask(),this.cameras.main.centerOn(this.centers.midpoint.x,this.centers.midpoint.y)):(this.cameras.main.setVisible(!1),this.playercams.p1.setMask(this.cameraMasks.p2,!1),this.playercams.p2.setMask(this.cameraMasks.p1,!1)),this.playercams.p1.centerOn(this.centers.center2.x,this.centers.center2.y),this.playercams.p2.centerOn(this.centers.center1.x,this.centers.center1.y),this.draw(this.maskShapes.p1,1),this.draw(this.maskShapes.p2,2)):this.cameras.main.centerOn(this.centers.midpoint.x,this.centers.midpoint.y)}}const br=1.5,vr={agility:{add:.1,expo:.1,flat:0,max:0,multi:0},charisma:{add:0,expo:.1,flat:10,max:0,multi:0},critchance:{add:0,expo:.1,flat:0,max:0,multi:.1},endurance:{add:0,expo:.1,flat:.1,max:0,multi:0},speed:{add:0,expo:.1,flat:0,max:2,multi:.1},strength:{add:.125,expo:.1,flat:0,max:0,multi:0}},wr=(e,t,s)=>{const i=vr[t],n=i.flat*s,r=i.add*s,a=(1+i.multi)**s,o=i.max;if("strength"===t&&(e.stats.attack=e.stats.attack*a+r+n),"agility"===t&&(e.stats.attackspeed=e.stats.attackspeed*a+r+n),"charisma"===t){const t=e.stats.health-e.stats.health*a+r+n;e.stats.health+=t,e.health+=t}return"endurance"===t&&(e.stats.regen=e.stats.regen*a+r+n),"speed"===t&&(e.stats.speed=Math.min(e.stats.speed*a+r,o),e.dashCooldown=5e3/e.stats.speed),"critchance"===t&&(e.hitboxSizes.magnet.height*=a,e.hitboxSizes.magnet.width*=a,void 0!==e.hitbox.magnet&&e.scene instanceof xa&&(e.hitbox.magnet.destroy(),e.hitbox.magnet=void 0)),e.refreshWeapons(),i},xr=(e,t,s)=>{const i=vr[t],n=i.flat*s,r=100*i.add*s,a=100*i.multi*s,o=100*i.max;let h="";0!==n&&(h=`+${n}`);let c="";0!==r&&(c=`+${r}%`);let l="";return 0!==a&&(l=`${a}%`),"strength"===t?`${c}${h}${l} attack\n\ncurrent: ${(100*(e.stats.attack-1)).toFixed(1)}%`:"agility"===t?`${c}${h}${l} attack speed\n\ncurrent: ${(100*(e.stats.attackspeed-1)).toFixed(1)}%`:"charisma"===t?`${c}${h}${l} health\n\ncurrent: ${e.stats.health.toFixed(0)}`:"critchance"===t?`${c}${h}${l} magnet range`:"endurance"===t?`${c}${h}${l} regen\n\ncurrent: ${e.stats.regen.toFixed(1)}`:"speed"===t?`${c}${h}${l} movespeed\n\n${(100*e.stats.speed).toFixed(0)}% / ${o.toFixed(0)}%`:"N/A"};class kr extends Mn{amount=0;amountText;promptKey;prompts=[{kbm:{color:16711935,frame:"keyboard_e"},text:"manage drones",xbox:{color:16777215,frame:"xbox_button_color_x"}}];scene;container;glow;interactionBox;new=!0;constructor(e,t,s){super(e,s.x,s.y,"castle");const{bottom:i,height:n,width:r,x:a,y:o}=this.getBounds();this.interactionBox=new Phaser.Geom.Rectangle(a-20,o-20,r+40,n+40),this.scene=e,this.promptKey="castle",this.setDepth(o+this.displayHeight/2),this.scene.buildings.add(this),this.scene.layers.player.add(this),this.body instanceof Phaser.Physics.Arcade.StaticBody&&(this.body.setSize(this.width,this.height/2),this.body.setOffset(0,this.height/2));const{centerX:h,top:c}=this.getBounds();this.amountText=this.scene.add.text(h,c-20,"",Ia).setOrigin(.5),this.container=new kn(e,s)}onCancel(){this.container.visible||console.log("onCancel")}onCollision(e){this.container.visible?e.inputProvider.setOnInteract(this.container):e.inputProvider.setOnInteract(this)}onInteract(e){console.trace(e),this.container.visible?this.container.setVisible(!1):this.container.open(e)}onMovement(){}onSelect(){}setButtons(e){this.container.setButtons(e)}update(e,t){this.container.update(e,t)}attention(){!1!==this.new&&(this.setRotation(Math.PI/32),this.scene.time.delayedCall(50,()=>{this.setRotation(0)}),Math.random()<.3&&(this.scene.time.delayedCall(100,()=>{this.setRotation(Math.PI/32)}),this.scene.time.delayedCall(150,()=>{this.setRotation(0)})),this.scene.time.delayedCall(1750+500*Math.random(),()=>{this.attention()}))}disableNew(){this.new&&(this.new=!1,this.glow&&this.preFX?.remove(this.glow),this.preFX?.setPadding(16),this.glow=this.preFX?.addGlow(16777215,100),this.preFX?.addShadow())}enableNew(){this.preFX?.setPadding(32),this.preFX?.addShadow(),this.glow=this.preFX?.addGlow(16762624)}}class _r{constructor(e,t,s,i=1){this.base=t,this.scene=e,this.sprite=this.scene.physics.add.sprite(t.x,t.y,"").setOrigin(.5,.5).setScale(2),this.scene.layers.game.add(this.sprite),this.sprite.body?.setSize(this.sprite.width/4,this.sprite.height/4,!0),this.sprite.setBounce(.25),this.resourceContainer=s,this.level=i,this.xp=this.xpBase**i,this.xpRequired=this.xpBase**(i+1),this.resourceTarget=void 0,this.debugText=this.scene.add.text(this.sprite.x,this.sprite.y,"",{align:"center",color:"#ffffff",fontFamily:"Arial Black",fontSize:20,stroke:"#000000",strokeThickness:4}),this.sprite.play("idle")}resourceTarget;scene;sprite;carrying=0;debugText;distance=0;level;miningElapsed=0;miningTime=500;resourceContainer;speed=100;task="idle";travelElapsed=0;travelTime=1e4;xp;xpBase=1.2;xpRequired;assignResource(e){if(this.resourceTarget=e,e){const t=this.base.x-e.x,s=this.base.y-e.y;this.distance=Math.sqrt(t*t+s*s)}}moveTo(e,t,s){const i=e-this.sprite.x,n=t-this.sprite.y,r=Math.sqrt(i*i+n*n),a=this.travelTime-this.travelElapsed;if(r>10){let e=r/a*1e3;e=Math.max(e,100);const t=Math.atan2(n,i),s=Math.cos(t)*e,o=Math.sin(t)*e;this.sprite.flipX=s<0,this.sprite.body instanceof Phaser.Physics.Arcade.Body&&(this.sprite.body.velocity.x/s<.1||this.sprite.body.velocity.y/o<.1)&&this.sprite.setVelocity(s,o)}else this.sprite.setVelocity(0,0);this.travelElapsed+=s}moveToPosition(e,t,s){const i=e-this.sprite.x,n=t-this.sprite.y,r=Math.sqrt(i*i+n*n),a=this.travelTime-this.travelElapsed;if(r>1){let e=r/a*1e3;e=Math.max(e,100);const t=Math.atan2(n,i),o=Math.cos(t)*e*(s/1e3),h=Math.sin(t)*e*(s/1e3);this.sprite.flipX=o<0,this.sprite.x+=o,this.sprite.y+=h,this.sprite.setVelocity(e,e)}}reached(e){const t=e.x-this.sprite.x,s=e.y-this.sprite.y;return t*t+s*s<100}update(e,t){switch(this.task){case"move":if(void 0===this.resourceTarget){this.task="deliver",this.sprite.play("deliver");break}this.moveTo(this.resourceTarget.x,this.resourceTarget.y,t),this.reached(this.resourceTarget)&&(this.task="mine",this.sprite.play("mine"),this.travelElapsed=0,this.miningElapsed=0);break;case"mine":if(void 0===this.resourceTarget){this.task="deliver",this.sprite.play("deliver");break}if(!this.reached(this.resourceTarget)){this.task="move",this.sprite.play("move");break}if(this.miningElapsed+=t,this.miningElapsed>=this.miningTime){if(this.carrying+=this.resourceTarget.mine(this.level-this.carrying),this.carrying<this.level)return this.resourceTarget=void 0,this.task="move",void this.sprite.play("move");this.task="deliver",this.sprite.play("move")}break;case"celebrate":if("deliver"===this.sprite.anims.getName())break;this.handleXp(),this.sprite.play("deliver"),setTimeout(()=>{this.task="move",this.sprite.play("move")},250);break;case"deliver":if(this.moveTo(this.base.x,this.base.y,t),this.reached(this.base)){if(this.resourceContainer.addResource(this.carrying),this.carrying=0,this.travelElapsed=0,void 0===this.resourceTarget){this.task="idle",this.sprite.play("idle");break}this.task="celebrate"}break;case"idle":void 0!==this.resourceTarget&&(this.task="move",this.sprite.play("move"))}}handleXp(){this.xp+=this.level,this.xp>=this.xpRequired&&(this.level+=1,this.xpRequired=this.xpBase**(this.level+1),this.travelTime=Math.max(Math.trunc(.9*this.travelTime),500),this.miningTime=Math.max(Math.trunc(.9*this.miningTime),100))}}class Pr extends Phaser.Physics.Arcade.Image{constructor(e,t,s,i,n=1e3){const r=["00","16","32","48","64"],a=`${t}${r[Math.floor(Math.random()*r.length)]??"00"}`;super(e,s.x,s.y,"ores",a),this.scene=e,this.resourceType=t,this.position=s,this.size=i,this.amountLeft=n;const o=this.size/this.width;this.setScale(o),this.scene.physics.add.existing(this),this.text=this.scene.add.text(this.position.x,this.position.y,`${this.amountLeft}`,{fontSize:40}).setOrigin(.5,2),e.add.existing(this)}text;mine(e){const t=Math.min(e,this.amountLeft);return this.amountLeft-=t,this.text.setText(`${this.amountLeft}`),t}}class Sr extends Phaser.GameObjects.Text{tween;constructor(e,t,s,i,n){super(e,t,s,i,n),this.setVisible(!1),this.setAlpha(0)}}class Mr{constructor(e,t,s){this.scene=e,this.type=t,this.probeBody=s,this.nodes=this.scene.physics.add.group(this.resourceNodes),this.droneGroup=this.scene.physics.add.group();const i=this.scene.config.load();this.amountVoidGems=i.inventory.player.voidGems;const n=this.scene.add.rectangle(0,0,this.scene.scale.baseSize.width,this.scene.scale.baseSize.height,255,255).setInteractive().on("pointerdown",e=>{if(!(e instanceof Phaser.Input.Pointer))throw new o;e.rightButtonDown()&&this.createNode(e)}).setOrigin(0);for(this.scene.layers.game.add(n),this.building=new kr(this.scene,this.type,{x:0,y:.25*this.scene.scale.height}),this.building.setButtons([{onClick:()=>{this.createDrone()},text:`Spawn Drone\n(${this.amountVoidGems}/${this.cost})`,tooltip:"1"},{onClick:e=>{const{inventory:t}=this.scene.config.load();this.scene.config.save({inventory:{...t,player:{plants:[],voidGems:2*t.player.voidGems}}}),e.refreshUpgrades()},text:"I'm a button",tooltip:"1"},{onClick:e=>{const{inventory:t}=this.scene.config.load();this.scene.config.save({inventory:{...t,player:{plants:[],voidGems:Math.trunc(t.player.voidGems/2)}}}),e.refreshUpgrades()},text:"I'm also a button",tooltip:"1"}]),this.notificationText=this.scene.add.group({maxSize:15});15!==this.notificationText.children.size;){const e=new Sr(this.scene,this.building.x,this.building.y,"+1",{align:"center",color:zr[this.type].toString(16),fontSize:40,strokeThickness:8});e.tween=this.scene.tweens.add({alpha:[1,.95,.9,.85,.8,.75,.7,.6,.5,0],duration:500,paused:!0,persist:!0,targets:e,x:{from:this.building.x,to:this.building.x+50},y:{from:this.building.y-50,to:this.building.y-150}}),this.notificationText.add(e,!0)}this.createNode({x:this.scene.scale.baseSize.width*(3/4),y:this.scene.scale.baseSize.height*(3/4)})}amount=0;amountVoidGems;baseCost=10;building;costExponent=1.05;costMultiplier=1.2;droneGroup;drones=[];nodes;notificationText;resourceNodes=[];resourceSize=64;get cost(){const e=this.droneGroup.countActive(),t=this.costMultiplier*e,s=this.costExponent**e-1;return Math.trunc(this.baseCost*(t+s))}addResource(e){this.amount+=e;const t=this.notificationText.getMatching("alpha",0),s=t[Math.trunc(t.length*Math.random())];let i;s instanceof Sr&&(i=s,i.text=`+${e}`,i.setVisible(!0),i.tween?.restart())}consumeResource(e){return this.amount>=e&&(this.amount-=e,!0)}createDrone(){if(this.amountVoidGems<this.cost)return;const e=new _r(this.scene,this.building,this,1);this.amountVoidGems-=this.cost,this.drones.push(e),this.droneGroup.add(e.sprite),this.building.setButtons([{onClick:()=>{this.createDrone()},text:`Spawn Drone\n(${this.amountVoidGems}/${this.cost})`,tooltip:"1"},{onClick:()=>{alert("button")},text:"I'm a button",tooltip:"1"},{onClick:()=>{alert("also a button")},text:"I'm also a button",tooltip:"1"}])}createNode(e){e??={x:600,y:200},this.probeBody.setEnable(!0).reset(e.x,e.y);const t=this.scene.physics.overlap(this.probeBody,this.nodes);if(this.probeBody.setEnable(!1),t)return;const s=new Pr(this.scene,this.type,e,this.resourceSize);return this.resourceNodes.push(s),this.scene.ResourceLayer?.add(s),this.nodes.add(s),s}update(e,t){for(const s of this.drones){if(0===s.resourceTarget?.amountLeft&&(s.resourceTarget.text.destroy(),this.nodes.remove(s.resourceTarget,!0,!0),s.assignResource(void 0)),!s.resourceTarget){const e=this.scene.physics.closest({x:s.sprite.x,y:s.sprite.y},this.nodes.getChildren());e&&e instanceof Pr&&s.assignResource(e)}s.update(e,t)}this.building.update(e,t),this.building.amountText.setText(`${this.amount}`)}}const zr={copper:13857085,gold:16634896,silver:14869218,stone:5855577};class Ir{constructor(e){this.scene=e,this.probeBody=this.scene.physics.add.body(0,0,0,0).setEnable(!1)}probeBody;resources=new Map;addResource(e,t){const s=this.resources.get(e);if(!s)throw new Error("meow");s.addResource(t)}consumeResource(e,t){const s=this.resources.get(e);if(!s)throw new Error("meow");return s.consumeResource(t)}createDrone(e){const t=this.resources.get(e);if(!t)throw new Error("meow");t.createDrone()}createNode(e){const t=this.resources.get(e);if(!t)throw new Error("meow");t.createNode()}initialize(e){const t=new Mr(this.scene,e,this.probeBody);this.resources.set(e,t)}update(e,t){for(const[,s]of this.resources)s.update(e,t)}}class Tr{promptKey="portal";prompts=[{kbm:{color:16711935,frame:"keyboard_e"},text:"enter",xbox:{color:16777215,frame:"xbox_button_color_x"}}];ellipse;particles;portal;scene;x;y;constructor(e,t,s){this.scene=e,this.x=t,this.y=s,this.portal=this.scene.physics.add.sprite(t,s,"portal2").setScale(1.5*br),this.portal.play("portal2");const{height:i,width:n,x:r,y:a}=this.portal;if(this.ellipse=new Phaser.Geom.Ellipse(r,a,n-20,i-20),!0===this.scene.physics.config.debug){const e=this.scene.add.ellipse(r,a,n-20,i-20,15790320);this.scene.layers.resource.add(e)}this.scene.layers.resource.add(this.portal)}destroy(){this.portal.destroy(),this.particles?.destroy()}onCancel(){}onInteract(){this.scene.switch(Qi)}onSelect(){}update(){for(const e of[this.scene.player1,this.scene.player2]){const t=e.x,s=e.y;Phaser.Geom.Ellipse.Contains(this.ellipse,t,s)&&e.inputProvider.setOnInteract(this)}}}const Er=[2,5,10,20,50,100,200,500,1e3,2e3,5e3,1e4,2e4,5e4,1e5,2e5,5e5,1e6,2e6,5e6,1e7,2e7,5e7,1e8,2e8,5e8,1e9,2e9,5e9,1e10,2e10,5e10,1e11,2e11,5e11,1e12],Ar=(e,t)=>{const s=[];for(const i of Er){if(i>t)return s;i>=e&&s.push(i)}return s},Cr={agility:Ar(2,5e6),charisma:Ar(5,2e4),critchance:Ar(5,2e4),endurance:Ar(500,1e4),speed:Ar(20,5e3),strength:Ar(2,5e6)};class Or extends zn{static setBounds(e,t,s){if(t instanceof Phaser.Physics.Arcade.Body){s*=br;const i=Math.min(e.width,e.height)+2*s;t.setSize(i,i).setOffset((e.width-2*i)/2+2*s,(e.height-2*i)/2+2*s)}if(t instanceof Phaser.Physics.Arcade.StaticBody){s*=br;const i=Math.min(e.width,e.height)+2*s;t.setSize(i,i).setOffset((e.width-2*i)/2+32+s,(e.height-2*i)/2+32+s)}}amount=0;baseSprite;costText;levelText;overlapRect;player;promptKey;prompts=[{kbm:{color:16711935,frame:"keyboard_q"},text:"refund",xbox:{color:16777215,frame:"xbox_button_color_b"}},{kbm:{color:16711935,frame:"keyboard_e"},text:"upgrade",xbox:{color:16777215,frame:"xbox_button_color_x"}}];scene;sprite;upgrade;icon;prev={cost:void 0,refund:void 0,shards:0};constructor(e,t,s){super(e,t.x,t.y),this.scene=e,this.upgrade=s,this.promptKey=s;let i="barracks";"agility"!==s&&"speed"!==s||(i="archery"),"endurance"!==s&&"charisma"!==s||(i="monastery"),this.sprite=e.add.sprite(0,0,i).setOrigin(.5);const{bottom:n,centerX:r,top:a}=this.sprite.getBounds();this.levelText=this.scene.add.text(r,a-20,"",Ia).setOrigin(.5),this.costText=this.scene.add.text(r,n+20,"",{...Ia,fontSize:Ma.SM}).setOrigin(.5),this.icon=e.add.image(0,-15,"drops",s).setScale(.5),this.overlapRect=new Phaser.Geom.Rectangle(0,0,this.icon.displayWidth,this.icon.displayHeight),this.add([this.sprite,this.icon,this.costText,this.levelText]),this.scene.layers.ui.add(this)}#y;get glow(){return!this.#y&&this.baseSprite?.preFX&&(this.#y=this.baseSprite.preFX.addGlow()),this.#y}destroy(){this.costText.destroy(),this.levelText.destroy(),this.baseSprite?.destroy(),this.icon.destroy(),super.destroy()}onCancel(e){if(!this.baseSprite)return;const{inventory:t,upgrades:s}=this.scene.config.load(),i=s[this.upgrade],n=Cr[this.upgrade][i.level-1];let{voidGems:r}=t.player;if(void 0!==n&&i.level>0){r+=n,e.inventory.voidGems+=n,i.level-=1;const t=(Phaser.Math.Angle.BetweenPoints(this.baseSprite,e)+Math.PI)%Phaser.Math.PI2/Phaser.Math.PI2;for(let s=0;s<Math.min(n,100);s++)if(this.scene.loot){const s=t+(.5*Math.random()-.25),i=e.getTargetCurve(256).getPoint(s).add(this.baseSprite),n=e.getTargetCurve(32).getPoint(s).add(e),r=this.scene.loot.spawn(!0,this.baseSprite.x,this.baseSprite.y,"","void-gem");r&&(r.moveTo(i,()=>{r.moveTo(n,()=>{r.setVisible(!1),r.setActive(!1),r.body&&(r.body.checkCollision.none=!0)})}),r.body&&(r.body.checkCollision.none=!1))}}this.scene.config.save({inventory:{...t,player:{...t.player,voidGems:r}},upgrades:{...s,[this.upgrade]:i}}),e.refreshUpgrades(),e.inputProvider.removeAllInteract(),e.inputProvider.refreshPrompt(this)}onCollision(e){e.inputProvider.setOnInteract(this),e.lootMenu.link(this,.5),e.lootMenu.text=xr(e,this.upgrade,1)}onFocus(e){}onInteract(e){if(!this.baseSprite)return;const{inventory:t,upgrades:s}=this.scene.config.load(),i=s[this.upgrade],n=Cr[this.upgrade][i.level];let{voidGems:r}=t.player;if(void 0!==n&&r>=n){r-=n,e.inventory.voidGems-=n,i.level+=1;const t=(Phaser.Math.Angle.BetweenPoints(this.baseSprite,e)+Math.PI)%Phaser.Math.PI2/Phaser.Math.PI2;for(let s=0;s<Math.min(n,1e3);s++)if(this.scene.loot){const s=.5*Math.random()-.25,i=t+s,n=e.getTargetCurve(64).getPoint(i).add(e),r=this.scene.loot.spawn(!0,n.x,n.y,"","void-gem");if(r){const t=e.getTargetCurve(256).getPoint(i).add(e).add({x:s,y:s});r.moveTo(t,()=>{if(!this.baseSprite)throw new Error;r.moveTo(this.baseSprite,()=>{r.setVisible(!1),r.setActive(!1),r.body&&(r.body.checkCollision.none=!0)})}),r.body&&(r.body.checkCollision.none=!1)}}}this.scene.config.save({inventory:{...t,player:{...t.player,voidGems:r}},upgrades:{...s,[this.upgrade]:i}}),e.refreshUpgrades()}onMovement(){}onSelect(){}refreshCosts(){const{inventory:{player:e},upgrades:t}=this.scene.config.load(),s=t[this.upgrade],{voidGems:i}=e,n=Cr[this.upgrade][s.level],r=Cr[this.upgrade][s.level-1];if(n!==this.prev.cost||r!==this.prev.refund||i!==this.prev.shards){if(this.prev.cost=n,this.prev.refund=r,this.prev.shards=i,void 0===n&&void 0!==r)this.prompts=[{kbm:{color:16711935,frame:"keyboard_q"},text:`refund (${r} gems)`,xbox:{color:16777215,frame:"xbox_button_color_b"}}];else if(void 0!==n&&void 0===r)this.prompts=[{kbm:{color:16711935,frame:"keyboard_e"},text:`upgrade ${this.upgrade} (${n} gems)`,xbox:{color:16777215,frame:"xbox_button_color_x"}}];else{if(void 0===n||void 0===r)throw new Error;this.prompts=[{kbm:{color:16711935,frame:"keyboard_q"},text:`refund (${r} gems)`,xbox:{color:16777215,frame:"xbox_button_color_b"}},{kbm:{color:16711935,frame:"keyboard_e"},text:`upgrade  ${this.upgrade} (${n} gems)`,xbox:{color:16777215,frame:"xbox_button_color_x"}}]}this.levelText.text=`${s.level} / ${Cr[this.upgrade].length}`,void 0!==n?(this.costText.text=n.toFixed(0),i>n?(this.costText.setColor("#00FF00"),this.glow&&this.baseSprite&&(this.baseSprite.alpha=1,this.glow.outerStrength=8,this.glow.color=8453888)):(this.costText.setColor("#FF8000"),this.icon.alpha=.5,this.glow&&this.baseSprite&&(this.glow.outerStrength=0,this.baseSprite.alpha=.5))):(this.costText.text="-",this.icon.setTint(8421504)),this.scene.player1.inputProvider.refreshPrompt(this),this.scene.player2.inputProvider.refreshPrompt(this)}}setEditing(e){if(e)this.baseSprite?.setTint(65280),this.baseSprite&&(this.scene.buildings.remove(this.baseSprite,!0,!0),this.baseSprite=void 0),this.sprite.setVisible(!0),this.setAlpha(.5),this.scene.buildings.remove(this);else{if(this.baseSprite?.clearTint(),this.baseSprite)throw new Error("Base sprite already exists");this.baseSprite=this.scene.physics.add.staticSprite(this.x,this.y,this.sprite.texture.key),this.scene.layers.player.add(this.baseSprite),this.scene.buildings.add(this.baseSprite),this.baseSprite.body instanceof Phaser.Physics.Arcade.StaticBody&&(this.baseSprite.body.setSize(this.baseSprite.width,this.baseSprite.height/2),this.baseSprite.body.setOffset(0,this.baseSprite.height/2)),this.baseSprite.setDepth(this.y+this.baseSprite.displayHeight/2),this.sprite.setVisible(!1),this.setAlpha(1),this.scene.buildings.add(this),this.scene.physics.world.enableBody(this,Phaser.Physics.Arcade.STATIC_BODY),Or.setBounds(this.sprite,this.body,16);const{buildings:e}=this.scene.config.load();this.scene.config.save({buildings:{...e,[this.upgrade]:{x:this.x,y:this.y}}})}return this}update(e,t){this.refreshCosts()}}class Dr extends fr{constructables=new Set(["strength","endurance","agility","critchance","charisma","speed"]);GameLayer=null;#f=!1;key=en;loot;MenuLayer=null;ResourceLayer=null;shouldSpawn=!1;UILayer=null;inventory={base:{plants:[],voidGems:0},player:{plants:[],voidGems:0},players:{}};resourceManager;constructor(){super({key:en,plugins:[...Phaser.Plugins.DefaultPlugins.DefaultScene,Ra.key]})}#b;get portal(){return this.#b??=new Tr(this,this.player1.x,this.player1.y-512),this.#b}#v;get upgradeBuilding(){if(!this.#v){const e={agility:void 0,charisma:void 0,critchance:void 0,endurance:void 0,speed:void 0,strength:void 0},{buildings:t}=this.config.load();for(const s of Array.from(this.constructables)){const i=t[s];if(!i)continue;const n=new Or(this,i,s).setEditing(!1);e[s]=n,this.constructables.delete(s)}this.#v=e}return this.#v}create(){console.log("creating idle"),this.ResourceLayer=this.add.layer(),this.GameLayer=this.add.layer(),this.UILayer=this.add.layer(),this.MenuLayer=this.add.layer(),this.input.mouse?.disableContextMenu(),this.resourceManager=new Ir(this);const{inventory:e}=this.config.load();this.inventory=e,this.loot=new $r({handleCollision:(e,t)=>{t.target=null},handleInteraction:void 0,keys:{play:"void-gem-float",sprite:"void-gem"},metadata:{maxSize:1048576,scale:.25},scene:this}),this.player1.body instanceof Phaser.Physics.Arcade.Body&&this.physics.add.collider(this.player1.body,this.drops).setName("p1DropCollider"),this.player2.body instanceof Phaser.Physics.Arcade.Body&&this.physics.add.collider(this.player2.body,this.drops).setName("p2DropCollider"),this.physics.add.collider(this.drops,this.drops).setName("dropCollider"),this.layers.walls&&(this.layers.walls.setCollision([5,6,7,14,16,23,24,25,32,33,34,35]),this.physics.add.collider([this.player1,this.player2],this.layers.walls)),this.resourceManager.initialize("stone"),this.events.once(Phaser.Scenes.Events.SHUTDOWN,()=>{console.log("shut down"),this.shutdown()},this)}preload(){console.log("preloading idle")}shutdown(){if(this.#b?.destroy(),this.#b=void 0,this.#v){for(const[,e]of Object.entries(this.#v))e?.destroy();this.#v=void 0,this.constructables=new Set(["strength","endurance","agility","critchance","charisma","speed"])}this.#f=!1,super.shutdown()}update(e,t){this.resourceManager?.update(e,t),this.player1.update(e,t),this.player2.update(e,t),this.portal.update();for(const s of Oi)this.upgradeBuilding[s]?.update(e,t);this.runAfterInit(()=>{this.spawnGems()}),super.update(e,t)}initialize(){this.#f||(this.#f=!0)}runAfterInit(e){this.#f?e():this.initialize()}spawnGems(){if(this.shouldSpawn){for(let e=0;e<this.inventory.player.voidGems/10;e++)if(this.loot&&this.loot.size<this.inventory.player.voidGems){const e=Math.random(),t=this.player1.getTargetCurve(64).getPoint(e).add(this.player1),s=this.loot.spawn(!0,t.x,t.y,"","void-gem");if(s){const t=this.player1.getTargetCurve(256).getPoint(e).add(this.player1).add({x:e,y:e});s.moveTo(t),s.body&&(s.body.checkCollision.none=!1)}}this.loot?.size!==this.inventory.player.voidGems&&1024!==this.loot?.size||(this.shouldSpawn=!1)}}}class Rr extends Mn{static isInstanceOf(e){return e instanceof Rr}alphaDefault=1;handleCollision;handleInteraction;isAttracting=!1;onCancel=e=>{};onInteract=e=>{this.handleInteraction&&this.handleInteraction(e)};onSelect=e=>{};owner;#w=!1;promptKey=this.constructor.name;prompts=[{kbm:{color:16711935,frame:"keyboard_e"},text:"Select",xbox:{color:16777215,frame:"xbox_button_color_x"}}];rarity=1;scene;siblings=[];subtype;target=null;type;attractSpeed;onArrival;travelRemaining=2e3;constructor({frame:e,handleCollision:t,handleInteraction:s,key:i,scene:n,type:r,x:a,y:o}){super(n,a,o,i,e),this.subtype=i,this.scene=n,this.type=r,this.setScale(window.devicePixelRatio),this.handleCollision=e=>{t(e,this)},s&&(this.handleInteraction=e=>{s(e,this)}),this.scene.drops.add(this),this.scene.layers.game.add(this),this.setDepth(this.getBottomCenter().y),this.body,Phaser.Physics.Arcade.Body}collect(){this.isAttracting=!1,this.destroy()}destroy(e=!1){e&&this.siblings?.forEach(e=>{e.destroy(!1)}),this.setActive(!1),this.body&&(this.body.enable=!1),this.setVisible(!1),this.target=null,super.destroy()}moveTo(e,t){if(null!==this.target)return;if(void 0!==this.handleInteraction)return;this.onArrival=t,this.target=e;const s=Phaser.Math.Distance.Between(e.x,e.y,this.x,this.y);this.travelRemaining=Math.min(s,2e3)}onFocus(e){"none"===e?this.setAlpha(this.alphaDefault):"sibling"===e?this.setAlpha(.5):this.setAlpha(1)}onMovement(){}update(e,t){this.physics(),this.lerp(e,t)}lerp(e,t){this.target&&(this.attractSpeed??=.02,this.x=Phaser.Math.Linear(this.x,this.target.x,this.attractSpeed),this.y=Phaser.Math.Linear(this.y,this.target.y,this.attractSpeed),Phaser.Math.Distance.Between(this.x,this.y,this.target.x,this.target.y)<8&&(this.target=null,this.onArrival?.(this)),this.attractSpeed=Math.min(this.attractSpeed+.002*t,.35))}moveToObj(e,t){if(0!==this.body?.velocity.x&&this.body?.velocity.y,this.target){if(25===this.travelRemaining)return this.scene.physics.moveToObject(this,this.target,0,0),this.target=null,void this.onArrival?.(this);this.scene.physics.moveToObject(this,this.target,300,this.travelRemaining),this.travelRemaining=Math.max(25,this.travelRemaining-t)}}physics(){if(this.#w)return;if(!(this.body instanceof Phaser.Physics.Arcade.Body))return;this.scene instanceof xa?this.body.setDrag(480):(this.body.setDamping(!0),this.body.setDrag(.1),this.body.setBounce(.75));let e=Math.min(this.width,this.height);void 0===this.handleInteraction?e*=.25:e*=.75;const t=this.width/2-e,s=this.height/2-e;this.body.setCircle(e,t,s),this.#w=!0}}class $r{getSiblingUsed=()=>0;DropClass=Rr;group;handleCollision;handleInteraction;keys;metadata;scene;constructor(e){this.scene=e.scene,this.group=this.scene.physics.add.group({maxSize:e.metadata.maxSize}),this.handleCollision=e.handleCollision,this.handleInteraction=e.handleInteraction,this.keys=e.keys,this.metadata=e.metadata}get items(){const e=[],t=this.group.getMatching();for(const s of t)s instanceof this.DropClass&&e.push(s);return e}get size(){return this.group.getTotalUsed()}clear(){this.group.clear(!0,!0)}spawn(e,t,s,i,n,r){let a=this.getFirstDead(t,s);if(!a){const r=this.group.getTotalUsed()+this.getSiblingUsed();if(!(!0===e&&r<this.metadata.maxSize))return a;a=this.create(t,s,i,n)}return a.setActive(!0),""!==this.keys.play&&a.play(this.keys.play),void 0!==r&&a.play(r),a.setVisible(!0),a}spawnGroup(e,t){const s=[];for(const i of e){const e=this.spawn(!0,i.x,i.y,i.frame,i.type,i.play);e&&s.push(e)}for(const i of s){i.alphaDefault=.5,i.owner=t;for(const e of s)i!==e&&i.siblings.push(e)}return s}create(e,t,s,i){const n=new this.DropClass({frame:s,handleCollision:this.handleCollision,handleInteraction:this.handleInteraction,key:this.keys.sprite,scene:this.scene,type:i,x:e,y:t});return n.setScale(this.metadata.scale),this.group.add(n),this.items.push(n),n}getFirstDead(e,t){const s=this.group.getFirstDead(!1,e,t);if(s instanceof this.DropClass)return s}}const Gr={attached:!1,bgColor:2236962,color:65280,maxValue:100,percision:0,text:!0,value:100};class Br{bar;config;percision;player;scene;text;zoom=1;constructor(e,t={}){this.player=e,this.scene=e.scene;const s=.025*e.scene.scale.height,i=e.scene.scale.width/3.5-s;this.config={...Gr,height:s,width:i,x:s,y:e.scene.scale.height-s,...t,lineStyle:{alpha:.5,color:0,lineWidth:6}},this.config.lineStyle.lineWidth=Math.min(this.config.lineStyle.lineWidth,this.config.height/4),this.bar=e.scene.add.graphics(),this.scene.layers.ui.add(this.bar),this.config.text&&(this.text=e.scene.add.text(0,0,"",Ia).setOrigin(.5),this.text.x=this.config.x+.5*this.config.width/this.zoom,this.text.y=this.config.y+this.config.height/2),this.config.attached?this.player.add(this.bar):(this.bar.setScrollFactor(0),this.text?.setScrollFactor(0)),this.percision=10**this.config.percision,this.draw()}destroy(){this.bar.destroy(),this.text?.destroy()}setVisible(e){this.bar.setVisible(e),this.text?.setVisible(e)}setZoom(e){this.config.attached||(this.zoom=e,this.draw())}update(e,t){(this.config.value!==e||this.config.maxValue!==t)&&(this.config.maxValue=t,this.config.value=Phaser.Math.Clamp(e,0,this.config.maxValue),this.draw())}draw(){this.bar.clear();const{alpha:e,color:t,lineWidth:s}=this.config.lineStyle;this.bar.lineStyle(s,t,e);const i=this.config.width*(1-this.zoom)/2,n=-this.config.height*(1-this.zoom)/2;this.config.width,this.zoom,this.config.height,this.zoom,this.bar.strokeRect(this.config.x-s/2-i,this.config.y-s/2-n,this.config.width+s+2*i,this.config.height+s+2*n),this.bar.fillStyle(this.config.bgColor),this.bar.fillRect(this.config.x-i,this.config.y-n,this.config.width+2*i,this.config.height+2*n);const r=this.config.value/this.config.maxValue*this.config.width;this.bar.fillStyle(this.config.color),this.bar.fillRect(this.config.x-i,this.config.y-n,r+2*i,this.config.height+2*n),this.text&&(this.text.text=`${Math.round(this.config.value*this.percision)/this.percision} / ${this.config.maxValue}`)}}const Fr=(e,t)=>({...e,...t,projectile:{...e.projectile,...t.projectile,multi:{...e.projectile.multi,...t.projectile?t.projectile.multi:{}},range:{...e.projectile.range,...t.projectile?t.projectile.range:{}}},splash:{...e.splash,...t.splash}}),Nr={bodyRadius:10,damage:0,delay:0,fired:0,knockback:0,multi:{count:1,spread:0},offsetAngle:0,pierce:0,range:{angular:0,linear:0},speed:{angular:0,linear:0},total:0},jr={cooldown:1e3,delta:0,deviation:0,projectile:Nr,splash:{damage:0,pierce:Number.POSITIVE_INFINITY,size:0}},Vr=["sword","arrow","needler","fireball","shotgun"];"function"!=typeof crypto.randomUUID&&(crypto.randomUUID=()=>`${"xxxxxxxx".replace(/[xy]/g,e=>{const t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)})}-${"xxxx".replace(/[xy]/g,e=>{const t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)})}-${"4xxx".replace(/[xy]/g,e=>{const t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)})}-${"yxxx".replace(/[xy]/g,e=>{const t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)})}-${"xxxxxxxxxxxx".replace(/[xy]/g,e=>{const t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)})}`);class Ur extends Phaser.Physics.Arcade.Sprite{created=!1;hitbox;id=crypto.randomUUID().slice(-4);scene;player;size;stats;enemiesDamaged=new Set;pierce=0;constructor(e,t,s){super(e,0,0,t.sprite),this.scene=e,this.stats=t,this.player=s,console.log(this.scene.layers.game),this.scene.add.existing(this),this.scene.layers.game.add(this),t.animation&&this.play(t.animation.key)}#x;get lifetime(){if(void 0===this.#x||this.#x.memo.some(e=>e!==this.stats.attack.projectile.range.linear||e!==this.stats.attack.projectile.range.angular||e!==this.stats.attack.projectile.speed.linear||e!==this.stats.attack.projectile.speed.angular)){const{range:e,speed:t}=this.stats.attack.projectile,s=t.linear>0?e.linear/t.linear*1e3:0,i=t.angular>0?e.angular/(t.angular*(Math.PI/180))*1e3:0;this.#x={memo:[e.linear,e.angular,t.linear,t.angular],value:Math.max(s,i)}}return this.#x.value}create(e,t){throw new Error}hide(){this.toggleVisibility(!1),this.pierce=0,this.enemiesDamaged.clear()}onEnemyCollision(e){this.pierce>=this.stats.attack.projectile.pierce||e instanceof la&&this.onDamage(e)}update(e,t){this.pierce>=this.stats.attack.projectile.pierce?this.setVisible(!1):"sword"===this.stats.key&&(this.updateHitbox(),this.checkHitbox())}checkHitbox(){const{height:e,left:t,top:s,width:i}=this.getBounds(),n=this.scene.physics.overlapRect(t,s,i,e);for(const r of n)this.onEnemyCollision(r.gameObject)}damage(e,t){if(!(e instanceof la))return;if(!1===e.body?.enable)return;if(this.enemiesDamaged.has(e))return;if(this.enemiesDamaged.size>=t.pierce)return;const s=(e=>Math.trunc(10*e)/10)(t.damage*this.player.stats.attack);e.dealDamage(s),this.enemiesDamaged.add(e),this.pierce++}onDamage(e){throw new Error("unimplemented")}toggleVisibility(e){this.created=e,this.setActive(e),this.setVisible(e),this.body instanceof Phaser.Physics.Arcade.Body&&(e||this.body.setVelocity(0,0),this.body.debugShowBody=e)}updateHitbox(){this.size??=Math.min(this.width,this.height),this.hitbox??=this.scene.physics.add.body(this.x,this.y,this.size,this.size);const e=Math.cos(this.rotation)*(this.width/2),t=Math.sin(this.rotation)*(this.width/2);this.hitbox.x=this.x+e-this.hitbox.width/2,this.hitbox.y=this.y+t-this.hitbox.height/2}}const Zr={...Nr,damage:8,delay:250,fired:0,knockback:1/8,lifetime:2e6/1920,offsetAngle:0,pierce:1,range:{angular:Math.PI/128,linear:1e3},speed:{angular:0,linear:2880},total:1},Wr={...jr,delta:0,deviation:0,projectile:structuredClone(Zr)},Kr={animation:void 0,attack:structuredClone(Wr),key:"arrow",name:"bow",sprite:"arrow"},Xr={animation:void 0,attack:Fr(Wr,{cooldown:Wr.cooldown/5,deviation:Phaser.Math.PI2/32,projectile:{bodyRadius:5,damage:1,delay:0,knockback:.075,pierce:1,range:{linear:750},speed:{angular:360,linear:1920},total:1}}),key:"needler",name:"shuriken",sprite:"ninja-star"},Hr={animation:void 0,attack:Fr(Wr,{cooldown:3*Wr.cooldown,projectile:{bodyRadius:5,damage:Zr.damage/4,delay:100,knockback:2*Zr.knockback,multi:{count:7,spread:Phaser.Math.PI2/64},pierce:1,speed:{linear:Zr.speed.linear*(2/3)},total:2}}),key:"shotgun",name:"shotgun",sprite:"shotgun"};class Lr extends Ur{#f=!1;create(e,t){if(this.created)return this;if(!this.body)throw new Error("arrow needs body");this.toggleVisibility(!0);const s=e.angles.actual;this.setRotation(s).setScale(br);const i=this.stats.attack.projectile.speed.angular*t;this.setAngularVelocity(i),this.scene.time.addEvent({callback:()=>{!1!==this.created&&this.hide()},callbackScope:this,delay:this.lifetime,loop:!1}),this.initialize();const n=Math.cos(s),r=Math.sin(s),a=this.width-this.stats.attack.projectile.bodyRadius,o=.5*this.width,h=.5*this.height;this.body.setOffset(o-n*a*.5-this.stats.attack.projectile.bodyRadius,h-r*a*.5-this.stats.attack.projectile.bodyRadius);const c=n*this.stats.attack.projectile.speed.linear,l=r*this.stats.attack.projectile.speed.linear;return this.setVelocity(c,l),this.setPosition(e.x,e.y),this}checkHitbox(){}onDamage(e){if(!this.body)throw new Error;if(!e.body)throw new Error("enemy needs body");this.damage(e,this.stats.attack.projectile);const t=this.body.velocity.clone().scale(this.stats.attack.projectile.knockback);e.speedCurr-=t.length(),e.body.velocity.add(t)}initialize(){if(!this.#f){if(!this.body)throw new Error("arrow needs body");this.body.setCircle(this.stats.attack.projectile.bodyRadius),this.#f=!0}}}const qr={animation:{key:"fireball-travel",sprite:"fireball"},attack:{cooldown:3500,delta:0,deviation:0,projectile:{...Nr,damage:0,fired:0,pierce:1,range:{angular:Math.PI/128,linear:2e3},speed:{angular:0,linear:480}},splash:{damage:12,pierce:Number.POSITIVE_INFINITY,size:192*br}},key:"fireball",name:"fireball",sprite:"fireball"};class Yr extends Ur{static BODY_RADIUS=10;#f=!1;#k;get splash(){return this.#k||(this.#k??=this.scene.add.circle(0,0,this.stats.attack.splash.size).setOrigin(.5).setFillStyle(16711680,.5),this.scene.layers.game.add(this.#k)),this.#k}create(e,t){if(this.created)return this;if(!this.body)throw new Error("arrow needs body");this.toggleVisibility(!0);const s=e.angles.actual;this.setRotation(s).setScale(br),this.scene.time.addEvent({callback:()=>{!1!==this.created&&this.hide()},callbackScope:this,delay:this.lifetime,loop:!1});const i=Math.cos(s),n=Math.sin(s),r=44-Yr.BODY_RADIUS,a=.5*this.width,o=.5*this.height;this.initialize(),this.body.setOffset(a+i*r*.5-Yr.BODY_RADIUS,o+n*r*.5-Yr.BODY_RADIUS);const h=i*this.stats.attack.projectile.speed.linear,c=n*this.stats.attack.projectile.speed.linear;return this.setVelocity(h,c),this.setPosition(e.x,e.y),this}checkHitbox(){}onDamage(e){if(!this.body)throw new Error;if(!e.body)throw new Error("enemy needs body");const t=this.scene.physics.overlapCirc(this.body.x,this.body.y,this.stats.attack.splash.size,!0,!1);this.splash.setVisible(!0).setPosition(this.body.x,this.body.y);for(let i=1;i<=10;i++)this.scene.time.delayedCall(100*i,()=>{this.splash?.setAlpha(1-i/10)});this.scene.time.delayedCall(1e3,()=>{this.splash?.setVisible(!1)}),t.forEach(e=>{this.damage(e.gameObject,this.stats.attack.splash)});const s=this.body.velocity.clone().scale(this.stats.attack.projectile.knockback);e.updated.move>0&&(e.updated.move=0),e.body.velocity.add(s)}initialize(){if(!this.#f){if(!this.body)throw new Error("arrow needs body");this.body.setCircle(Yr.BODY_RADIUS),this.#f=!0}}}const Qr={animation:void 0,attack:{...jr,cooldown:2500,delta:0,deviation:0,projectile:{...Nr,damage:10,delay:500,fired:0,knockback:.25,offsetAngle:800*Phaser.Math.DEG_TO_RAD*.15/2,pierce:Number.POSITIVE_INFINITY,range:{angular:2/3*Math.PI,linear:200},speed:{angular:800,linear:3840},total:1}},key:"sword",name:"sword",sprite:"sword"};class Jr extends Ur{create(e,t){if(this.created)return this;this.x=e.x,this.y=e.y,this.setRotation(e.angles.actual).setScale(br),this.setOrigin(-.5,.5),this.setPosition(this.x-this.player.x,this.y-this.player.y),this.player.add(this),this.setVelocityX(0),this.setVelocityY(0),this.body instanceof Phaser.Physics.Arcade.Body&&(this.body.maxAngular=2160);const s=this.stats.attack.projectile.speed.angular*t,i=s*(this.lifetime/1e3),n=Phaser.Math.DEG_TO_RAD*(i/2);return this.setRotation(this.rotation-n),this.setAngularVelocity(s),this.scene.time.addEvent({callback:()=>{this.hide()},delay:this.lifetime}),this.toggleVisibility(!0),this}onDamage(e){this.damage(e,this.stats.attack.projectile)}}class ea extends Phaser.Physics.Arcade.Group{scene;player;constructor(e,t){super(e.physics.world,e),this.scene=e,this.player=t,this.runChildUpdate=!0}spawn(e,t){for(let s=0;s<t.attack.projectile.multi.count;s++){const i=structuredClone(e);s%2==0?i.angles.actual+=s*t.attack.projectile.multi.spread/2:i.angles.actual-=(s+1)*t.attack.projectile.multi.spread/2,this.getProjectile(i,t)}}getDead(){const e=this.getFirstDead(!1);return e instanceof Ur?e:null}getProjectile(e,t){let s=t.attack.projectile.fired%2==0?-1:1;"arrow"===t.key&&(s=0);let i=this.getDead();if(null===i){if(this.children.size>100)throw new Error("attack speed too high");switch(t.key){case"sword":i=new Jr(this.scene,t,this.player);break;case"arrow":case"needler":case"shotgun":i=new Lr(this.scene,t,this.player);break;case"fireball":i=new Yr(this.scene,t,this.player)}}return this.add(i),i.create(e,s),i}}class ta{stats;defaultStats;constructor(e){switch(e){case"needler":this.defaultStats=Xr,this.stats=structuredClone(Xr);break;case"arrow":this.defaultStats=Kr,this.stats=structuredClone(Kr);break;case"shotgun":this.defaultStats=Hr,this.stats=structuredClone(Hr);break;case"sword":this.defaultStats=Qr,this.stats=structuredClone(Qr);break;case"fireball":this.defaultStats=qr,this.stats=structuredClone(qr)}}levelUp(e){this.stats.attack.projectile.offsetAngle=this.defaultStats.attack.projectile.offsetAngle/e.accuracy,this.stats.attack.projectile.delay=this.defaultStats.attack.projectile.delay/e.attackspeed,this.stats.attack.cooldown=this.defaultStats.attack.cooldown/e.attackspeed}}class sa extends ta{scene;arc;cone;player;projectiles;constructor(e,t,s){super(t),this.scene=e,this.projectiles=new ea(e,s),this.player=s,e.physics.add.overlap(this.projectiles,e.enemies,(e,t)=>{t instanceof la&&e instanceof Ur&&e.onEnemyCollision(t)}),this.cone=this.scene.add.graphics({fillStyle:{alpha:.05,color:0},lineStyle:{alpha:.1,color:16711935,width:4}}),this.arc=this.scene.add.graphics({fillStyle:{alpha:0,color:0},lineStyle:{alpha:.5,color:16777215,width:4}})}cooldown({targetX:e,targetY:t}){if(this.arc.clear(),!this.player.inputProvider.aiming)return;const{attack:s}=this.stats,i=s.cooldown,n=1-Math.min(s.delta/i,1),r=2*Math.PI*n;this.arc.arc(e,t,50,0,r,!1).strokePath().fillPath()}update(e,t){this.projectiles.preUpdate(e,t);const{attack:s}=this.stats,{projectile:i}=s;s.delta+=t;const n=i.fired%2==0?-1:1;let r;s.delta>=s.cooldown+i.delay*i.fired&&(r=this.position(n*this.stats.attack.projectile.offsetAngle,e),this.attack(r),i.fired++,i.fired>=i.total&&(s.delta=0,i.fired=0)),this.player.inputProvider.aiming?(r??=this.position(n*this.stats.attack.projectile.offsetAngle,e),this.aim(r),this.cooldown(r)):(this.cone.clear(),this.arc.clear())}aim({angles:{target:e}}){if(this.cone.clear(),!this.player.inputProvider.aiming)return;const{angular:t,linear:s}=this.stats.attack.projectile.range;this.cone.beginPath(),this.cone.arc(this.player.x,this.player.y,s,e-t/2,e+t/2,!1).strokePath().lineTo(this.player.x,this.player.y).fillPath()}attack(e){this.projectiles.spawn(e,this.stats)}position(e,t){const{angle:s,x:i,y:n}=this.player.target(t),r=e+s,a=Math.random()*this.stats.attack.deviation*2-this.stats.attack.deviation,o=s+a,h=Math.cos(o),c=Math.sin(o);return{angles:{actual:o,deviation:a,offset:r,target:s},targetX:i,targetY:n,vx:h*this.stats.attack.projectile.speed.linear,vy:c*this.stats.attack.projectile.speed.linear,x:this.player.x+40*h,y:this.player.y+40*c}}}class ia{buildingKey;isBuilding=!1;upgradeBuilding;direction={x:1,y:0};distance=128;placement;player;scene;x=0;y=0;constructor(e,t){this.player=e,this.scene=t}construct(){if(this.scene instanceof Dr&&this.placement&&this.upgradeBuilding&&this.isBuilding&&this.player.visible){if(this.scene.physics.collide(this.placement,this.scene.buildings))return;this.scene.upgradeBuilding[this.upgradeBuilding.upgrade]=this.upgradeBuilding,this.upgradeBuilding.setEditing(!1),this.upgradeBuilding=void 0,this.placement.destroy(),this.placement=void 0,this.isBuilding=!1}}edit(){if(!this.player.visible)return;if(!this.isBuilding)return;if(!(this.scene instanceof Dr))return;if(!this.buildingKey&&this.scene.constructables.size>0&&!this.upgradeBuilding&&(this.buildingKey=this.scene.constructables.entries().next().value?.[0],!this.buildingKey))throw new Error;if(!this.buildingKey)return;if(this.upgradeBuilding||(this.upgradeBuilding=this.scene.upgradeBuilding[this.buildingKey],this.upgradeBuilding??=new Or(this.scene,{x:this.x,y:this.y},this.buildingKey),this.upgradeBuilding.setEditing(!0)),!this.placement){console.log("placement");let e="barracks";"agility"!==this.buildingKey&&"speed"!==this.buildingKey||(e="archery"),"endurance"!==this.buildingKey&&"charisma"!==this.buildingKey||(e="monastery"),this.placement=this.scene.physics.add.image(0,0,e).setAlpha(1),this.scene.layers.ui.add(this.placement),Or.setBounds(this.placement,this.placement.body,64)}let e=this.player.x+this.direction.x*this.distance,t=this.player.y+this.direction.y*this.distance;e=64*Math.round(e/64),t=64*Math.round(t/64),e===this.x&&t===this.y||(this.x=e,this.y=t,this.upgradeBuilding.setPosition(this.x,this.y),this.placement.setPosition(this.x,this.y)),this.scene.physics.overlap(this.placement,this.scene.buildings)?this.placement.setTint(16711680):this.placement.clearTint()}update(e,t){if(this.player.visible){if(!(this.player.body instanceof Phaser.Physics.Arcade.Body))throw new Error("player needs a body");0===this.player.body.velocity.x&&0===this.player.body.velocity.y||(this.direction=this.player.body.velocity.clone().normalize()),this.edit()}}}class na{constructor(e){this.player=e,this.player.scene.time.addEvent({callback:()=>{this.#_?.clear(),this.#P?.setVisible(!1),this.player.inputProvider.removeAllInteract();for(const e of this.items)e.onFocus("none")},delay:100,loop:!0})}items=new Set;#_;get lootMenu(){return void 0===this.#_&&(this.#_=this.player.scene.add.graphics(),this.player.scene.layers.ui.add(this.#_)),this.#_}#P;get lootText(){return void 0===this.#P&&(this.#P=this.player.scene.add.text(0,0,"",Ia).setOrigin(.5),this.player.scene.layers.ui.add(this.#P)),this.#P}clear(){this.lootMenu.clear(),this.lootText.setVisible(!1)}link(e,t=1){this.lootMenu.clear(),e.siblings&&e.siblings.forEach(e=>{this.lootMenu.lineStyle(5,16711680);const t=e.getBounds();this.lootMenu.lineBetween(t.centerX-24,t.centerY-24,t.centerX+24,t.centerY+24),this.lootMenu.lineBetween(t.centerX+24,t.centerY-24,t.centerX-24,t.centerY+24),e.siblings&&e.siblings.forEach(t=>{this.lootMenu.lineStyle(5,0,.25),this.lootMenu.lineBetween(e.x,e.y,t.x,t.y)}),e.onFocus("sibling"),this.items.add(e)}),this.#_?.stroke();const s=200;this.lootMenu.fillStyle(0,t),this.lootMenu.lineStyle(5,16777215),this.lootMenu.fillRect(e.x-175,e.y-s-100,350,s),this.lootMenu.strokeRect(e.x-175,e.y-s-100,350,s),this.lootText.setPosition(e.x,e.y-s),this.lootText.setVisible(!0),e.onFocus("this"),this.items.add(e)}set text(e){this.lootText.text=e}}let ra=class extends Phaser.Physics.Arcade.Sprite{constructor(e,t,s,i){super(e,t,s,i,0),this.scene=e,this.scene.add.existing(this),this.scene.layers.player.add(this),this.setOrigin(.5)}};class aa extends Phaser.GameObjects.Container{constructor(e,t,s,i){super(e,192*i*br,192*i*br),this.textureKey=t,this.scene=e,this.config=s,this.scene instanceof xa&&this.add(this.reticle),this.add(this.player),this.player.setScale(br),this.num=i,this.graphics=this.scene.add.graphics(),this.graphics.lineStyle(2,16711680,1),this.add(this.graphics),this.scene instanceof Dr&&(this.buildManager=new ia(this,this.scene)),this.refreshUpgrades(),this.scene.physics.add.existing(this),this.scene.layers.player.add(this)}static DEFAULT_STATS={accuracy:1,attack:1,attackspeed:1,critChance:0,critDamage:0,health:30,range:1,regen:0,speed:1};static IFRAME_DURATION=500;active_weapon=void 0;activeWeapons=structuredClone(An);alive=!0;buildManager;damagedAt=0;dashCooldown=5e3;dashing=!1;health=aa.DEFAULT_STATS.health;hitbox={enemy:void 0,loot:void 0,magnet:void 0};hitboxSizes={loot:{height:32*br,width:32*br},magnet:{height:128*br,width:128*br}};#S=0-aa.IFRAME_DURATION;iframe=!1;#f=!1;inventory={plants:[],startGems:0,voidGems:0};level=0;num;scene;stats={...aa.DEFAULT_STATS};#M=new Map;#z;weapons=new Map;xp={curr:0,max:5};config;dashStart=-5e3;graphics;lastHpUpdate=0;#I;get hpbar(){if(!(this.scene instanceof xa))return null;if(!1===this.visible)return null;if(!this.#I){const e=26,t=52,s=this.scene.scale.width/3.5-e,i=0===this.num?0:130-this.scene.scale.height,n={color:16711680,height:t,percision:1,text:!1,width:s,x:(0===this.num?0:this.scene.scale.width-s-2*e)+e,y:i+this.scene.scale.height-2*e-t};this.#I=new Br(this,n)}return this.#I}#i;get inputProvider(){return this.#i??=new Sn(this.scene,this,this.config),this.#i}#T=null;get interceptionPoint(){return this.#T}_inventoryUI;get inventoryUI(){return this.scene instanceof xa?(this._inventoryUI??=this.scene.add.container(),this._inventoryUI):null}#_;get lootMenu(){return this.#_??=new na(this),this.#_}#E;get player(){return this.#E??=new ra(this.scene,0,0,"blue_warrior_idle"),this.#E}#A;get reticle(){return this.#A||(this.#A=this.scene.add.sprite(0,0,"reticle").setOrigin(.5),this.scene.layers.game.add(this.#A)),this.#A.setVisible(this.activeWeapons.length>0),this.#A}_spawnCurves;get spawnCurves(){return this._spawnCurves??=[new Phaser.Curves.Ellipse(0,0,this.scene.scale.height/2,this.scene.scale.height/2),new Phaser.Curves.Ellipse(0,0,this.scene.scale.height/2+200,this.scene.scale.height/2+200),new Phaser.Curves.Ellipse(0,0,this.scene.scale.height/2+400,this.scene.scale.height/2+400)],this._spawnCurves}_curve;get curve(){return this._curve??=new Phaser.Curves.Ellipse(0,20,50,20),this._curve}#C;get dashbar(){if(!1===this.visible)return null;if(!this.#C){const{height:e,width:t}=this.getBounds(),s={attached:!0,color:16777215,height:t/32,text:!1,width:t/4,x:-t/8,y:e/4};this.#C=new Br(this,s)}return this.#C}#O;get inventoryVoidGems(){if(0===this.inventory.voidGems)return null;const e=0===this.num?200:-this.scene.scale.height-200,t=0===this.num?48:this.scene.scale.width-48;return this.#O||(this.#O={sprite:this.scene.add.sprite(t+0,e,"static-void-gem").setScale(.5).setOrigin(.5).setScrollFactor(0),text:this.scene.add.text(t+48,e,this.inventory.voidGems.toString(),Ia).setOrigin(.5).setScrollFactor(0)},this.scene.layers.ui.add(this.#O.sprite),this.scene.layers.ui.add(this.#O.text)),this.#O}#D;get xpbar(){if(!(this.scene instanceof xa))return null;if(!1===this.visible)return null;const e=0===this.num?0:130-this.scene.scale.height;if(!this.#D){const t=52,s=26,i=26,n=t,r=e+this.scene.scale.height-s-i,a={color:16777215,height:i,percision:0,text:!1,width:this.scene.scale.width-2*t,x:n,y:r};this.#D=new Br(this,a)}return this.#D}applyDamage(e,t){this.onDamaged(e,t)}destroy(e){this.#i?.destroy(),this.#i=void 0,this.#E?.destroy(e),this.#A?.destroy(e),this.#A=void 0,this.#E=void 0,this.hitbox.enemy?.destroy(),this.hitbox.enemy=void 0,this.hitbox.loot?.destroy(),this.hitbox.loot=void 0,this.hitbox.magnet?.destroy(),this.hitbox.magnet=void 0,this.#f=!1,super.destroy(e)}die(){this.scene.config.save({lastPlayed:Date.now()});let e=0;e+=this.scene.player2.onDeath(),e+=this.scene.player2.onDeath(),this.scene.config.saveInventory(`p${this.num}`,{player:{...this.inventory,voidGems:this.inventory.voidGems+e}}),this.scene.switch(en)}enable(){1===this.num&&this.scene.config.save({p2:!0})}getBounds(e){return this.player.getBounds(e)}getDamageText(){if(!(this.scene instanceof xa))throw new Error("shouldn't be getting called");const e=this.scene.damageText.getFirstDead(!0,this.x,this.y-40);if(!(e instanceof Phaser.GameObjects.Text))throw new Error("shouldn't be getting called");return e}getInterceptionVector(e,t){if(t<0)throw new Error("this breaks all of physics");const s={x:this.x,y:this.y};if(e<60)return s;const i=Math.min(4,Math.trunc(e/60)-1),n=this.getTargetCurve(60*i).getPointAt(t);return s.x+=n.x,s.y+=n.y,s}getTargetCurve(e){this.#z||(this.#z=this.scene.add.graphics().lineStyle(1,16711680),this.add(this.#z));let t=this.#M.get(e);return t||(t=new Phaser.Curves.Ellipse(0,0,e,e),this.#M.set(e,t)),this.scene.debugging&&t.draw(this.#z),t}initialize(){this.#f||!1!==this.visible&&(this.scene instanceof xa&&0===this.activeWeapons.length&&this.scene.lootManager.spawn({x:this.x,y:this.y-128},[{data:{subtype:Vr,type:Ta.Weapon},owner:this}]),this.#f=!0)}levelUp(){if(this.xp.curr>=this.xp.max&&(this.xp.curr=this.xp.curr%this.xp.max,this.xp.max=this.xp.max+5,this.level+=1,this.scene instanceof xa))if(3===this.level||7===this.level){const e=structuredClone(Vr);this.scene.lootManager.spawn({x:this.x+128,y:this.y-128},[{data:{subtype:e.filter(e=>!this.activeWeapons.includes(e)).sort(()=>Math.random()-.5).slice(0,3),type:Ta.Weapon},owner:this}])}else this.scene.lootManager.spawn({x:this.x,y:this.y-200},[{data:{subtype:void 0,type:Ta.StatDrop},owner:this}])}onDamaged(e,t){if(!(this.scene instanceof xa))return;const s=this.getDamageText();s.text=t.toString(),s.style.setColor(za.red).setFontSize(Ma.LG),this.health-=t,this.#S=e,this.flickerSprite(this.player,aa.IFRAME_DURATION/2)}onDeath(){return this.alive&&(this.alive=!1),this.inventory.voidGems-this.inventory.startGems}refreshUpgrades(){const{inventory:e,upgrades:t}=this.scene.config.load();this.inventory={...e.player,startGems:e.player.voidGems},this.stats={...aa.DEFAULT_STATS};for(const s of Oi)wr(this,s,t[s].level);this.health=this.stats.health,this.refreshWeapons()}refreshWeapons(){for(const[,e]of this.weapons)e.levelUp(this.stats)}setVisible(e){return super.setVisible(e)}setZoom(e){this.hpbar?.setZoom(e),this.xpbar?.setZoom(e)}target(e){const t=this.inputProvider.target(this);this.scene.debugging&&this.curve.draw(this.graphics,64);const{x:s,y:i}=this.curve.getPoint(t.angle/(2*Math.PI));return this.reticle.setRotation(t.angle).setPosition(s,i),t}update(e,t){if(this.buildManager?.update(e,t),this.initialize(),!1===this.visible?this.inputProvider.refresh():this.inputProvider.update(e,t),this.setDepth(this.y),this.updateInterceptionPoint(),this.updateResources(),this.hp(e,t),this.visible&&this.getWeapons().forEach(s=>{s.update(e,t)}),!(this.body instanceof Phaser.Physics.Arcade.Body))return;const[s,i]=this.inputProvider.position();this.physics(),this.inputProvider.dashing&&(this.inputProvider.dashing=!1,this.dashStart+this.dashCooldown<e&&(0!==s||0!==i)&&(this.dashStart=e)),this.dashbar?.update(e-this.dashStart,this.dashCooldown),this.dashing=this.dashStart+200>e,this.iframe=this.#S+aa.IFRAME_DURATION>e,this.dashing&&!this.body.checkCollision.none&&(this.#S=e,this.iframe=!0);let n=240*this.stats.speed;this.dashing&&(n*=5),s<0?this.player.flipX=!0:s>0&&(this.player.flipX=!1);let r="blue_warrior_idle";r=0===s&&0===i?`${this.textureKey}_${"arrow"===this.activeWeapons[0]?"archer":"warrior"}_idle`:`${this.textureKey}_${"arrow"===this.activeWeapons[0]?"archer":"warrior"}_run`,this.player.anims.getName().includes("attack")&&this.player.anims.isPlaying||this.player.anims.getName()===r||(this.player.setTexture(r),this.player.play(r,!0));const a=n*s,o=n*i;this.body instanceof Phaser.Physics.Arcade.Body&&this.body.setVelocity(a,o)}updateInventory(e){const t=0===this.num?-150:150-this.scene.scale.height,s=0===this.num?40:this.scene.scale.width-40,i=0===this.num?-1:1,n=0===this.num?1:-1,r=this.scene.add.sprite(s+40*n*(this.inventory.plants.length%30),t+this.scene.scale.height+40*i*Math.floor(this.inventory.plants.length/30),"crops",e).setScale(3).setScrollFactor(0);this.inventoryUI?.add(r),this.inventory.plants.push(e),this.scene.config.save({lastPlayed:Date.now()})}updateResources(){this.inventoryVoidGems&&(this.inventoryVoidGems.text.text=this.inventory.voidGems.toString()),this.scene instanceof xa&&(this.levelUp(),this.xpbar?.update(this.xp.curr,this.xp.max),this.hpbar?.update(this.health,this.stats.health),this.health<=0&&this.die())}flickerSprite(e,t){let s=0;const i=this.scene.time.addEvent({callback:()=>{e.visible=!e.visible,e.tint=16711680,s+=50,s>=t&&(e.visible=!0,e.tint=16777215,i.remove())},callbackScope:this,delay:50,loop:!0})}getWeapons(){return 0===this.activeWeapons.length?[]:this.scene instanceof xa?this.activeWeapons.map(e=>{if(!(this.scene instanceof xa))throw new Error;let t=this.weapons.get(e);return t||(t=new sa(this.scene,e,this),this.weapons.set(e,t)),t.levelUp(this.stats),t}):[]}hp(e,t){this.health<this.stats.health?this.health+=this.stats.regen*(t/1e3):(this.lastHpUpdate+=t,this.lastHpUpdate>1e3&&this.health<this.stats.health&&(this.health+=this.stats.regen,this.lastHpUpdate=0))}physics(){if(!(this.body instanceof Phaser.Physics.Arcade.Body))throw new Error;if(this.body.enable!==this.visible&&(this.body.enable=this.visible),!1!==this.body.enable&&(void 0===this.hitbox.loot&&(this.body.setCircle(32).setOffset(-32,0),this.hitbox.loot=this.scene.physics.add.body(0,0).setCircle(this.hitboxSizes.loot.width/2),this.scene instanceof xa&&this.scene.physics.add.overlap(this.hitbox.loot,this.scene.drops,(e,t)=>{!1!==this.visible&&t instanceof Rr&&t.handleCollision(this)}).setName(`p${this.num}DropsOverlap`)),this.hitbox.loot.x=this.x-this.hitbox.loot.width/2,this.hitbox.loot.y=this.y-this.hitbox.loot.height/2+32,this.scene instanceof xa)){if(void 0===this.hitbox.magnet){const e=this.scene.physics.add.body(0,0).setCircle(this.hitboxSizes.magnet.width);this.hitbox.magnet=e,this.scene.physics.add.overlap(e,this.scene.drops,(e,t)=>{!1!==this.visible&&t instanceof Rr&&this.hitbox.loot&&t.moveTo(this.hitbox.loot)}).setName(`p${this.num}MagnetOverlap`)}this.hitbox.magnet.x=this.x-this.hitbox.magnet.width/2,this.hitbox.magnet.y=this.y-this.hitbox.magnet.height/2+32}}updateInterceptionPoint(){if(!this.body)return;if(0===this.body.velocity.x&&0===this.body.velocity.y)return void(this.#T=null);const e=Math.atan2(this.body.velocity.y,this.body.velocity.x);this.#T=(e/(2*Math.PI)+1)%1}}const oa=[{chance:.73375,chanceLoot:0,dmg:1,glow:16777215,health:1,prefxPadding:16,rarity:"common",required:5,size:1},{chance:.195,chanceLoot:.25,dmg:1.2,glow:2031360,health:1.2,prefxPadding:16,rarity:"uncommon",required:10,size:1.5},{chance:.0525,chanceLoot:.5,dmg:1.5,glow:28927,health:1.5,prefxPadding:16,rarity:"rare",required:25,size:1.8},{chance:.014,chanceLoot:.75,dmg:2,glow:10696174,health:2,prefxPadding:16,rarity:"epic",required:100,size:1.8},{chance:.00375,chanceLoot:1,dmg:3,glow:16744448,health:3,prefxPadding:16,rarity:"legendary",required:500,size:2},{chance:.001,chanceLoot:1,dmg:5,glow:16711680,health:5,prefxPadding:16,rarity:"mythic",required:1e3,size:2.5}];let ha=0;const ca=new Set(["common","uncommon","rare","epic","legendary"]);for(const Fa of oa){ca.delete(Fa.rarity);const e=Math.round(1e5*(ha+Fa.chance))/1e5;Fa.rand=[ha,e],ha=e}if(1!==ha)throw new Error(`sum ${ha} is incorrect`);if(0!==ca.size)throw new Error("missing rarity");"function"!=typeof crypto.randomUUID&&(crypto.randomUUID=()=>`${"xxxxxxxx".replace(/[xy]/g,e=>{const t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)})}-${"xxxx".replace(/[xy]/g,e=>{const t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)})}-${"4xxx".replace(/[xy]/g,e=>{const t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)})}-${"yxxx".replace(/[xy]/g,e=>{const t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)})}-${"xxxxxxxxxxxx".replace(/[xy]/g,e=>{const t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)})}`);class la extends Phaser.GameObjects.Container{constructor(e,t,s){if(super(e,0,0),this.scene=e,this.info=t,this.sprite=this.scene.add.sprite(0,0,t.TEXTURE_KEY).setOrigin(.5),this.manager=s.manager,this.add(this.sprite),this.add(this.sprite),!this.scene.textures.exists("pixel")){const e=this.scene.make.graphics({x:0,y:0});e.fillStyle(16777215),e.fillRect(0,0,1,1),e.generateTexture("pixel",1,1)}this.hp=this.scene.add.sprite(0,0,"pixel"),this.hp.setOrigin(0),this.hp.setTint(16711680),this.add(this.hp),this.health={curr:t.stats.health,max:t.stats.health,prev:t.stats.health},this.dmg={max:this.info.stats.damage,min:this.info.stats.damage},this.scene.layers.game.add(this),this.rarities=[{...oa[0]}],this.rarity=oa[0],this.scene.enemies.add(this)}static ACCELERATION_FREQ=200;static HEALTH_HEIGHT=10;static HEALTH_WIDTH=64;static SEEK_FREQ=2500;applyDamage=null;body=null;dmg={max:0,min:0};health={curr:0,max:0,prev:0};healthBar=null;id=crypto.randomUUID().slice(-4);#R=Math.random();speed=0;speedCurr=0;target=null;updated={move:la.ACCELERATION_FREQ,seek:la.SEEK_FREQ};glow={common:void 0,epic:void 0,legendary:void 0,mythic:void 0,rare:void 0,uncommon:void 0};hp;lastDmgTime=0;manager;moveModifier=.8+.2*Math.random();rarities;rarity;sprite;damage(e){if(!this.scene.debugging&&this.applyDamage){if(this.lastDmgTime<e-this.info.stats.attackSpeed){this.lastDmgTime=e;const t=this.scene[this.applyDamage],s=a(t.health,t.stats.health),i=Math.trunc(this.dmg.min*s);t.applyDamage(e,i)}this.applyDamage=null}}dealDamage(e){this.health.curr-=e,this.scene.showDamage(this.x,this.y-40,e),this.healthbar()}die(){this.toggle(!1),this.hp.setVisible(!1);const e=this.rarity.chance*this.info.loot.xp,t=(this.rarity.chance,this.rarity.chanceLoot,Math.random()),s=[];t<this.info.loot.loot&&s.push({data:{subtype:void 0,type:Ta.StatDrop},owner:1===this.info.loot.loot?this.manager.player:void 0}),t<this.info.loot.void&&s.push({data:{subtype:void 0,type:Ta.VoidDrop},owner:void 0});let i=1;this.target&&(i=1/a(this.target.health,this.target.stats.health)),t<this.info.loot.health*i&&s.push({data:{subtype:void 0,type:Ta.Health},owner:void 0}),t<e&&s.push({data:{subtype:this.info.xp,type:Ta.XP},owner:void 0}),this.id,this.info.loot.void,this.scene.lootManager.spawn(this,s)}findPlayer(e,t){this.updated.seek<la.SEEK_FREQ?this.updated.seek+=t:(this.updated.seek=0,this.scene.player2.visible?this.scene.player1.body instanceof Phaser.Physics.Arcade.Body&&this.scene.player2.body instanceof Phaser.Physics.Arcade.Body&&(this.scene.physics.closest(this,[this.scene.player1.body,this.scene.player2.body])===this.scene.player2.body?this.target=this.scene.player2:this.target=this.scene.player1):this.target=this.scene.player1)}move(e,t){if(!this.body)throw new Error("need a body to move");if(this.updated.move+t<la.ACCELERATION_FREQ)return void(this.updated.move+=t);if(this.updated.move=0,this.findPlayer(e,t),!this.target)return;const s=Phaser.Math.Distance.Squared(this.x,this.y,this.target.x,this.target.y);if(s<this.info.stats.range*this.info.stats.range)return;const i=Math.sqrt(s),n=5*this.health.max/(this.health.curr+4*this.health.max);this.speed=Math.min(this.speed*n,this.info.stats.moveSpeed.max),this.speedCurr=Math.min(this.speedCurr+this.speed*t*.2,this.speed);const r=this.speedCurr*this.moveModifier,a=this.target.getInterceptionVector(i,this.#R);this.scene.physics.moveToObject(this,a,r),this.body instanceof Phaser.Physics.Arcade.Body&&(this.sprite.flipX=this.body.velocity.x<0)}spawn(e,t,s,i=1){this.updateRarityData(),this.#R=s,this.target=e;const n=Math.random(),r=this.rarities.find(e=>void 0!==e.rand&&n>e.rand[0]&&n<e.rand[1])??this.rarities[0];if(!r)throw new Error(`${n}`);for(const[o,h]of Object.entries(this.glow))h&&(o===r.rarity?h.setActive(!0):h.setActive(!1));this.glow[r.rarity]||16777215===r.glow||(this.sprite.preFX?.setPadding(r.prefxPadding),this.glow[r.rarity]=this.sprite.preFX?.addGlow(r.glow));const a=this.info.stats.health*1.02**(i-1)*r.health;this.dmg={max:this.info.stats.damage*r.dmg,min:this.info.stats.damage*r.dmg},this.health.curr=a,this.health.max=a,this.speed=this.info.stats.moveSpeed.start,this.speedCurr=this.info.stats.moveSpeed.start,this.sprite.setScale(r.size*br),this.scene.time.delayedCall(100,()=>{if(!(this.body instanceof Phaser.Physics.Arcade.Body))throw new Error("this makes life hard");{const e=this.sprite.width/3;this.body.setCircle(e/2),this.body.setOffset(-e/2,0),this.body.setBounce(.5),this.hp.setPosition(-e/4,-e)}}),this.setPosition(this.target.x+t.x,this.target.y+t.y),this.toggle(!0)}update(e,t){this.active&&(this.move(e,t),this.damage(e),this.sprite.anims.getName()!==this.info.FRAMES.MOVE.key&&this.sprite.play(this.info.FRAMES.MOVE,!0))}healthbar(){if(this.health.curr<=0)return void this.die();if(this.health.curr>=this.health.max)return void this.hp.setVisible(!1);this.hp.setVisible(!0);const e=this.health.curr/this.health.max;this.hp.setScale(la.HEALTH_WIDTH*e,la.HEALTH_HEIGHT)}toggle(e){this.setActive(e),this.setVisible(e),this.body instanceof Phaser.Physics.Arcade.Body&&(this.body.setVelocity(0,0),this.body.setEnable(e),this.body.debugShowBody=e)}updateRarityData(){const e=this.rarities[this.rarities.length-1];if(!e)throw new Error("");if("mythic"!==e.rarity)if(0===e.required){const e=oa[this.rarities.length];if(!e)throw new Error("");this.rarities.push({...e})}else e.required--}}var da=(e=>(e.squad="squad",e.scatter="scatter",e.surround="surround",e))(da||{});const ua=[{config:{maxSize:200},frameRate:10,FRAMES:{ATTACK:{config:{end:18,start:13},key:"torch-attack"},IDLE:{config:{end:6,start:0},key:"torch-idle"},MOVE:{config:{end:11,start:7},key:"torch-move"}},loot:{health:.05,loot:.005,void:.05,xp:.85},metadata:{lastSpawn:-5e3,max:150,spawn:[{count:[1],rate:1e3,start:60,style:"squad"},{count:[1],rate:1250,start:95,style:"squad"},{count:[24],rate:5e3,start:105,style:"surround"},{count:[1,2],rate:1e3,start:110,style:"squad"},{count:[24],rate:5e3,start:135,style:"surround"},{count:[4],rate:1250,start:140,style:"squad"},{count:[2],rate:1e3,start:150,style:"squad"},{count:[1,2],rate:500,start:180,style:"squad"},{count:[1,2,3],rate:250,start:210,style:"squad"},{count:[2,3,3,4,5,5,6],rate:1e3,start:240,style:"squad"},{count:[2,2,3,3,3],rate:2500,start:210,style:"squad"},{count:[3],rate:1e3,start:300,style:"squad"},{count:[3],rate:750,start:360,style:"squad"},{count:[3],rate:500,start:420,style:"squad"}]},stats:{attackSpeed:400,damage:5,health:20,level:1,moveSpeed:{max:216,min:120,start:180},range:0},TEXTURE_KEY:"torch",xp:1},{config:{maxSize:50},frameRate:10,FRAMES:{ATTACK:{config:{end:18,start:13},key:"barrel-attack"},IDLE:{config:{frames:[0]},key:"barrel-idle"},MOVE:{config:{frames:[6,7,8,9,10,11,12,18,19,20,21,22,23]},key:"barrel-move"}},loot:{health:.05,loot:.01,void:.15,xp:.8},metadata:{lastSpawn:0,max:50,spawn:[{count:[0],rate:Number.POSITIVE_INFINITY,start:30,style:"squad"},{count:[0],rate:Number.POSITIVE_INFINITY,start:60,style:"squad"},{count:[1],rate:2e3,start:150,style:"squad"},{count:[1],rate:1e3,start:180,style:"squad"},{count:[1],rate:500,start:210,style:"squad"},{count:[1],rate:750,start:270,style:"squad"},{count:[1],rate:500,start:300,style:"squad"}]},stats:{attackSpeed:800,damage:30,health:60,level:2,moveSpeed:{max:180,min:120,start:144},range:0},TEXTURE_KEY:"barrel",xp:5},{config:{maxSize:25},frameRate:10,FRAMES:{ATTACK:{config:{end:20,start:14},key:"tnt-attack"},IDLE:{config:{end:5,start:0},key:"tnt-idle"},MOVE:{config:{end:12,start:7},key:"tnt-move"}},loot:{health:.05,loot:.01,void:.15,xp:.8},metadata:{lastSpawn:0,max:50,spawn:[{count:[1],rate:1e3,start:180,style:"squad"},{count:[1],rate:1e3,start:540,style:"squad"},{count:[1],rate:1e3,start:600,style:"squad"},{count:[1],rate:750,start:660,style:"squad"},{count:[1],rate:500,start:720,style:"squad"}]},stats:{attackSpeed:200,damage:15,health:25,level:3,moveSpeed:{max:288,min:240,start:240},range:0},TEXTURE_KEY:"tnt",xp:5}],pa=structuredClone(ua[0]),ga={...pa,loot:{...pa.loot,loot:1,void:0,xp:0},metadata:{...pa.metadata,spawn:[{count:[1],end:5,rate:5e3,start:0,style:"squad"}]}},ma=structuredClone(ua[0]),ya={...ma,loot:{...ma.loot,health:.05,loot:0,void:.2,xp:1/oa[0].chance},metadata:{...ma.metadata,spawn:[{count:[1],rate:2500,end:45,start:5,style:"squad"},{count:[1],rate:1250,end:60,start:45,style:"squad"}]}};for(const Fa of ua){let e={};for(const t of Fa.metadata.spawn)e.end=t.start,e=t}class fa extends Phaser.Physics.Arcade.Group{info;manager;scene;ROW_SIZES=[4,6,8,12];constructor(e,t){super(e.scene.physics.world,e.scene,t.config),this.manager=e,this.info=t,this.scene=e.scene,this.runChildUpdate=!0}#$(){const e=this.getFirstDead(!1);if(e instanceof la)return e;if(this.isFull())return null;const t=new la(this.scene,this.info,this);return this.add(t),t}spawn(e,t,s){let i;i=null!==t.interceptionPoint&&s!==da.scatter?(t.interceptionPoint+.1*Math.random())%1:Math.random();let n,r=1;r=e<8?2:e<12?3:4,s===da.squad?n=Math.PI/256:s===da.surround?(r=e,n=Phaser.Math.PI2/e):s===da.scatter&&(r=e);let a=t.spawnCurves[0];for(let o=0;o<e;o++){o>=r?a=t.spawnCurves[1]:o>=2*r&&(a=t.spawnCurves[2]);const e=this.#$();if(!e)break;let s;s=void 0!==n?(i+n*(o%r))%1:Math.random();const h=a.getPoint(s);e.spawn(t,h,s)}return this}}class ba{constructor(e,t){this.scene=e,this.player=t,this.groups.set("first",new fa(this,structuredClone(ga))),this.groups.set("second",new fa(this,structuredClone(ya)));for(const s of ua)this.groups.set(s.TEXTURE_KEY,new fa(this,structuredClone(s)));this.elapsed=0}static MAX_SPAWNS=200;#G=[];groups=new Map;elapsed=0;spawn(e,t){const s=this.groups.get(e);s?.spawn(t,this.player)}update(e,t){if(this.elapsed+=t,!this.player.visible||0===this.player.activeWeapons.length)return;const s=Math.floor(this.elapsed/1e3);for(const[i,n]of this.groups){n.preUpdate(e,t);const{info:{metadata:i}}=n,{spawn:r}=i,a=r.find(e=>s>e.start&&void 0!==e.end&&s<e.end);if(a&&i.lastSpawn+a.rate<this.elapsed){const e=Math.min(i.max,ba.MAX_SPAWNS)-n.countActive(),t=Math.trunc(Math.random()*a.count.length),s=a.count[t]??1,r=Math.min(e,s);n.spawn(r,this.player,a.style),i.lastSpawn=this.elapsed}}}performance(){this.#G.push(this.scene.game.loop.actualFps),this.#G.length>60&&this.#G.shift();const e=this.#G.reduce((e,t)=>e+t)/this.#G.length;e<30?(ba.MAX_SPAWNS-=5,console.log("reducing max spawns")):e>55&&(ba.MAX_SPAWNS+=5,console.log("increasing max spawns"))}}var va=Object.defineProperty,wa=Object.getOwnPropertyDescriptor;class xa extends fr{active=!0;enemyManager1;enemyManager2;#f=!1;key=Qi;#B;displayTimeTime=0;constructor(){super({key:Qi,plugins:[...Phaser.Plugins.DefaultPlugins.DefaultScene,Ra.key]})}#F;get damageText(){return this.#F||(this.#F??=this.add.group({active:!0,classType:Phaser.GameObjects.Text,maxSize:200,runChildUpdate:!1})),this.#F}#N;get displayTime(){return this.#N??=this.add.bitmapText(this.scale.width/2,200,"MarcellusSCBitmap","").setFontSize(40).setScrollFactor(0),this.#N}#j;get enemies(){return this.#j||(this.#j=this.physics.add.group().setName("enemiesGroup")),this.#j}get lootManager(){if(!(Aa.mapping in this))throw new Error("this.load.scenePlugin(LootManager.mapping, LootManager) required in preload()");const e=this[Aa.mapping];if(!(e instanceof Aa))throw new Error;return e}create(){console.log("create action"),this.physics.add.collider(this.enemies,this.player1,(e,t)=>{t instanceof la&&(t.applyDamage="player1")},(e,t)=>{if(e instanceof aa&&t instanceof la)return!e.iframe}).setName("p1Collider"),this.physics.add.collider(this.enemies,this.player2,(e,t)=>{t instanceof la&&this.player2.visible&&(t.applyDamage="player2")},(e,t)=>{if(e instanceof aa&&t instanceof la)return!e.iframe}).setName("p2Collider"),this.enemyManager1=new ba(this,this.player1),this.enemyManager2=new ba(this,this.player2),this.events.once(Phaser.Scenes.Events.SHUTDOWN,()=>{console.log("shut down action"),this.shutdown()},this)}init(){console.log("launching action"),super.init()}preload(){console.log("launching action"),this.load.scenePlugin(Aa.mapping,Aa)}showDamage(e,t,s){const i=this.damageText.get(e,t);i instanceof Phaser.GameObjects.Text&&(i.setActive(!0).setVisible(!0),i.setText(s.toString()),i.setStyle(Ia),this.layers.ui.add(i),this.tweens.add({alpha:0,duration:500,onComplete:()=>{i.setActive(!1),i.setVisible(!1),i.setAlpha(1)},targets:i,y:t-50}))}shutdown(){super.shutdown(),this.#j?.destroy(),this.#j=void 0,this.#N?.destroy(),this.#N=void 0,this.#F?.destroy(),this.#F=void 0,this.#f=!1,this.displayTimeTime=0}update(e,t){this.active&&(this.initialize(),this.#B?.body instanceof Phaser.Physics.Arcade.StaticBody&&this.#B.body.setCircle(32,192,0),this.player1.update(e,t),this.player2.update(e,t),0!==this.player1.activeWeapons.length?(this.enemyManager1?.update(e,t),this.player2.visible&&this.enemyManager2?.update(e,t),this.displayTimeTime+=t,this.displayTime.setText(`${Math.round(this.displayTimeTime/1e3)}`)):0===this.drops.countActive(!0)?this.config.save({lastPlayed:Date.now()}):this.config.load().lastPlayed,super.update(e,t))}initialize(){this.#f||(this.#f=!0)}}((e,t,s)=>{for(var i,n=wa(t,s),r=e.length-1;r>=0;r--)(i=e[r])&&(n=i(t,s,n)||n);n&&va(t,s,n)})([h()],xa.prototype,"update");class ka extends Phaser.Scene{constructor(){super({key:Ji,plugins:Phaser.Plugins.DefaultPlugins.DefaultScene})}create(){performance.now();this.createPlayerAnimations(),this.createIncrementalAnimations(),this.createEnemyAnimations(),this.createEffectsAnimations();performance.now();this.scene.stop()}#V(e){if(void 0===e.key)return;const t=this.anims;t.exists(e.key)||t.create(e)}preload(){}createEffectsAnimations(){this.anims.create({frameRate:60,frames:this.anims.generateFrameNumbers("portal-particles",{end:59,start:0}),key:"portal-start",repeat:0}),this.anims.create({frameRate:60,frames:this.anims.generateFrameNumbers("portal-particles",{start:60}),key:"portal-enabled",repeat:-1}),this.anims.create({frameRate:60,frames:this.anims.generateFrameNumbers("portal",{end:0,start:0}),key:"portal",repeat:0}),this.anims.create({frameRate:10,frames:this.anims.generateFrameNumbers("portal2",{end:0,start:5}),key:"portal2",repeat:-1})}createEnemyAnimations(){const e=this.anims;for(const t of un)this.toAnim(t);for(const t of ua)for(const{config:s,key:i}of Object.values(t.FRAMES))e.exists(i)||e.create({frameRate:t.frameRate,frames:e.generateFrameNumbers(t.TEXTURE_KEY,s),key:i,repeat:-1})}createIncrementalAnimations(){this.anims.create({frameRate:8,frames:this.anims.generateFrameNumbers("drone",{frames:[4,5]}),key:"move",repeat:-1}),this.anims.create({frameRate:4,frames:this.anims.generateFrameNumbers("drone",{frames:[0,2]}),key:"idle",repeat:-1}),this.anims.create({frameRate:4,frames:this.anims.generateFrameNumbers("drone",{frames:[1,3]}),key:"idle2",repeat:-1}),this.anims.create({frameRate:8,frames:this.anims.generateFrameNumbers("drone",{frames:[0,2]}),key:"mine",repeat:-1}),this.anims.create({frameRate:8,frames:this.anims.generateFrameNumbers("drone",{frames:[8,9]}),key:"deliver",repeat:-1})}createPlayerAnimations(){const e=this.anims;this.#V({frameRate:10,frames:e.generateFrameNumbers("tree1",{end:7,start:0}),key:"tree1",repeat:0}),this.#V({frameRate:10,frames:e.generateFrameNumbers("blue_archer_idle",{end:5,start:0}),key:"blue_archer_idle",repeat:-1}),this.#V({frameRate:10,frames:e.generateFrameNumbers("blue_archer_run",{end:3,start:0}),key:"blue_archer_run",repeat:-1}),this.#V({frameRate:10,frames:e.generateFrameNumbers("blue_archer_shoot",{end:7,start:0}),key:"blue_archer_attack1",repeat:0}),this.#V({frameRate:10,frames:e.generateFrameNumbers("blue_archer_shoot",{end:7,start:0}),key:"blue_archer_attack2",repeat:0}),this.#V({frameRate:10,frames:e.generateFrameNumbers("blue_warrior_idle",{end:7,start:0}),key:"blue_warrior_idle",repeat:-1}),this.#V({frameRate:10,frames:e.generateFrameNumbers("blue_warrior_run",{end:5,start:0}),key:"blue_warrior_run",repeat:-1}),this.#V({frameRate:10,frames:e.generateFrameNumbers("blue_warrior_attack1",{end:3,start:0}),key:"blue_warrior_attack1",repeat:0}),this.#V({frameRate:10,frames:e.generateFrameNumbers("blue_warrior_attack2",{end:3,start:0}),key:"blue_warrior_attack2",repeat:0}),this.#V({frameRate:10,frames:e.generateFrameNumbers("red_archer_idle",{end:5,start:0}),key:"red_archer_idle",repeat:-1}),this.#V({frameRate:10,frames:e.generateFrameNumbers("red_archer_run",{end:3,start:0}),key:"red_archer_run",repeat:-1}),this.#V({frameRate:10,frames:e.generateFrameNumbers("red_archer_shoot",{end:7,start:0}),key:"red_archer_attack1",repeat:-1}),this.#V({frameRate:10,frames:e.generateFrameNumbers("red_archer_shoot",{end:7,start:0}),key:"red_archer_attack2",repeat:-1}),this.#V({frameRate:10,frames:e.generateFrameNumbers("red_warrior_idle",{end:7,start:0}),key:"red_warrior_idle",repeat:-1}),this.#V({frameRate:10,frames:e.generateFrameNumbers("red_warrior_run",{end:5,start:0}),key:"red_warrior_run",repeat:-1}),this.#V({frameRate:10,frames:e.generateFrameNumbers("red_warrior_attack1",{end:3,start:0}),key:"red_warrior_attack1",repeat:-1}),this.#V({frameRate:10,frames:e.generateFrameNumbers("red_warrior_attack2",{end:3,start:0}),key:"red_warrior_attack2",repeat:-1}),this.#V({frameRate:1,frames:e.generateFrameNumbers("player1",{end:5,start:0}),key:"player1-idle",repeat:-1}),this.#V({frameRate:10,frames:e.generateFrameNumbers("player1",{end:11,start:6}),key:"player1-move",repeat:-1}),this.#V({frameRate:1,frames:e.generateFrameNumbers("player2",{end:5,start:0}),key:"player2-idle",repeat:-1}),this.#V({frameRate:10,frames:e.generateFrameNumbers("player2",{end:11,start:6}),key:"player2-move",repeat:-1})}toAnim({animations:e,key:t}){for(const s of e){const{frameRate:e,repeat:i,yoyo:n}=s;this.anims.create({delay:s.delay??0,frameRate:e,frames:this.anims.generateFrameNumbers(t,s.config),key:`${t}-${s.key}`,repeat:i,repeatDelay:s.repeatDelay??0,yoyo:n})}}}var _a=Object.defineProperty,Pa=Object.getOwnPropertyDescriptor;class Sa extends Phaser.Scene{gameScene;sceneRunning=null;sceneStopped=!0;constructor(){super({key:"Boot",plugins:Phaser.Plugins.DefaultPlugins.DefaultScene})}create(){this.cameras.main.setBackgroundColor("#FFF000"),this.cameras.main.setBackgroundColor("#CDD7E1"),this.launchScene(nn)}preload(){}update(e,t){}launchScene(e,t){this.scene.launch(e,t),this.gameScene=this.scene.get(e)}resize(e){if(!this.sceneStopped){const t=e.width,s=e.height;this.parent.setSize(t,s),this.sizer.setSize(t,s);const i=this.cameras.main,n=this.sizer.width/this.game.screenBaseSize.width,r=this.sizer.height/this.game.screenBaseSize.height;i.setZoom(Math.max(n,r)),i.centerOn(this.game.screenBaseSize.width/2,this.game.screenBaseSize.height/2)}}updateCamera(e){const t=e.cameras.main,s=e.sizer.width/this.game.screenBaseSize.width,i=e.sizer.height/this.game.screenBaseSize.height;t.setZoom(Math.max(s,i)),t.centerOn(this.game.screenBaseSize.width/2,this.game.screenBaseSize.height/2)}updateResize(e){e.scale.on("resize",this.resize,e);const t=e.scale.gameSize.width,s=e.scale.gameSize.height;e.parent=new Phaser.Structs.Size(t,s),e.sizer=new Phaser.Structs.Size(e.width,e.height,Phaser.Structs.Size.FIT,e.parent),e.parent.setSize(t,s),e.sizer.setSize(t,s),this.updateCamera(e)}}((e,t,s)=>{for(var i,n=Pa(t,s),r=e.length-1;r>=0;r--)(i=e[r])&&(n=i(t,s,n)||n);n&&_a(t,s,n)})([h()],Sa.prototype,"update");const Ma={LG:30*br,MD:25*br,SM:20*br},za={black:"#000000",green:"#00ff00",red:"#ff0000",white:"#ffffff"},Ia={align:"center",color:za.white,fontFamily:"MarcellusSC",fontSize:Ma.MD,stroke:za.black,strokeThickness:8};var Ta=(e=>(e.VoidDrop="void-gem",e.StatDrop="stat-drop",e.XP="xp",e.Health="health-drop",e.Weapon="weapon-pickup",e))(Ta||{});class Ea{static memo=new Map;static get(e){e*=2;const t=Ea.getPoints(Ea.getKey(e,e));t.size>e*e/2&&t.clear();let s=Math.trunc(Math.random()*e),i=Math.trunc(Math.random()*e),n=Ea.getKey(s,i);for(;t.has(n);)s=Math.trunc(Math.random()*e),i=Math.trunc(Math.random()*e),n=Ea.getKey(s,i);return t.add(n),{x:30*s,y:30*i}}static getKey(e,t){return`${e},${t}`}static getPoints(e){let t=this.memo.get(e);return t||(t=new Set,this.memo.set(e,t),t)}}class Aa extends Phaser.Plugins.ScenePlugin{static key="LootManager";static mapping="_lootManager";scene;constructor(e,t,s){if(super(e,t,s),!(e instanceof xa)){if("Scene2"===e.constructor.name)throw new Error("what is 'Scene2'");throw new Error}this.scene=e}#U;get healthGroup(){return this.#U??=new $r({handleCollision:(e,t)=>{const s=Math.min(10,e.stats.health-e.health),i=e.getDamageText();i.setColor(za.green).setFontSize(Ma.LG),i.text="+10",e.health+=s,t.destroy()},handleInteraction:void 0,keys:{play:"health-drop-float",sprite:"health-drop"},metadata:{maxSize:100,scale:.5},scene:this.scene}),this.#U}#Z;get lootGemGroup(){return this.#Z||(this.#Z=new $r({handleCollision:(e,t)=>{const s=this.statUpgrade.items.find(s=>!t.owner&&s.owner===e||s.owner===t.owner);if(s){const i=(Phaser.Math.Angle.BetweenPoints(e,s)+Phaser.Math.PI2)%Phaser.Math.PI2/Phaser.Math.PI2,n=e.getTargetCurve(512).getPoint(i).add(e);return void t.setPosition(n.x,n.y)}let i=125,n=Math.sqrt(62500-i**2);i*=2,n/=2;const r=[...Oi].filter(e=>"endurance"!==e).sort(()=>Math.random()-.5).slice(0,3),a=[{x:e.x,y:e.y-n},{x:e.x+i,y:e.y},{x:e.x-i,y:e.y}],o=r.map((e,t)=>{if(!a[t])throw new Error;return{frame:e,type:e,...a[t]}});this.statUpgrade.spawnGroup(o,t.owner).forEach(e=>{e.alpha=.5;let t=16777215,s=16777215;0===e.owner?.num&&(t=255),1===e.owner?.num&&(s=16711680),e.setTint(t,s,16777215,16777215)}),this.scene.physics.overlapCirc(e.x,e.y,384).forEach(t=>{if(!(t instanceof Phaser.Physics.Arcade.Body))return;const s=t.gameObject;if(s instanceof la){const i=8;s.updated.move=-200;const n=Phaser.Math.Angle.BetweenPoints(e,s)+Math.PI,r=new Phaser.Math.Vector2(1);r.setAngle(n);const a=t.velocity.reflect(r).scale(i);t.setVelocity(a.x,a.y)}}),t.destroy()},handleInteraction:()=>{},keys:{play:"",sprite:"stat-drop"},metadata:{maxSize:15,scale:1},scene:this.scene}),this.#Z.getSiblingUsed=()=>this.statUpgrade.size/3),this.#Z}#W;get statUpgrade(){return this.#W??=new $r({handleCollision:(e,t)=>{void 0!==t.owner&&t.owner!==e||(e.lootMenu.link(t),e.lootMenu.text=xr(e,t.type,t.rarity),e.inputProvider.setOnInteract(t))},handleInteraction:(e,t)=>{wr(e,t.type,t.rarity),e.inputProvider.removeAllInteract(),t.destroy(!0),e.lootMenu.clear()},keys:{play:"",sprite:"drops"},metadata:{maxSize:45,scale:.5},scene:this.scene}),this.#W}#K;get voidGemGroup(){return this.#K??=new $r({handleCollision:(e,t)=>{e.inventory.voidGems+=1,t.destroy()},handleInteraction:void 0,keys:{play:"void-gem-float",sprite:"void-gem"},metadata:{maxSize:100,scale:.5},scene:this.scene}),this.#K}#X;get weaponPickup(){return this.#X??=new $r({handleCollision:(e,t)=>{void 0!==t.owner&&t.owner!==e||(e.lootMenu.link(t),e.lootMenu.text=t.type.slice(0,t.type.indexOf("-")),e.inputProvider.setOnInteract(t))},handleInteraction:(e,t)=>{const s=t.type.slice(0,t.type.indexOf("-")).toLowerCase();if(!(e=>"string"==typeof e&&Vr.includes(e))(s))throw new Error;e.activeWeapons.push(s),e.inputProvider.removeAllInteract(),t.destroy(!0),e.lootMenu.clear()},keys:{play:"sword-p1-pickup-float",sprite:"weapon-pickup"},metadata:{maxSize:45,scale:1},scene:this.scene}),this.#X}#H;get xpGroup(){return this.#H??=new $r({handleCollision:(e,t)=>{e.xp.curr+=1,t.destroy()},handleInteraction:void 0,keys:{play:"xp1-float",sprite:"xp"},metadata:{maxSize:100,scale:.5},scene:this.scene}),this.#H}spawn(e,t){for(const s of t){const{x:i,y:n}=Ea.get(t.length);this.#$(e.x+i,e.y+n,s)}}#$(e,t,{data:{subtype:s,type:i},owner:n}){let r=0;switch(void 0!==n&&(r=n.num+1),i){case Ta.Health:this.healthGroup.spawnGroup([{frame:"",type:"health-drop",x:e,y:t}],n);break;case Ta.XP:this.xpGroup.spawnGroup([{frame:"",type:`xp${s}`,x:e,y:t}],n);break;case Ta.VoidDrop:this.voidGemGroup.spawnGroup([{frame:"",type:"void-gem",x:e,y:t}],n);break;case Ta.StatDrop:console.log(r),this.lootGemGroup.spawnGroup([{frame:"",play:`upgrade-pickup-p${r}-float`,type:`upgrade-pickup-p${r}`,x:e,y:t}],n);break;case Ta.Weapon:if(1===n?.num&&(t+=256,e+=128),!n)throw new Error;this.weaponPickup.spawnGroup(s.map((s,i)=>({frame:"",play:`${s}-p${n.num+1}-pickup-float`,type:`${s}-p${n.num+1}-pickup`,x:e-128*i,y:t})),n),this.weaponPickup.items.forEach(e=>{e.alphaDefault=.75,e.alpha=.75})}}}class Ca extends Phaser.Plugins.BasePlugin{static key="PlayerManager";static mapping="_playerplugin";alive;constructor(e){super(e),this.alive=!0}isAlive(){return this.alive}}const Oa={key:Ca.key,mapping:Ca.mapping,plugin:Ca,start:!1};class Da extends Phaser.Plugins.ScenePlugin{constructor(e,t,s){if(super(e,t,s),this.scene=e,"Scene2"===e.constructor.name)return;if(!(e instanceof In))return;if(!Da.config){const e=t.get(Xi.key);e instanceof Xi&&(Da.config=e)}const i=e.input.keyboard;if(i){i.addKey(Phaser.Input.Keyboard.KeyCodes.H).on("up",(e,t)=>{if(!(e instanceof Phaser.Input.Keyboard.Key))throw new o;if(!(t instanceof KeyboardEvent))throw new o});const e=i.createCombo([Phaser.Input.Keyboard.KeyCodes.ALT,Phaser.Input.Keyboard.KeyCodes.H],{resetOnMatch:!0}),t=i.createCombo([Phaser.Input.Keyboard.KeyCodes.ALT,Phaser.Input.Keyboard.KeyCodes.K],{resetOnMatch:!0});i.addKey(Phaser.Input.Keyboard.KeyCodes.BACKTICK).on("up",(e,t)=>{if(!(e instanceof Phaser.Input.Keyboard.Key))throw new o;if(!(t instanceof KeyboardEvent))throw new o;if(t.altKey){const e=!this.scene.physics.world.drawDebug;if(console.log("toggling debug to",e),console.log(this.scene),!(this.scene instanceof In))return;this.scene.debugging=e,e||this.scene.physics.world.debugGraphic.clear(),this.scene.physics.world.drawDebug=e}}),i.on("keycombomatch",(s,i)=>{if(!(s instanceof Phaser.Input.Keyboard.KeyCombo))throw new o;if(!(i instanceof KeyboardEvent))throw new o;s===e&&console.log(this.scene),s===t&&console.log("combo!")})}}static key="SceneInput";static mapping="_inputPlugin";static beta=!0;static config=null;static _alpha;static get alpha(){return Da._alpha??=!1,Da._alpha}_bounds;updateMapping(){Da.config?.save({time:performance.now()})}}const Ra={key:Da.key,mapping:Da.mapping,plugin:Da,start:!1},$a=[Sa,pn,ka,xa,Dr,Cn,Rn],Ga=s.Scale.FIT,Ba={fps:{forceSetTimeOut:!0,limit:120},height:2160,input:{gamepad:!0},min:{height:480,width:720},parent:"game-container",physics:{arcade:{debug:!1,gravity:{x:0,y:0}},default:"arcade"},plugins:{global:[Oa,Hi],scene:[Ra,Yi]},scale:{autoCenter:s.Scale.CENTER_BOTH,mode:Ga},scene:$a,type:s.AUTO,width:3840};document.addEventListener("DOMContentLoaded",()=>{(()=>{if(console.log("devicePixelRatio",window.devicePixelRatio),window.__PHASER_GAME__)window.__PHASER_GAME__.scene.getScenes().forEach(e=>{e.sys.displayList.destroy(),e.sys.updateList.destroy(),e.textures.destroy(),e.sys.events.emit("destroy")});else{const e=new s.Game({...Ba,parent:"game-container"});window.__PHASER_GAME__=e}window.__PHASER_GAME__})()}),document.addEventListener("fullscreenchange",()=>{var e;"keyboard"in(e=navigator)&&null!==e.keyboard&&"object"==typeof e.keyboard&&"lock"in e.keyboard&&"function"==typeof e.keyboard.lock&&navigator.keyboard.lock(["Escape"])});
